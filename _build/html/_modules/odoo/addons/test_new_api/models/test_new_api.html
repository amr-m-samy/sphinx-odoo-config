<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>odoo.addons.test_new_api.models.test_new_api &mdash; Amr  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Amr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">odoo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Amr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../../odoo.html">odoo</a></li>
      <li class="breadcrumb-item active">odoo.addons.test_new_api.models.test_new_api</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for odoo.addons.test_new_api.models.test_new_api</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Part of Odoo. See LICENSE file for full copyright and licensing details.</span>

<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="kn">from</span> <span class="nn">odoo.tools.float_utils</span> <span class="kn">import</span> <span class="n">float_round</span>
<span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;precompute_setter&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">api</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">Command</span>
<span class="kn">from</span> <span class="nn">odoo.exceptions</span> <span class="kn">import</span> <span class="n">AccessError</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">odoo.tools.translate</span> <span class="kn">import</span> <span class="n">html_translate</span>


<div class="viewcode-block" id="Category">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Category">[docs]</a>
<span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.category&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Category&#39;</span>
    <span class="n">_order</span> <span class="o">=</span> <span class="s1">&#39;name&#39;</span>
    <span class="n">_parent_store</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">_parent_name</span> <span class="o">=</span> <span class="s1">&#39;parent&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="s1">&#39;Color Index&#39;</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.category&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">parent_path</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unaccent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_compute_depth&quot;</span><span class="p">)</span>
    <span class="n">root_categ</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="n">_name</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_root_categ&#39;</span><span class="p">)</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_display_name&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_inverse_display_name&#39;</span><span class="p">)</span>
    <span class="n">dummy</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">discussions</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.discussion&#39;</span><span class="p">,</span> <span class="s1">&#39;test_new_api_discussion_category&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;category&#39;</span><span class="p">,</span> <span class="s1">&#39;discussion&#39;</span><span class="p">)</span>

    <span class="n">_sql_constraints</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;positive_color&#39;</span><span class="p">,</span> <span class="s1">&#39;CHECK(color &gt;= 0)&#39;</span><span class="p">,</span> <span class="s1">&#39;The color code must be positive!&#39;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;parent.display_name&#39;</span><span class="p">)</span>     <span class="c1"># this definition is recursive</span>
    <span class="k">def</span> <span class="nf">_compute_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">cat</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">cat</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">display_name</span> <span class="o">+</span> <span class="s1">&#39; / &#39;</span> <span class="o">+</span> <span class="n">cat</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cat</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_root_categ</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">cat</span>
            <span class="k">while</span> <span class="n">current</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">current</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">parent</span>
            <span class="n">cat</span><span class="o">.</span><span class="n">root_categ</span> <span class="o">=</span> <span class="n">current</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;parent_path&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_depth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">cat</span><span class="o">.</span><span class="n">depth</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">parent_path</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_inverse_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">cat</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">cat</span><span class="o">.</span><span class="n">display_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
            <span class="c1"># determine sequence of categories</span>
            <span class="n">categories</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">())])</span>
                <span class="n">categories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">category</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">categories</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cat</span><span class="p">)</span>
            <span class="c1"># assign parents following sequence</span>
            <span class="k">for</span> <span class="n">parent</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="n">categories</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
                <span class="k">if</span> <span class="n">parent</span> <span class="ow">and</span> <span class="n">child</span><span class="p">:</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
            <span class="c1"># assign name of last category, and reassign display_name (to normalize it)</span>
            <span class="n">cat</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_fetch_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">fields</span><span class="p">):</span>
        <span class="c1"># DLE P45: `test_31_prefetch`,</span>
        <span class="c1"># with self.assertRaises(AccessError):</span>
        <span class="c1">#     cat1.name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_count</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ids</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;NOACCESS&#39;</span><span class="p">)]):</span>
            <span class="k">raise</span> <span class="n">AccessError</span><span class="p">(</span><span class="s1">&#39;Sorry&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_fetch_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span></div>



<div class="viewcode-block" id="Discussion">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Discussion">[docs]</a>
<span class="k">class</span> <span class="nc">Discussion</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.discussion&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Discussion&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Description of discussion.&quot;</span><span class="p">)</span>
    <span class="n">moderator</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">)</span>
    <span class="n">categories</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.category&#39;</span><span class="p">,</span>
        <span class="s1">&#39;test_new_api_discussion_category&#39;</span><span class="p">,</span> <span class="s1">&#39;discussion&#39;</span><span class="p">,</span> <span class="s1">&#39;category&#39;</span><span class="p">)</span>
    <span class="n">participants</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;active_test&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.message&#39;</span><span class="p">,</span> <span class="s1">&#39;discussion&#39;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">message_concat</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Message concatenate&#39;</span><span class="p">)</span>
    <span class="n">important_messages</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.message&#39;</span><span class="p">,</span> <span class="s1">&#39;discussion&#39;</span><span class="p">,</span>
                                         <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;important&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">very_important_messages</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s1">&#39;test_new_api.message&#39;</span><span class="p">,</span> <span class="s1">&#39;discussion&#39;</span><span class="p">,</span>
        <span class="n">domain</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain_very_important</span><span class="p">())</span>
    <span class="n">emails</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.emailmessage&#39;</span><span class="p">,</span> <span class="s1">&#39;discussion&#39;</span><span class="p">)</span>
    <span class="n">important_emails</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.emailmessage&#39;</span><span class="p">,</span> <span class="s1">&#39;discussion&#39;</span><span class="p">,</span>
                                       <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;important&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>

    <span class="n">history</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Json</span><span class="p">(</span><span class="s1">&#39;History&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;delete_messages&#39;</span><span class="p">:</span> <span class="p">[]})</span>
    <span class="n">attributes_definition</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">PropertiesDefinition</span><span class="p">(</span><span class="s1">&#39;Message Properties&#39;</span><span class="p">)</span>  <span class="c1"># see message@attributes</span>

    <span class="k">def</span> <span class="nf">_domain_very_important</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure computed O2M domains work as expected.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s2">&quot;important&quot;</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)]</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># test onchange modifying one2many field values</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;generate_dummy_message&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="si">{generate_dummy_message}</span><span class="s1">&#39;</span><span class="p">:</span>
            <span class="c1"># update body of existings messages and emails</span>
            <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
                <span class="n">message</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;not last dummy message&#39;</span>
            <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">important_messages</span><span class="p">:</span>
                <span class="n">message</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s1">&#39;not last dummy message&#39;</span>
            <span class="c1"># add new dummy message</span>
            <span class="n">message_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">_add_missing_default_values</span><span class="p">({</span><span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;dummy message&#39;</span><span class="p">,</span> <span class="s1">&#39;important&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">messages</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">message_vals</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">important_messages</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">message_vals</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;moderator&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_moderator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">participants</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moderator</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;messages&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_concat</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">:</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">body</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">])</span></div>



<div class="viewcode-block" id="Message">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Message">[docs]</a>
<span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.message&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Message&#39;</span>

    <span class="n">discussion</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.discussion&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">body</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;trigram&#39;</span><span class="p">)</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_name&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Abstract&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_display_name&#39;</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_size&#39;</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s1">&#39;_search_size&#39;</span><span class="p">)</span>
    <span class="n">double_size</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_double_size&#39;</span><span class="p">)</span>
    <span class="n">discussion_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;discussion.name&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Discussion Name&quot;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">author_partner</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span>
        <span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_author_partner&#39;</span><span class="p">,</span>
        <span class="n">search</span><span class="o">=</span><span class="s1">&#39;_search_author_partner&#39;</span><span class="p">)</span>
    <span class="n">important</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">()</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
    <span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">has_important_sibling</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_has_important_sibling&#39;</span><span class="p">)</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Properties</span><span class="p">(</span>
        <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Properties&#39;</span><span class="p">,</span>
        <span class="n">definition</span><span class="o">=</span><span class="s1">&#39;discussion.attributes_definition&#39;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;discussion.messages.important&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_has_important_sibling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">siblings</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">discussion</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">messages</span> <span class="o">-</span> <span class="n">record</span>
            <span class="n">record</span><span class="o">.</span><span class="n">has_important_sibling</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">siblings</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;important&#39;</span><span class="p">))</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;discussion&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_author</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">discussion</span> <span class="ow">and</span> <span class="n">message</span><span class="o">.</span><span class="n">author</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">message</span><span class="o">.</span><span class="n">discussion</span><span class="o">.</span><span class="n">sudo</span><span class="p">()</span><span class="o">.</span><span class="n">participants</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Author must be among the discussion participants.&quot;</span><span class="p">))</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;author.name&#39;</span><span class="p">,</span> <span class="s1">&#39;discussion.name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">message</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;compute_name&#39;</span><span class="p">,</span>
                <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">discussion</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># dummy constraint to check on computed field</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;[X]&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s2">&quot;No way!&quot;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;author.name&#39;</span><span class="p">,</span> <span class="s1">&#39;discussion.name&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">stuff</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">] </span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">discussion</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">body</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">message</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">stuff</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">message</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">body</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_search_size</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">operator</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="c1"># retrieve all the messages that match with a specific SQL query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flush_model</span><span class="p">([</span><span class="s1">&#39;body&#39;</span><span class="p">])</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;SELECT id FROM &quot;</span><span class="si">%s</span><span class="s2">&quot; WHERE char_length(&quot;body&quot;) </span><span class="si">%s</span><span class="s2"> </span><span class="si">%%</span><span class="s2">s&quot;&quot;&quot;</span> <span class="o">%</span> \
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_table</span><span class="p">,</span> <span class="n">operator</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">value</span><span class="p">,))</span>
        <span class="n">ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()]</span>
        <span class="c1"># return domain with an implicit AND</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">ids</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_double_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="c1"># This illustrates a subtle situation: message.double_size depends</span>
            <span class="c1"># on message.size. When the latter is computed, message.size is</span>
            <span class="c1"># assigned, which would normally invalidate message.double_size.</span>
            <span class="c1"># However, this may not happen while message.double_size is being</span>
            <span class="c1"># computed: the last statement below would fail, because</span>
            <span class="c1"># message.double_size would be undefined.</span>
            <span class="n">message</span><span class="o">.</span><span class="n">double_size</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">size</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">size</span>
            <span class="n">message</span><span class="o">.</span><span class="n">double_size</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">double_size</span> <span class="o">+</span> <span class="n">size</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;author.partner_id&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_author_partner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">message</span><span class="o">.</span><span class="n">author_partner</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">author</span><span class="o">.</span><span class="n">partner_id</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
    <span class="k">def</span> <span class="nf">_search_author_partner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;author.partner_id&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span>

<div class="viewcode-block" id="Message.write">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Message.write">[docs]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;priority&#39;</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="n">vals</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="EmailMessage">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.EmailMessage">[docs]</a>
<span class="k">class</span> <span class="nc">EmailMessage</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.emailmessage&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Email Message&#39;</span>
    <span class="n">_inherits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;test_new_api.message&#39;</span><span class="p">:</span> <span class="s1">&#39;message&#39;</span><span class="p">}</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.message&#39;</span><span class="p">,</span> <span class="s1">&#39;Message&#39;</span><span class="p">,</span>
                              <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">email_to</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;To&#39;</span><span class="p">)</span>
    <span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="s1">&#39;Active Message&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;message.active&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">related_sudo</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="DiscussionPartner">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.DiscussionPartner">[docs]</a>
<span class="k">class</span> <span class="nc">DiscussionPartner</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Simplified model for partners. Having a specific model avoids all the</span>
<span class="sd">    overrides from other modules that may change which fields are being read,</span>
<span class="sd">    how many queries it takes to use that model, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.partner&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Discussion Partner&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Multi">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Multi">[docs]</a>
<span class="k">class</span> <span class="nc">Multi</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Model for testing multiple onchange methods in cascade that modify a</span>
<span class="sd">        one2many field several times.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.multi&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Multi&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;partner.name&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">partner</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.multi.line&#39;</span><span class="p">,</span> <span class="s1">&#39;multi&#39;</span><span class="p">)</span>
    <span class="n">partners</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;partner.child_ids&#39;</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.multi.tag&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)])</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;partner&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_partner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;tags&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lines</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">tags</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span></div>



<div class="viewcode-block" id="MultiLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MultiLine">[docs]</a>
<span class="k">class</span> <span class="nc">MultiLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.multi.line&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Multi Line&#39;</span>

    <span class="n">multi</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.multi&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">partner</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;multi.partner&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tags</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.multi.tag&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="MultiLine2">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MultiLine2">[docs]</a>
<span class="k">class</span> <span class="nc">MultiLine2</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.multi.line2&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.multi.line&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Multi Line 2&#39;</span></div>



<div class="viewcode-block" id="MultiTag">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MultiTag">[docs]</a>
<span class="k">class</span> <span class="nc">MultiTag</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.multi.tag&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Multi Tag&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_display_name&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">depends_context</span><span class="p">(</span><span class="s1">&#39;special_tag&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;special_tag&#39;</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">+=</span> <span class="s2">&quot;!&quot;</span>
            <span class="n">record</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span></div>



<div class="viewcode-block" id="Edition">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Edition">[docs]</a>
<span class="k">class</span> <span class="nc">Edition</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.creativework.edition&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Creative Work Edition&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">res_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">res_model_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;ir.model&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">res_model</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;res_model_id.model&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="Book">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Book">[docs]</a>
<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.creativework.book&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Creative Work Book&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">editions</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s1">&#39;test_new_api.creativework.edition&#39;</span><span class="p">,</span> <span class="s1">&#39;res_id&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;res_model&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">_name</span><span class="p">)]</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="Movie">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Movie">[docs]</a>
<span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.creativework.movie&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Creative Work Movie&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">editions</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s1">&#39;test_new_api.creativework.edition&#39;</span><span class="p">,</span> <span class="s1">&#39;res_id&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;res_model&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">_name</span><span class="p">)]</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="MixedModel">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MixedModel">[docs]</a>
<span class="k">class</span> <span class="nc">MixedModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.mixed&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Mixed&#39;</span>

    <span class="n">number</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">default</span><span class="o">=</span><span class="mf">3.14</span><span class="p">)</span>
    <span class="n">number2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="s1">&#39;New API Precision&#39;</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">()</span>
    <span class="n">moment</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="p">()</span>
    <span class="n">now</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_now&#39;</span><span class="p">)</span>
    <span class="n">lang</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Language&#39;</span><span class="p">,</span> <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;_get_lang&#39;</span><span class="p">)</span>
    <span class="n">reference</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Reference</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Related Document&#39;</span><span class="p">,</span>
        <span class="n">selection</span><span class="o">=</span><span class="s1">&#39;_reference_models&#39;</span><span class="p">)</span>
    <span class="n">comment1</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="n">sanitize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">comment2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="n">sanitize_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strip_classes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">comment3</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="n">sanitize_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strip_classes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">comment4</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="n">sanitize_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strip_style</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">comment5</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="n">sanitize_overridable</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sanitize_attributes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">currency_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.currency&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.EUR&#39;</span><span class="p">))</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Monetary</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_compute_now</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># this is a non-stored computed field without dependencies</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">message</span><span class="o">.</span><span class="n">now</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
    <span class="k">def</span> <span class="nf">_get_lang</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_installed</span><span class="p">()</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">model</span>
    <span class="k">def</span> <span class="nf">_reference_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">models</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sudo</span><span class="p">()</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;manual&#39;</span><span class="p">)])</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;ir.&#39;</span><span class="p">)]</span></div>



<div class="viewcode-block" id="BoolModel">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.BoolModel">[docs]</a>
<span class="k">class</span> <span class="nc">BoolModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;domain.bool&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Boolean Domain&#39;</span>

    <span class="n">bool_true</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="s1">&#39;b1&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bool_false</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="s1">&#39;b2&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">bool_undefined</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="s1">&#39;b3&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Foo">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Foo">[docs]</a>
<span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.foo&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Foo&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">value1</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">change_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">value2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">trim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="Bar">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Bar">[docs]</a>
<span class="k">class</span> <span class="nc">Bar</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.bar&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Bar&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.foo&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_foo&#39;</span><span class="p">,</span> <span class="n">search</span><span class="o">=</span><span class="s1">&#39;_search_foo&#39;</span><span class="p">)</span>
    <span class="n">value1</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;foo.value1&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">value2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;foo.value2&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">text1</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Text1&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;foo.text&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">text2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Text2&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;foo.text&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">trim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">bar</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">bar</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;test_new_api.foo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">bar</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_search_foo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">operator</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span>
        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;test_new_api.foo&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">records</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))]</span></div>



<div class="viewcode-block" id="Related">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Related">[docs]</a>
<span class="k">class</span> <span class="nc">Related</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.related&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Related&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="c1"># related fields with a single field</span>
    <span class="n">related_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;A related on Name&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">related_related_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;related_name&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;A related on a related on Name&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">message</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.message&#39;</span><span class="p">)</span>
    <span class="n">message_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s2">&quot;message.body&quot;</span><span class="p">,</span> <span class="n">related_sudo</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Message Body&#39;</span><span class="p">)</span>
    <span class="n">message_currency</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s2">&quot;message.author&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Message Author&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ComputeReadonly">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeReadonly">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeReadonly</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute.readonly&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model with a computed readonly field&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bar&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span></div>



<div class="viewcode-block" id="ComputeInverse">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeInverse">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeInverse</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute.inverse&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model with a computed inversed field&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bar&#39;</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_inverse_bar&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">baz</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;compute&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span>

    <span class="k">def</span> <span class="nf">_inverse_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;inverse&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">bar</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">constrains</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log_constraint&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;constraint&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="MultiComputeInverse">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MultiComputeInverse">[docs]</a>
<span class="k">class</span> <span class="nc">MultiComputeInverse</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Model with the same inverse method for several fields. &quot;&quot;&quot;</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.multi_compute_inverse&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Multi Compute Inverse&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bar1</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bars&#39;</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_inverse_bar1&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bar2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bars&#39;</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_inverse_bar23&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bar3</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bars&#39;</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_inverse_bar23&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;compute&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">substrs</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]</span>
            <span class="n">record</span><span class="o">.</span><span class="n">bar1</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">bar2</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">bar3</span> <span class="o">=</span> <span class="n">substrs</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_inverse_bar1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;inverse1&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">record</span><span class="o">.</span><span class="n">bar1</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">bar2</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">bar3</span><span class="p">])})</span>

    <span class="k">def</span> <span class="nf">_inverse_bar23</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_context</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;inverse23&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">record</span><span class="o">.</span><span class="n">bar1</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">bar2</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">bar3</span><span class="p">])})</span></div>



<div class="viewcode-block" id="Move">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Move">[docs]</a>
<span class="k">class</span> <span class="nc">Move</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.move&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Move&#39;</span>

    <span class="n">line_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.move_line&#39;</span><span class="p">,</span> <span class="s1">&#39;move_id&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;visible&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_quantity&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tag_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.multi.tag&#39;</span><span class="p">)</span>
    <span class="n">tag_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;tag_id.name&#39;</span><span class="p">)</span>
    <span class="n">tag_repeat</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
    <span class="n">tag_string</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_tag_string&#39;</span><span class="p">)</span>

    <span class="c1"># This field can fool the ORM during onchanges!  When editing a payment</span>
    <span class="c1"># record, modified fields are assigned to the parent record.  When</span>
    <span class="c1"># determining the dependent records, the ORM looks for the payments related</span>
    <span class="c1"># to this record by the field `move_id`.  As this field is an inverse of</span>
    <span class="c1"># `move_id`, it uses it.  If that field was not initialized properly, the</span>
    <span class="c1"># ORM determines its value to be... empty (instead of the payment record.)</span>
    <span class="n">payment_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.payment&#39;</span><span class="p">,</span> <span class="s1">&#39;move_id&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;line_ids.quantity&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">quantity</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">quantity</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">line_ids</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;tag_name&#39;</span><span class="p">,</span> <span class="s1">&#39;tag_repeat&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_tag_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">tag_string</span> <span class="o">=</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">tag_name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">record</span><span class="o">.</span><span class="n">tag_repeat</span></div>



<div class="viewcode-block" id="MoveLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MoveLine">[docs]</a>
<span class="k">class</span> <span class="nc">MoveLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.move_line&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Move Line&#39;</span>

    <span class="n">move_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.move&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">visible</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span></div>



<div class="viewcode-block" id="Payment">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Payment">[docs]</a>
<span class="k">class</span> <span class="nc">Payment</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.payment&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Payment inherits from Move&#39;</span>
    <span class="n">_inherits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;test_new_api.move&#39;</span><span class="p">:</span> <span class="s1">&#39;move_id&#39;</span><span class="p">}</span>

    <span class="n">move_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.move&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Order">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Order">[docs]</a>
<span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.order&#39;</span>

    <span class="n">line_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.order.line&#39;</span><span class="p">,</span> <span class="s1">&#39;order_id&#39;</span><span class="p">)</span>
    <span class="n">line_short_field_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="OrderLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.OrderLine">[docs]</a>
<span class="k">class</span> <span class="nc">OrderLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.order.line&#39;</span>

    <span class="n">order_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.order&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">product</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">()</span>
    <span class="n">short_field_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">very_very_very_very_very_long_field_name_1</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">very_very_very_very_very_long_field_name_2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">has_been_rewarded</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_has_been_rewarded&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;reward&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_has_been_rewarded</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">reward</span><span class="p">:</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">has_been_rewarded</span> <span class="o">=</span> <span class="s1">&#39;Yes&#39;</span>

<div class="viewcode-block" id="OrderLine.unlink">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.OrderLine.unlink">[docs]</a>
    <span class="k">def</span> <span class="nf">unlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># also delete associated reward lines</span>
        <span class="n">reward_lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">other_line</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">reward</span>
            <span class="k">for</span> <span class="n">other_line</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">order_id</span><span class="o">.</span><span class="n">line_ids</span>
            <span class="k">if</span> <span class="n">other_line</span><span class="o">.</span><span class="n">reward</span> <span class="ow">and</span> <span class="n">other_line</span><span class="o">.</span><span class="n">product</span> <span class="o">==</span> <span class="n">line</span><span class="o">.</span><span class="n">product</span>
        <span class="p">]</span>
        <span class="bp">self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="o">*</span><span class="n">reward_lines</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="CompanyDependent">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.CompanyDependent">[docs]</a>
<span class="k">class</span> <span class="nc">CompanyDependent</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.company&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Company&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">moment</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="p">(</span><span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">tag_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.multi.tag&#39;</span><span class="p">,</span> <span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">truth</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">html1</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sanitize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">html2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="n">company_dependent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sanitize_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strip_classes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">strip_style</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="CompanyDependentAttribute">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.CompanyDependentAttribute">[docs]</a>
<span class="k">class</span> <span class="nc">CompanyDependentAttribute</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.company.attr&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Company Attribute&#39;</span>

    <span class="n">company</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.company&#39;</span><span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bar&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;company.foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">foo</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">record</span><span class="o">.</span><span class="n">quantity</span></div>



<div class="viewcode-block" id="ComputeRecursive">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeRecursive">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeRecursive</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.recursive&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Recursive&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parent</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.recursive&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">full_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_full_name&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_display_name&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">context_dependent_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_context_dependent_name&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;parent.full_name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">full_name</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">full_name</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">full_name</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;parent.display_name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">display_name</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span>

    <span class="c1"># This field is recursive, non-stored and context-dependent. Its purpose is</span>
    <span class="c1"># to reproduce a bug in modified(), which might not detect that the field</span>
    <span class="c1"># is present in cache if it has values in another context.</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">depends_context</span><span class="p">(</span><span class="s1">&#39;bozo&#39;</span><span class="p">)</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;parent.context_dependent_name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_context_dependent_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">parent</span><span class="p">:</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">context_dependent_name</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">context_dependent_name</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rec</span><span class="o">.</span><span class="n">context_dependent_name</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">name</span></div>



<div class="viewcode-block" id="ComputeRecursiveTree">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeRecursiveTree">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeRecursiveTree</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.recursive.tree&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Recursive with one2many field&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.recursive.tree&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">children_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.recursive.tree&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">)</span>
    <span class="n">display_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_display_name&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;children_ids.display_name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">children_names</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;children_ids.display_name&#39;</span><span class="p">)</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">children_names</span><span class="p">))</span></div>



<div class="viewcode-block" id="ComputeRecursiveOrder">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeRecursiveOrder">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeRecursiveOrder</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.recursive.order&#39;</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span></div>



<div class="viewcode-block" id="ComputeRecursiveLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeRecursiveLine">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeRecursiveLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.recursive.line&#39;</span>

    <span class="n">order_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.recursive.order&#39;</span><span class="p">)</span>
    <span class="n">task_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.recursive.task&#39;</span><span class="p">,</span> <span class="s1">&#39;line_id&#39;</span><span class="p">)</span>
    <span class="n">task_number</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_task_number&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># line.task_number indirectly depends on recursive field task.line_id, and</span>
    <span class="c1"># is triggered by the recursion in modified() on field task.line_id</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;task_ids&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_task_number</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">task_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">task_ids</span><span class="p">)</span></div>



<div class="viewcode-block" id="ComputeRecursiveTask">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeRecursiveTask">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeRecursiveTask</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.recursive.task&#39;</span>

    <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
    <span class="n">line_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.recursive.line&#39;</span><span class="p">,</span>
                              <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_line_id&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># the recursive nature of task.line_id is a bit artificial, but it makes</span>
    <span class="c1"># line.task_number be triggered by a recursive call in modified()</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;line_id.order_id.value&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_line_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># this assignment forces the new value of record.line_id to be dirty in cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_id</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">domain</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;order_id.value&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">value</span><span class="p">)]</span>
            <span class="n">record</span><span class="o">.</span><span class="n">line_id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">line_id</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id desc&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>



<div class="viewcode-block" id="ComputeCascade">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeCascade">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeCascade</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.cascade&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test New API Cascade&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bar&#39;</span><span class="p">)</span>               <span class="c1"># depends on foo</span>
    <span class="n">baz</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_baz&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>   <span class="c1"># depends on bar</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">foo</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_baz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">baz</span> <span class="o">=</span> <span class="s2">&quot;&lt;</span><span class="si">%s</span><span class="s2">&gt;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">bar</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ComputeReadWrite">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeReadWrite">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeReadWrite</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute.readwrite&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model with a computed non-readonly field&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bar&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span></div>



<div class="viewcode-block" id="ComputeOnchange">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeOnchange">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeOnchange</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute.onchange&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Compute method as an onchange&quot;</span>

    <span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">()</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bar&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">baz</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_baz&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">line_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s1">&#39;test_new_api.compute.onchange.line&#39;</span><span class="p">,</span> <span class="s1">&#39;record_id&#39;</span><span class="p">,</span>
        <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_line_ids&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">tag_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span>
        <span class="s1">&#39;test_new_api.multi.tag&#39;</span><span class="p">,</span>
        <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_tag_ids&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_foo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">foo</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;r&quot;</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_baz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
                <span class="n">record</span><span class="o">.</span><span class="n">baz</span> <span class="o">=</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">foo</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;z&quot;</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_line_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">foo</span> <span class="o">==</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">line_ids</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="c1"># add a line with the same value as &#39;foo&#39;</span>
            <span class="n">record</span><span class="o">.</span><span class="n">line_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">Command</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span><span class="p">})]</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_tag_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;test_new_api.multi.tag&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span><span class="p">:</span>
                <span class="n">record</span><span class="o">.</span><span class="n">tag_ids</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span><span class="p">)])</span>

<div class="viewcode-block" id="ComputeOnchange.copy">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeOnchange.copy">[docs]</a>
    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">default</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">default</span> <span class="ow">or</span> <span class="p">{},</span> <span class="n">foo</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (copy)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">foo</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">default</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ComputeOnchangeLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeOnchangeLine">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeOnchangeLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute.onchange.line&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Line-like model for test_new_api.compute.onchange&quot;</span>

    <span class="n">record_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.compute.onchange&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bar&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">foo</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;r&quot;</span></div>



<div class="viewcode-block" id="ComputeDynamicDepends">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeDynamicDepends">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeDynamicDepends</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute.dynamic.depends&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Computed field with dynamic dependencies&quot;</span>

    <span class="n">name1</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">name2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">name3</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">full_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_full_name&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_full_name_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># the fields to use are stored in a config parameter</span>
        <span class="n">depends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.config_parameter&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_param</span><span class="p">(</span><span class="s1">&#39;test_new_api.full_name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">depends</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">depends</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_full_name_fields</span><span class="p">())</span>
    <span class="k">def</span> <span class="nf">_compute_full_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_full_name_fields</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">full_name</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="n">fname</span><span class="p">]</span> <span class="k">for</span> <span class="n">fname</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">)))</span></div>



<div class="viewcode-block" id="ComputeUnassigned">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeUnassigned">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeUnassigned</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute.unassigned&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with computed fields left unassigned&quot;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bar&#39;</span><span class="p">)</span>
    <span class="n">bare</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bare&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">bars</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bars&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bares</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bares&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span> <span class="o">==</span> <span class="s2">&quot;assign&quot;</span><span class="p">:</span>
                <span class="n">record</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span> <span class="o">==</span> <span class="s2">&quot;assign&quot;</span><span class="p">:</span>
                <span class="n">record</span><span class="o">.</span><span class="n">bare</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span> <span class="o">==</span> <span class="s2">&quot;assign&quot;</span><span class="p">:</span>
                <span class="n">record</span><span class="o">.</span><span class="n">bars</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bares</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span> <span class="o">==</span> <span class="s2">&quot;assign&quot;</span><span class="p">:</span>
                <span class="n">record</span><span class="o">.</span><span class="n">bares</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">foo</span></div>



<div class="viewcode-block" id="ComputeOne2many">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeOne2many">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeOne2many</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.one2many&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;A computed editable one2many field with a domain&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">line_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s1">&#39;test_new_api.one2many.line&#39;</span><span class="p">,</span> <span class="s1">&#39;container_id&#39;</span><span class="p">,</span>
        <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_line_ids&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
    <span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_line_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># increment counter of line with the same name, or create a new line</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">line_ids</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">record</span><span class="o">.</span><span class="n">line_ids</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">})]</span></div>



<div class="viewcode-block" id="ComputeOne2manyLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeOne2manyLine">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeOne2manyLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.one2many.line&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Line of a computed one2many&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">container_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.one2many&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="ModelBinary">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelBinary">[docs]</a>
<span class="k">class</span> <span class="nc">ModelBinary</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_binary&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test Image field&#39;</span>

    <span class="n">binary</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">()</span>
    <span class="n">binary_related_store</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="s2">&quot;Binary Related Store&quot;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">binary_related_no_store</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="s2">&quot;Binary Related No Store&quot;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">binary_computed</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_binary&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;binary&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># arbitrary value: &#39;bin_size&#39; must have no effect</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">binary_computed</span> <span class="o">=</span> <span class="p">[(</span><span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">binary</span><span class="p">))]</span></div>



<div class="viewcode-block" id="ModelImage">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelImage">[docs]</a>
<span class="k">class</span> <span class="nc">ModelImage</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_image&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test Image field&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Image</span><span class="p">()</span>
    <span class="n">image_512</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s2">&quot;Image 512&quot;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">max_height</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">image_256</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s2">&quot;Image 256&quot;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">max_height</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">image_128</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s2">&quot;Image 128&quot;</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">max_height</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
    <span class="n">image_64</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span><span class="s2">&quot;Image 64&quot;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="n">max_width</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">max_height</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attachment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="BinarySvg">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.BinarySvg">[docs]</a>
<span class="k">class</span> <span class="nc">BinarySvg</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.binary_svg&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test SVG upload&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">image_attachment</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">attachment</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">image_wo_attachment</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span><span class="n">attachment</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">image_wo_attachment_related</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Binary</span><span class="p">(</span>
        <span class="s2">&quot;image wo attachment&quot;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s2">&quot;image_wo_attachment&quot;</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">attachment</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="MonetaryBase">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MonetaryBase">[docs]</a>
<span class="k">class</span> <span class="nc">MonetaryBase</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.monetary_base&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Monetary Base&#39;</span>

    <span class="n">base_currency_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.currency&#39;</span><span class="p">)</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Monetary</span><span class="p">(</span><span class="n">currency_field</span><span class="o">=</span><span class="s1">&#39;base_currency_id&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="MonetaryRelated">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MonetaryRelated">[docs]</a>
<span class="k">class</span> <span class="nc">MonetaryRelated</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.monetary_related&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Monetary Related&#39;</span>

    <span class="n">monetary_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.monetary_base&#39;</span><span class="p">)</span>
    <span class="n">currency_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.currency&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;monetary_id.base_currency_id&#39;</span><span class="p">)</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Monetary</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;monetary_id.amount&#39;</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Monetary</span><span class="p">()</span></div>



<div class="viewcode-block" id="MonetaryCustom">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MonetaryCustom">[docs]</a>
<span class="k">class</span> <span class="nc">MonetaryCustom</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.monetary_custom&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Monetary Related Custom&#39;</span>

    <span class="n">monetary_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.monetary_base&#39;</span><span class="p">)</span>
    <span class="n">x_currency_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.currency&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;monetary_id.base_currency_id&#39;</span><span class="p">)</span>
    <span class="n">x_amount</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Monetary</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;monetary_id.amount&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="MonetaryInherits">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MonetaryInherits">[docs]</a>
<span class="k">class</span> <span class="nc">MonetaryInherits</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.monetary_inherits&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Monetary Inherits&#39;</span>
    <span class="n">_inherits</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;test_new_api.monetary_base&#39;</span><span class="p">:</span> <span class="s1">&#39;monetary_id&#39;</span><span class="p">}</span>

    <span class="n">monetary_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.monetary_base&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">currency_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.currency&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="MonetaryOrder">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MonetaryOrder">[docs]</a>
<span class="k">class</span> <span class="nc">MonetaryOrder</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.monetary_order&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Sales Order&#39;</span>

    <span class="n">currency_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.currency&#39;</span><span class="p">)</span>
    <span class="n">line_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.monetary_order_line&#39;</span><span class="p">,</span> <span class="s1">&#39;order_id&#39;</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Monetary</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_total&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;line_ids.subtotal&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">subtotal</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">line_ids</span><span class="p">)</span></div>



<div class="viewcode-block" id="MonetaryOrderLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.MonetaryOrderLine">[docs]</a>
<span class="k">class</span> <span class="nc">MonetaryOrderLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.monetary_order_line&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Sales Order Line&#39;</span>

    <span class="n">order_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.monetary_order&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">subtotal</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span></div>



<div class="viewcode-block" id="FieldWithCaps">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.FieldWithCaps">[docs]</a>
<span class="k">class</span> <span class="nc">FieldWithCaps</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.field_with_caps&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model with field defined with capital letters&#39;</span>

    <span class="n">pArTneR_321_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Selection">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Selection">[docs]</a>
<span class="k">class</span> <span class="nc">Selection</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.selection&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Selection&quot;</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;Foo&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;Bar&#39;</span><span class="p">)])</span>
    <span class="n">other</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;Foo&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;Bar&#39;</span><span class="p">)])</span></div>



<div class="viewcode-block" id="RequiredM2O">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.RequiredM2O">[docs]</a>
<span class="k">class</span> <span class="nc">RequiredM2O</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.req_m2o&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Required Many2one&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.currency&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.country&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="RequiredM2OTransient">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.RequiredM2OTransient">[docs]</a>
<span class="k">class</span> <span class="nc">RequiredM2OTransient</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TransientModel</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.req_m2o_transient&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Transient Model with Required Many2one&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.currency&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;restrict&#39;</span><span class="p">)</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.country&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="TestTransient">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.TestTransient">[docs]</a>
<span class="k">class</span> <span class="nc">TestTransient</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">TransientModel</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.transient_model&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Transient Model&#39;</span></div>



<div class="viewcode-block" id="Attachment">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Attachment">[docs]</a>
<span class="k">class</span> <span class="nc">Attachment</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.attachment&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Attachment&#39;</span>

    <span class="n">res_model</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">res_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_name&#39;</span><span class="p">,</span> <span class="n">compute_sudo</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;res_model&#39;</span><span class="p">,</span> <span class="s1">&#39;res_id&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="n">rec</span><span class="o">.</span><span class="n">res_model</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">res_id</span><span class="p">)</span><span class="o">.</span><span class="n">display_name</span>

    <span class="c1"># DLE P55: `test_cache_invalidation`</span>
<div class="viewcode-block" id="Attachment.modified">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Attachment.modified">[docs]</a>
    <span class="k">def</span> <span class="nf">modified</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fnames</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">comodel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">res_model</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;res_id&#39;</span> <span class="ow">in</span> <span class="n">fnames</span> <span class="ow">and</span> <span class="s1">&#39;attachment_ids&#39;</span> <span class="ow">in</span> <span class="n">comodel</span><span class="p">:</span>
            <span class="n">record</span> <span class="o">=</span> <span class="n">comodel</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res_id</span><span class="p">)</span>
            <span class="n">record</span><span class="o">.</span><span class="n">invalidate_recordset</span><span class="p">([</span><span class="s1">&#39;attachment_ids&#39;</span><span class="p">])</span>
            <span class="n">record</span><span class="o">.</span><span class="n">modified</span><span class="p">([</span><span class="s1">&#39;attachment_ids&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Attachment</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">modified</span><span class="p">(</span><span class="n">fnames</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="AttachmentHost">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.AttachmentHost">[docs]</a>
<span class="k">class</span> <span class="nc">AttachmentHost</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.attachment.host&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Attachment Host&#39;</span>

    <span class="n">attachment_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s1">&#39;test_new_api.attachment&#39;</span><span class="p">,</span> <span class="s1">&#39;res_id&#39;</span><span class="p">,</span> <span class="n">auto_join</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">domain</span><span class="o">=</span><span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;res_model&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)],</span>
    <span class="p">)</span></div>


<div class="viewcode-block" id="DecimalPrecisionTestModel">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.DecimalPrecisionTestModel">[docs]</a>
<span class="k">class</span> <span class="nc">DecimalPrecisionTestModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;decimal.precision.test&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Decimal Precision Test&#39;</span>

    <span class="nb">float</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">()</span>
    <span class="n">float_2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">float_4</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span></div>



<div class="viewcode-block" id="ModelA">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelA">[docs]</a>
<span class="k">class</span> <span class="nc">ModelA</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_a&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model A&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">a_restricted_b_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_b&#39;</span><span class="p">,</span> <span class="n">relation</span><span class="o">=</span><span class="s1">&#39;rel_model_a_model_b_1&#39;</span><span class="p">)</span>
    <span class="n">b_restricted_b_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_b&#39;</span><span class="p">,</span> <span class="n">relation</span><span class="o">=</span><span class="s1">&#39;rel_model_a_model_b_2&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;restrict&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ModelB">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelB">[docs]</a>
<span class="k">class</span> <span class="nc">ModelB</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_b&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model B&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">a_restricted_a_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_a&#39;</span><span class="p">,</span> <span class="n">relation</span><span class="o">=</span><span class="s1">&#39;rel_model_a_model_b_1&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;restrict&#39;</span><span class="p">)</span>
    <span class="n">b_restricted_a_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_a&#39;</span><span class="p">,</span> <span class="n">relation</span><span class="o">=</span><span class="s1">&#39;rel_model_a_model_b_2&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ModelParent">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelParent">[docs]</a>
<span class="k">class</span> <span class="nc">ModelParent</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_parent&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model Multicompany parent&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.company&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ModelChild">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelChild">[docs]</a>
<span class="k">class</span> <span class="nc">ModelChild</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_child&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model Multicompany child&#39;</span>
    <span class="n">_check_company_auto</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.company&#39;</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_parent&#39;</span><span class="p">,</span> <span class="n">check_company</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="ModelChildNoCheck">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelChildNoCheck">[docs]</a>
<span class="k">class</span> <span class="nc">ModelChildNoCheck</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_child_nocheck&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model Multicompany child&#39;</span>
    <span class="n">_check_company_auto</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">company_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.company&#39;</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_parent&#39;</span><span class="p">,</span> <span class="n">check_company</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<span class="c1"># model with explicit and stored field &#39;display_name&#39;</span>
<div class="viewcode-block" id="Display">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Display">[docs]</a>
<span class="k">class</span> <span class="nc">Display</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.display&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model that overrides display_name&#39;</span>

    <span class="n">display_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_display_name&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_compute_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">display_name</span> <span class="o">=</span> <span class="s1">&#39;My id is </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>



<span class="c1"># abstract model with automatic and non-stored field &#39;display_name&#39;</span>
<div class="viewcode-block" id="Mixin">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Mixin">[docs]</a>
<span class="k">class</span> <span class="nc">Mixin</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">AbstractModel</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.mixin&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Dummy mixin model&#39;</span></div>



<span class="c1"># in this model extension, the field &#39;display_name&#39; should not be inherited from</span>
<span class="c1"># &#39;test_new_api.mixin&#39;</span>
<div class="viewcode-block" id="ExtendedDisplay">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ExtendedDisplay">[docs]</a>
<span class="k">class</span> <span class="nc">ExtendedDisplay</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.display&#39;</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;test_new_api.mixin&#39;</span><span class="p">,</span> <span class="s1">&#39;test_new_api.display&#39;</span><span class="p">]</span></div>



<div class="viewcode-block" id="ModelActiveField">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelActiveField">[docs]</a>
<span class="k">class</span> <span class="nc">ModelActiveField</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_active_field&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;A model with active field&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_active_field&#39;</span><span class="p">)</span>
    <span class="n">children_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_active_field&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">)</span>
    <span class="n">all_children_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_active_field&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span>
                                       <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;active_test&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
    <span class="n">active_children_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_active_field&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span>
                                          <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;active_test&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
    <span class="n">parent_active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s1">&#39;Active Parent&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;parent_id.active&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="ModelMany2oneReference">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelMany2oneReference">[docs]</a>
<span class="k">class</span> <span class="nc">ModelMany2oneReference</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_many2one_reference&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;dummy m2oref model&#39;</span>

    <span class="n">res_model</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Resource Model&#39;</span><span class="p">)</span>
    <span class="n">res_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2oneReference</span><span class="p">(</span><span class="s1">&#39;Resource ID&#39;</span><span class="p">,</span> <span class="n">model_field</span><span class="o">=</span><span class="s1">&#39;res_model&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="InverseM2oRef">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.InverseM2oRef">[docs]</a>
<span class="k">class</span> <span class="nc">InverseM2oRef</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.inverse_m2o_ref&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;dummy m2oref inverse model&#39;</span>

    <span class="n">model_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_many2one_reference&#39;</span><span class="p">,</span> <span class="s1">&#39;res_id&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Models&quot;</span><span class="p">)</span>
    <span class="n">model_ids_count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_model_ids_count&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;model_ids&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_model_ids_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">model_ids_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">model_ids</span><span class="p">)</span></div>



<div class="viewcode-block" id="ModelChildM2o">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelChildM2o">[docs]</a>
<span class="k">class</span> <span class="nc">ModelChildM2o</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_child_m2o&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;dummy model with override write and ValidationError&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_parent_m2o&#39;</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">size1</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_sizes&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">size2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_sizes&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_cost&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;parent_id.name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_sizes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">size1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">record</span><span class="o">.</span><span class="n">size2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="ModelChildM2o.write">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelChildM2o.write">[docs]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="n">res</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ModelChildM2o</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="s1">&#39;the first existing child should not be changed when adding a new child to the parent&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>
</div>



<div class="viewcode-block" id="ModelParentM2o">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelParentM2o">[docs]</a>
<span class="k">class</span> <span class="nc">ModelParentM2o</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_parent_m2o&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;dummy model with multiple childs&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="n">child_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_child_m2o&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Children&quot;</span><span class="p">)</span>
    <span class="n">cost</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_cost&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;child_ids.cost&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">cost</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">cost</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">record</span><span class="o">.</span><span class="n">child_ids</span><span class="p">)</span></div>



<div class="viewcode-block" id="Country">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Country">[docs]</a>
<span class="k">class</span> <span class="nc">Country</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.country&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Country, ordered by name&#39;</span>
    <span class="n">_order</span> <span class="o">=</span> <span class="s1">&#39;name, id&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span></div>



<div class="viewcode-block" id="City">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.City">[docs]</a>
<span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.city&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;City, ordered by country then name&#39;</span>
    <span class="n">_order</span> <span class="o">=</span> <span class="s1">&#39;country_id, name, id&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">country_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.country&#39;</span><span class="p">)</span></div>


<span class="c1"># abstract model with a selection field</span>
<div class="viewcode-block" id="StateMixin">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.StateMixin">[docs]</a>
<span class="k">class</span> <span class="nc">StateMixin</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">AbstractModel</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.state_mixin&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Dummy state mixin model&#39;</span>

    <span class="n">state</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;draft&#39;</span><span class="p">,</span> <span class="s1">&#39;Draft&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;confirmed&#39;</span><span class="p">,</span> <span class="s1">&#39;Confirmed&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">,</span> <span class="s1">&#39;Done&#39;</span><span class="p">),</span>
    <span class="p">])</span></div>



<div class="viewcode-block" id="SelectionBase">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionBase">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionBase</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_base&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with a base selection field&quot;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s2">&quot;Foo&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s2">&quot;Bar&quot;</span><span class="p">),</span>
    <span class="p">])</span></div>



<div class="viewcode-block" id="SelectionBaseNullExplicit">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionBaseNullExplicit">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionBaseNullExplicit</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_base&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with a selection field extension with ondelete null&quot;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection_add</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;quux&#39;</span><span class="p">,</span> <span class="s2">&quot;Quux&quot;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">ondelete</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;quux&#39;</span><span class="p">:</span> <span class="s1">&#39;set null&#39;</span><span class="p">})</span></div>



<div class="viewcode-block" id="SelectionBaseNullImplicit">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionBaseNullImplicit">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionBaseNullImplicit</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_base&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with a selection field extension without ondelete&quot;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection_add</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;ham&#39;</span><span class="p">,</span> <span class="s2">&quot;Ham&quot;</span><span class="p">),</span>
    <span class="p">])</span></div>



<div class="viewcode-block" id="SelectionRelated">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRelated">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionRelated</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_related&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with a related selection field&quot;</span>

    <span class="n">selection_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span>
        <span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;test_new_api.model_selection_base&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">related_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span>
        <span class="n">related</span><span class="o">=</span><span class="s1">&#39;selection_id.my_selection&#39;</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="SelectionRelatedUpdatable">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRelatedUpdatable">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionRelatedUpdatable</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_related_updatable&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with an updatable related selection field&quot;</span>

    <span class="n">selection_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span>
        <span class="n">comodel_name</span><span class="o">=</span><span class="s1">&#39;test_new_api.model_selection_base&#39;</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">related_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span>
        <span class="n">related</span><span class="o">=</span><span class="s1">&#39;selection_id.my_selection&#39;</span><span class="p">,</span>
        <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span></div>



<div class="viewcode-block" id="SelectionRequired">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRequired">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionRequired</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_required&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with a required selection field&quot;</span>

    <span class="n">active</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Boolean</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s2">&quot;Foo&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s2">&quot;Bar&quot;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="SelectionRequiredDefault">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRequiredDefault">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionRequiredDefault</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_required&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with a selection field extension with ondelete default&quot;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection_add</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s2">&quot;Baz&quot;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">ondelete</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;baz&#39;</span><span class="p">:</span> <span class="s1">&#39;set default&#39;</span><span class="p">})</span></div>



<div class="viewcode-block" id="SelectionRequiredCascade">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRequiredCascade">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionRequiredCascade</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_required&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with a selection field extension with ondelete cascade&quot;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection_add</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;eggs&#39;</span><span class="p">,</span> <span class="s2">&quot;Eggs&quot;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">ondelete</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;eggs&#39;</span><span class="p">:</span> <span class="s1">&#39;cascade&#39;</span><span class="p">})</span></div>



<div class="viewcode-block" id="SelectionRequiredLiteral">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRequiredLiteral">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionRequiredLiteral</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_required&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with a selection field extension with ondelete set &lt;option&gt;&quot;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection_add</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;bacon&#39;</span><span class="p">,</span> <span class="s2">&quot;Bacon&quot;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">ondelete</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;bacon&#39;</span><span class="p">:</span> <span class="s1">&#39;set bar&#39;</span><span class="p">})</span></div>



<div class="viewcode-block" id="SelectionRequiredMultiple">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRequiredMultiple">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionRequiredMultiple</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_required&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with a selection field extension with multiple ondelete policies&quot;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection_add</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;pikachu&#39;</span><span class="p">,</span> <span class="s2">&quot;Pikachu&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;eevee&#39;</span><span class="p">,</span> <span class="s2">&quot;Eevee&quot;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">ondelete</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;pikachu&#39;</span><span class="p">:</span> <span class="s1">&#39;set default&#39;</span><span class="p">,</span> <span class="s1">&#39;eevee&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;my_selection&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">})})</span></div>



<div class="viewcode-block" id="SelectionRequiredCallback">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRequiredCallback">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionRequiredCallback</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_required&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with a selection field extension with ondelete callback&quot;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection_add</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;knickers&#39;</span><span class="p">,</span> <span class="s2">&quot;Oh la la&quot;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">ondelete</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;knickers&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">recs</span><span class="p">:</span> <span class="n">recs</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;my_selection&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">}),</span>
    <span class="p">})</span></div>



<div class="viewcode-block" id="SelectionNonStored">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionNonStored">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionNonStored</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_non_stored&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with non-stored selection field&quot;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s2">&quot;Foo&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s2">&quot;Bar&quot;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="SelectionRequiredForWriteOverride">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRequiredForWriteOverride">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionRequiredForWriteOverride</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_required_for_write_override&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Model with required selection field for an extension with write override&quot;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s2">&quot;Foo&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s2">&quot;Bar&quot;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="SelectionRequiredWithWriteOverride">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRequiredWithWriteOverride">[docs]</a>
<span class="k">class</span> <span class="nc">SelectionRequiredWithWriteOverride</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_inherit</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_selection_required_for_write_override&#39;</span>

    <span class="n">my_selection</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">(</span><span class="n">selection_add</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;divinity&#39;</span><span class="p">,</span> <span class="s2">&quot;Divinity: Original Sin 2&quot;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">ondelete</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;divinity&#39;</span><span class="p">:</span> <span class="s1">&#39;set default&#39;</span><span class="p">})</span>

<div class="viewcode-block" id="SelectionRequiredWithWriteOverride.write">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SelectionRequiredWithWriteOverride.write">[docs]</a>
    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vals</span><span class="p">):</span>
        <span class="k">if</span> <span class="s1">&#39;my_selection&#39;</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No... no no no&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span></div>
</div>



<span class="c1"># Special classes to ensure the correct usage of a shared cache amongst users.</span>
<span class="c1"># See the method test_shared_cache_computed_field</span>
<div class="viewcode-block" id="SharedCacheComputeParent">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.SharedCacheComputeParent">[docs]</a>
<span class="k">class</span> <span class="nc">SharedCacheComputeParent</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_shared_cache_compute_parent&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;model_shared_cache_compute_parent&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Task Name&quot;</span><span class="p">)</span>
    <span class="n">line_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span>
        <span class="s1">&#39;test_new_api.model_shared_cache_compute_line&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Timesheets&quot;</span><span class="p">)</span>
    <span class="n">total_amount</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_total_amount&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">compute_sudo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;line_ids.amount&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_total_amount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">total_amount</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">line_ids</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;amount&#39;</span><span class="p">))</span></div>



<div class="viewcode-block" id="ShareCacheComputeLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ShareCacheComputeLine">[docs]</a>
<span class="k">class</span> <span class="nc">ShareCacheComputeLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_shared_cache_compute_line&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;model_shared_cache_compute_line&#39;</span>

    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.model_shared_cache_compute_parent&#39;</span><span class="p">)</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>  <span class="c1"># Note: There is an ir.rule about this.</span></div>



<div class="viewcode-block" id="ComputeContainer">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeContainer">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeContainer</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute.container&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">member_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.compute.member&#39;</span><span class="p">,</span> <span class="s1">&#39;container_id&#39;</span><span class="p">)</span>
    <span class="n">member_count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_member_count&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;member_ids&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_member_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">member_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">member_ids</span><span class="p">)</span></div>



<div class="viewcode-block" id="ComputeMember">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeMember">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeMember</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute.member&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">container_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.compute.container&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_container&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_container</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;test_new_api.compute.container&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">member</span><span class="o">.</span><span class="n">container_id</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>



<div class="viewcode-block" id="User">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.User">[docs]</a>
<span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.user&#39;</span>
    <span class="n">_allow_sudo_commands</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">group_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.group&#39;</span><span class="p">)</span>
    <span class="n">group_count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_group_count&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;group_ids&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_group_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">user</span><span class="o">.</span><span class="n">group_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">group_ids</span><span class="p">)</span></div>



<div class="viewcode-block" id="Group">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Group">[docs]</a>
<span class="k">class</span> <span class="nc">Group</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.group&#39;</span>
    <span class="n">_allow_sudo_commands</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">user_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.user&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ComputeEditable">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeEditable">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeEditable</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute_editable&#39;</span>

    <span class="n">precision_rounding</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">digits</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
    <span class="n">line_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.compute_editable.line&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">onchange</span><span class="p">(</span><span class="s1">&#39;line_ids&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onchange_line_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_ids</span><span class="p">:</span>
            <span class="c1"># even if &#39;same&#39; is not in the view, it should be the same as &#39;value&#39;</span>
            <span class="n">line</span><span class="o">.</span><span class="n">count</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">same</span></div>



<div class="viewcode-block" id="ComputeEditableLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ComputeEditableLine">[docs]</a>
<span class="k">class</span> <span class="nc">ComputeEditableLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.compute_editable.line&#39;</span>

    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.compute_editable&#39;</span><span class="p">)</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
    <span class="n">same</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_same&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">edit</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_edit&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
    <span class="n">one_compute</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_one_compute&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_same</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">same</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_edit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">edit</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">value</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;parent_id.precision_rounding&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_one_compute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">one_compute</span> <span class="o">=</span> <span class="n">float_round</span><span class="p">(</span><span class="mf">99.9999999</span><span class="p">,</span> <span class="n">precision_rounding</span><span class="o">=</span><span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">precision_rounding</span><span class="p">)</span></div>


<div class="viewcode-block" id="ConstrainedUnlinks">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ConstrainedUnlinks">[docs]</a>
<span class="k">class</span> <span class="nc">ConstrainedUnlinks</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.model_constrained_unlinks&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Model with unlink override that is constrained&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">ondelete</span><span class="p">(</span><span class="n">at_uninstall</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_unlink_except_bar_gt_five</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">bar</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">bar</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Nooooooooo bar can&#39;t be greater than five!!&quot;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">ondelete</span><span class="p">(</span><span class="n">at_uninstall</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_unlink_except_prosciutto</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rec</span><span class="o">.</span><span class="n">foo</span> <span class="ow">and</span> <span class="n">rec</span><span class="o">.</span><span class="n">foo</span> <span class="o">==</span> <span class="s1">&#39;prosciutto&#39;</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You didn&#39;t say if you wanted it crudo or cotto...&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="TriggerLeft">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.TriggerLeft">[docs]</a>
<span class="k">class</span> <span class="nc">TriggerLeft</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.trigger.left&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;model with a related many2one&#39;</span>

    <span class="n">middle_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.trigger.middle&#39;</span><span class="p">,</span> <span class="s1">&#39;left_id&#39;</span><span class="p">)</span>
    <span class="n">right_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;middle_ids.right_id&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="TriggerMiddle">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.TriggerMiddle">[docs]</a>
<span class="k">class</span> <span class="nc">TriggerMiddle</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.trigger.middle&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;model linking test_new_api.trigger.left and test_new_api.trigger.right&#39;</span>

    <span class="n">left_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.trigger.left&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">right_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.trigger.right&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="TriggerRight">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.TriggerRight">[docs]</a>
<span class="k">class</span> <span class="nc">TriggerRight</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.trigger.right&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;model with a dependency on the inverse of the related many2one&#39;</span>

    <span class="n">left_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.trigger.left&#39;</span><span class="p">,</span> <span class="s1">&#39;right_id&#39;</span><span class="p">)</span>
    <span class="n">left_size</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_left_size&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;left_ids&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_left_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">left_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">left_ids</span><span class="p">)</span></div>



<div class="viewcode-block" id="Crew">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Crew">[docs]</a>
<span class="k">class</span> <span class="nc">Crew</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.crew&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;All yaaaaaarrrrr by ship&#39;</span>
    <span class="n">_table</span> <span class="o">=</span> <span class="s1">&#39;test_new_api_crew&#39;</span>

    <span class="c1"># this actually represents the union of two relations pirate/ship and</span>
    <span class="c1"># prisoner/ship, where some of the many2one fields can be NULL</span>
    <span class="n">pirate_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.pirate&#39;</span><span class="p">)</span>
    <span class="n">prisoner_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.prisoner&#39;</span><span class="p">)</span>
    <span class="n">ship_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.ship&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Ship">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Ship">[docs]</a>
<span class="k">class</span> <span class="nc">Ship</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.ship&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Yaaaarrr machine&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="n">pirate_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.pirate&#39;</span><span class="p">,</span> <span class="s1">&#39;test_new_api_crew&#39;</span><span class="p">,</span> <span class="s1">&#39;ship_id&#39;</span><span class="p">,</span> <span class="s1">&#39;pirate_id&#39;</span><span class="p">)</span>
    <span class="n">prisoner_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.prisoner&#39;</span><span class="p">,</span> <span class="s1">&#39;test_new_api_crew&#39;</span><span class="p">,</span> <span class="s1">&#39;ship_id&#39;</span><span class="p">,</span> <span class="s1">&#39;prisoner_id&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Pirate">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Pirate">[docs]</a>
<span class="k">class</span> <span class="nc">Pirate</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.pirate&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Yaaarrr&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="n">ship_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.ship&#39;</span><span class="p">,</span> <span class="s1">&#39;test_new_api_crew&#39;</span><span class="p">,</span> <span class="s1">&#39;pirate_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ship_id&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Prisoner">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Prisoner">[docs]</a>
<span class="k">class</span> <span class="nc">Prisoner</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.prisoner&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Yaaarrr minions&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="n">ship_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.ship&#39;</span><span class="p">,</span> <span class="s1">&#39;test_new_api_crew&#39;</span><span class="p">,</span> <span class="s1">&#39;prisoner_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ship_id&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Precompute">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Precompute">[docs]</a>
<span class="k">class</span> <span class="nc">Precompute</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.precompute&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;model with precomputed fields&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># both fields are precomputed</span>
    <span class="n">lower</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_names&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_names&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># precomputed that depends on precomputed fields</span>
    <span class="n">lowup</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_lowup&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># kind of precomputed related field traversing a many2one</span>
    <span class="n">partner_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span>
    <span class="n">commercial_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_commercial_id&#39;</span><span class="p">,</span>
                                    <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># precomputed depending on one2many fields</span>
    <span class="n">line_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.precompute.line&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_size&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">lower</span> <span class="o">=</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">record</span><span class="o">.</span><span class="n">upper</span> <span class="o">=</span> <span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="s1">&#39;upper&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_lowup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">lowup</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">lower</span> <span class="o">+</span> <span class="n">record</span><span class="o">.</span><span class="n">upper</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;partner_id.commercial_partner_id&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_commercial_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">commercial_id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">commercial_partner_id</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;line_ids.size&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">line_ids</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;size&#39;</span><span class="p">))</span></div>



<div class="viewcode-block" id="PrecomputeLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.PrecomputeLine">[docs]</a>
<span class="k">class</span> <span class="nc">PrecomputeLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.precompute.line&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;secondary model with precomputed fields&#39;</span>

    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.precompute&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_size&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">line</span><span class="o">.</span><span class="n">size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="PrecomputeCombo">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.PrecomputeCombo">[docs]</a>
<span class="k">class</span> <span class="nc">PrecomputeCombo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.precompute.combo&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;yet another model with precomputed fields&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_reader&#39;</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">editer</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_editer&#39;</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">setter</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_setter&#39;</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="s1">&#39;_inverse_setter&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_reader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">reader</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_editer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">editer</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">setter</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span> <span class="nf">_inverse_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unexpected inverse of </span><span class="si">%s</span><span class="s2">.setter&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span> <span class="n">stack_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="PrecomputeEditable">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.PrecomputeEditable">[docs]</a>
<span class="k">class</span> <span class="nc">PrecomputeEditable</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.precompute.editable&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;yet another model with precomputed editable fields&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bar&#39;</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">baz</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_baz&#39;</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">baz2</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_baz2&#39;</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="s2">&quot;COMPUTED&quot;</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_baz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baz</span> <span class="o">=</span> <span class="s2">&quot;COMPUTED&quot;</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_baz2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># this field is a trick to get the value of baz if it ever is recomputed</span>
        <span class="c1"># during the precomputation of bar</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">baz2</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">baz</span></div>



<div class="viewcode-block" id="PrecomputeReadonly">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.PrecomputeReadonly">[docs]</a>
<span class="k">class</span> <span class="nc">PrecomputeReadonly</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.precompute.readonly&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;a model with precomputed readonly fields&#39;</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">state</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Selection</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;draft&#39;</span><span class="p">,</span> <span class="s1">&#39;Draft&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;confirmed&#39;</span><span class="p">,</span> <span class="s1">&#39;Confirmed&#39;</span><span class="p">),</span>
    <span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;draft&#39;</span><span class="p">)</span>
    <span class="n">bar</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_bar&#39;</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">baz</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_baz&#39;</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="s2">&quot;COMPUTED&quot;</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_baz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baz</span> <span class="o">=</span> <span class="s2">&quot;COMPUTED&quot;</span></div>



<div class="viewcode-block" id="PrecomputeRequired">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.PrecomputeRequired">[docs]</a>
<span class="k">class</span> <span class="nc">PrecomputeRequired</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.precompute.required&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;a model with precomputed required fields&#39;</span>

    <span class="n">partner_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s1">&#39;partner_id.name&#39;</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>



<div class="viewcode-block" id="PrecomputeMonetary">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.PrecomputeMonetary">[docs]</a>
<span class="k">class</span> <span class="nc">PrecomputeMonetary</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.precompute.monetary&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;a model with precomputed monetary and currency&#39;</span>

    <span class="n">amount</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Monetary</span><span class="p">(</span>
        <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_amount&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">currency_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span>
        <span class="s1">&#39;res.currency&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_compute_currency_id&quot;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">precompute</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_compute_amount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="mf">12.333</span>

    <span class="k">def</span> <span class="nf">_compute_currency_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">currency_id</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># EUR</span></div>



<div class="viewcode-block" id="Prefetch">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Prefetch">[docs]</a>
<span class="k">class</span> <span class="nc">Prefetch</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.prefetch&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;A model to check the prefetching of fields (translated and group)&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Description&#39;</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">html_description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="s1">&#39;Styled description&#39;</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">rare_description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Rare Description&#39;</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prefetch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">rare_html_description</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="s1">&#39;Rare Styled description&#39;</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">prefetch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">harry</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="s1">&#39;Harry Potter&#39;</span><span class="p">,</span> <span class="n">prefetch</span><span class="o">=</span><span class="s1">&#39;Harry Potter&#39;</span><span class="p">)</span>
    <span class="n">hermione</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Hermione Granger&#39;</span><span class="p">,</span> <span class="n">prefetch</span><span class="o">=</span><span class="s1">&#39;Harry Potter&#39;</span><span class="p">)</span>
    <span class="n">ron</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="s1">&#39;Ron Weasley&#39;</span><span class="p">,</span> <span class="n">prefetch</span><span class="o">=</span><span class="s1">&#39;Harry Potter&#39;</span><span class="p">)</span>
    <span class="n">hansel</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="s1">&#39;Hansel&#39;</span><span class="p">,</span> <span class="n">prefetch</span><span class="o">=</span><span class="s2">&quot;Hansel and Gretel&quot;</span><span class="p">)</span>
    <span class="n">gretel</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Gretel&#39;</span><span class="p">,</span> <span class="n">prefetch</span><span class="o">=</span><span class="s2">&quot;Hansel and Gretel&quot;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Modified">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Modified">[docs]</a>
<span class="k">class</span> <span class="nc">Modified</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.modified&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;A model to check modified trigger&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="n">line_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.modified.line&#39;</span><span class="p">,</span> <span class="s1">&#39;modified_id&#39;</span><span class="p">)</span>
    <span class="n">total_quantity</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_total_quantity&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;line_ids.quantity&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_total_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">total_quantity</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">line_ids</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">))</span></div>



<div class="viewcode-block" id="ModifiedLine">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModifiedLine">[docs]</a>
<span class="k">class</span> <span class="nc">ModifiedLine</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.modified.line&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;A model to check modified trigger&#39;</span>

    <span class="n">modified_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.modified&#39;</span><span class="p">)</span>
    <span class="n">modified_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="n">related</span><span class="o">=</span><span class="s2">&quot;modified_id.name&quot;</span><span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
    <span class="n">price</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">()</span>
    <span class="n">total_price</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_total_quantity&#39;</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">total_price_quantity</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Float</span><span class="p">(</span><span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_total_price_quantity&#39;</span><span class="p">)</span>

    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.modified.line&#39;</span><span class="p">)</span>
    <span class="n">child_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.modified.line&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="s1">&#39;child_ids.total_price&#39;</span><span class="p">,</span> <span class="s1">&#39;child_ids.price&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_total_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">total_price</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">child_ids</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;total_price&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="n">rec</span><span class="o">.</span><span class="n">price</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;total_price&#39;</span><span class="p">,</span> <span class="s1">&#39;quantity&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_total_price_quantity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">rec</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">total_price_quantity</span> <span class="o">=</span> <span class="n">rec</span><span class="o">.</span><span class="n">total_price</span> <span class="o">*</span> <span class="n">rec</span><span class="o">.</span><span class="n">quantity</span></div>



<div class="viewcode-block" id="RelatedTranslation">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.RelatedTranslation">[docs]</a>
<span class="k">class</span> <span class="nc">RelatedTranslation</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.related_translation_1&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;A model to test translation for related fields&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="s1">&#39;HTML&#39;</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="n">html_translate</span><span class="p">)</span></div>



<div class="viewcode-block" id="RelatedTranslation2">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.RelatedTranslation2">[docs]</a>
<span class="k">class</span> <span class="nc">RelatedTranslation2</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.related_translation_2&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;A model to test translation for related fields&#39;</span>

    <span class="n">related_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.related_translation_1&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Parent Model&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name Related&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;related_id.name&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="s1">&#39;HTML Related&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;related_id.html&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">computed_name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name Computed&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_name&#39;</span><span class="p">)</span>
    <span class="n">computed_html</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;HTML Computed&#39;</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s1">&#39;_compute_html&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends_context</span><span class="p">(</span><span class="s1">&#39;lang&#39;</span><span class="p">)</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;related_id.name&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">computed_name</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">related_id</span><span class="o">.</span><span class="n">name</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends_context</span><span class="p">(</span><span class="s1">&#39;lang&#39;</span><span class="p">)</span>
    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;related_id.html&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">computed_html</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">related_id</span><span class="o">.</span><span class="n">html</span></div>



<div class="viewcode-block" id="RelatedTranslation3">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.RelatedTranslation3">[docs]</a>
<span class="k">class</span> <span class="nc">RelatedTranslation3</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.related_translation_3&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;A model to test translation for related fields&#39;</span>

    <span class="n">related_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.related_translation_2&#39;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s1">&#39;Parent Model&#39;</span><span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name Related&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;related_id.name&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">html</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Html</span><span class="p">(</span><span class="s1">&#39;HTML Related&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;related_id.html&#39;</span><span class="p">,</span> <span class="n">readonly</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>



<div class="viewcode-block" id="IndexedTranslation">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.IndexedTranslation">[docs]</a>
<span class="k">class</span> <span class="nc">IndexedTranslation</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.indexed_translation&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;A model to indexed translated fields&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="s1">&#39;Name trigram&#39;</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;trigram&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="EmptyChar">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.EmptyChar">[docs]</a>
<span class="k">class</span> <span class="nc">EmptyChar</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.empty_char&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;A model to test emtpy char&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="Team">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.Team">[docs]</a>
<span class="k">class</span> <span class="nc">Team</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.team&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Odoo Team&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.team&#39;</span><span class="p">)</span>
    <span class="n">member_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.team.member&#39;</span><span class="p">,</span> <span class="s1">&#39;team_id&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="TeamMember">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.TeamMember">[docs]</a>
<span class="k">class</span> <span class="nc">TeamMember</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.team.member&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Odoo Developer&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="n">team_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.team&#39;</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.team&#39;</span><span class="p">,</span> <span class="n">related</span><span class="o">=</span><span class="s1">&#39;team_id.parent_id&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="UnsearchableO2M">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.UnsearchableO2M">[docs]</a>
<span class="k">class</span> <span class="nc">UnsearchableO2M</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.unsearchable.o2m&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Test non-stored unsearchable o2m&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">(</span><span class="s1">&#39;Name&#39;</span><span class="p">)</span>
    <span class="n">stored_parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.unsearchable.o2m&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.unsearchable.o2m&#39;</span><span class="p">,</span> <span class="n">store</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">compute</span><span class="o">=</span><span class="s2">&quot;_compute_parent_id&quot;</span><span class="p">)</span>
    <span class="n">child_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.unsearchable.o2m&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">depends</span><span class="p">(</span><span class="s1">&#39;stored_parent_id&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_compute_parent_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">r</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">stored_parent_id</span></div>



<div class="viewcode-block" id="AnyParent">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.AnyParent">[docs]</a>
<span class="k">class</span> <span class="nc">AnyParent</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.any.parent&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Any Parent&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">child_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">One2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.any.child&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="AnyChild">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.AnyChild">[docs]</a>
<span class="k">class</span> <span class="nc">AnyChild</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.any.child&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Any Child&#39;</span>
    <span class="n">_inherits</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;test_new_api.any.parent&#39;</span><span class="p">:</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">parent_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.any.parent&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s1">&#39;cascade&#39;</span><span class="p">)</span>
    <span class="n">link_sibling_id</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2one</span><span class="p">(</span><span class="s1">&#39;test_new_api.any.child&#39;</span><span class="p">)</span>
    <span class="n">quantity</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Integer</span><span class="p">()</span>
    <span class="n">tag_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.any.tag&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="AnyTag">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.AnyTag">[docs]</a>
<span class="k">class</span> <span class="nc">AnyTag</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.any.tag&#39;</span>
    <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;Any tag&#39;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Char</span><span class="p">()</span>
    <span class="n">child_ids</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Many2many</span><span class="p">(</span><span class="s1">&#39;test_new_api.any.child&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="ModelAutovacuumed">
<a class="viewcode-back" href="../../../../../odoo.addons.test_new_api.models.html#odoo.addons.test_new_api.models.test_new_api.ModelAutovacuumed">[docs]</a>
<span class="k">class</span> <span class="nc">ModelAutovacuumed</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">_name</span> <span class="o">=</span> <span class="n">_description</span> <span class="o">=</span> <span class="s1">&#39;test_new_api.autovacuumed&#39;</span>

    <span class="n">expire_at</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="p">(</span><span class="s1">&#39;Expires at&#39;</span><span class="p">)</span>

    <span class="nd">@api</span><span class="o">.</span><span class="n">autovacuum</span>
    <span class="k">def</span> <span class="nf">_gc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;expire_at&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">))])</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Amr.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>