<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>odoo.addons.test_impex.tests.test_load &mdash; Amr  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Amr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">odoo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Amr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../../odoo.html">odoo</a></li>
      <li class="breadcrumb-item active">odoo.addons.test_impex.tests.test_load</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for odoo.addons.test_impex.tests.test_load</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Part of Odoo. See LICENSE file for full copyright and licensing details.</span>
<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pkgutil</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">fields</span>
<span class="kn">from</span> <span class="nn">odoo.addons.base.tests.common</span> <span class="kn">import</span> <span class="n">SavepointCaseWithUserDemo</span>
<span class="kn">from</span> <span class="nn">odoo.tests</span> <span class="kn">import</span> <span class="n">common</span>
<span class="kn">from</span> <span class="nn">odoo.tools.misc</span> <span class="kn">import</span> <span class="n">mute_logger</span>
<span class="kn">from</span> <span class="nn">odoo.tools.translate</span> <span class="kn">import</span> <span class="n">code_translations</span>

<div class="viewcode-block" id="message">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.message">[docs]</a>
<span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">from_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">to_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="n">from_</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="n">to_</span><span class="p">},</span> <span class="n">record</span><span class="o">=</span><span class="n">record</span><span class="p">,</span>
                <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="moreaction">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.moreaction">[docs]</a>
<span class="k">def</span> <span class="nf">moreaction</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;ir.actions.act_window&#39;</span><span class="p">,</span>
        <span class="n">target</span><span class="o">=</span><span class="s1">&#39;new&#39;</span><span class="p">,</span>
        <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;create&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Possible Values&#39;</span><span class="p">,</span>
        <span class="n">view_mode</span><span class="o">=</span><span class="s1">&#39;tree,form&#39;</span><span class="p">,</span>
        <span class="n">views</span><span class="o">=</span><span class="p">[(</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">),</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">)],</span>
        <span class="n">help</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;See all possible values&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="values">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.values">[docs]</a>
<span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">]</span></div>



<div class="viewcode-block" id="ImporterCase">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.ImporterCase">[docs]</a>
<span class="k">class</span> <span class="nc">ImporterCase</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">TransactionCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="ImporterCase.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.ImporterCase.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span></div>


<div class="viewcode-block" id="ImporterCase.import_">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.ImporterCase.import_">[docs]</a>
    <span class="k">def</span> <span class="nf">import_</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="n">context</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;import_file&#39;</span><span class="p">:</span> <span class="kc">True</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">rows</span><span class="p">)</span></div>


<div class="viewcode-block" id="ImporterCase.read">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.ImporterCase.read">[docs]</a>
    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,),</span> <span class="n">domain</span><span class="o">=</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">records</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span></div>


<div class="viewcode-block" id="ImporterCase.browse">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.ImporterCase.browse">[docs]</a>
    <span class="k">def</span> <span class="nf">browse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">(),</span> <span class="n">context</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span></div>


<div class="viewcode-block" id="ImporterCase.xid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.ImporterCase.xid">[docs]</a>
    <span class="k">def</span> <span class="nf">xid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="n">ModelData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">ModelData</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">_name</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;res_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">read</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;module&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">],</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">display_name</span>
        <span class="c1"># fix dotted display_name results, otherwise xid lookups blow up</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">ModelData</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">_name</span><span class="p">,</span>
            <span class="s1">&#39;res_id&#39;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;__test__&#39;</span>
        <span class="p">})</span>
        <span class="k">return</span> <span class="s1">&#39;__test__.&#39;</span> <span class="o">+</span> <span class="n">name</span></div>
</div>



<div class="viewcode-block" id="test_ids_stuff">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_ids_stuff">[docs]</a>
<span class="k">class</span> <span class="nc">test_ids_stuff</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.integer&#39;</span>

<div class="viewcode-block" id="test_ids_stuff.test_create_with_id">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_ids_stuff.test_create_with_id">[docs]</a>
    <span class="k">def</span> <span class="nf">test_create_with_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;.id&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;42&#39;</span><span class="p">,</span> <span class="s1">&#39;36&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;.id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;Unknown database identifier &#39;42&#39;&quot;</span><span class="p">,</span>
        <span class="p">}])</span></div>


<div class="viewcode-block" id="test_ids_stuff.test_create_with_xid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_ids_stuff.test_create_with_xid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_create_with_xid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;somexmlid&#39;</span><span class="p">,</span> <span class="s1">&#39;42&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;__import__.somexmlid&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span></div>


<div class="viewcode-block" id="test_ids_stuff.test_update_with_id">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_ids_stuff.test_update_with_id">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_with_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">36</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="mi">36</span><span class="p">,</span>
            <span class="n">record</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;.id&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="s1">&#39;42&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">42</span><span class="p">],</span> <span class="c1"># updated value to imported</span>
            <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_ids_stuff.test_update_with_xid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_ids_stuff.test_update_with_xid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_with_xid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;somexmlid&#39;</span><span class="p">,</span> <span class="s1">&#39;36&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">36</span><span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;somexmlid&#39;</span><span class="p">,</span> <span class="s1">&#39;1234567&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="mi">1234567</span><span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>
</div>



<div class="viewcode-block" id="test_boolean_field">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_boolean_field">[docs]</a>
<span class="k">class</span> <span class="nc">test_boolean_field</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.boolean&#39;</span>

<div class="viewcode-block" id="test_boolean_field.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_boolean_field.test_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[]),</span>
            <span class="p">{</span><span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;messages&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;nextrow&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span></div>


<div class="viewcode-block" id="test_boolean_field.test_exported">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_boolean_field.test_exported">[docs]</a>
    <span class="k">def</span> <span class="nf">test_exported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;False&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;True&#39;</span><span class="p">],</span> <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span>
            <span class="kc">False</span><span class="p">,</span>
            <span class="kc">True</span><span class="p">,</span>
        <span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="n">records</span><span class="p">))</span></div>


<div class="viewcode-block" id="test_boolean_field.test_falses">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_boolean_field.test_falses">[docs]</a>
    <span class="k">def</span> <span class="nf">test_falses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;de_DE&#39;</span><span class="p">,</span> <span class="s1">&#39;ru_RU&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_BE&#39;</span><span class="p">,</span> <span class="s1">&#39;lt_LT&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="n">lang</span><span class="p">)</span>
        <span class="n">falses</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">u</span><span class="s1">&#39;0&#39;</span><span class="p">],</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;no&#39;</span><span class="p">],</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;false&#39;</span><span class="p">],</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;FALSE&#39;</span><span class="p">],</span> <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
                  <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;faux&#39;</span><span class="p">],</span> <span class="c1"># false, fr</span>
                  <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;falsch&#39;</span><span class="p">],</span> <span class="c1"># false, de</span>
                  <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;ложь&#39;</span><span class="p">],</span> <span class="c1"># no, ru</span>
                  <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;onwaar&#39;</span><span class="p">],</span> <span class="c1"># false, nl</span>
                  <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;ne&#39;</span><span class="p">],</span> <span class="c1"># false, lt,</span>
        <span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">falses</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">falses</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">falses</span><span class="p">),</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_boolean_field.test_trues">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_boolean_field.test_trues">[docs]</a>
    <span class="k">def</span> <span class="nf">test_trues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Since importing wrong boolean values is now returning error, import should not return any ids if an error is raised.</span>
        <span class="n">trues</span> <span class="o">=</span> <span class="p">[[</span><span class="s1">&#39;None&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;nil&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;()&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;#f&#39;</span><span class="p">],</span>
                  <span class="c1"># Problem: OpenOffice (and probably excel) output localized booleans</span>
                  <span class="p">[</span><span class="s1">&#39;VRAI&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;ok&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;yes&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">trues</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[{</span>
            <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">},</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;Unknown value &#39;</span><span class="si">%s</span><span class="s2">&#39; for boolean field &#39;Value&#39;&quot;</span> <span class="o">%</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;moreinfo&#39;</span><span class="p">:</span> <span class="s2">&quot;Use &#39;1&#39; for yes and &#39;0&#39; for no&quot;</span><span class="p">,</span> <span class="s1">&#39;field_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Value&#39;</span>
        <span class="p">}</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">trues</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)])</span>

        <span class="c1"># Only correct boolean values are accepted.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;yes&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;true&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
            <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>
</div>



<div class="viewcode-block" id="test_integer_field">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_integer_field">[docs]</a>
<span class="k">class</span> <span class="nc">test_integer_field</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.integer&#39;</span>

<div class="viewcode-block" id="test_integer_field.test_none">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_integer_field.test_none">[docs]</a>
    <span class="k">def</span> <span class="nf">test_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[]),</span>
            <span class="p">{</span><span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;messages&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;nextrow&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span></div>


<div class="viewcode-block" id="test_integer_field.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_integer_field.test_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="kc">False</span><span class="p">],</span>
            <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_integer_field.test_zero">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_integer_field.test_zero">[docs]</a>
    <span class="k">def</span> <span class="nf">test_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;0&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;-0&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_integer_field.test_positives">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_integer_field.test_positives">[docs]</a>
    <span class="k">def</span> <span class="nf">test_positives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;42&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;12345678&#39;</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12345678</span>
        <span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_integer_field.test_negatives">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_integer_field.test_negatives">[docs]</a>
    <span class="k">def</span> <span class="nf">test_negatives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;-1&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;-42&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))],</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;-12345678&#39;</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">42</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">),</span> <span class="o">-</span><span class="mi">12345678</span>
        <span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_integer_field.test_out_of_range">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_integer_field.test_out_of_range">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">,</span> <span class="s1">&#39;odoo.models&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_out_of_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">)]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;integer out of range</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">}])</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">32</span><span class="p">)]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[{</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s2">&quot;integer out of range</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">}])</span></div>


<div class="viewcode-block" id="test_integer_field.test_nonsense">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_integer_field.test_nonsense">[docs]</a>
    <span class="k">def</span> <span class="nf">test_nonsense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;zorglub&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[{</span>
            <span class="s1">&#39;field_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
            <span class="s1">&#39;rows&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
            <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;value&#39;</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s2">&quot;&#39;zorglub&#39; does not seem to be an integer for field &#39;Value&#39;&quot;</span><span class="p">,</span>
        <span class="p">}])</span></div>
</div>



<div class="viewcode-block" id="test_float_field">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_float_field">[docs]</a>
<span class="k">class</span> <span class="nc">test_float_field</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.float&#39;</span>

<div class="viewcode-block" id="test_float_field.test_none">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_float_field.test_none">[docs]</a>
    <span class="k">def</span> <span class="nf">test_none</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[]),</span>
            <span class="p">{</span><span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;messages&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;nextrow&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span></div>


<div class="viewcode-block" id="test_float_field.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_float_field.test_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="kc">False</span><span class="p">],</span>
            <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_float_field.test_zero">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_float_field.test_zero">[docs]</a>
    <span class="k">def</span> <span class="nf">test_zero</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;0&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;-0&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_float_field.test_positives">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_float_field.test_positives">[docs]</a>
    <span class="k">def</span> <span class="nf">test_positives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;42&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="o">-</span><span class="mi">1</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;12345678&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">33</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;0.000001&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span>
            <span class="mi">1</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12345678</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">**</span><span class="mi">33</span><span class="p">,</span> <span class="mf">.000001</span>
        <span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_float_field.test_negatives">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_float_field.test_negatives">[docs]</a>
    <span class="k">def</span> <span class="nf">test_negatives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;-1&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;-42&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)],</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;-12345678&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">**</span><span class="mi">33</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;-0.000001&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">7</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span>
            <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">42</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="mi">31</span><span class="p">),</span> <span class="o">-</span><span class="mi">12345678</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="o">**</span><span class="mi">33</span><span class="p">,</span> <span class="o">-</span><span class="mf">.000001</span>
        <span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_float_field.test_nonsense">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_float_field.test_nonsense">[docs]</a>
    <span class="k">def</span> <span class="nf">test_nonsense</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;foobar&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="n">message</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;&#39;foobar&#39; does not seem to be a number for field &#39;Value&#39;&quot;</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">)])</span></div>
</div>


<div class="viewcode-block" id="test_string_field">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_string_field">[docs]</a>
<span class="k">class</span> <span class="nc">test_string_field</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.string.bounded&#39;</span>

<div class="viewcode-block" id="test_string_field.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_string_field.test_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="kc">False</span><span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_string_field.test_imported">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_string_field.test_imported">[docs]</a>
    <span class="k">def</span> <span class="nf">test_imported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;foobar&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;foobarbaz&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;Með suð í eyrum við spilum endalaust&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="sa">u</span><span class="s2">&quot;People &#39;get&#39; types. They use them all the time. Telling &quot;</span>
             <span class="sa">u</span><span class="s2">&quot;someone he can&#39;t pound a nail with a banana doesn&#39;t much &quot;</span>
             <span class="sa">u</span><span class="s2">&quot;surprise him.&quot;</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span>
            <span class="sa">u</span><span class="s2">&quot;foobar&quot;</span><span class="p">,</span>
            <span class="sa">u</span><span class="s2">&quot;foobarbaz&quot;</span><span class="p">,</span>
            <span class="sa">u</span><span class="s2">&quot;Með suð í eyrum &quot;</span><span class="p">,</span>
            <span class="sa">u</span><span class="s2">&quot;People &#39;get&#39; typ&quot;</span><span class="p">,</span>
        <span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>
</div>



<div class="viewcode-block" id="test_unbound_string_field">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_unbound_string_field">[docs]</a>
<span class="k">class</span> <span class="nc">test_unbound_string_field</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.string&#39;</span>

<div class="viewcode-block" id="test_unbound_string_field.test_imported">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_unbound_string_field.test_imported">[docs]</a>
    <span class="k">def</span> <span class="nf">test_imported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="sa">u</span><span class="s1">&#39;í dag viðrar vel til loftárása&#39;</span><span class="p">],</span>
            <span class="c1"># ackbar.jpg</span>
            <span class="p">[</span><span class="sa">u</span><span class="s2">&quot;If they ask you about fun, you tell them – fun is a filthy&quot;</span>
             <span class="sa">u</span><span class="s2">&quot; parasite&quot;</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span>
            <span class="sa">u</span><span class="s2">&quot;í dag viðrar vel til loftárása&quot;</span><span class="p">,</span>
            <span class="sa">u</span><span class="s2">&quot;If they ask you about fun, you tell them – fun is a filthy parasite&quot;</span>
        <span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>
</div>



<div class="viewcode-block" id="test_required_string_field">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_required_string_field">[docs]</a>
<span class="k">class</span> <span class="nc">test_required_string_field</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.string.required&#39;</span>

<div class="viewcode-block" id="test_required_string_field.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_required_string_field.test_empty">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">,</span> <span class="s1">&#39;odoo.models&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;Missing required value for the field &#39;Value&#39; (value)&quot;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_required_string_field.test_not_provided">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_required_string_field.test_not_provided">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">,</span> <span class="s1">&#39;odoo.models&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_not_provided</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;12&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;Missing required value for the field &#39;Value&#39; (value)&quot;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_required_string_field.test_ignore_excess_messages">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_required_string_field.test_ignore_excess_messages">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">,</span> <span class="s1">&#39;odoo.models&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_ignore_excess_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]),</span> <span class="mi">11</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="s1">&#39;error&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="sa">u</span><span class="s2">&quot;Missing required value for the field &#39;Value&#39; (value)&quot;</span><span class="p">)</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">last</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="s1">&#39;warning&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">last</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span>
            <span class="sa">u</span><span class="s2">&quot;Found more than 10 errors and more than one error per 10 records, interrupted to avoid showing too many errors.&quot;</span>
        <span class="p">)</span></div>
</div>


<div class="viewcode-block" id="test_text">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_text">[docs]</a>
<span class="k">class</span> <span class="nc">test_text</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.text&#39;</span>

<div class="viewcode-block" id="test_text.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_text.test_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="kc">False</span><span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_text.test_imported">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_text.test_imported">[docs]</a>
    <span class="k">def</span> <span class="nf">test_imported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Breiðskífa er notað um útgefna hljómplötu sem inniheldur &quot;</span>
             <span class="sa">u</span><span class="s2">&quot;stúdíóupptökur frá einum flytjanda. Breiðskífur eru oftast &quot;</span>
             <span class="sa">u</span><span class="s2">&quot;milli 25-80 mínútur og er lengd þeirra oft miðuð við 33⅓ &quot;</span>
             <span class="sa">u</span><span class="s2">&quot;snúninga 12 tommu vínylplötur (sem geta verið allt að 30 mín &quot;</span>
             <span class="sa">u</span><span class="s2">&quot;hvor hlið).</span><span class="se">\n\n</span><span class="s2">Breiðskífur eru stundum tvöfaldar og eru þær þá&quot;</span>
             <span class="sa">u</span><span class="s2">&quot; gefnar út á tveimur geisladiskum eða tveimur vínylplötum.&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="n">s</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">s</span><span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>
</div>



<div class="viewcode-block" id="test_selection">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_selection">[docs]</a>
<span class="k">class</span> <span class="nc">test_selection</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.selection&#39;</span>
    <span class="n">translations_fr</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Foo&quot;</span><span class="p">:</span> <span class="s2">&quot;tete&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Bar&quot;</span><span class="p">:</span> <span class="s2">&quot;titi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Qux&quot;</span><span class="p">:</span> <span class="s2">&quot;toto&quot;</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="test_selection.test_imported">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_selection.test_imported">[docs]</a>
    <span class="k">def</span> <span class="nf">test_imported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;Qux&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;Bar&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;Foo&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_selection.test_imported_translated">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_selection.test_imported_translated">[docs]</a>
    <span class="k">def</span> <span class="nf">test_imported_translated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="c1"># add translations for selection</span>
        <span class="n">selections</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.fields.selection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">translations_fr</span><span class="p">))])</span>
        <span class="k">for</span> <span class="n">selection</span> <span class="ow">in</span> <span class="n">selections</span><span class="p">:</span>
            <span class="n">selection</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translations_fr</span><span class="p">[</span><span class="n">selection</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;toto&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;tete&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;titi&#39;</span><span class="p">],</span>
        <span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;Foo&#39;</span><span class="p">]],</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_selection.test_invalid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_selection.test_invalid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;Baz&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;Value &#39;Baz&#39; not found in selection field &#39;Value&#39;&quot;</span><span class="p">,</span>
            <span class="n">moreinfo</span><span class="o">=</span><span class="s2">&quot;Foo Bar Qux 4&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span> <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])])</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;42&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;Value &#39;42&#39; not found in selection field &#39;Value&#39;&quot;</span><span class="p">,</span>
            <span class="n">moreinfo</span><span class="o">=</span><span class="s2">&quot;Foo Bar Qux 4&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])])</span></div>
</div>



<div class="viewcode-block" id="test_selection_with_default">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_selection_with_default">[docs]</a>
<span class="k">class</span> <span class="nc">test_selection_with_default</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.selection.withdefault&#39;</span>

<div class="viewcode-block" id="test_selection_with_default.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_selection_with_default.test_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Empty cells should set corresponding field to False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()),</span>
            <span class="p">[</span><span class="kc">False</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_selection_with_default.test_default">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_selection_with_default.test_default">[docs]</a>
    <span class="k">def</span> <span class="nf">test_default</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Non-provided cells should set corresponding field to default</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;42&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()),</span>
            <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">])</span></div>
</div>



<div class="viewcode-block" id="test_selection_function">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_selection_function">[docs]</a>
<span class="k">class</span> <span class="nc">test_selection_function</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.selection.function&#39;</span>
    <span class="n">translations_fr</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Corge&quot;</span><span class="p">:</span> <span class="s2">&quot;toto&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Grault&quot;</span><span class="p">:</span> <span class="s2">&quot;titi&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Wheee&quot;</span><span class="p">:</span> <span class="s2">&quot;tete&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Moog&quot;</span><span class="p">:</span> <span class="s2">&quot;tutu&quot;</span><span class="p">,</span>
    <span class="p">}</span>

<div class="viewcode-block" id="test_selection_function.test_imported">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_selection_function.test_imported">[docs]</a>
    <span class="k">def</span> <span class="nf">test_imported</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; import uses fields_get, so translates import label (may or may not</span>
<span class="sd">        be good news) *and* serializes the selection function to reverse it:</span>
<span class="sd">        import does not actually know that the selection field uses a function</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: conflict between a value and a label =&gt; pick first</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;Grault&quot;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()),</span> <span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_selection_function.test_translated">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_selection_function.test_translated">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Expects output of selection function returns translated labels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="c1"># hack into code translations</span>
        <span class="n">code_translations</span><span class="o">.</span><span class="n">python_translations</span><span class="p">[(</span><span class="s1">&#39;test_impex&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translations_fr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">code_translations</span><span class="o">.</span><span class="n">python_translations</span><span class="o">.</span><span class="n">pop</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;test_impex&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">))</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;titi&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;tete&#39;</span><span class="p">],</span>
        <span class="p">],</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()),</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">])</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;Wheee&#39;</span><span class="p">]],</span> <span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="test_m2o">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o">[docs]</a>
<span class="k">class</span> <span class="nc">test_m2o</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.many2one&#39;</span>

<div class="viewcode-block" id="test_m2o.test_by_name">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_by_name">[docs]</a>
    <span class="k">def</span> <span class="nf">test_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># create integer objects</span>
        <span class="n">record1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.integer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
        <span class="n">record2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.integer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">36</span><span class="p">})</span>

        <span class="c1"># preheat the oven</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">closing</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">savepoint</span><span class="p">(</span><span class="n">flush</span><span class="o">=</span><span class="kc">False</span><span class="p">)):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="n">record1</span><span class="o">.</span><span class="n">display_name</span><span class="p">],</span> <span class="p">[</span><span class="n">record1</span><span class="o">.</span><span class="n">display_name</span><span class="p">],</span> <span class="p">[</span><span class="n">record2</span><span class="o">.</span><span class="n">display_name</span><span class="p">]])</span>

        <span class="c1"># 1 x SAVEPOINT load</span>
        <span class="c1"># 3 x name_search</span>
        <span class="c1"># 1 x SAVEPOINT _load_records</span>
        <span class="c1"># 1 x select on list of existing modules</span>
        <span class="c1"># 1 x insert</span>
        <span class="c1"># 1 x RELEASE SAVEPOINT _load_records</span>
        <span class="c1"># 1 x RELEASE SAVEPOINT load</span>
        <span class="c1"># =&gt; 9</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueryCount</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
                <span class="c1"># import by display_name</span>
                <span class="p">[</span><span class="n">record1</span><span class="o">.</span><span class="n">display_name</span><span class="p">],</span>
                <span class="p">[</span><span class="n">record1</span><span class="o">.</span><span class="n">display_name</span><span class="p">],</span>
                <span class="p">[</span><span class="n">record2</span><span class="o">.</span><span class="n">display_name</span><span class="p">],</span>
            <span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span>
        <span class="c1"># correct ids assigned to corresponding records</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span>
            <span class="p">(</span><span class="n">record1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record1</span><span class="o">.</span><span class="n">display_name</span><span class="p">),</span>
            <span class="p">(</span><span class="n">record1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record1</span><span class="o">.</span><span class="n">display_name</span><span class="p">),</span>
            <span class="p">(</span><span class="n">record2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record2</span><span class="o">.</span><span class="n">display_name</span><span class="p">),],</span>
            <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_m2o.test_by_xid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_by_xid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_by_xid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.integer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
        <span class="n">xid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xid</span><span class="p">(</span><span class="n">record</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="n">xid</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2o.test_by_id">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_by_id">[docs]</a>
    <span class="k">def</span> <span class="nf">test_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.integer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/.id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2o.test_by_names">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_by_names">[docs]</a>
    <span class="k">def</span> <span class="nf">test_by_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">record1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.integer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
        <span class="n">record2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.integer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
        <span class="c1"># names should be the same</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">record1</span><span class="o">.</span><span class="n">display_name</span><span class="p">,</span> <span class="n">record2</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="n">record2</span><span class="o">.</span><span class="n">display_name</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="n">message</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Found multiple matches for value &#39;export.integer:42&#39; in field &#39;Value&#39; (2 matches)&quot;</span><span class="p">,</span>
                     <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;warning&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span>
            <span class="p">(</span><span class="n">record1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record1</span><span class="o">.</span><span class="n">display_name</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span></div>


<div class="viewcode-block" id="test_m2o.test_fail_by_implicit_id">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_fail_by_implicit_id">[docs]</a>
    <span class="k">def</span> <span class="nf">test_fail_by_implicit_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Can&#39;t implicitly import records by id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># create integer objects</span>
        <span class="n">record1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.integer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
        <span class="n">record2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.integer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">36</span><span class="p">})</span>

        <span class="c1"># Because name_search all the things. Fallback schmallback</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
                <span class="c1"># import by id, without specifying it</span>
                <span class="p">[</span><span class="n">record1</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
                <span class="p">[</span><span class="n">record2</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
                <span class="p">[</span><span class="n">record1</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="n">message</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;No matching record found for name &#39;</span><span class="si">%s</span><span class="s2">&#39; in field &#39;Value&#39;&quot;</span> <span class="o">%</span> <span class="nb">id</span><span class="p">,</span>
                    <span class="n">from_</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">to_</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">record</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
                    <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span><span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;export.integer&#39;</span><span class="p">),</span> <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span>
                    <span class="n">field_type</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">record1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">record1</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2o.test_fail_id_mistype">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_fail_id_mistype">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_fail_id_mistype</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/.id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s2">&quot;foo&quot;</span><span class="p">]])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="n">message</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Invalid database id &#39;foo&#39; for the field &#39;Value&#39;&quot;</span><span class="p">,</span>
                    <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span><span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">,</span>
                                        <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;export.integer&#39;</span><span class="p">)]),</span>
                    <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;.id&#39;</span><span class="p">])</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2o.test_sub_field">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_sub_field">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sub_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Does not implicitly create the record, does not warn that you can&#39;t</span>
<span class="sd">        import m2o subfields (at all)...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;42&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="n">message</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Can not create Many-To-One records indirectly, import &quot;</span>
                    <span class="sa">u</span><span class="s2">&quot;the field separately&quot;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2o.test_fail_noids">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_fail_noids">[docs]</a>
    <span class="k">def</span> <span class="nf">test_fail_noids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;nameisnoexist:3&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for name &#39;nameisnoexist:3&#39; &quot;</span>
            <span class="sa">u</span><span class="s2">&quot;in field &#39;Value&#39;&quot;</span><span class="p">,</span> <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span>
                <span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;export.integer&#39;</span><span class="p">),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;nameisnoexist:3&#39;</span>
        <span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;noxidhere&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for external id &#39;noxidhere&#39; &quot;</span>
            <span class="sa">u</span><span class="s2">&quot;in field &#39;Value&#39;&quot;</span><span class="p">,</span> <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span>
                <span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;export.integer&#39;</span><span class="p">)]),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s2">&quot;external id&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;noxidhere&quot;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/.id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;66&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for database id &#39;66&#39; &quot;</span>
            <span class="sa">u</span><span class="s2">&quot;in field &#39;Value&#39;&quot;</span><span class="p">,</span> <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span>
                <span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;export.integer&#39;</span><span class="p">)]),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;.id&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s2">&quot;database id&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;66&quot;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2o.test_fail_multiple">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_fail_multiple">[docs]</a>
    <span class="k">def</span> <span class="nf">test_fail_multiple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;value/id&#39;</span><span class="p">],</span>
            <span class="p">[[</span><span class="s1">&#39;somename&#39;</span><span class="p">,</span> <span class="s1">&#39;somexid&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;Ambiguous specification for field &#39;Value&#39;, only provide one of &quot;</span>
            <span class="sa">u</span><span class="s2">&quot;name, external id or database id&quot;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2o.test_fail_id">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_fail_id">[docs]</a>
    <span class="k">def</span> <span class="nf">test_fail_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">record</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.integer&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/.id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s2">&quot;lorem&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">record</span><span class="o">.</span><span class="n">id</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">],</span> <span class="s2">&quot;Invalid database id &#39;lorem&#39; for the field &#39;Value&#39;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2o.test_name_create_enabled_m2o">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_name_create_enabled_m2o">[docs]</a>
    <span class="k">def</span> <span class="nf">test_name_create_enabled_m2o</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">101</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for name &#39;101&#39; &quot;</span>
            <span class="sa">u</span><span class="s2">&quot;in field &#39;Value&#39;&quot;</span><span class="p">,</span> <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span>
                <span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;export.integer&#39;</span><span class="p">),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">101</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name_create_enabled_fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">101</span><span class="p">]],</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2o.test_name_create_enabled_m2o_required_field">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2o.test_name_create_enabled_m2o_required_field">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_name_create_enabled_m2o_required_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2one.required.subfield&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.with.required.field&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ipsum&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;name_create_enabled_fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;lorem&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;ipsum&#39;</span><span class="p">]],</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">messages</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">messages</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">],</span>
                         <span class="s2">&quot;No matching record found for name &#39;lorem&#39; in field &#39;Name&#39; and the following error was &quot;</span>
                         <span class="s2">&quot;encountered when we attempted to create one: Cannot create new &#39;export.with.required.field&#39; &quot;</span>
                         <span class="s2">&quot;records from their name alone. Please create those records manually and try importing again.&quot;</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="TestInvalidStrings">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.TestInvalidStrings">[docs]</a>
<span class="k">class</span> <span class="nc">TestInvalidStrings</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.m2o.str&#39;</span>

<div class="viewcode-block" id="TestInvalidStrings.test_fail_unpaired_surrogate">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.TestInvalidStrings.test_fail_unpaired_surrogate">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_fail_unpaired_surrogate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;child_id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;</span><span class="se">\uddff</span><span class="s1">&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;surrogates&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestInvalidStrings.test_fail_nul">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.TestInvalidStrings.test_fail_nul">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_fail_nul</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;child_id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;</span><span class="se">\x00</span><span class="s1">&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;NUL&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">])</span></div>
</div>


<div class="viewcode-block" id="test_m2m">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2m">[docs]</a>
<span class="k">class</span> <span class="nc">test_m2m</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.many2many&#39;</span>

    <span class="c1"># apparently, one and only thing which works is a</span>
    <span class="c1"># csv_internal_sep-separated list of ids, xids, or names (depending if</span>
    <span class="c1"># m2m/.id, m2m/id or m2m[/anythingelse]</span>
<div class="viewcode-block" id="test_m2m.test_ids">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2m.test_ids">[docs]</a>
    <span class="k">def</span> <span class="nf">test_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">id1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record0&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">id2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">44</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record1&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">id3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record2&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">id4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record3&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">id5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">99</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record4&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/.id&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">id1</span><span class="p">,</span> <span class="n">id3</span><span class="p">,</span> <span class="n">id4</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">id3</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">id5</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">4</span><span class="p">)</span>

        <span class="n">ids</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">records</span><span class="p">:</span> <span class="p">[</span><span class="n">record</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">]</span>

        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ids</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">44</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ids</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">,</span> <span class="n">id3</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">84</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_m2m.test_noids">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2m.test_noids">[docs]</a>
    <span class="k">def</span> <span class="nf">test_noids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/.id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;42&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for database id &#39;42&#39; in field &quot;</span>
            <span class="sa">u</span><span class="s2">&quot;&#39;Value&#39;&quot;</span><span class="p">,</span> <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span>
                <span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;export.many2many.other&#39;</span><span class="p">)]),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;.id&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s2">&quot;database id&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;42&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2m.test_xids">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2m.test_xids">[docs]</a>
    <span class="k">def</span> <span class="nf">test_xids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">record0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record0&#39;</span><span class="p">})</span>
        <span class="n">record1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">44</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record1&#39;</span><span class="p">})</span>
        <span class="n">record2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record2&#39;</span><span class="p">})</span>
        <span class="n">record3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record3&#39;</span><span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/id&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xid</span><span class="p">(</span><span class="n">record0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">xid</span><span class="p">(</span><span class="n">record1</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">xid</span><span class="p">(</span><span class="n">record3</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xid</span><span class="p">(</span><span class="n">record2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">xid</span><span class="p">(</span><span class="n">record1</span><span class="p">))],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertCountEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">44</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertCountEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">44</span><span class="p">,</span> <span class="mi">84</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_m2m.test_noxids">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2m.test_noxids">[docs]</a>
    <span class="k">def</span> <span class="nf">test_noxids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;noxidforthat&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for external id &#39;noxidforthat&#39; in field&quot;</span>
            <span class="sa">u</span><span class="s2">&quot; &#39;Value&#39;&quot;</span><span class="p">,</span> <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span>
                <span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;export.many2many.other&#39;</span><span class="p">)]),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s1">&#39;external id&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;noxidforthat&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2m.test_names">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2m.test_names">[docs]</a>
    <span class="k">def</span> <span class="nf">test_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">record0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record0&#39;</span><span class="p">})</span>
        <span class="n">record1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">44</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record1&#39;</span><span class="p">})</span>
        <span class="n">record2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record2&#39;</span><span class="p">})</span>
        <span class="n">record3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record3&#39;</span><span class="p">})</span>

        <span class="n">name</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">record</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">display_name</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="n">record1</span><span class="p">),</span> <span class="n">name</span><span class="p">(</span><span class="n">record2</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="n">record0</span><span class="p">),</span> <span class="n">name</span><span class="p">(</span><span class="n">record1</span><span class="p">),</span> <span class="n">name</span><span class="p">(</span><span class="n">record2</span><span class="p">))],</span>
            <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">(</span><span class="n">record0</span><span class="p">),</span> <span class="n">name</span><span class="p">(</span><span class="n">record3</span><span class="p">))],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="mi">84</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_m2m.test_nonames">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2m.test_nonames">[docs]</a>
    <span class="k">def</span> <span class="nf">test_nonames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;wherethem2mhavenonames&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for name &#39;wherethem2mhavenonames&#39; in &quot;</span>
            <span class="sa">u</span><span class="s2">&quot;field &#39;Value&#39;&quot;</span><span class="p">,</span> <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span>
                <span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;wherethem2mhavenonames&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_m2m.test_import_to_existing">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_m2m.test_import_to_existing">[docs]</a>
    <span class="k">def</span> <span class="nf">test_import_to_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">id1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record0&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">id2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">44</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record1&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">id3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">84</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record2&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">id4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.many2many.other&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;record3&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>

        <span class="n">xid</span> <span class="o">=</span> <span class="s1">&#39;myxid&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;value/.id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="n">xid</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">)]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;value/.id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="n">xid</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">id3</span><span class="p">,</span> <span class="n">id4</span><span class="p">)]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># TODO: replacement of existing m2m values is correct?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">84</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span></div>
</div>



<div class="viewcode-block" id="test_o2m">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m">[docs]</a>
<span class="k">class</span> <span class="nc">test_o2m</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.one2many&#39;</span>

<div class="viewcode-block" id="test_o2m.test_display_name">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_display_name">[docs]</a>
    <span class="k">def</span> <span class="nf">test_display_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39;Java is a DSL for taking large XML files and converting them &#39;</span> \
            <span class="sa">u</span><span class="s1">&#39;to stack traces&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span>
            <span class="p">[[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="n">s</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for name &#39;</span><span class="si">%s</span><span class="s2">&#39; in field &#39;Value&#39;&quot;</span> <span class="o">%</span> <span class="n">s</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span>
            <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span><span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;export.one2many.child&#39;</span><span class="p">),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">s</span><span class="p">[:</span><span class="mi">50</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_o2m.test_single">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_single">[docs]</a>
    <span class="k">def</span> <span class="nf">test_single</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;value/value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;63&#39;</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">(</span><span class="n">b</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">const</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">63</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_o2m.test_multicore">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_multicore">[docs]</a>
    <span class="k">def</span> <span class="nf">test_multicore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;value/value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;63&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="s1">&#39;64&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">const</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">63</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b2</span><span class="o">.</span><span class="n">const</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b2</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">64</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_o2m.test_multisub">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_multisub">[docs]</a>
    <span class="k">def</span> <span class="nf">test_multisub</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;value/value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;63&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;64&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;65&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;66&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">(</span><span class="n">b</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">)),</span> <span class="nb">set</span><span class="p">([</span><span class="mi">63</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">66</span><span class="p">]))</span></div>


<div class="viewcode-block" id="test_o2m.test_multi_subfields">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_multi_subfields">[docs]</a>
    <span class="k">def</span> <span class="nf">test_multi_subfields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/str&#39;</span><span class="p">,</span> <span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;value/value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;this&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;63&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;64&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;65&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;rhythm&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;66&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">(</span><span class="n">b</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">sorted</span><span class="p">())),</span> <span class="nb">set</span><span class="p">([</span><span class="mi">63</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">66</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">sorted</span><span class="p">(),</span> <span class="s1">&#39;str&#39;</span><span class="p">),</span>
            <span class="s1">&#39;this is the rhythm&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">())</span></div>


<div class="viewcode-block" id="test_o2m.test_subfields_fail_by_implicit_id">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_subfields_fail_by_implicit_id">[docs]</a>
    <span class="k">def</span> <span class="nf">test_subfields_fail_by_implicit_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/parent_id&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;noxidforthat&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for name &#39;noxidforthat&#39; in field &#39;Value/Parent&#39;&quot;</span><span class="p">,</span>
            <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span><span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;export.one2many&#39;</span><span class="p">),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;noxidforthat&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_o2m.test_link_inline">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_link_inline">[docs]</a>
    <span class="k">def</span> <span class="nf">test_link_inline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; m2m-style specification for o2ms</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">id1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.one2many.child&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;Bf&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">109</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">id2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.one2many.child&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;Me&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">262</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;value/.id&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;42&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">,</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">)]</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">const</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
        <span class="c1"># automatically forces link between core record and o2ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">)),</span> <span class="nb">set</span><span class="p">([</span><span class="mi">109</span><span class="p">,</span> <span class="mi">262</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;parent_id&#39;</span><span class="p">),</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_o2m.test_link">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_link">[docs]</a>
    <span class="k">def</span> <span class="nf">test_link</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; O2M relating to an existing record (update) force a LINK_TO as well</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">id1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.one2many.child&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;Bf&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">109</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">id2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.one2many.child&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;Me&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">262</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;value/.id&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;42&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">id1</span><span class="p">)],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">id2</span><span class="p">)],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">const</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
        <span class="c1"># automatically forces link between core record and o2ms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertCountEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">[</span><span class="mi">109</span><span class="p">,</span> <span class="mi">262</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;parent_id&#39;</span><span class="p">),</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_o2m.test_link_2">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_link_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_link_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">id1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.one2many.child&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;Bf&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">109</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">id2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.one2many.child&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;str&#39;</span><span class="p">:</span> <span class="s1">&#39;Me&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">262</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;value/.id&#39;</span><span class="p">,</span> <span class="s1">&#39;value/value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;42&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">id1</span><span class="p">),</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">id2</span><span class="p">),</span> <span class="s1">&#39;2&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">const</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">)),</span> <span class="nb">set</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;parent_id&#39;</span><span class="p">),</span> <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_o2m.test_o2m_repeated_with_xids">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_o2m_repeated_with_xids">[docs]</a>
    <span class="k">def</span> <span class="nf">test_o2m_repeated_with_xids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># concern: formerly this would link existing records, and fault if</span>
        <span class="c1"># the records did not exist. This is more in line with other XID uses,</span>
        <span class="c1"># however it does make thing work where they&#39;d previously fail for</span>
        <span class="c1"># well-defined reasons.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;value/id&#39;</span><span class="p">,</span> <span class="s1">&#39;value/value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ac&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ad&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;ba&#39;</span><span class="p">,</span> <span class="s1">&#39;15&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;bb&#39;</span><span class="p">,</span> <span class="s1">&#39;16&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;value/id&#39;</span><span class="p">,</span> <span class="s1">&#39;value/value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ac&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;ad&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;8&#39;</span><span class="p">,</span> <span class="s1">&#39;ba&#39;</span><span class="p">,</span> <span class="s1">&#39;25&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;bb&#39;</span><span class="p">,</span> <span class="s1">&#39;16&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>

        <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span><span class="o">.</span><span class="n">sorted</span><span class="p">(</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">const</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="mi">4</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">const</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">mapped</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">),</span> <span class="p">[</span><span class="mi">25</span><span class="p">,</span> <span class="mi">16</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_o2m.test_name_create_enabled_m2o_in_o2m">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_name_create_enabled_m2o_in_o2m">[docs]</a>
    <span class="k">def</span> <span class="nf">test_name_create_enabled_m2o_in_o2m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/m2o&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">101</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for name &#39;101&#39; &quot;</span>
            <span class="sa">u</span><span class="s2">&quot;in field &#39;Value/M2O&#39;&quot;</span><span class="p">,</span> <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span>
                <span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;export.integer&#39;</span><span class="p">),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;m2o&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">101</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name_create_enabled_fields&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;value/m2o&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/m2o&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="mi">101</span><span class="p">]],</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">m2o</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_o2m.test_escape_m2o_in_o2m">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m.test_escape_m2o_in_o2m">[docs]</a>
    <span class="k">def</span> <span class="nf">test_escape_m2o_in_o2m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value/m2o&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;21%&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for name &#39;21%&#39; &quot;</span>
            <span class="sa">u</span><span class="s2">&quot;in field &#39;Value/M2O&#39;&quot;</span><span class="p">,</span> <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span>
                <span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;export.integer&#39;</span><span class="p">),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;m2o&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;21%&#39;</span><span class="p">)])</span></div>
</div>



<div class="viewcode-block" id="test_o2m_multiple">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m_multiple">[docs]</a>
<span class="k">class</span> <span class="nc">test_o2m_multiple</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.one2many.multiple&#39;</span>

<div class="viewcode-block" id="test_o2m_multiple.test_multi_mixed">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m_multiple.test_multi_mixed">[docs]</a>
    <span class="k">def</span> <span class="nf">test_multi_mixed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;child1/value&#39;</span><span class="p">,</span> <span class="s1">&#39;child2/value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;21&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="s1">&#39;22&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">,</span> <span class="s1">&#39;23&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">child1</span><span class="p">)),</span> <span class="nb">set</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">child2</span><span class="p">)),</span> <span class="nb">set</span><span class="p">([</span><span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">]))</span></div>


<div class="viewcode-block" id="test_o2m_multiple.test_multi">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m_multiple.test_multi">[docs]</a>
    <span class="k">def</span> <span class="nf">test_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;child1/value&#39;</span><span class="p">,</span> <span class="s1">&#39;child2/value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;21&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;22&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;23&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">child1</span><span class="p">)),</span> <span class="nb">set</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">child2</span><span class="p">)),</span> <span class="nb">set</span><span class="p">([</span><span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">]))</span></div>


<div class="viewcode-block" id="test_o2m_multiple.test_multi_fullsplit">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_o2m_multiple.test_multi_fullsplit">[docs]</a>
    <span class="k">def</span> <span class="nf">test_multi_fullsplit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;const&#39;</span><span class="p">,</span> <span class="s1">&#39;child1/value&#39;</span><span class="p">,</span> <span class="s1">&#39;child2/value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;11&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;13&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;14&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;21&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;22&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;23&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">browse</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">const</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">child1</span><span class="p">)),</span> <span class="nb">set</span><span class="p">([</span><span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">child2</span><span class="p">)),</span> <span class="nb">set</span><span class="p">([</span><span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">]))</span></div>
</div>



<div class="viewcode-block" id="test_realworld">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_realworld">[docs]</a>
<span class="k">class</span> <span class="nc">test_realworld</span><span class="p">(</span><span class="n">SavepointCaseWithUserDemo</span><span class="p">):</span>

<div class="viewcode-block" id="test_realworld.setUpClass">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_realworld.setUpClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">test_realworld</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_load_partners_set</span><span class="p">()</span></div>


<div class="viewcode-block" id="test_realworld.test_bigfile">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_realworld.test_bigfile">[docs]</a>
    <span class="k">def</span> <span class="nf">test_bigfile</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pkgutil</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="s1">&#39;contacts_big.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;mobile&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;image_1920&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>


<div class="viewcode-block" id="test_realworld.test_backlink">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_realworld.test_backlink">[docs]</a>
    <span class="k">def</span> <span class="nf">test_backlink</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fnames</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;street&quot;</span><span class="p">,</span> <span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;country_id&quot;</span><span class="p">,</span> <span class="s2">&quot;category_id&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;is_company&quot;</span><span class="p">,</span> <span class="s2">&quot;parent_id&quot;</span><span class="p">]</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">pkgutil</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span> <span class="s1">&#39;contacts.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fnames</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>


<div class="viewcode-block" id="test_realworld.test_recursive_o2m">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_realworld.test_recursive_o2m">[docs]</a>
    <span class="k">def</span> <span class="nf">test_recursive_o2m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; The content of the o2m field&#39;s dict needs to go through conversion</span>
<span class="sd">        as it may be composed of convertables or other relational fields</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.one2many.recursive&#39;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="s1">&#39;child/const&#39;</span><span class="p">,</span> <span class="s1">&#39;child/child1/str&#39;</span><span class="p">,</span> <span class="s1">&#39;child/child2/value&#39;</span><span class="p">],</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="s1">&#39;42&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;55&#39;</span><span class="p">],</span>
                <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;43&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;56&#39;</span><span class="p">],</span>
                <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
                <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;55&#39;</span><span class="p">,</span> <span class="s1">&#39;qux&#39;</span><span class="p">,</span> <span class="s1">&#39;57&#39;</span><span class="p">],</span>
                <span class="p">[</span><span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;99&#39;</span><span class="p">,</span> <span class="s1">&#39;wheee&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">],</span>
                <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;98&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">],</span>
            <span class="p">],</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">b</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">),</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">child</span><span class="o">.</span><span class="n">str</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">sorted</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">child1</span><span class="p">],</span>
                         <span class="p">[</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;baz&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">sorted</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">child1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">child</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">child</span><span class="o">.</span><span class="n">sorted</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">child2</span><span class="p">],</span>
                         <span class="p">[</span><span class="mi">12</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_realworld.test_o2m_subfields_fail_by_implicit_id">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_realworld.test_o2m_subfields_fail_by_implicit_id">[docs]</a>
    <span class="k">def</span> <span class="nf">test_o2m_subfields_fail_by_implicit_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">()</span>
        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.one2many.recursive&#39;</span><span class="p">]</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">import_file</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;child/child1/parent_id&#39;</span><span class="p">],</span>
            <span class="p">[[</span><span class="s1">&#39;5&#39;</span><span class="p">],],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span><span class="n">message</span><span class="p">(</span>
            <span class="sa">u</span><span class="s2">&quot;No matching record found for name &#39;5&#39; in field &#39;Child/Child1/Parent&#39;&quot;</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;child&#39;</span><span class="p">,</span>
            <span class="n">moreinfo</span><span class="o">=</span><span class="n">moreaction</span><span class="p">(</span><span class="n">res_model</span><span class="o">=</span><span class="s1">&#39;export.one2many.multiple&#39;</span><span class="p">),</span>
            <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Child&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;child&#39;</span><span class="p">,</span> <span class="s1">&#39;child1&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">],</span> <span class="n">field_type</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s1">&#39;5&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="test_date">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_date">[docs]</a>
<span class="k">class</span> <span class="nc">test_date</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.date&#39;</span>

<div class="viewcode-block" id="test_date.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_date.test_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[]),</span>
            <span class="p">{</span><span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;messages&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;nextrow&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span></div>


<div class="viewcode-block" id="test_date.test_basic">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_date.test_basic">[docs]</a>
    <span class="k">def</span> <span class="nf">test_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;2012-02-03&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_date.test_invalid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_date.test_invalid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;not really a date&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="n">message</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;&#39;not really a date&#39; does not seem to be a valid date &quot;</span>
                    <span class="sa">u</span><span class="s2">&quot;for field &#39;Value&#39;&quot;</span><span class="p">,</span>
                    <span class="n">moreinfo</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;Use the format &#39;2012-12-31&#39;&quot;</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="test_datetime">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_datetime">[docs]</a>
<span class="k">class</span> <span class="nc">test_datetime</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.datetime&#39;</span>

<div class="viewcode-block" id="test_datetime.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_datetime.test_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[]),</span>
            <span class="p">{</span><span class="s1">&#39;ids&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;messages&#39;</span><span class="p">:</span> <span class="p">[],</span> <span class="s1">&#39;nextrow&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span></div>


<div class="viewcode-block" id="test_datetime.test_basic">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_datetime.test_basic">[docs]</a>
    <span class="k">def</span> <span class="nf">test_basic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;2012-02-03 11:11:11&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_datetime.test_invalid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_datetime.test_invalid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;not really a datetime&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="n">message</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;&#39;not really a datetime&#39; does not seem to be a valid &quot;</span>
                    <span class="sa">u</span><span class="s2">&quot;datetime for field &#39;Value&#39;&quot;</span><span class="p">,</span>
                    <span class="n">moreinfo</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;Use the format &#39;2012-12-31 23:59:59&#39;&quot;</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">field_path</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">],</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="test_datetime.test_checktz1">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_datetime.test_checktz1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_checktz1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Imported date should be interpreted as being in the tz provided by</span>
<span class="sd">        the context</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># write dummy tz in user (Asia/Hovd UTC+0700), should be superseded by</span>
        <span class="c1"># context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;tz&#39;</span><span class="p">:</span> <span class="s1">&#39;Asia/Hovd&#39;</span><span class="p">})</span>

        <span class="c1"># UTC+1400</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;2012-02-03 11:11:11&#39;</span><span class="p">]],</span> <span class="p">{</span><span class="s1">&#39;tz&#39;</span><span class="p">:</span> <span class="s1">&#39;Pacific/Kiritimati&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])])],</span>
            <span class="p">[</span><span class="s1">&#39;2012-02-02 21:11:11&#39;</span><span class="p">])</span>

        <span class="c1"># UTC-0930</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;2012-02-03 11:11:11&#39;</span><span class="p">]],</span> <span class="p">{</span><span class="s1">&#39;tz&#39;</span><span class="p">:</span> <span class="s1">&#39;Pacific/Marquesas&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])])],</span>
            <span class="p">[</span><span class="s1">&#39;2012-02-03 20:41:11&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_datetime.test_usertz">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_datetime.test_usertz">[docs]</a>
    <span class="k">def</span> <span class="nf">test_usertz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; If the context does not hold a timezone, the importing user&#39;s tz</span>
<span class="sd">        should be used</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># UTC +1000</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;tz&#39;</span><span class="p">:</span> <span class="s1">&#39;Asia/Yakutsk&#39;</span><span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">(</span>
            <span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;2012-02-03 11:11:11&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])])],</span>
            <span class="p">[</span><span class="s1">&#39;2012-02-03 01:11:11&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="test_datetime.test_notz">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_datetime.test_notz">[docs]</a>
    <span class="k">def</span> <span class="nf">test_notz</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; If there is no tz either in the context or on the user, falls back</span>
<span class="sd">        to UTC</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;tz&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[[</span><span class="s1">&#39;2012-02-03 11:11:11&#39;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">[</span><span class="n">fields</span><span class="o">.</span><span class="n">Datetime</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="s1">&#39;value&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])])],</span>
            <span class="p">[</span><span class="s1">&#39;2012-02-03 11:11:11&#39;</span><span class="p">])</span></div>
</div>



<div class="viewcode-block" id="test_unique">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_unique">[docs]</a>
<span class="k">class</span> <span class="nc">test_unique</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.unique&#39;</span>

<div class="viewcode-block" id="test_unique.test_unique">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_unique.test_unique">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_unique</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;3&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;The value for the field &#39;value&#39; already exists &quot;</span>
                         <span class="sa">u</span><span class="s2">&quot;(this is probably &#39;Value&#39; in the current model).&quot;</span><span class="p">,</span>
                 <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                 <span class="n">record</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">),</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;The value for the field &#39;value&#39; already exists &quot;</span>
                         <span class="sa">u</span><span class="s2">&quot;(this is probably &#39;Value&#39; in the current model).&quot;</span><span class="p">,</span>
                 <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">},</span>
                 <span class="n">record</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">),</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="test_unique.test_unique_pair">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_unique.test_unique_pair">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_unique_pair</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;value2&#39;</span><span class="p">,</span> <span class="s1">&#39;value3&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">],</span> <span class="s1">&#39;error&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;record&#39;</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;rows&#39;</span><span class="p">],</span> <span class="p">{</span><span class="s1">&#39;from&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;The values for the fields &#39;([^&#39;]+)&#39; already exist &quot;</span>
            <span class="sa">r</span><span class="s2">&quot;\(they are probably &#39;([^&#39;]+)&#39; in the current model\)\.&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span>
            <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">),</span>
            <span class="p">[</span><span class="s1">&#39;value2&#39;</span><span class="p">,</span> <span class="s1">&#39;value3&#39;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span>
            <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">),</span>
            <span class="p">[</span><span class="s1">&#39;Value2&#39;</span><span class="p">,</span> <span class="s1">&#39;Value3&#39;</span><span class="p">]</span>
        <span class="p">)</span></div>
</div>


<div class="viewcode-block" id="test_inherits">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_inherits">[docs]</a>
<span class="k">class</span> <span class="nc">test_inherits</span><span class="p">(</span><span class="n">ImporterCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; The import process should only assign a new xid (derived from the</span>
<span class="sd">    childs&#39;) if the child is being created and triggers the creation of the</span>
<span class="sd">    parent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;export.inherits.child&#39;</span>
<div class="viewcode-block" id="test_inherits.test_create_no_parent">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_inherits.test_create_no_parent">[docs]</a>
    <span class="k">def</span> <span class="nf">test_create_no_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;value_parent&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">value_parent</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">value_parent</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">rec</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child_export_inherits_parent&#39;</span><span class="p">],</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="test_inherits.test_create_parent_no_xid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_inherits.test_create_parent_no_xid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_create_parent_no_xid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.inherits.parent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value_parent&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id/.id&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">value_parent</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">rec</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[],</span>
            <span class="s2">&quot;no xid should be created for the parent&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="test_inherits.test_create_parent_with_xid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_inherits.test_create_parent_with_xid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_create_parent_with_xid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.inherits.parent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value_parent&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;export.inherits.parent&#39;</span><span class="p">,</span>
            <span class="s1">&#39;res_id&#39;</span><span class="p">:</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;parent&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id/.id&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">value_parent</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">pid</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span><span class="o">.</span><span class="n">res_id</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">rec</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;xxx.parent&#39;</span><span class="p">],</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="test_inherits.test_create_parent_by_xid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_inherits.test_create_parent_by_xid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_create_parent_by_xid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.inherits.parent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value_parent&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="n">pid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;export.inherits.parent&#39;</span><span class="p">,</span>
            <span class="s1">&#39;res_id&#39;</span><span class="p">:</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;parent&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id/id&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">,</span> <span class="s1">&#39;xxx.parent&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">],</span>
        <span class="p">])</span>
        <span class="n">rec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="s1">&#39;ids&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">value_parent</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">pid</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span><span class="o">.</span><span class="n">res_id</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">rec</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">rec</span><span class="o">.</span><span class="n">parent_id</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;xxx.parent&#39;</span><span class="p">],</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="test_inherits.test_update_parent_no_xid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_inherits.test_update_parent_no_xid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_parent_no_xid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.inherits.parent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value_parent&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="s1">&#39;res_id&#39;</span><span class="p">:</span> <span class="n">child</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;child&#39;</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">,</span> <span class="s1">&#39;42&#39;</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">child</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[],</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="test_inherits.test_update_parent_with_xid">
<a class="viewcode-back" href="../../../../../odoo.addons.test_impex.tests.html#odoo.addons.test_impex.tests.test_load.test_inherits.test_update_parent_with_xid">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_parent_with_xid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;export.inherits.parent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;value_parent&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>
        <span class="n">child</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">pid</span><span class="p">,</span> <span class="n">cid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">([{</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;export.inherits.parent&#39;</span><span class="p">,</span>
            <span class="s1">&#39;res_id&#39;</span><span class="p">:</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;parent&#39;</span><span class="p">,</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_name</span><span class="p">,</span>
            <span class="s1">&#39;res_id&#39;</span><span class="p">:</span> <span class="n">child</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;child&#39;</span>
        <span class="p">}])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">import_</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">],</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">,</span> <span class="s1">&#39;42&#39;</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="mi">42</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">parent_id</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pid</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span><span class="o">.</span><span class="n">res_id</span><span class="p">,</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">cid</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span><span class="o">.</span><span class="n">res_id</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">child</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">child</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;xxx.child&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">_get_external_ids</span><span class="p">()[</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;xxx.parent&#39;</span><span class="p">],</span>
        <span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Amr.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>