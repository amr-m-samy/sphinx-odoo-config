<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>odoo.addons.base.tests.test_expression &mdash; Amr  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Amr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">odoo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Amr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../../odoo.html">odoo</a></li>
          <li class="breadcrumb-item"><a href="../../base.html">odoo.addons.base</a></li>
      <li class="breadcrumb-item active">odoo.addons.base.tests.test_expression</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for odoo.addons.base.tests.test_expression</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Part of Odoo. See LICENSE file for full copyright and licensing details.</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">textwrap</span>
<span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">from</span> <span class="nn">ast</span> <span class="kn">import</span> <span class="n">literal_eval</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>

<span class="kn">import</span> <span class="nn">psycopg2</span>

<span class="kn">from</span> <span class="nn">odoo.addons.base.tests.common</span> <span class="kn">import</span> <span class="n">SavepointCaseWithUserDemo</span>
<span class="kn">from</span> <span class="nn">odoo.fields</span> <span class="kn">import</span> <span class="n">Date</span>
<span class="kn">from</span> <span class="nn">odoo.models</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">from</span> <span class="nn">odoo.tests.common</span> <span class="kn">import</span> <span class="n">BaseCase</span><span class="p">,</span> <span class="n">TransactionCase</span>
<span class="kn">from</span> <span class="nn">odoo.tools</span> <span class="kn">import</span> <span class="n">mute_logger</span>
<span class="kn">from</span> <span class="nn">odoo.osv</span> <span class="kn">import</span> <span class="n">expression</span>
<span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">Command</span>


<div class="viewcode-block" id="TestExpression">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression">[docs]</a>
<span class="k">class</span> <span class="nc">TestExpression</span><span class="p">(</span><span class="n">SavepointCaseWithUserDemo</span><span class="p">):</span>

<div class="viewcode-block" id="TestExpression.setUpClass">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.setUpClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestExpression</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_load_partners_set</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.currency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">({</span><span class="s1">&#39;active_test&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;EUR&#39;</span><span class="p">,</span> <span class="s1">&#39;USD&#39;</span><span class="p">])])</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span></div>


    <span class="k">def</span> <span class="nf">_search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">init_domain</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="n">fil</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">init_domain</span> <span class="ow">or</span> <span class="p">[],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">filtered_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sql</span><span class="o">.</span><span class="n">_ids</span><span class="p">,</span> <span class="n">fil</span><span class="o">.</span><span class="n">_ids</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;filtered_domain do not match SQL search for domain: </span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sql</span>

<div class="viewcode-block" id="TestExpression.test_00_in_not_in_m2m">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_00_in_not_in_m2m">[docs]</a>
    <span class="k">def</span> <span class="nf">test_00_in_not_in_m2m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Create 4 partners with no category, or one or two categories (out of two categories).</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span>
        <span class="n">cat_a</span> <span class="o">=</span> <span class="n">categories</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_expression_category_A&#39;</span><span class="p">})</span>
        <span class="n">cat_b</span> <span class="o">=</span> <span class="n">categories</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_expression_category_B&#39;</span><span class="p">})</span>

        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">partners</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_expression_partner_A&#39;</span><span class="p">,</span> <span class="s1">&#39;category_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">Command</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">cat_a</span><span class="o">.</span><span class="n">id</span><span class="p">])]})</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">partners</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_expression_partner_B&#39;</span><span class="p">,</span> <span class="s1">&#39;category_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">Command</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">cat_b</span><span class="o">.</span><span class="n">id</span><span class="p">])]})</span>
        <span class="n">ab</span> <span class="o">=</span> <span class="n">partners</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_expression_partner_AB&#39;</span><span class="p">,</span> <span class="s1">&#39;category_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">Command</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">cat_a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">cat_b</span><span class="o">.</span><span class="n">id</span><span class="p">])]})</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">partners</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_expression_partner_C&#39;</span><span class="p">})</span>

        <span class="c1"># The tests.</span>

        <span class="c1"># On a one2many or many2many field, `in` should be read `contains` (and</span>
        <span class="c1"># `not in` should be read `doesn&#39;t contain`.</span>
        <span class="n">with_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_a</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">ab</span><span class="p">,</span> <span class="n">with_a</span><span class="p">,</span> <span class="s2">&quot;Search for category_id in cat_a failed.&quot;</span><span class="p">)</span>

        <span class="n">with_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_b</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">ab</span><span class="p">,</span> <span class="n">with_b</span><span class="p">,</span> <span class="s2">&quot;Search for category_id in cat_b failed.&quot;</span><span class="p">)</span>

        <span class="c1"># Partners with the category A or the category B.</span>
        <span class="n">with_a_or_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">cat_b</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">ab</span><span class="p">,</span> <span class="n">with_a_or_b</span><span class="p">,</span> <span class="s2">&quot;Search for category_id contains cat_a or cat_b failed.&quot;</span><span class="p">)</span>

        <span class="c1"># Show that `contains list` is really `contains element or contains element`.</span>
        <span class="n">with_a_or_with_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_a</span><span class="o">.</span><span class="n">id</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_b</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">ab</span><span class="p">,</span> <span class="n">with_a_or_with_b</span><span class="p">,</span> <span class="s2">&quot;Search for category_id contains cat_a or contains cat_b failed.&quot;</span><span class="p">)</span>

        <span class="c1"># If we change the OR in AND...</span>
        <span class="n">with_a_and_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_a</span><span class="o">.</span><span class="n">id</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_b</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">ab</span><span class="p">,</span> <span class="n">with_a_and_b</span><span class="p">,</span> <span class="s2">&quot;Search for category_id contains cat_a and cat_b failed.&quot;</span><span class="p">)</span>

        <span class="c1"># Partners without category A and without category B.</span>
        <span class="n">without_a_or_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">cat_b</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">without_a_or_b</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">ab</span><span class="p">),</span> <span class="s2">&quot;Search for category_id doesn&#39;t contain cat_a or cat_b failed (1).&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">without_a_or_b</span><span class="p">,</span> <span class="s2">&quot;Search for category_id doesn&#39;t contain cat_a or cat_b failed (2).&quot;</span><span class="p">)</span>

        <span class="c1"># Show that `doesn&#39;t contain list` is really `doesn&#39;t contain element and doesn&#39;t contain element`.</span>
        <span class="n">without_a_and_without_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_a</span><span class="o">.</span><span class="n">id</span><span class="p">]),</span> <span class="p">(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_b</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">without_a_and_without_b</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span> <span class="o">+</span> <span class="n">ab</span><span class="p">),</span> <span class="s2">&quot;Search for category_id doesn&#39;t contain cat_a and cat_b failed (1).&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="n">without_a_and_without_b</span><span class="p">,</span> <span class="s2">&quot;Search for category_id doesn&#39;t contain cat_a and cat_b failed (2).&quot;</span><span class="p">)</span>

        <span class="c1"># We can exclude any partner containing the category A.</span>
        <span class="n">without_a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_a</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">without_a</span><span class="p">,</span> <span class="s2">&quot;Search for category_id doesn&#39;t contain cat_a failed (1).&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ab</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">without_a</span><span class="p">,</span> <span class="s2">&quot;Search for category_id doesn&#39;t contain cat_a failed (2).&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="n">without_a</span><span class="p">,</span> <span class="s2">&quot;Search for category_id doesn&#39;t contain cat_a failed (3).&quot;</span><span class="p">)</span>

        <span class="c1"># (Obviously we can do the same for cateory B.)</span>
        <span class="n">without_b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">cat_b</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">without_b</span><span class="p">,</span> <span class="s2">&quot;Search for category_id doesn&#39;t contain cat_b failed (1).&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">ab</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">without_b</span><span class="p">,</span> <span class="s2">&quot;Search for category_id doesn&#39;t contain cat_b failed (2).&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="n">without_b</span><span class="p">,</span> <span class="s2">&quot;Search for category_id doesn&#39;t contain cat_b failed (3).&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_05_not_str_m2m">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_05_not_str_m2m">[docs]</a>
    <span class="k">def</span> <span class="nf">test_05_not_str_m2m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span>

        <span class="n">cids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="s1">&#39;A B AB&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="n">cids</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">categories</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>

        <span class="n">partners_config</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cids</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cids</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;ab&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cids</span><span class="p">[</span><span class="s1">&#39;AB&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;a b&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cids</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">],</span> <span class="n">cids</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">]],</span>
            <span class="s1">&#39;b ab&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">cids</span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">],</span> <span class="n">cids</span><span class="p">[</span><span class="s1">&#39;AB&#39;</span><span class="p">]],</span>
        <span class="p">}</span>
        <span class="n">pids</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">cat_ids</span> <span class="ow">in</span> <span class="n">partners_config</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">pids</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">partners</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;category_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">Command</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">cat_ids</span><span class="p">)]})</span><span class="o">.</span><span class="n">id</span>

        <span class="n">base_domain</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">pids</span><span class="o">.</span><span class="n">values</span><span class="p">()))]</span>

        <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
            <span class="n">found_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="n">base_domain</span> <span class="o">+</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="n">op</span><span class="p">,</span> <span class="n">value</span><span class="p">)])</span><span class="o">.</span><span class="n">ids</span>
            <span class="n">expected_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">pids</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">expected</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">found_ids</span><span class="p">,</span> <span class="n">expected_ids</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%r</span><span class="s1"> should return </span><span class="si">%r</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">op</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">expected</span><span class="p">))</span>

        <span class="n">test</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;a b&#39;</span><span class="p">])</span>
        <span class="n">test</span><span class="p">(</span><span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">])</span>
        <span class="n">test</span><span class="p">(</span><span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">,</span> <span class="s1">&#39;a b&#39;</span><span class="p">,</span> <span class="s1">&#39;b ab&#39;</span><span class="p">])</span>
        <span class="n">test</span><span class="p">(</span><span class="s1">&#39;not ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">])</span>
        <span class="n">test</span><span class="p">(</span><span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s1">&#39;AB&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a b&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestExpression.test_09_hierarchy_filtered_domain">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_09_hierarchy_filtered_domain">[docs]</a>
    <span class="k">def</span> <span class="nf">test_09_hierarchy_filtered_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;dummy&#39;</span><span class="p">})</span>

        <span class="c1"># hierarchy without parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">parent_id</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">)],</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">)],</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_10_hierarchy_in_m2m">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_10_hierarchy_in_m2m">[docs]</a>
    <span class="k">def</span> <span class="nf">test_10_hierarchy_in_m2m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">Category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span>

        <span class="c1"># search through m2m relation</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner_category</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>

        <span class="c1"># setup test partner categories</span>
        <span class="n">categ_root</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Root category&#39;</span><span class="p">})</span>
        <span class="n">categ_0</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Parent category&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">categ_root</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="n">categ_1</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Child1&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">categ_0</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>

        <span class="c1"># test hierarchical search in m2m with child id (list of ids)</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="n">categ_root</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with child id (single id)</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="n">categ_root</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with child ids</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">categ_0</span> <span class="o">+</span> <span class="n">categ_1</span><span class="p">)</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with child ids</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="n">categ_0</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with child ids</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="n">categ_1</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with an empty list</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with &#39;False&#39; value</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertLogs</span><span class="p">(</span><span class="s1">&#39;odoo.osv.expression&#39;</span><span class="p">):</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with parent id (list of ids)</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="n">categ_1</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with parent id (single id)</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="n">categ_1</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with parent ids</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">categ_root</span> <span class="o">+</span> <span class="n">categ_0</span><span class="p">)</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with parent ids</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="n">categ_0</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with parent ids</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="n">categ_root</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with an empty list</span>
        <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># test hierarchical search in m2m with &#39;False&#39; value</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertLogs</span><span class="p">(</span><span class="s1">&#39;odoo.osv.expression&#39;</span><span class="p">):</span>
            <span class="n">cats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cats</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_10_hierarchy_access">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_10_hierarchy_access">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.models.unlink&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_10_hierarchy_access</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_demo</span><span class="p">)</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Top&#39;</span><span class="p">})</span>
        <span class="n">med</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Medium&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">top</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="n">bot</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">med</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>

        <span class="c1"># restrict access of user Demo to partners Top and Bottom</span>
        <span class="n">accessible</span> <span class="o">=</span> <span class="n">top</span> <span class="o">+</span> <span class="n">bot</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.rule&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.rule&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;partners rule&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;domain_force&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">accessible</span><span class="o">.</span><span class="n">ids</span><span class="p">)]),</span>
        <span class="p">})</span>

        <span class="c1"># these searches should return the subset of accessible nodes that are</span>
        <span class="c1"># in the given hierarchy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([]),</span> <span class="n">accessible</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">.</span><span class="n">ids</span><span class="p">)]),</span> <span class="n">accessible</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="n">bot</span><span class="o">.</span><span class="n">ids</span><span class="p">)]),</span> <span class="n">accessible</span><span class="p">)</span>

        <span class="c1"># same kind of search from another model</span>
        <span class="n">Bank</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.bank&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_demo</span><span class="p">)</span>
        <span class="n">bank_top</span><span class="p">,</span> <span class="n">bank_med</span><span class="p">,</span> <span class="n">bank_bot</span> <span class="o">=</span> <span class="n">Bank</span><span class="o">.</span><span class="n">create</span><span class="p">([</span>
            <span class="p">{</span><span class="s1">&#39;acc_number&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="n">top</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;acc_number&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="n">med</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;acc_number&#39;</span><span class="p">:</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="n">bot</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
        <span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Bank</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;partner_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">accessible</span><span class="o">.</span><span class="n">ids</span><span class="p">)]),</span> <span class="n">bank_top</span> <span class="o">+</span> <span class="n">bank_bot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Bank</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;partner_id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="n">top</span><span class="o">.</span><span class="n">ids</span><span class="p">)]),</span> <span class="n">bank_top</span> <span class="o">+</span> <span class="n">bank_med</span> <span class="o">+</span> <span class="n">bank_bot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Bank</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;partner_id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="n">bot</span><span class="o">.</span><span class="n">ids</span><span class="p">)]),</span> <span class="n">bank_top</span> <span class="o">+</span> <span class="n">bank_med</span> <span class="o">+</span> <span class="n">bank_bot</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_10_eq_lt_gt_lte_gte">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_10_eq_lt_gt_lte_gte">[docs]</a>
    <span class="k">def</span> <span class="nf">test_10_eq_lt_gt_lte_gte</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># test if less/greater than or equal operators work</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.currency&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([],</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># test equal</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rounding&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">currency</span><span class="o">.</span><span class="n">rounding</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">currency</span> <span class="ow">in</span> <span class="n">res</span><span class="p">)</span>
        <span class="c1"># test not equal</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rounding&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="n">currency</span><span class="o">.</span><span class="n">rounding</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">currency</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">)</span>
        <span class="c1"># test greater than</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rounding&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="n">currency</span><span class="o">.</span><span class="n">rounding</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">currency</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">)</span>
        <span class="c1"># test greater than or equal</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rounding&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;=&#39;</span><span class="p">,</span> <span class="n">currency</span><span class="o">.</span><span class="n">rounding</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">currency</span> <span class="ow">in</span> <span class="n">res</span><span class="p">)</span>
        <span class="c1"># test less than</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rounding&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="n">currency</span><span class="o">.</span><span class="n">rounding</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">currency</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">res</span><span class="p">)</span>
        <span class="c1"># test less than or equal</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rounding&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="n">currency</span><span class="o">.</span><span class="n">rounding</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">currency</span> <span class="ow">in</span> <span class="n">res</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_10_equivalent_id">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_10_equivalent_id">[docs]</a>
    <span class="k">def</span> <span class="nf">test_10_equivalent_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># equivalent queries</span>
        <span class="n">Currency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.currency&#39;</span><span class="p">]</span>
        <span class="n">non_currency_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Currency</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1003</span>
        <span class="n">res_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">res_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s1">&#39;probably_unexisting_name&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_0</span><span class="p">,</span> <span class="n">res_1</span><span class="p">)</span>
        <span class="n">res_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">non_currency_id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_0</span><span class="p">,</span> <span class="n">res_2</span><span class="p">)</span>
        <span class="n">res_3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_0</span><span class="p">,</span> <span class="n">res_3</span><span class="p">)</span>
        <span class="n">res_4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_0</span><span class="p">,</span> <span class="n">res_4</span><span class="p">)</span>

        <span class="c1"># equivalent queries, integer and string</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">all_partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_partners</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.main_partner&#39;</span><span class="p">)</span>
        <span class="n">others</span> <span class="o">=</span> <span class="n">all_partners</span> <span class="o">-</span> <span class="n">one</span>

        <span class="n">res_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">one</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">res_1</span><span class="p">)</span>
        <span class="c1"># Partner.search([(&#39;id&#39;, &#39;!=&#39;, others)]) # not permitted</span>
        <span class="n">res_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="n">others</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">res_2</span><span class="p">)</span>
        <span class="n">res_3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="n">one</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">res_3</span><span class="p">)</span>
        <span class="n">res_4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">others</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">res_4</span><span class="p">)</span>
        <span class="c1"># res_5 = Partner.search([(&#39;id&#39;, &#39;in&#39;, one)]) # TODO make it permitted, just like for child_of</span>
        <span class="c1"># self.assertEqual(one, res_5)</span>
        <span class="n">res_6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">one</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">res_6</span><span class="p">)</span>
        <span class="n">res_7</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">one</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">one</span><span class="p">,</span> <span class="n">res_7</span><span class="p">)</span>
        <span class="n">res_8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">one</span><span class="o">.</span><span class="n">name</span><span class="p">])])</span></div>

        <span class="c1"># res_9 = Partner.search([(&#39;name&#39;, &#39;in&#39;, one.name)]) # TODO</span>

<div class="viewcode-block" id="TestExpression.test_15_m2o">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_15_m2o">[docs]</a>
    <span class="k">def</span> <span class="nf">test_15_m2o</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>

        <span class="c1"># testing equality with name</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Pepper Street&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>

        <span class="c1"># testing the in operator with name</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="s1">&#39;Pepper Street&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>

        <span class="c1"># testing the in operator with a list of names</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Pepper Street&#39;</span><span class="p">,</span> <span class="s1">&#39;Inner Works&#39;</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>

        <span class="c1"># check if many2one works with empty search list</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>

        <span class="c1"># create new company with partners, and partners with no company</span>
        <span class="n">company2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.company&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Acme 2&#39;</span><span class="p">})</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">Partner</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;P of Acme </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;company_id&#39;</span><span class="p">:</span> <span class="n">company2</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
            <span class="n">Partner</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;P of All </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">i</span><span class="p">,</span> <span class="s1">&#39;company_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

        <span class="c1"># check if many2one works with negative empty list</span>
        <span class="n">all_partners</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span>
        <span class="n">res_partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[]),</span> <span class="p">(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">all_partners</span><span class="p">,</span> <span class="n">res_partners</span><span class="p">,</span> <span class="s2">&quot;not in [] fails&quot;</span><span class="p">)</span>

        <span class="c1"># check that many2one will pick the correct records with a list</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">False</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;We should have at least 4 partners with no company&quot;</span><span class="p">)</span>

        <span class="c1"># check that many2one will exclude the correct records with a list</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;We should have at least 4 partners not related to company #1&quot;</span><span class="p">)</span>

        <span class="c1"># check that many2one will exclude the correct records with a list and False</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                        <span class="p">(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;We should have at least 8 partners not related to company #1&quot;</span><span class="p">)</span>

        <span class="c1"># check that multi-level expressions also work</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;company_id.partner_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>

        <span class="c1"># check multi-level expressions with magic columns</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;create_uid.active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>

        <span class="c1"># check that multi-level expressions with negative op work</span>
        <span class="n">all_partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>

        <span class="c1"># FP Note: filtered_domain differs</span>
        <span class="n">res_partners</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.partner_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">all_partners</span><span class="p">,</span> <span class="n">res_partners</span><span class="p">,</span> <span class="s2">&quot;not in [] fails&quot;</span><span class="p">)</span>

        <span class="c1"># Test the &#39;(not) like/in&#39; behavior. res.partner and its parent_id</span>
        <span class="c1"># column are used because parent_id is a many2one, allowing to test the</span>
        <span class="c1"># Null value, and there are actually some null and non-null values in</span>
        <span class="c1"># the demo data.</span>
        <span class="n">all_partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">non_partner_id</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">all_partners</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">with_parent</span> <span class="o">=</span> <span class="n">all_partners</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">parent_id</span><span class="p">)</span>
        <span class="n">without_parent</span> <span class="o">=</span> <span class="n">all_partners</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">parent_id</span><span class="p">)</span>
        <span class="n">with_website</span> <span class="o">=</span> <span class="n">all_partners</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">website</span><span class="p">)</span>

        <span class="c1"># We treat null values differently than in SQL. For instance in SQL:</span>
        <span class="c1">#   SELECT id FROM res_partner WHERE parent_id NOT IN (0)</span>
        <span class="c1"># will return only the records with non-null parent_id.</span>
        <span class="c1">#   SELECT id FROM res_partner WHERE parent_id IN (0)</span>
        <span class="c1"># will return expectedly nothing (our ids always begin at 1).</span>
        <span class="c1"># This means the union of those two results will give only some</span>
        <span class="c1"># records, but not all present in database.</span>
        <span class="c1">#</span>
        <span class="c1"># When using domains and the ORM&#39;s search method, we think it is</span>
        <span class="c1"># more intuitive that the union returns all the records, and that</span>
        <span class="c1"># a domain like (&#39;parent_id&#39;, &#39;not in&#39;, [0]) will return all</span>
        <span class="c1"># the records. For instance, if you perform a search for the companies</span>
        <span class="c1"># that don&#39;t have OpenERP has a parent company, you expect to find,</span>
        <span class="c1"># among others, the companies that don&#39;t have parent company.</span>
        <span class="c1">#</span>

        <span class="c1"># existing values be treated similarly if we simply check that some</span>
        <span class="c1"># existing value belongs to them.</span>
        <span class="n">res_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s1">&#39;probably_unexisting_name&#39;</span><span class="p">)])</span> <span class="c1"># get all rows, included null parent_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_0</span><span class="p">,</span> <span class="n">all_partners</span><span class="p">)</span>
        <span class="n">res_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">non_partner_id</span><span class="p">])])</span> <span class="c1"># get all rows, included null parent_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_1</span><span class="p">,</span> <span class="n">all_partners</span><span class="p">)</span>
        <span class="n">res_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span> <span class="c1"># get rows with not null parent_id, deprecated syntax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_2</span><span class="p">,</span> <span class="n">with_parent</span><span class="p">)</span>
        <span class="n">res_3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[])])</span> <span class="c1"># get all rows, included null parent_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_3</span><span class="p">,</span> <span class="n">all_partners</span><span class="p">)</span>
        <span class="n">res_4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">False</span><span class="p">])])</span> <span class="c1"># get rows with not null parent_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_4</span><span class="p">,</span> <span class="n">with_parent</span><span class="p">)</span>
        <span class="n">res_4b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)])</span> <span class="c1"># get only rows without parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_4b</span><span class="p">,</span> <span class="n">without_parent</span><span class="p">)</span>

        <span class="c1"># The results of these queries, when combined with queries 0..4 must</span>
        <span class="c1"># give the whole set of ids.</span>
        <span class="n">res_5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;probably_unexisting_name&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res_5</span><span class="p">)</span>
        <span class="n">res_6</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">non_partner_id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res_6</span><span class="p">)</span>
        <span class="n">res_7</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_7</span><span class="p">,</span> <span class="n">without_parent</span><span class="p">)</span>
        <span class="n">res_8</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res_8</span><span class="p">)</span>
        <span class="n">res_9</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">False</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_9</span><span class="p">,</span> <span class="n">without_parent</span><span class="p">)</span>
        <span class="n">res_9b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)])</span> <span class="c1"># get those with a parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_9b</span><span class="p">,</span> <span class="n">with_parent</span><span class="p">)</span>

        <span class="c1"># These queries must return exactly the results than the queries 0..4,</span>
        <span class="c1"># i.e. not ... in ... must be the same as ... not in ... .</span>
        <span class="n">res_10</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;probably_unexisting_name&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_0</span><span class="p">,</span> <span class="n">res_10</span><span class="p">)</span>
        <span class="n">res_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">non_partner_id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_1</span><span class="p">,</span> <span class="n">res_11</span><span class="p">)</span>
        <span class="n">res_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_2</span><span class="p">,</span> <span class="n">res_12</span><span class="p">)</span>
        <span class="n">res_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_3</span><span class="p">,</span> <span class="n">res_13</span><span class="p">)</span>
        <span class="n">res_14</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">False</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_4</span><span class="p">,</span> <span class="n">res_14</span><span class="p">)</span>

        <span class="c1"># Testing many2one field is not enough, a regular char field is tested</span>
        <span class="n">res_15</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;website&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res_15</span><span class="p">)</span>
        <span class="n">res_16</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;website&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_16</span><span class="p">,</span> <span class="n">all_partners</span><span class="p">)</span>
        <span class="n">res_17</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;website&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_17</span><span class="p">,</span> <span class="n">with_website</span><span class="p">)</span>

        <span class="c1"># check behavior for required many2one fields: currency_id is required</span>
        <span class="n">companies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.company&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span>
        <span class="n">res_101</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">companies</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;currency_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)])</span> <span class="c1"># get no companies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res_101</span><span class="p">)</span>
        <span class="n">res_102</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">companies</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;currency_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)])</span> <span class="c1"># get all companies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_102</span><span class="p">,</span> <span class="n">companies</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_in_operator">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_in_operator">[docs]</a>
    <span class="k">def</span> <span class="nf">test_in_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; check that we can use the &#39;in&#39; operator for plain fields &quot;&quot;&quot;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.menu&#39;</span><span class="p">]</span>
        <span class="n">menus</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;sequence&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">menus</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_in_boolean">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_in_boolean">[docs]</a>
    <span class="k">def</span> <span class="nf">test_in_boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check the &#39;in&#39; operator for boolean fields. &quot;&quot;&quot;</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">,</span> <span class="s2">&quot;I need a model with field &#39;active&#39;&quot;</span><span class="p">)</span>
        <span class="n">count_true</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">search_count</span><span class="p">([(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">count_true</span><span class="p">,</span> <span class="s2">&quot;I need an active partner&quot;</span><span class="p">)</span>
        <span class="n">count_false</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">search_count</span><span class="p">([(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">count_false</span><span class="p">,</span> <span class="s2">&quot;I need an inactive partner&quot;</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">search_count</span><span class="p">([(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count_true</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">search_count</span><span class="p">([(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">False</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count_false</span><span class="p">)</span>

        <span class="n">count</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">search_count</span><span class="p">([(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">count_true</span> <span class="o">+</span> <span class="n">count_false</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_15_o2m">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_15_o2m">[docs]</a>
    <span class="k">def</span> <span class="nf">test_15_o2m</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>

        <span class="c1"># test one2many operator with empty search list</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>

        <span class="c1"># test one2many operator with False</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">partner</span> <span class="ow">in</span> <span class="n">partners</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">partner</span><span class="o">.</span><span class="n">child_ids</span><span class="p">)</span>

        <span class="c1"># verify domain evaluation for one2many != False and one2many == False</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span>
        <span class="n">parents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parents</span><span class="p">,</span> <span class="n">categories</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">child_ids</span><span class="p">))</span>
        <span class="n">leafs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">categories</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">leafs</span><span class="p">,</span> <span class="n">categories</span><span class="o">.</span><span class="n">filtered</span><span class="p">(</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="ow">not</span> <span class="n">c</span><span class="o">.</span><span class="n">child_ids</span><span class="p">))</span>

        <span class="c1"># test many2many operator with empty search list</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>

        <span class="c1"># test many2many operator with False</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">partner</span> <span class="ow">in</span> <span class="n">partners</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">partner</span><span class="o">.</span><span class="n">category_id</span><span class="p">)</span>

        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">partner</span> <span class="ow">in</span> <span class="n">partners</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">partner</span><span class="o">.</span><span class="n">category_id</span><span class="p">)</span>

        <span class="c1"># filtering on nonexistent value across x2many should return nothing</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids.city&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_15_equivalent_one2many_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_15_equivalent_one2many_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_15_equivalent_one2many_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.company&#39;</span><span class="p">]</span>
        <span class="n">company3</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Acme 3&#39;</span><span class="p">})</span>
        <span class="n">company4</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Acme 4&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">company3</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>

        <span class="c1"># one2many towards same model</span>
        <span class="n">res_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">company3</span><span class="o">.</span><span class="n">child_ids</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span> <span class="c1"># any company having a child of company3 as child</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_1</span><span class="p">,</span> <span class="n">company3</span><span class="p">)</span>
        <span class="n">res_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">company3</span><span class="o">.</span><span class="n">child_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span> <span class="c1"># any company having the first child of company3 as child</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_2</span><span class="p">,</span> <span class="n">company3</span><span class="p">)</span>

        <span class="c1"># child_of x returns x and its children (direct or not).</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">company3</span> <span class="o">+</span> <span class="n">company4</span>
        <span class="n">res_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">company3</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_1</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
        <span class="n">res_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="n">company3</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_2</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
        <span class="n">res_3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">company3</span><span class="o">.</span><span class="n">name</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_3</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
        <span class="n">res_4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;child_of&#39;</span><span class="p">,</span> <span class="n">company3</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_4</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>

        <span class="c1"># parent_of x returns x and its parents (direct or not).</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">company3</span> <span class="o">+</span> <span class="n">company4</span>
        <span class="n">res_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">company4</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_1</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
        <span class="n">res_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="n">company4</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_2</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
        <span class="n">res_3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">company4</span><span class="o">.</span><span class="n">name</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_3</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>
        <span class="n">res_4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Company</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_of&#39;</span><span class="p">,</span> <span class="n">company4</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_4</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>

        <span class="c1"># try testing real subsets with IN/NOT IN</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">Users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.users&#39;</span><span class="p">]</span>
        <span class="n">p1</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">name_create</span><span class="p">(</span><span class="s2">&quot;Dédé Boitaclou&quot;</span><span class="p">)</span>
        <span class="n">p2</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">name_create</span><span class="p">(</span><span class="s2">&quot;Raoulette Pizza O&#39;poil&quot;</span><span class="p">)</span>
        <span class="n">u1a</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;login&#39;</span><span class="p">:</span> <span class="s1">&#39;dbo&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="n">p1</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">u1b</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;login&#39;</span><span class="p">:</span> <span class="s1">&#39;dbo2&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="n">p1</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>
        <span class="n">u2</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;login&#39;</span><span class="p">:</span> <span class="s1">&#39;rpo&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="n">p2</span><span class="p">})</span><span class="o">.</span><span class="n">id</span>

        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;user_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">u1a</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">p1</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="s2">&quot;o2m IN accept single int on right side&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;user_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Dédé Boitaclou&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">p1</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="s2">&quot;o2m NOT IN matches none on the right side&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;user_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10000</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([],</span> <span class="n">res</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="s2">&quot;o2m NOT IN matches none on the right side&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;user_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">u1a</span><span class="p">,</span><span class="n">u2</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">],</span> <span class="n">res</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="s2">&quot;o2m IN matches any on the right side&quot;</span><span class="p">)</span>
        <span class="n">all_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">ids</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;user_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="n">u1a</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_ids</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">p1</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">ids</span><span class="p">),</span> <span class="s2">&quot;o2m NOT IN matches none on the right side&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;user_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;Dédé Boitaclou&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_ids</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">p1</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">ids</span><span class="p">),</span> <span class="s2">&quot;o2m NOT IN matches none on the right side&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;user_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">u1b</span><span class="p">,</span> <span class="n">u2</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">all_ids</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">]),</span> <span class="nb">set</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">ids</span><span class="p">),</span> <span class="s2">&quot;o2m NOT IN matches none on the right side&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_15_equivalent_one2many_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_15_equivalent_one2many_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_15_equivalent_one2many_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Currency</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.currency&#39;</span><span class="p">]</span>
        <span class="n">CurrencyRate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.currency.rate&#39;</span><span class="p">]</span>

        <span class="n">CurrencyRate</span><span class="o">.</span><span class="n">create</span><span class="p">([</span>
            <span class="p">{</span>
                <span class="s1">&#39;currency_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.EUR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;2000-01-01&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span>
            <span class="p">},</span> <span class="p">{</span>
                <span class="s1">&#39;currency_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.USD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;2000-01-01&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="mf">1.2834</span><span class="p">,</span>
            <span class="p">},</span> <span class="p">{</span>
                <span class="s1">&#39;currency_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.USD&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;2000-01-02&#39;</span><span class="p">,</span>
                <span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="mf">1.5289</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">])</span>

        <span class="c1"># create a currency and a currency rate</span>
        <span class="n">currency</span> <span class="o">=</span> <span class="n">Currency</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;ZZZ&#39;</span><span class="p">,</span> <span class="s1">&#39;symbol&#39;</span><span class="p">:</span> <span class="s1">&#39;ZZZ&#39;</span><span class="p">,</span> <span class="s1">&#39;rounding&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
        <span class="n">currency_rate</span> <span class="o">=</span> <span class="n">CurrencyRate</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;2010-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;currency_id&#39;</span><span class="p">:</span> <span class="n">currency</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
        <span class="n">non_currency_id</span> <span class="o">=</span> <span class="n">currency_rate</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="mi">1000</span>
        <span class="n">default_currency</span> <span class="o">=</span> <span class="n">Currency</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># search the currency via its rates one2many (the one2many must point back at the currency)</span>
        <span class="n">currency_rate1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">CurrencyRate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;currency_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s1">&#39;probably_unexisting_name&#39;</span><span class="p">)])</span>
        <span class="n">currency_rate2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">CurrencyRate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">non_currency_id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">currency_rate1</span><span class="p">,</span> <span class="n">currency_rate2</span><span class="p">)</span>
        <span class="n">currency_rate3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">CurrencyRate</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">currency_rate1</span><span class="p">,</span> <span class="n">currency_rate3</span><span class="p">)</span>

        <span class="c1"># one2many towards another model</span>
        <span class="n">res_3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rate_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">default_currency</span><span class="o">.</span><span class="n">rate_ids</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span> <span class="c1"># currencies having a rate of main currency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_3</span><span class="p">,</span> <span class="n">default_currency</span><span class="p">)</span>
        <span class="n">res_4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rate_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">default_currency</span><span class="o">.</span><span class="n">rate_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span> <span class="c1"># currencies having first rate of main currency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_4</span><span class="p">,</span> <span class="n">default_currency</span><span class="p">)</span>
        <span class="n">res_5</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rate_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">default_currency</span><span class="o">.</span><span class="n">rate_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span> <span class="c1"># currencies having first rate of main currency</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_5</span><span class="p">,</span> <span class="n">default_currency</span><span class="p">)</span>
        <span class="c1"># res_6 = Currency.search([(&#39;rate_ids&#39;, &#39;in&#39;, [default_currency.rate_ids[0].name])])</span>
        <span class="c1"># res_7 = Currency.search([(&#39;rate_ids&#39;, &#39;=&#39;, default_currency.rate_ids[0].name)])</span>
        <span class="c1"># res_8 = Currency.search([(&#39;rate_ids&#39;, &#39;like&#39;, default_currency.rate_ids[0].name)])</span>

        <span class="n">res_9</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rate_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;probably_unexisting_name&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">res_9</span><span class="p">)</span>
        <span class="c1"># Currency.search([(&#39;rate_ids&#39;, &#39;unexisting_op&#39;, &#39;probably_unexisting_name&#39;)]) # TODO expected exception</span>

        <span class="c1"># get the currencies referenced by some currency rates using a weird negative domain</span>
        <span class="n">res_10</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rate_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s1">&#39;probably_unexisting_name&#39;</span><span class="p">)])</span>
        <span class="n">res_11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rate_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">non_currency_id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_10</span><span class="p">,</span> <span class="n">res_11</span><span class="p">)</span>
        <span class="n">res_12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rate_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_10</span><span class="p">,</span> <span class="n">res_12</span><span class="p">)</span>
        <span class="n">res_13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Currency</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;rate_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">res_10</span><span class="p">,</span> <span class="n">res_13</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_20_expression_parse">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_20_expression_parse">[docs]</a>
    <span class="k">def</span> <span class="nf">test_20_expression_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># TDE note: those tests have been added when refactoring the expression.parse() method.</span>
        <span class="c1"># They come in addition to the already existing tests; maybe some tests</span>
        <span class="c1"># will be a bit redundant</span>
        <span class="n">Users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.users&#39;</span><span class="p">]</span>

        <span class="c1"># Create users</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_A&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">:</span> <span class="s1">&#39;test_A&#39;</span><span class="p">})</span>
        <span class="n">b1</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_B&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">:</span> <span class="s1">&#39;test_B&#39;</span><span class="p">})</span>
        <span class="n">b2</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_B2&#39;</span><span class="p">,</span> <span class="s1">&#39;login&#39;</span><span class="p">:</span> <span class="s1">&#39;test_B2&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">b1</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>

        <span class="c1"># Test1: simple inheritance</span>
        <span class="n">users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Users</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;searching through inheritance failed&#39;</span><span class="p">)</span>
        <span class="n">users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Users</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;test_B&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="s1">&#39;searching through inheritance failed&#39;</span><span class="p">)</span>

        <span class="c1"># Test2: inheritance + relational fields</span>
        <span class="n">users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Users</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;test_B&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="s1">&#39;searching through inheritance failed&#39;</span><span class="p">)</span>

        <span class="c1"># Special =? operator mean &quot;is equal if right is set, otherwise always True&quot;</span>
        <span class="n">users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Users</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=?&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;(x =? False) failed&#39;</span><span class="p">)</span>
        <span class="n">users</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Users</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=?&#39;</span><span class="p">,</span> <span class="n">b1</span><span class="o">.</span><span class="n">partner_id</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;(x =? id) failed&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_30_normalize_domain">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_30_normalize_domain">[docs]</a>
    <span class="k">def</span> <span class="nf">test_30_normalize_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">normalize_domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">normalize_domain</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">normalize_domain</span><span class="p">([]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">normalize_domain</span><span class="p">([</span><span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">normalize_domain</span><span class="p">([</span><span class="n">expression</span><span class="o">.</span><span class="n">FALSE_LEAF</span><span class="p">]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">FALSE_LEAF</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">normalize_domain</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]),</span> <span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">normalize_domain</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]),</span>
            <span class="p">[</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">normalize_domain</span><span class="p">([</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]),</span>
            <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">normalize_domain</span><span class="p">([</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]),</span>
            <span class="p">[</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">normalize_domain</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]),</span>
            <span class="p">[</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">normalize_domain</span><span class="p">([</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]),</span>
            <span class="p">[</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
        <span class="p">)</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;b.z&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">normalize_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">domain</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">normalize_domain</span><span class="p">([</span><span class="s1">&#39;&amp;&#39;</span><span class="p">])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">normalize_domain</span><span class="p">([</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">normalize_domain</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">normalize_domain</span><span class="p">([(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;!&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestExpression.test_35_negating_thruty_leafs">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_35_negating_thruty_leafs">[docs]</a>
    <span class="k">def</span> <span class="nf">test_35_negating_thruty_leafs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">([</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">],</span> <span class="s2">&quot;distribute_not applied wrongly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">([</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">.</span><span class="n">FALSE_LEAF</span><span class="p">]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">FALSE_LEAF</span><span class="p">],</span> <span class="s2">&quot;distribute_not applied wrongly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">([</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">],</span> <span class="s2">&quot;distribute_not applied wrongly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">([</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">.</span><span class="n">FALSE_LEAF</span><span class="p">]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">FALSE_LEAF</span><span class="p">],</span> <span class="s2">&quot;distribute_not applied wrongly&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">([</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">FALSE_LEAF</span><span class="p">],</span> <span class="s2">&quot;distribute_not applied wrongly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">([</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">.</span><span class="n">FALSE_LEAF</span><span class="p">]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">],</span> <span class="s2">&quot;distribute_not applied wrongly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">([</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">FALSE_LEAF</span><span class="p">],</span> <span class="s2">&quot;distribute_not applied wrongly&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">([</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="o">.</span><span class="n">FALSE_LEAF</span><span class="p">]),</span> <span class="p">[</span><span class="n">expression</span><span class="o">.</span><span class="n">TRUE_LEAF</span><span class="p">],</span> <span class="s2">&quot;distribute_not applied wrongly&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_40_negating_long_expression">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_40_negating_long_expression">[docs]</a>
    <span class="k">def</span> <span class="nf">test_40_negating_long_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;partner_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;partner_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">(</span><span class="n">source</span><span class="p">),</span> <span class="n">expect</span><span class="p">,</span>
            <span class="s2">&quot;distribute_not on expression applied wrongly&quot;</span><span class="p">)</span>

        <span class="n">pos_leaves</span> <span class="o">=</span> <span class="p">[[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[])],</span> <span class="p">[(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]]</span>
        <span class="n">neg_leaves</span> <span class="o">=</span> <span class="p">[[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[])],</span> <span class="p">[(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]]</span>

        <span class="n">source</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([</span><span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">(</span><span class="n">pos_leaves</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">(</span><span class="n">source</span><span class="p">),</span> <span class="n">expect</span><span class="p">,</span>
            <span class="s2">&quot;distribute_not on long expression without negation operator should not alter it&quot;</span><span class="p">)</span>

        <span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">source</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">([</span><span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">(</span><span class="n">neg_leaves</span><span class="p">)]</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">distribute_not</span><span class="p">(</span><span class="n">source</span><span class="p">),</span> <span class="n">expect</span><span class="p">,</span>
            <span class="s2">&quot;distribute_not on long expression applied wrongly&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_accent">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_accent">[docs]</a>
    <span class="k">def</span> <span class="nf">test_accent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">has_unaccent</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">unittest</span><span class="o">.</span><span class="n">SkipTest</span><span class="p">(</span><span class="s2">&quot;unaccent not enabled&quot;</span><span class="p">)</span>

        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span>
        <span class="n">helen</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Hélène&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;Helene&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;hélène&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;Hel%&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;hél%&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;not ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;Helene&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;not ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;hélène&#39;</span><span class="p">)]))</span>

        <span class="c1"># =like and like should be case and accent sensitive</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=like&#39;</span><span class="p">,</span> <span class="s1">&#39;Hél%&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=like&#39;</span><span class="p">,</span> <span class="s1">&#39;Hel%&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;élè&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">helen</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;ele&#39;</span><span class="p">)]))</span>

        <span class="n">hermione</span><span class="p">,</span> <span class="n">nicostratus</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">create</span><span class="p">([</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Hermione&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">helen</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
            <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Nicostratus&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">helen</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
        <span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">nicostratus</span><span class="o">.</span><span class="n">parent_path</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">helen</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">nicostratus</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">/&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">&#39;odoo.osv.expression.get_unaccent_wrapper&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">w</span><span class="p">:</span>
            <span class="n">w</span><span class="p">()</span><span class="o">.</span><span class="n">side_effect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span>
            <span class="n">rs</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;parent_path&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">helen</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">/%&#39;</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id asc&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">helen</span> <span class="o">|</span> <span class="n">hermione</span> <span class="o">|</span> <span class="n">nicostratus</span><span class="p">)</span>
            <span class="c1"># the result of `get_unaccent_wrapper()` is the wrapper and that&#39;s</span>
            <span class="c1"># what should not be called</span>
            <span class="n">w</span><span class="p">()</span><span class="o">.</span><span class="n">assert_not_called</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestExpression.test_pure_function">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_pure_function">[docs]</a>
    <span class="k">def</span> <span class="nf">test_pure_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">orig_false</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">FALSE_DOMAIN</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">orig_true</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">TRUE_DOMAIN</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">false</span> <span class="o">=</span> <span class="n">orig_false</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">true</span> <span class="o">=</span> <span class="n">orig_true</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">([])</span>
        <span class="n">domain</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">orig_true</span><span class="p">)</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">([</span><span class="n">false</span><span class="p">])</span>
        <span class="n">domain</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">([</span><span class="n">false</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">orig_false</span><span class="p">)</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([])</span>
        <span class="n">domain</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">orig_false</span><span class="p">)</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([</span><span class="n">true</span><span class="p">])</span>
        <span class="n">domain</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([</span><span class="n">true</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">orig_true</span><span class="p">)</span>

        <span class="n">domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">normalize_domain</span><span class="p">([])</span>
        <span class="n">domain</span> <span class="o">+=</span> <span class="p">[(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">normalize_domain</span><span class="p">([])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">orig_true</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_like_wildcards">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_like_wildcards">[docs]</a>
    <span class="k">def</span> <span class="nf">test_like_wildcards</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># check that =like/=ilike expressions are working on an untranslated field</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=like&#39;</span><span class="p">,</span> <span class="s1">&#39;I_ner_W_rk_&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">all</span><span class="p">(</span><span class="n">partner</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Inner Works&#39;</span> <span class="k">for</span> <span class="n">partner</span> <span class="ow">in</span> <span class="n">partners</span><span class="p">),</span> <span class="s2">&quot;Must match only &#39;Inner Works&#39;&quot;</span><span class="p">)</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;G%&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">partners</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Must match one partner (Gemini Furniture)&quot;</span><span class="p">)</span>

        <span class="c1"># check that =like/=ilike expressions are working on translated field</span>
        <span class="n">Country</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.country&#39;</span><span class="p">]</span>
        <span class="n">countries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=like&#39;</span><span class="p">,</span> <span class="s1">&#39;Ind__&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Must match India only&quot;</span><span class="p">)</span>
        <span class="n">countries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;z%&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">countries</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Must match only countries with names starting with Z (currently 2)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_like_cast">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_like_cast">[docs]</a>
    <span class="k">def</span> <span class="nf">test_like_cast</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span>
        <span class="n">record</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;XY&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;not ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;Z&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;not ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">)]))</span>

        <span class="c1"># like, ilike, not like, not ilike convert their lhs to str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;not ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">)]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">)]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;not ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;4&#39;</span><span class="p">)]))</span>

        <span class="c1"># =like and =ilike don&#39;t work on non-character fields</span>
        <span class="k">with</span> <span class="n">mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">Error</span><span class="p">):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;=like&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">)])</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;X&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;=like&#39;</span><span class="p">,</span> <span class="s1">&#39;4%&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestExpression.test_translate_search">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_translate_search">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Country</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.country&#39;</span><span class="p">]</span>
        <span class="n">belgium</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.be&#39;</span><span class="p">)</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Belgium&#39;</span><span class="p">)],</span>
            <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;Belgi&#39;</span><span class="p">)],</span>
            <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Belgium&#39;</span><span class="p">,</span> <span class="s1">&#39;Care Bears&#39;</span><span class="p">])],</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
            <span class="n">countries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="n">domain</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="n">belgium</span><span class="p">)</span>

        <span class="n">countries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;No country&#39;</span><span class="p">])])</span>
        <span class="n">all_countries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">countries</span><span class="p">,</span> <span class="n">all_countries</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_invalid">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_invalid">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_invalid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; verify that invalid expressions are refused, even for magic fields &quot;&quot;&quot;</span>
        <span class="n">Country</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.country&#39;</span><span class="p">]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;^Invalid field res\.country\.does_not_exist in leaf \(&#39;does_not_exist&#39;, &#39;=&#39;, &#39;foo&#39;\)$&quot;</span><span class="p">):</span>
            <span class="n">Country</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;does_not_exist&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="s2">&quot;^Invalid field &#39;name.</span><span class="se">\&quot;</span><span class="s2">Et plouf</span><span class="se">\&quot;</span><span class="s2">&#39;&quot;</span><span class="p">):</span>
            <span class="n">Country</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name.&quot;Et plouf&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="s2">&quot;^Invalid field &#39;name.</span><span class="se">\&quot;</span><span class="s2">Et plouf</span><span class="se">\&quot;</span><span class="s2">&#39;&quot;</span><span class="p">):</span>
            <span class="n">Country</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name.&quot;Et plouf&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;foo&#39;</span><span class="p">])])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;^&#39;does_not_exist&#39;$&quot;</span><span class="p">):</span>
            <span class="n">Country</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">filtered_domain</span><span class="p">([(</span><span class="s1">&#39;does_not_exist&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;^Invalid leaf \(&#39;create_date&#39;, &#39;&gt;&gt;&#39;, &#39;foo&#39;\)$&quot;</span><span class="p">):</span>
            <span class="n">Country</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;^stray </span><span class="si">% i</span><span class="s2">n format &#39;%&#39;$&quot;</span><span class="p">):</span>
            <span class="n">Country</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">filtered_domain</span><span class="p">([(</span><span class="s1">&#39;create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">DataError</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;invalid input syntax&quot;</span><span class="p">):</span>
            <span class="n">Country</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;create_date&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;1970-01-01&#39;); --&quot;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestExpression.test_active">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_active">[docs]</a>
    <span class="k">def</span> <span class="nf">test_active</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># testing for many2many field with category office and active=False</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;OpenERP Test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;category_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">Command</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">partner_category</span><span class="o">.</span><span class="n">id</span><span class="p">])],</span>
            <span class="s1">&#39;child_ids&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">Command</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;address of OpenERP Test&#39;</span><span class="p">,</span> <span class="s1">&#39;country_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;base.be&quot;</span><span class="p">)})],</span>
        <span class="p">}</span>
        <span class="n">Partner</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
        <span class="n">partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;sellers&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="p">[(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="s2">&quot;Record not Found with category sellers and active False.&quot;</span><span class="p">)</span>

        <span class="c1"># testing for one2many field with country Belgium and active=False</span>
        <span class="n">partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids.country_id&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="s1">&#39;Belgium&#39;</span><span class="p">),(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">)],</span> <span class="p">[(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">partner</span><span class="p">,</span> <span class="s2">&quot;Record not Found with country Belgium and active False.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_lp1071710">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_lp1071710">[docs]</a>
    <span class="k">def</span> <span class="nf">test_lp1071710</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check that we can exclude translated fields (bug lp:1071710) &quot;&quot;&quot;</span>
        <span class="c1"># first install french language</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Pepper Street&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">country_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.be&#39;</span><span class="p">)</span>
        <span class="c1"># actual test</span>
        <span class="n">Country</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">be</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.be&#39;</span><span class="p">)</span>
        <span class="n">be</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Belgique&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">be</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Belgique&quot;</span><span class="p">,</span> <span class="s2">&quot;Setting a translation should not impact other languages&quot;</span><span class="p">)</span>
        <span class="n">not_be</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Country</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;Belgique&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">be</span><span class="p">,</span> <span class="n">not_be</span><span class="p">)</span>

        <span class="c1"># indirect search via m2o</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">deco_addict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Pepper Street&#39;</span><span class="p">)])</span>

        <span class="n">not_be</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;Belgium&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">deco_addict</span><span class="p">,</span> <span class="n">not_be</span><span class="p">)</span>

        <span class="n">Partner</span> <span class="o">=</span> <span class="n">Partner</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">not_be</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;Belgique&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotIn</span><span class="p">(</span><span class="n">deco_addict</span><span class="p">,</span> <span class="n">not_be</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_or_with_implicit_and">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_or_with_implicit_and">[docs]</a>
    <span class="k">def</span> <span class="nf">test_or_with_implicit_and</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Check that when using expression.OR on a list of domains with at least one</span>
        <span class="c1"># implicit &#39;&amp;&#39; the returned domain is the expected result.</span>
        <span class="c1"># from #24038</span>
        <span class="n">d1</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">d2</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                         <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">]),</span> <span class="n">expected</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_proper_combine_unit_leaves">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_proper_combine_unit_leaves">[docs]</a>
    <span class="k">def</span> <span class="nf">test_proper_combine_unit_leaves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># test that unit leaves (TRUE_LEAF, FALSE_LEAF) are properly handled in specific cases</span>
        <span class="n">false</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">FALSE_DOMAIN</span>
        <span class="n">true</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">TRUE_DOMAIN</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">)]</span>
        <span class="c1"># OR with single FALSE_LEAF</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([</span><span class="n">false</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">false</span><span class="p">)</span>
        <span class="c1"># OR with multiple FALSE_LEAF</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([</span><span class="n">false</span><span class="p">,</span> <span class="n">false</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">false</span><span class="p">)</span>
        <span class="c1"># OR with FALSE_LEAF and a normal leaf</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([</span><span class="n">false</span><span class="p">,</span> <span class="n">normal</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">normal</span><span class="p">)</span>
        <span class="c1"># OR with AND of single TRUE_LEAF and normal leaf</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([</span><span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">([</span><span class="n">true</span><span class="p">]),</span> <span class="n">normal</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span>
        <span class="c1"># AND with single TRUE_LEAF</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">([</span><span class="n">true</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span>
        <span class="c1"># AND with multiple TRUE_LEAF</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">([</span><span class="n">true</span><span class="p">,</span> <span class="n">true</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span>
        <span class="c1"># AND with TRUE_LEAF and normal leaves</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">([</span><span class="n">true</span><span class="p">,</span> <span class="n">normal</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">normal</span><span class="p">)</span>
        <span class="c1"># AND with OR with single FALSE_LEAF and normal leaf</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">AND</span><span class="p">([</span><span class="n">expression</span><span class="o">.</span><span class="n">OR</span><span class="p">([</span><span class="n">false</span><span class="p">]),</span> <span class="n">normal</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">false</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_filtered_domain_order">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_filtered_domain_order">[docs]</a>
    <span class="k">def</span> <span class="nf">test_filtered_domain_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)]</span>
        <span class="n">countries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertGreater</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">countries</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="c1"># same ids, same order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">countries</span><span class="o">.</span><span class="n">filtered_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">_ids</span><span class="p">,</span> <span class="n">countries</span><span class="o">.</span><span class="n">_ids</span><span class="p">)</span>
        <span class="c1"># again, trying the other way around</span>
        <span class="n">countries</span> <span class="o">=</span> <span class="n">countries</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">countries</span><span class="o">.</span><span class="n">_ids</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">countries</span><span class="o">.</span><span class="n">filtered_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">_ids</span><span class="p">,</span> <span class="n">countries</span><span class="o">.</span><span class="n">_ids</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_filtered_domain_order2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_filtered_domain_order2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_filtered_domain_order2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">countries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.country&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span>
        <span class="c1"># match the first two countries, in order</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">countries</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span> <span class="o">=</span> <span class="n">expected</span><span class="o">.</span><span class="n">_ids</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">id1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">id2</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">countries</span><span class="o">.</span><span class="n">filtered_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">_ids</span><span class="p">,</span> <span class="n">expected</span><span class="o">.</span><span class="n">_ids</span><span class="p">)</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">id2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">id1</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">countries</span><span class="o">.</span><span class="n">filtered_domain</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span><span class="o">.</span><span class="n">_ids</span><span class="p">,</span> <span class="n">expected</span><span class="o">.</span><span class="n">_ids</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestExpression.test_filtered_domain_any_operator">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression.test_filtered_domain_any_operator">[docs]</a>
    <span class="k">def</span> <span class="nf">test_filtered_domain_any_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>

        <span class="n">all_partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">partners</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">children_partner_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">name</span><span class="p">)])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">children_partner_1</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">child_ids</span><span class="p">)</span>

        <span class="n">children_other_partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">partner</span><span class="o">.</span><span class="n">name</span><span class="p">)])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">children_other_partners</span><span class="p">,</span> <span class="n">all_partner</span> <span class="o">-</span> <span class="n">partner</span><span class="o">.</span><span class="n">child_ids</span><span class="p">)</span>

        <span class="n">one_child_partner</span> <span class="o">=</span> <span class="n">partner</span><span class="o">.</span><span class="n">child_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">parent_partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">one_child_partner</span><span class="o">.</span><span class="n">name</span><span class="p">)])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">parent_partner</span><span class="p">,</span> <span class="n">partner</span><span class="p">)</span>

        <span class="n">other_partners</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_search</span><span class="p">(</span><span class="n">Partner</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">one_child_partner</span><span class="o">.</span><span class="n">name</span><span class="p">)])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">other_partners</span><span class="p">,</span> <span class="n">all_partner</span> <span class="o">-</span> <span class="n">partner</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestExpression2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression2">[docs]</a>
<span class="k">class</span> <span class="nc">TestExpression2</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestExpression2.test_long_table_alias">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestExpression2.test_long_table_alias">[docs]</a>
    <span class="k">def</span> <span class="nf">test_long_table_alias</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># To test the 64 characters limit for table aliases in PostgreSQL</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;res.users&#39;</span><span class="p">],</span> <span class="s1">&#39;_order&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">],</span> <span class="s1">&#39;_order&#39;</span><span class="p">,</span> <span class="s1">&#39;commercial_partner_id,company_id,name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.users&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;test&#39;</span><span class="p">)])</span></div>
</div>



<div class="viewcode-block" id="TestAutoJoin">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAutoJoin">[docs]</a>
<span class="k">class</span> <span class="nc">TestAutoJoin</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestAutoJoin.test_auto_join">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAutoJoin.test_auto_join">[docs]</a>
    <span class="k">def</span> <span class="nf">test_auto_join</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Get models</span>
        <span class="n">partner_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">state_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.country.state&#39;</span><span class="p">]</span>
        <span class="n">bank_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.bank&#39;</span><span class="p">]</span>

        <span class="c1"># Get test columns</span>
        <span class="k">def</span> <span class="nf">patch_auto_join</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="n">fname</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">patch_domain</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="n">fname</span><span class="p">],</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

        <span class="c1"># Get country/state data</span>
        <span class="n">Country</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.country&#39;</span><span class="p">]</span>
        <span class="n">country_us</span> <span class="o">=</span> <span class="n">Country</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">)],</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">State</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.country.state&#39;</span><span class="p">]</span>
        <span class="n">states</span> <span class="o">=</span> <span class="n">State</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">country_us</span><span class="o">.</span><span class="n">id</span><span class="p">)],</span> <span class="n">limit</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Create demo data: partners and bank object</span>
        <span class="n">p_a</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test__A&#39;</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="n">p_b</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test__B&#39;</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="n">p_c</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test__C&#39;</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="n">p_aa</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test__AA&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">p_a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="n">p_ab</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test__AB&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">p_a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="n">p_ba</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test__BA&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">:</span> <span class="n">p_b</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">:</span> <span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="n">b_aa</span> <span class="o">=</span> <span class="n">bank_obj</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;acc_number&#39;</span><span class="p">:</span> <span class="s1">&#39;123&#39;</span><span class="p">,</span> <span class="s1">&#39;acc_type&#39;</span><span class="p">:</span> <span class="s1">&#39;bank&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="n">p_aa</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="n">b_ab</span> <span class="o">=</span> <span class="n">bank_obj</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;acc_number&#39;</span><span class="p">:</span> <span class="s1">&#39;456&#39;</span><span class="p">,</span> <span class="s1">&#39;acc_type&#39;</span><span class="p">:</span> <span class="s1">&#39;bank&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="n">p_ab</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="n">b_ba</span> <span class="o">=</span> <span class="n">bank_obj</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;acc_number&#39;</span><span class="p">:</span> <span class="s1">&#39;789&#39;</span><span class="p">,</span> <span class="s1">&#39;acc_type&#39;</span><span class="p">:</span> <span class="s1">&#39;bank&#39;</span><span class="p">,</span> <span class="s1">&#39;partner_id&#39;</span><span class="p">:</span> <span class="n">p_ba</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>

        <span class="c1"># --------------------------------------------------</span>
        <span class="c1"># Test1: basics about the attribute</span>
        <span class="c1"># --------------------------------------------------</span>

        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;category_id&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;category_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="c1"># --------------------------------------------------</span>
        <span class="c1"># Test2: one2many</span>
        <span class="c1"># --------------------------------------------------</span>

        <span class="n">name_test</span> <span class="o">=</span> <span class="s1">&#39;12&#39;</span>

        <span class="c1"># Do: one2many without _auto_join</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">name_test</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="n">p_aa</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join off: (&#39;bank_ids.sanitized_acc_number&#39;, &#39;like&#39;, &#39;..&#39;): incorrect result&quot;</span><span class="p">)</span>

        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">name_test</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">p_aa</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join off: &#39;|&#39;, (&#39;name&#39;, &#39;like&#39;, &#39;C&#39;), (&#39;bank_ids.sanitized_acc_number&#39;, &#39;like&#39;, &#39;..&#39;): incorrect result&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">p_c</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join off: &#39;|&#39;, (&#39;name&#39;, &#39;like&#39;, &#39;C&#39;), (&#39;bank_ids.sanitized_acc_number&#39;, &#39;like&#39;, &#39;..&#39;): incorrect result&quot;</span><span class="p">)</span>

        <span class="c1"># Do: cascaded one2many without _auto_join</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.bank_ids.id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">b_aa</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">b_ba</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="n">p_a</span> <span class="o">+</span> <span class="n">p_b</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join off: (&#39;child_ids.bank_ids.id&#39;, &#39;in&#39;, [..]): incorrect result&quot;</span><span class="p">)</span>

        <span class="c1"># Do: one2many with _auto_join</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">name_test</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="n">p_aa</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on: (&#39;bank_ids.sanitized_acc_number&#39;, &#39;like&#39;, &#39;..&#39;) incorrect result&quot;</span><span class="p">)</span>

        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">name_test</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">p_aa</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on: &#39;|&#39;, (&#39;name&#39;, &#39;like&#39;, &#39;C&#39;), (&#39;bank_ids.sanitized_acc_number&#39;, &#39;like&#39;, &#39;..&#39;): incorrect result&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">p_c</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on: &#39;|&#39;, (&#39;name&#39;, &#39;like&#39;, &#39;C&#39;), (&#39;bank_ids.sanitized_acc_number&#39;, &#39;like&#39;, &#39;..&#39;): incorrect result&quot;</span><span class="p">)</span>

        <span class="c1"># Do: one2many with _auto_join, test final leaf is an id</span>
        <span class="n">bank_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">b_aa</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">b_ab</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids.id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">bank_ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="n">p_aa</span> <span class="o">+</span> <span class="n">p_ab</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on: (&#39;bank_ids.id&#39;, &#39;in&#39;, [..]) incorrect result&quot;</span><span class="p">)</span>

        <span class="c1"># Do: 2 cascaded one2many with _auto_join, test final leaf is an id</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">bank_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">b_aa</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">b_ba</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.bank_ids.id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">bank_ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span> <span class="n">p_a</span> <span class="o">+</span> <span class="n">p_b</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on: (&#39;child_ids.bank_ids.id&#39;, &#39;not in&#39;, [..]): incorrect result&quot;</span><span class="p">)</span>

        <span class="c1"># --------------------------------------------------</span>
        <span class="c1"># Test3: many2one</span>
        <span class="c1"># --------------------------------------------------</span>
        <span class="n">name_test</span> <span class="o">=</span> <span class="s1">&#39;US&#39;</span>

        <span class="c1"># Do: many2one without _auto_join</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;state_id.country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">name_test</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">p_a</span> <span class="o">+</span> <span class="n">p_b</span> <span class="o">+</span> <span class="n">p_aa</span> <span class="o">+</span> <span class="n">p_ab</span> <span class="o">+</span> <span class="n">p_ba</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join off: (&#39;state_id.country_id.code&#39;, &#39;like&#39;, &#39;..&#39;) incorrect result&quot;</span><span class="p">)</span>

        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;state_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">p_a</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span> <span class="s1">&#39;_auto_join off: disjunction incorrect result&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">p_c</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span> <span class="s1">&#39;_auto_join off: disjunction incorrect result&#39;</span><span class="p">)</span>

        <span class="c1"># Do: many2one with 1 _auto_join on the first many2one</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;state_id.country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">name_test</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">p_a</span> <span class="o">+</span> <span class="n">p_b</span> <span class="o">+</span> <span class="n">p_aa</span> <span class="o">+</span> <span class="n">p_ab</span> <span class="o">+</span> <span class="n">p_ba</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on for state_id: (&#39;state_id.country_id.code&#39;, &#39;like&#39;, &#39;..&#39;) incorrect result&quot;</span><span class="p">)</span>

        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([</span><span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;state_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">states</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">code</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">p_a</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span> <span class="s1">&#39;_auto_join: disjunction incorrect result&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">p_c</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span> <span class="s1">&#39;_auto_join: disjunction incorrect result&#39;</span><span class="p">)</span>

        <span class="c1"># Do: many2one with 1 _auto_join on the second many2one</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">state_obj</span><span class="p">,</span> <span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;state_id.country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">name_test</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">p_a</span> <span class="o">+</span> <span class="n">p_b</span> <span class="o">+</span> <span class="n">p_aa</span> <span class="o">+</span> <span class="n">p_ab</span> <span class="o">+</span> <span class="n">p_ba</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on for country_id: (&#39;state_id.country_id.code&#39;, &#39;like&#39;, &#39;..&#39;) incorrect result&quot;</span><span class="p">)</span>

        <span class="c1"># Do: many2one with 2 _auto_join</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">state_obj</span><span class="p">,</span> <span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;state_id.country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">name_test</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">p_a</span> <span class="o">+</span> <span class="n">p_b</span> <span class="o">+</span> <span class="n">p_aa</span> <span class="o">+</span> <span class="n">p_ab</span> <span class="o">+</span> <span class="n">p_ba</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on: (&#39;state_id.country_id.code&#39;, &#39;like&#39;, &#39;..&#39;) incorrect result&quot;</span><span class="p">)</span>

        <span class="c1"># --------------------------------------------------</span>
        <span class="c1"># Test4: domain attribute on one2many fields</span>
        <span class="c1"># --------------------------------------------------</span>

        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">patch_domain</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)])</span>
        <span class="n">patch_domain</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)])</span>

        <span class="c1"># Do: 2 cascaded one2many with _auto_join, test final leaf is an id</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;child_ids.bank_ids.id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">b_aa</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">b_ba</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">p_a</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on one2many with domains incorrect result&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">((</span><span class="n">p_ab</span> <span class="o">+</span> <span class="n">p_ba</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on one2many with domains incorrect result&quot;</span><span class="p">)</span>

        <span class="n">patch_domain</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;__</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)])</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;child_ids.bank_ids.id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">b_aa</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">b_ba</span><span class="o">.</span><span class="n">id</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on one2many with domains incorrect result&quot;</span><span class="p">)</span>

        <span class="c1"># ----------------------------------------</span>
        <span class="c1"># Test5: result-based tests</span>
        <span class="c1"># ----------------------------------------</span>

        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">state_obj</span><span class="p">,</span> <span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">patch_domain</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">patch_domain</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="p">[])</span>

        <span class="c1"># Do: (&#39;child_ids.state_id.country_id.code&#39;, &#39;like&#39;, &#39;..&#39;) without _auto_join</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.state_id.country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">name_test</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">p_a</span> <span class="o">+</span> <span class="n">p_b</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join off: (&#39;child_ids.state_id.country_id.code&#39;, &#39;like&#39;, &#39;..&#39;) incorrect result&quot;</span><span class="p">)</span>

        <span class="c1"># Do: (&#39;child_ids.state_id.country_id.code&#39;, &#39;like&#39;, &#39;..&#39;) with _auto_join</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">partner_obj</span><span class="p">,</span> <span class="s1">&#39;state_id&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">patch_auto_join</span><span class="p">(</span><span class="n">state_obj</span><span class="p">,</span> <span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">partners</span> <span class="o">=</span> <span class="n">partner_obj</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.state_id.country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">name_test</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="n">p_a</span> <span class="o">+</span> <span class="n">p_b</span><span class="p">,</span> <span class="n">partners</span><span class="p">,</span>
            <span class="s2">&quot;_auto_join on: (&#39;child_ids.state_id.country_id.code&#39;, &#39;like&#39;, &#39;..&#39;) incorrect result&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestAutoJoin.test_nullfields">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAutoJoin.test_nullfields">[docs]</a>
    <span class="k">def</span> <span class="nf">test_nullfields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">obj1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.bank&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;c0&#39;</span><span class="p">})</span>
        <span class="n">obj2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.bank&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;c1&#39;</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;Ljósálfaheimr&#39;</span><span class="p">})</span>
        <span class="n">obj3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.bank&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;c2&#39;</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;York&#39;</span><span class="p">})</span>
        <span class="n">obj4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.bank&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;c3&#39;</span><span class="p">,</span> <span class="s1">&#39;city&#39;</span><span class="p">:</span> <span class="s1">&#39;Springfield&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.bank&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">obj1</span> <span class="o">|</span> <span class="n">obj2</span> <span class="o">|</span> <span class="n">obj3</span> <span class="o">|</span> <span class="n">obj4</span><span class="p">)</span><span class="o">.</span><span class="n">ids</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;York&#39;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="p">(</span><span class="n">obj1</span> <span class="o">|</span> <span class="n">obj2</span> <span class="o">|</span> <span class="n">obj4</span><span class="p">),</span>
            <span class="s2">&quot;Should have returned all banks whose city is not York&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.bank&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">obj1</span> <span class="o">|</span> <span class="n">obj2</span> <span class="o">|</span> <span class="n">obj3</span> <span class="o">|</span> <span class="n">obj4</span><span class="p">)</span><span class="o">.</span><span class="n">ids</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;city&#39;</span><span class="p">,</span> <span class="s1">&#39;not ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;field&#39;</span><span class="p">),</span>
            <span class="p">]),</span>
            <span class="p">(</span><span class="n">obj1</span> <span class="o">|</span> <span class="n">obj2</span> <span class="o">|</span> <span class="n">obj3</span><span class="p">),</span>
            <span class="s2">&quot;Should have returned all banks whose city doesn&#39;t contain field&quot;</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestQueries">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestQueries">[docs]</a>
<span class="k">class</span> <span class="nc">TestQueries</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestQueries.test_logic">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestQueries.test_logic">[docs]</a>
    <span class="k">def</span> <span class="nf">test_logic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">domain</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">),</span>
                 <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;ref&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;42&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (</span>
<span class="s1">                (</span>
<span class="s1">                    (&quot;res_partner&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">) AND</span>
<span class="s1">                    (&quot;res_partner&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">                ) AND (</span>
<span class="s1">                    (&quot;res_partner&quot;.&quot;title&quot; = </span><span class="si">%s</span><span class="s1">) OR (</span>
<span class="s1">                        (&quot;res_partner&quot;.&quot;ref&quot; != </span><span class="si">%s</span><span class="s1">) OR</span>
<span class="s1">                        &quot;res_partner&quot;.&quot;ref&quot; IS NULL</span>
<span class="s1">                    )</span>
<span class="s1">                )</span>
<span class="s1">            )</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQueries.test_order">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestQueries.test_order">[docs]</a>
    <span class="k">def</span> <span class="nf">test_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE ((&quot;res_partner&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">) AND (&quot;res_partner&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE ((&quot;res_partner&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">) AND (&quot;res_partner&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQueries.test_count">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestQueries.test_count">[docs]</a>
    <span class="k">def</span> <span class="nf">test_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT COUNT(*)</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE ((&quot;res_partner&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">) AND (&quot;res_partner&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">search_count</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestQueries.test_count_limit">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestQueries.test_count_limit">[docs]</a>
    <span class="k">def</span> <span class="nf">test_count_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT COUNT(*) FROM (</span>
<span class="s1">                SELECT FROM &quot;res_partner&quot;</span>
<span class="s1">                WHERE ((&quot;res_partner&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">) AND (&quot;res_partner&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">                LIMIT </span><span class="si">%s</span>
<span class="s1">            ) t</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">search_count</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)],</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQueries.test_translated_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestQueries.test_translated_field">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translated_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner_title&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner_title&quot;</span>
<span class="s1">            WHERE (COALESCE(&quot;res_partner_title&quot;.&quot;name&quot;-&gt;&gt;</span><span class="si">%s</span><span class="s1">, &quot;res_partner_title&quot;.&quot;name&quot;-&gt;&gt;</span><span class="si">%s</span><span class="s1">) like </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ORDER BY COALESCE(&quot;res_partner_title&quot;.&quot;name&quot;-&gt;&gt;</span><span class="si">%s</span><span class="s1">, &quot;res_partner_title&quot;.&quot;name&quot;-&gt;&gt;</span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT COUNT(*)</span>
<span class="s1">            FROM &quot;res_partner_title&quot;</span>
<span class="s1">            WHERE (&quot;res_partner_title&quot;.&quot;id&quot; = </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">search_count</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestQueries.test_access_rules">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestQueries.test_access_rules">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.models.unlink&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_access_rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.users&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.user_admin&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.rule&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.rule&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">([{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;users rule&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s1">&#39;res.users&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;domain_force&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]),</span>
        <span class="p">},</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;partners rule&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s1">&#39;res.partner&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;domain_force&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]),</span>
        <span class="p">}])</span>
        <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_users&quot;</span>
<span class="s1">            LEFT JOIN &quot;res_partner&quot; AS &quot;res_users__partner_id&quot; ON</span>
<span class="s1">                (&quot;res_users&quot;.&quot;partner_id&quot; = &quot;res_users__partner_id&quot;.&quot;id&quot;)</span>
<span class="s1">            WHERE (&quot;res_users&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            AND ((&quot;res_users&quot;.&quot;id&quot; = </span><span class="si">%s</span><span class="s1">) AND (&quot;res_users__partner_id&quot;.&quot;id&quot; = </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">            ORDER BY &quot;res_users__partner_id&quot;.&quot;name&quot;, &quot;res_users&quot;.&quot;login&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span></div>


<div class="viewcode-block" id="TestQueries.test_rec_names_search">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestQueries.test_rec_names_search">[docs]</a>
    <span class="k">def</span> <span class="nf">test_rec_names_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span>

        <span class="c1"># search on both &#39;name&#39; and &#39;model&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">_rec_names_search</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;ir_model&quot;.&quot;id&quot;, &quot;ir_model&quot;.&quot;name&quot;-&gt;&gt;</span><span class="si">%s</span>
<span class="s1">            FROM &quot;ir_model&quot;</span>
<span class="s1">            WHERE (</span>
<span class="s1">                (&quot;ir_model&quot;.&quot;name&quot;-&gt;&gt;</span><span class="si">%s</span><span class="s1"> ILIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">                OR (&quot;ir_model&quot;.&quot;model&quot;::text ILIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            )</span>
<span class="s1">            ORDER BY &quot;ir_model&quot;.&quot;model&quot;</span>
<span class="s1">            LIMIT </span><span class="si">%s</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">name_search</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;ir_model&quot;.&quot;id&quot;, &quot;ir_model&quot;.&quot;name&quot;-&gt;&gt;</span><span class="si">%s</span>
<span class="s1">            FROM &quot;ir_model&quot;</span>
<span class="s1">            WHERE (</span>
<span class="s1">                (&quot;ir_model&quot;.&quot;name&quot; is NULL OR &quot;ir_model&quot;.&quot;name&quot;-&gt;&gt;</span><span class="si">%s</span><span class="s1"> not ilike </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">                AND ((&quot;ir_model&quot;.&quot;model&quot;::text NOT ILIKE </span><span class="si">%s</span><span class="s1">) OR &quot;ir_model&quot;.&quot;model&quot; IS NULL)</span>
<span class="s1">            )</span>
<span class="s1">            ORDER BY &quot;ir_model&quot;.&quot;model&quot;</span>
<span class="s1">            LIMIT </span><span class="si">%s</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">Model</span><span class="o">.</span><span class="n">name_search</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="n">operator</span><span class="o">=</span><span class="s1">&#39;not ilike&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMany2one">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2one">[docs]</a>
<span class="k">class</span> <span class="nc">TestMany2one</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestMany2one.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2one.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">User</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.users&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.company&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMany2one.test_inherited">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2one.test_inherited">[docs]</a>
    <span class="k">def</span> <span class="nf">test_inherited</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_users&quot;</span>
<span class="s1">            LEFT JOIN &quot;res_partner&quot; AS &quot;res_users__partner_id&quot; ON</span>
<span class="s1">                (&quot;res_users&quot;.&quot;partner_id&quot; = &quot;res_users__partner_id&quot;.&quot;id&quot;)</span>
<span class="s1">            WHERE (&quot;res_users__partner_id&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ORDER BY &quot;res_users__partner_id&quot;.&quot;name&quot;, &quot;res_users&quot;.&quot;login&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span>

        <span class="c1"># the field supporting the inheritance should be auto_join, too</span>
        <span class="c1"># TODO: use another model, since &#39;res.users&#39; has explicit auto_join</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_users&quot;</span>
<span class="s1">            LEFT JOIN &quot;res_partner&quot; AS &quot;res_users__partner_id&quot; ON</span>
<span class="s1">                (&quot;res_users&quot;.&quot;partner_id&quot; = &quot;res_users__partner_id&quot;.&quot;id&quot;)</span>
<span class="s1">            WHERE (&quot;res_users__partner_id&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ORDER BY &quot;res_users__partner_id&quot;.&quot;name&quot;, &quot;res_users&quot;.&quot;login&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;partner_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestMany2one.test_regular">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2one.test_regular">[docs]</a>
    <span class="k">def</span> <span class="nf">test_regular</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.partner_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;BE&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;company_id&quot; = </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;company_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_company&quot;</span>
<span class="s1">                WHERE (&quot;res_company&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;company_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_company&quot;</span>
<span class="s1">                WHERE (&quot;res_company&quot;.&quot;partner_id&quot; IN (</span>
<span class="s1">                    SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">                    FROM &quot;res_partner&quot;</span>
<span class="s1">                    WHERE (&quot;res_partner&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">                ))</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.partner_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE ((&quot;res_partner&quot;.&quot;company_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_company&quot;</span>
<span class="s1">                WHERE (&quot;res_company&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            )) OR (&quot;res_partner&quot;.&quot;country_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_country&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_country&quot;</span>
<span class="s1">                WHERE (&quot;res_country&quot;.&quot;code&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            )))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([</span>
                <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;BE&#39;</span><span class="p">),</span>
            <span class="p">])</span></div>


<div class="viewcode-block" id="TestMany2one.test_explicit_subquery">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2one.test_explicit_subquery">[docs]</a>
    <span class="k">def</span> <span class="nf">test_explicit_subquery</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;company_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_company&quot;</span>
<span class="s1">                WHERE ((&quot;res_company&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">) AND (&quot;res_company&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">_search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">company_ids</span><span class="p">)])</span>

        <span class="c1"># special case, with a LIMIT to make ORDER BY necessary</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;company_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_company&quot;</span>
<span class="s1">                WHERE ((&quot;res_company&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">) AND (&quot;res_company&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">                ORDER BY &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                LIMIT </span><span class="si">%s</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">_search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">company_ids</span><span class="p">)])</span>

        <span class="c1"># special case, when the query has been &quot;forced&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_company&quot;</span>
<span class="s1">            WHERE ((&quot;res_company&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">) AND (&quot;res_company&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">            ORDER BY &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;company_id&quot; IN </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">_search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">company_ids</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">company_ids</span><span class="p">)])</span>

        <span class="c1"># special case, when the query has been build from a record</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_company&quot;</span>
<span class="s1">            WHERE ((&quot;res_company&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">) AND (&quot;res_company&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">            ORDER BY &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;company_id&quot; IN </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">companies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="n">companies</span><span class="o">.</span><span class="n">_as_query</span><span class="p">(</span><span class="n">ordered</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">company_ids</span><span class="p">)])</span>

        <span class="c1"># special case, when the query has been transformed to SQL</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;company_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_company&quot;</span>
<span class="s1">                WHERE ((&quot;res_company&quot;.&quot;active&quot; = </span><span class="si">%s</span><span class="s1">) AND (&quot;res_company&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="n">company_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">_search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">company_ids</span><span class="o">.</span><span class="n">subselect</span><span class="p">())])</span></div>


<div class="viewcode-block" id="TestMany2one.test_autojoin">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2one.test_autojoin">[docs]</a>
    <span class="k">def</span> <span class="nf">test_autojoin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># auto_join on the first many2one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;partner_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.partner_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            LEFT JOIN &quot;res_company&quot; AS &quot;res_partner__company_id&quot; ON</span>
<span class="s1">                (&quot;res_partner&quot;.&quot;company_id&quot; = &quot;res_partner__company_id&quot;.&quot;id&quot;)</span>
<span class="s1">            WHERE (&quot;res_partner__company_id&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            LEFT JOIN &quot;res_company&quot; AS &quot;res_partner__company_id&quot; ON</span>
<span class="s1">                (&quot;res_partner&quot;.&quot;company_id&quot; = &quot;res_partner__company_id&quot;.&quot;id&quot;)</span>
<span class="s1">            WHERE (&quot;res_partner__company_id&quot;.&quot;partner_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_partner&quot;</span>
<span class="s1">                WHERE (&quot;res_partner&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.partner_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="c1"># auto_join on the second many2one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;partner_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.partner_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;company_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_company&quot;</span>
<span class="s1">                LEFT JOIN &quot;res_partner&quot; AS &quot;res_company__partner_id&quot; ON</span>
<span class="s1">                    (&quot;res_company&quot;.&quot;partner_id&quot; = &quot;res_company__partner_id&quot;.&quot;id&quot;)</span>
<span class="s1">                WHERE (&quot;res_company__partner_id&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.partner_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="c1"># auto_join on both many2one</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;partner_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.partner_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            LEFT JOIN &quot;res_company&quot; AS &quot;res_partner__company_id&quot; ON</span>
<span class="s1">                (&quot;res_partner&quot;.&quot;company_id&quot; = &quot;res_partner__company_id&quot;.&quot;id&quot;)</span>
<span class="s1">            LEFT JOIN &quot;res_partner&quot; AS &quot;res_partner__company_id__partner_id&quot; ON</span>
<span class="s1">                (&quot;res_partner__company_id&quot;.&quot;partner_id&quot; = &quot;res_partner__company_id__partner_id&quot;.&quot;id&quot;)</span>
<span class="s1">            WHERE (&quot;res_partner__company_id__partner_id&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id.partner_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="c1"># union with two auto_join</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;company_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;country_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([</span>
            <span class="s1">&#39;|&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;BE&#39;</span><span class="p">),</span>
        <span class="p">])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            LEFT JOIN &quot;res_country&quot; AS &quot;res_partner__country_id&quot; ON</span>
<span class="s1">                (&quot;res_partner&quot;.&quot;country_id&quot; = &quot;res_partner__country_id&quot;.&quot;id&quot;)</span>
<span class="s1">            LEFT JOIN &quot;res_company&quot; AS &quot;res_partner__company_id&quot; ON</span>
<span class="s1">                (&quot;res_partner&quot;.&quot;company_id&quot; = &quot;res_partner__company_id&quot;.&quot;id&quot;)</span>
<span class="s1">            WHERE ((&quot;res_partner__company_id&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">                OR (&quot;res_partner__country_id&quot;.&quot;code&quot;::text LIKE </span><span class="si">%s</span><span class="s1">))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([</span>
                <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;BE&#39;</span><span class="p">),</span>
            <span class="p">])</span></div>


<div class="viewcode-block" id="TestMany2one.test_name_search">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2one.test_name_search">[docs]</a>
    <span class="k">def</span> <span class="nf">test_name_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;company_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_company&quot;</span>
<span class="s1">                WHERE (&quot;res_company&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE ((&quot;res_partner&quot;.&quot;company_id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                FROM &quot;res_company&quot;</span>
<span class="s1">                WHERE ((&quot;res_company&quot;.&quot;name&quot;::text not like </span><span class="si">%s</span><span class="s1">) OR &quot;res_company&quot;.&quot;name&quot; IS NULL))</span>
<span class="s1">            ) OR &quot;res_partner&quot;.&quot;company_id&quot; IS NULL)</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not like&#39;</span><span class="p">,</span> <span class="s2">&quot;blablabla&quot;</span><span class="p">)])</span></div>
</div>



<div class="viewcode-block" id="TestOne2many">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestOne2many">[docs]</a>
<span class="k">class</span> <span class="nc">TestOne2many</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestOne2many.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestOne2many.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Foo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bank_ids&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">Command</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;acc_number&#39;</span><span class="p">:</span> <span class="s1">&#39;123&#39;</span><span class="p">,</span> <span class="s1">&#39;acc_type&#39;</span><span class="p">:</span> <span class="s1">&#39;bank&#39;</span><span class="p">}),</span>
                <span class="n">Command</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;acc_number&#39;</span><span class="p">:</span> <span class="s1">&#39;456&#39;</span><span class="p">,</span> <span class="s1">&#39;acc_type&#39;</span><span class="p">:</span> <span class="s1">&#39;bank&#39;</span><span class="p">}),</span>
                <span class="n">Command</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;acc_number&#39;</span><span class="p">:</span> <span class="s1">&#39;789&#39;</span><span class="p">,</span> <span class="s1">&#39;acc_type&#39;</span><span class="p">:</span> <span class="s1">&#39;bank&#39;</span><span class="p">}),</span>
            <span class="p">],</span>
        <span class="p">})</span></div>


<div class="viewcode-block" id="TestOne2many.test_regular">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestOne2many.test_regular">[docs]</a>
    <span class="k">def</span> <span class="nf">test_regular</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span><span class="o">.</span><span class="n">bank_ids</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                WHERE &quot;res_partner_bank&quot;.&quot;id&quot; IN </span><span class="si">%s</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span><span class="o">.</span><span class="n">bank_ids</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                WHERE (&quot;res_partner_bank&quot;.&quot;sanitized_acc_number&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner&quot;.&quot;parent_id&quot;</span>
<span class="s1">                FROM &quot;res_partner&quot;</span>
<span class="s1">                WHERE (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                    SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                    FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                    WHERE (&quot;res_partner_bank&quot;.&quot;sanitized_acc_number&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">                )) AND &quot;res_partner&quot;.&quot;parent_id&quot; IS NOT NULL</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestOne2many.test_autojoin">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestOne2many.test_autojoin">[docs]</a>
    <span class="k">def</span> <span class="nf">test_autojoin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;child_ids&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span><span class="o">.</span><span class="n">bank_ids</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                WHERE &quot;res_partner_bank&quot;.&quot;id&quot; IN </span><span class="si">%s</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span><span class="o">.</span><span class="n">bank_ids</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                WHERE (&quot;res_partner_bank&quot;.&quot;sanitized_acc_number&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE ((&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                WHERE (&quot;res_partner_bank&quot;.&quot;sanitized_acc_number&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            )) AND (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                WHERE (&quot;res_partner_bank&quot;.&quot;sanitized_acc_number&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            )))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;45&#39;</span><span class="p">),</span>
            <span class="p">])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; IN</span>
<span class="s1">                     (SELECT &quot;res_partner&quot;.&quot;parent_id&quot;</span>
<span class="s1">                      FROM &quot;res_partner&quot;</span>
<span class="s1">                      WHERE ((&quot;res_partner&quot;.&quot;active&quot; = TRUE) AND (&quot;res_partner&quot;.&quot;id&quot; IN</span>
<span class="s1">                                (SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                                 FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                                 WHERE (&quot;res_partner_bank&quot;.&quot;sanitized_acc_number&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)))</span>
<span class="s1">                             )))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.bank_ids.sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)])</span>

        <span class="c1"># check domains on one2many fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">],</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span>
                   <span class="p">[(</span><span class="s1">&#39;sanitized_acc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;child_ids&#39;</span><span class="p">],</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span>
                   <span class="k">lambda</span> <span class="bp">self</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner&quot;.&quot;parent_id&quot;</span>
<span class="s1">                FROM &quot;res_partner&quot;</span>
<span class="s1">                WHERE ((</span>
<span class="s1">                    (&quot;res_partner&quot;.&quot;name&quot; != </span><span class="si">%s</span><span class="s1">) OR &quot;res_partner&quot;.&quot;name&quot; IS NULL</span>
<span class="s1">                ) AND (</span>
<span class="s1">                    &quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                        SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                        FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                        WHERE ((</span>
<span class="s1">                            &quot;res_partner_bank&quot;.&quot;id&quot; IN </span><span class="si">%s</span>
<span class="s1">                        ) AND (</span>
<span class="s1">                            &quot;res_partner_bank&quot;.&quot;sanitized_acc_number&quot;::text LIKE </span><span class="si">%s</span>
<span class="s1">                        ))</span>
<span class="s1">                    )</span>
<span class="s1">                ))</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.bank_ids.id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">partner</span><span class="o">.</span><span class="n">bank_ids</span><span class="o">.</span><span class="n">ids</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestOne2many.test_autojoin_mixed">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestOne2many.test_autojoin_mixed">[docs]</a>
    <span class="k">def</span> <span class="nf">test_autojoin_mixed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;child_ids&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;state_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">state_id</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;country_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.state_id.country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner&quot;.&quot;parent_id&quot;</span>
<span class="s1">                FROM &quot;res_partner&quot;</span>
<span class="s1">                LEFT JOIN &quot;res_country_state&quot; AS &quot;res_partner__state_id&quot;</span>
<span class="s1">                    ON (&quot;res_partner&quot;.&quot;state_id&quot; = &quot;res_partner__state_id&quot;.&quot;id&quot;)</span>
<span class="s1">                LEFT JOIN &quot;res_country&quot; AS &quot;res_partner__state_id__country_id&quot;</span>
<span class="s1">                    ON (&quot;res_partner__state_id&quot;.&quot;country_id&quot; = &quot;res_partner__state_id__country_id&quot;.&quot;id&quot;)</span>
<span class="s1">                WHERE ((</span>
<span class="s1">                    &quot;res_partner&quot;.&quot;active&quot; = TRUE</span>
<span class="s1">                ) AND (</span>
<span class="s1">                    &quot;res_partner__state_id__country_id&quot;.&quot;code&quot;::text LIKE </span><span class="si">%s</span>
<span class="s1">                ))</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;child_ids.state_id.country_id.code&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;US&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestOne2many.test_name_search">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestOne2many.test_name_search">[docs]</a>
    <span class="k">def</span> <span class="nf">test_name_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                WHERE (&quot;res_partner_bank&quot;.&quot;sanitized_acc_number&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;complete_name&quot;asc,&quot;res_partner&quot;.&quot;id&quot;desc</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;12&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestOne2many.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestOne2many.test_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; IN (</span>
<span class="s1">                SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                WHERE &quot;res_partner_bank&quot;.&quot;partner_id&quot; IS NOT NULL</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_partner&quot;</span>
<span class="s1">            WHERE (&quot;res_partner&quot;.&quot;id&quot; NOT IN (</span>
<span class="s1">                SELECT &quot;res_partner_bank&quot;.&quot;partner_id&quot;</span>
<span class="s1">                FROM &quot;res_partner_bank&quot;</span>
<span class="s1">                WHERE &quot;res_partner_bank&quot;.&quot;partner_id&quot; IS NOT NULL</span>
<span class="s1">            ))</span>
<span class="s1">            ORDER BY &quot;res_partner&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Partner</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;bank_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestMany2many">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2many">[docs]</a>
<span class="k">class</span> <span class="nc">TestMany2many</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestMany2many.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2many.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">User</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.users&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.company&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMany2many.test_regular">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2many.test_regular">[docs]</a>
    <span class="k">def</span> <span class="nf">test_regular</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.group_user&#39;</span><span class="p">)</span>
        <span class="n">rule</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">rule_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">ids</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id.rule_groups.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_users&quot;</span>
<span class="s1">            WHERE EXISTS (</span>
<span class="s1">                SELECT 1 FROM &quot;res_groups_users_rel&quot; AS &quot;res_users__groups_id&quot;</span>
<span class="s1">                WHERE &quot;res_users__groups_id&quot;.&quot;uid&quot; = &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">                AND &quot;res_users__groups_id&quot;.&quot;gid&quot; IN </span><span class="si">%s</span>
<span class="s1">            )</span>
<span class="s1">            ORDER BY &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">ids</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="n">group_color</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">color</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_users&quot;</span>
<span class="s1">            WHERE NOT EXISTS (</span>
<span class="s1">                SELECT 1 FROM &quot;res_groups_users_rel&quot; AS &quot;res_users__groups_id&quot;</span>
<span class="s1">                WHERE &quot;res_users__groups_id&quot;.&quot;uid&quot; = &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">                AND &quot;res_users__groups_id&quot;.&quot;gid&quot; IN </span><span class="si">%s</span>
<span class="s1">            )</span>
<span class="s1">            ORDER BY &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not in&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">ids</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_users&quot;</span>
<span class="s1">            WHERE EXISTS (</span>
<span class="s1">                SELECT 1 FROM &quot;res_groups_users_rel&quot; AS &quot;res_users__groups_id&quot;</span>
<span class="s1">                WHERE &quot;res_users__groups_id&quot;.&quot;uid&quot; = &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">                AND &quot;res_users__groups_id&quot;.&quot;gid&quot; IN (</span>
<span class="s1">                    SELECT &quot;res_groups&quot;.&quot;id&quot;</span>
<span class="s1">                    FROM &quot;res_groups&quot;</span>
<span class="s1">                    WHERE (&quot;res_groups&quot;.&quot;color&quot; = </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">                )</span>
<span class="s1">            )</span>
<span class="s1">            ORDER BY &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id.color&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="n">group_color</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_users&quot;</span>
<span class="s1">            WHERE EXISTS (</span>
<span class="s1">                SELECT 1 FROM &quot;res_groups_users_rel&quot; AS &quot;res_users__groups_id&quot;</span>
<span class="s1">                WHERE &quot;res_users__groups_id&quot;.&quot;uid&quot; = &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">                AND &quot;res_users__groups_id&quot;.&quot;gid&quot; IN (</span>
<span class="s1">                    SELECT &quot;res_groups&quot;.&quot;id&quot;</span>
<span class="s1">                    FROM &quot;res_groups&quot;</span>
<span class="s1">                    WHERE EXISTS (</span>
<span class="s1">                        SELECT 1 FROM &quot;rule_group_rel&quot; AS &quot;res_groups__rule_groups&quot;</span>
<span class="s1">                        WHERE &quot;res_groups__rule_groups&quot;.&quot;group_id&quot; = &quot;res_groups&quot;.&quot;id&quot;</span>
<span class="s1">                        AND &quot;res_groups__rule_groups&quot;.&quot;rule_group_id&quot; IN (</span>
<span class="s1">                            SELECT &quot;ir_rule&quot;.&quot;id&quot;</span>
<span class="s1">                            FROM &quot;ir_rule&quot;</span>
<span class="s1">                            WHERE (&quot;ir_rule&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">                        )</span>
<span class="s1">                    )</span>
<span class="s1">                )</span>
<span class="s1">            )</span>
<span class="s1">            ORDER BY &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id.rule_groups.name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="n">rule</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMany2many.test_autojoin">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2many.test_autojoin">[docs]</a>
    <span class="k">def</span> <span class="nf">test_autojoin</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;groups_id&#39;</span><span class="p">],</span> <span class="s1">&#39;auto_join&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestMany2many.test_name_search">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2many.test_name_search">[docs]</a>
    <span class="k">def</span> <span class="nf">test_name_search</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_users&quot;</span>
<span class="s1">            WHERE EXISTS (</span>
<span class="s1">                SELECT 1 FROM &quot;res_company_users_rel&quot; AS &quot;res_users__company_ids&quot;</span>
<span class="s1">                WHERE &quot;res_users__company_ids&quot;.&quot;user_id&quot; = &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">                AND &quot;res_users__company_ids&quot;.&quot;cid&quot; IN (</span>
<span class="s1">                    SELECT &quot;res_company&quot;.&quot;id&quot;</span>
<span class="s1">                    FROM &quot;res_company&quot;</span>
<span class="s1">                    WHERE (&quot;res_company&quot;.&quot;name&quot;::text LIKE </span><span class="si">%s</span><span class="s1">)</span>
<span class="s1">                )</span>
<span class="s1">            )</span>
<span class="s1">            ORDER BY &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;company_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">company</span><span class="o">.</span><span class="n">name</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestMany2many.test_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestMany2many.test_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_users&quot;</span>
<span class="s1">            WHERE EXISTS (</span>
<span class="s1">                SELECT 1 FROM &quot;res_groups_users_rel&quot; AS &quot;res_users__groups_id&quot;</span>
<span class="s1">                WHERE &quot;res_users__groups_id&quot;.&quot;uid&quot; = &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            )</span>
<span class="s1">            ORDER BY &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueries</span><span class="p">([</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            SELECT &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            FROM &quot;res_users&quot;</span>
<span class="s1">            WHERE NOT EXISTS (</span>
<span class="s1">                SELECT 1 FROM &quot;res_groups_users_rel&quot; AS &quot;res_users__groups_id&quot;</span>
<span class="s1">                WHERE &quot;res_users__groups_id&quot;.&quot;uid&quot; = &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">            )</span>
<span class="s1">            ORDER BY &quot;res_users&quot;.&quot;id&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">User</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;groups_id&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestPrettifyDomain">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestPrettifyDomain">[docs]</a>
<span class="k">class</span> <span class="nc">TestPrettifyDomain</span><span class="p">(</span><span class="n">BaseCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestPrettifyDomain.test_prettify_domain">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestPrettifyDomain.test_prettify_domain">[docs]</a>
    <span class="k">def</span> <span class="nf">test_prettify_domain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_Case</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">namedtuple</span><span class="p">(</span><span class="s1">&#39;Case&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;dom&#39;</span><span class="p">,</span> <span class="s1">&#39;pretty&#39;</span><span class="p">))</span>

        <span class="n">test_matrix</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">_Case</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;single leaf&#39;</span><span class="p">,</span>
                <span class="n">dom</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">)],</span>
                <span class="n">pretty</span><span class="o">=</span><span class="s2">&quot;[(&#39;name&#39;, &#39;=&#39;, &#39;Jack&#39;)]&quot;</span>
            <span class="p">),</span>
            <span class="n">_Case</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;not&#39;</span><span class="p">,</span>
                <span class="n">dom</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Apophis&#39;</span><span class="p">)],</span>
                <span class="n">pretty</span><span class="o">=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                    [&#39;!&#39;,</span>
<span class="s2">                        (&#39;name&#39;, &#39;=&#39;, &#39;Apophis&#39;)]</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="n">_Case</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;single and&#39;</span><span class="p">,</span>
                <span class="n">dom</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                        <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Colonel&#39;</span><span class="p">)],</span>
                <span class="n">pretty</span><span class="o">=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                    [&#39;&amp;&#39;,</span>
<span class="s2">                        (&#39;name&#39;, &#39;=&#39;, &#39;Jack&#39;),</span>
<span class="s2">                        (&#39;function&#39;, &#39;=&#39;, &#39;Colonel&#39;)]</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="n">_Case</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;multiple and&#39;</span><span class="p">,</span>
                <span class="n">dom</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                        <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s2">&quot;O&#39;Neill&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Colonel&#39;</span><span class="p">)],</span>
                <span class="n">pretty</span><span class="o">=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                    [&#39;&amp;&#39;, &#39;&amp;&#39;,</span>
<span class="s2">                        (&#39;name&#39;, &#39;like&#39;, &#39;Jack&#39;),</span>
<span class="s2">                        (&#39;name&#39;, &#39;like&#39;, &quot;O&#39;Neill&quot;),</span>
<span class="s2">                        (&#39;function&#39;, &#39;=&#39;, &#39;Colonel&#39;)]</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="n">_Case</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;and or&#39;</span><span class="p">,</span>
                <span class="n">dom</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                            <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                            <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;like&#39;</span><span class="p">,</span> <span class="s2">&quot;O&#39;Neill&quot;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;function&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Colonel&#39;</span><span class="p">)],</span>
                <span class="n">pretty</span><span class="o">=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                    [&#39;&amp;&#39;,</span>
<span class="s2">                        &#39;|&#39;,</span>
<span class="s2">                            (&#39;name&#39;, &#39;like&#39;, &#39;Jack&#39;),</span>
<span class="s2">                            (&#39;name&#39;, &#39;like&#39;, &quot;O&#39;Neill&quot;),</span>
<span class="s2">                        (&#39;function&#39;, &#39;=&#39;, &#39;Colonel&#39;)]</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="n">_Case</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;any single&#39;</span><span class="p">,</span>
                <span class="n">dom</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;company&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">)])],</span>
                <span class="n">pretty</span><span class="o">=</span><span class="s2">&quot;[(&#39;company&#39;, &#39;any&#39;, [(&#39;name&#39;, &#39;=&#39;, &#39;SGC&#39;)])]&quot;</span>
            <span class="p">),</span>
            <span class="n">_Case</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s1">&#39;any or&#39;</span><span class="p">,</span>
                <span class="n">dom</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;company&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;|&#39;</span><span class="p">,</span>
                        <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">),</span>
                        <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Stargate Command&#39;</span><span class="p">)])],</span>
                <span class="n">pretty</span><span class="o">=</span><span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">                    [(&#39;company&#39;, &#39;any&#39;, [&#39;|&#39;,</span>
<span class="s2">                        (&#39;name&#39;, &#39;=&#39;, &#39;SGC&#39;),</span>
<span class="s2">                        (&#39;name&#39;, &#39;=&#39;, &#39;Stargate Command&#39;)])]</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="p">)</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">case</span> <span class="ow">in</span> <span class="n">test_matrix</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">case</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">pretty_domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">prettify_domain</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">dom</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">pretty_domain</span><span class="p">,</span> <span class="n">case</span><span class="o">.</span><span class="n">pretty</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">literal_eval</span><span class="p">(</span><span class="n">case</span><span class="o">.</span><span class="n">pretty</span><span class="p">),</span> <span class="n">case</span><span class="o">.</span><span class="n">dom</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestAnyfy">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy">[docs]</a>
<span class="k">class</span> <span class="nc">TestAnyfy</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_test_combine_anies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="n">anyfied_domain</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">domain_combine_anies</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">anyfied_domain</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span>
                                <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">For initial domain: </span><span class="si">{</span><span class="n">domain</span><span class="si">}</span><span class="se">\n</span><span class="s1">Became: </span><span class="si">{</span><span class="n">anyfied_domain</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="TestAnyfy.test_true_leaf_as_list">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_true_leaf_as_list">[docs]</a>
    <span class="k">def</span> <span class="nf">test_true_leaf_as_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_single_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_single_field">[docs]</a>
    <span class="k">def</span> <span class="nf">test_single_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">)</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">)</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_single_many2one_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_single_many2one_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_single_many2one_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">)]),</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_single_one2many_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_single_one2many_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_single_one2many_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">)]),</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_and_multiple_fields">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_and_multiple_fields">[docs]</a>
    <span class="k">def</span> <span class="nf">test_and_multiple_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_or_multiple_fields">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_or_multiple_fields">[docs]</a>
    <span class="k">def</span> <span class="nf">test_or_multiple_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_and_multiple_many2one_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_and_multiple_many2one_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_and_multiple_many2one_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;NID&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Free Jaffa Nation&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;NID&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Free Jaffa Nation&#39;</span><span class="p">),</span>
            <span class="p">])</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_or_multiple_many2one_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_or_multiple_many2one_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_or_multiple_many2one_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;NID&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Free Jaffa Nation&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;NID&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Free Jaffa Nation&#39;</span><span class="p">),</span>
            <span class="p">])</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_and_multiple_one2many_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_and_multiple_one2many_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_and_multiple_one2many_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
            <span class="p">(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">)]),</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_or_multiple_one2many_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_or_multiple_one2many_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_or_multiple_one2many_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
            <span class="p">])</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_not_single_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_not_single_field">[docs]</a>
    <span class="k">def</span> <span class="nf">test_not_single_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">)</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">)</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_not_single_many2one_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_not_single_many2one_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_not_single_many2one_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">)</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">)])</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_not_single_one2many_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_not_single_one2many_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_not_single_one2many_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">)</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">)])</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_not_or_multiple_fields">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_not_or_multiple_fields">[docs]</a>
    <span class="k">def</span> <span class="nf">test_not_or_multiple_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;!=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_not_and_multiple_many2one_field_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_not_and_multiple_many2one_field_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_not_and_multiple_many2one_field_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;NID&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Free Jaffa Nation&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not any&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;NID&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Free Jaffa Nation&#39;</span><span class="p">),</span>
            <span class="p">])</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_not_or_multiple_many2one_field_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_not_or_multiple_many2one_field_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_not_or_multiple_many2one_field_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;NID&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;company_id.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Free Jaffa Nation&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;company_id&#39;</span><span class="p">,</span> <span class="s1">&#39;not any&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;SGC&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;NID&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Free Jaffa Nation&#39;</span><span class="p">),</span>
            <span class="p">])</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_not_and_multiple_one2many_field_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_not_and_multiple_one2many_field_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_not_and_multiple_one2many_field_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span> <span class="s1">&#39;&amp;&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">)]),</span>
                <span class="p">(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">)]),</span>
                <span class="p">(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not any&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">)]),</span>
        <span class="p">])</span></div>


<div class="viewcode-block" id="TestAnyfy.test_not_or_multiple_one2many_field_with_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_expression.TestAnyfy.test_not_or_multiple_one2many_field_with_subfield">[docs]</a>
    <span class="k">def</span> <span class="nf">test_not_or_multiple_one2many_field_with_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_combine_anies</span><span class="p">([</span>
            <span class="s1">&#39;!&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;child_ids.name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
        <span class="p">],</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;child_ids&#39;</span><span class="p">,</span> <span class="s1">&#39;not any&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;|&#39;</span><span class="p">,</span> <span class="s1">&#39;|&#39;</span><span class="p">,</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Jack&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Daniel&#39;</span><span class="p">),</span>
            <span class="p">])</span>
        <span class="p">])</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Amr.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>