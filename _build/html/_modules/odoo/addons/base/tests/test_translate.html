<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>odoo.addons.base.tests.test_translate &mdash; Amr  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Amr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">odoo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Amr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../../odoo.html">odoo</a></li>
          <li class="breadcrumb-item"><a href="../../base.html">odoo.addons.base</a></li>
      <li class="breadcrumb-item active">odoo.addons.base.tests.test_translate</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for odoo.addons.base.tests.test_translate</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Part of Odoo. See LICENSE file for full copyright and licensing details.</span>
<span class="kn">from</span> <span class="nn">hashlib</span> <span class="kn">import</span> <span class="n">sha256</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">psycopg2</span> <span class="kn">import</span> <span class="n">IntegrityError</span>
<span class="kn">from</span> <span class="nn">psycopg2.extras</span> <span class="kn">import</span> <span class="n">Json</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="kn">from</span> <span class="nn">odoo.exceptions</span> <span class="kn">import</span> <span class="n">UserError</span>
<span class="kn">from</span> <span class="nn">odoo.tools</span> <span class="kn">import</span> <span class="n">sql</span>
<span class="kn">from</span> <span class="nn">odoo.tools.translate</span> <span class="kn">import</span> <span class="n">quote</span><span class="p">,</span> <span class="n">unquote</span><span class="p">,</span> <span class="n">xml_translate</span><span class="p">,</span> <span class="n">html_translate</span><span class="p">,</span> <span class="n">TranslationImporter</span><span class="p">,</span> <span class="n">TranslationModuleReader</span>
<span class="kn">from</span> <span class="nn">odoo.tests.common</span> <span class="kn">import</span> <span class="n">TransactionCase</span><span class="p">,</span> <span class="n">BaseCase</span><span class="p">,</span> <span class="n">new_test_user</span><span class="p">,</span> <span class="n">tagged</span>

<span class="n">_stats_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s1">&#39;odoo.tests.stats&#39;</span><span class="p">)</span>

<span class="c1"># a string with various unicode characters</span>
<span class="n">SPECIAL_CHARACTERS</span> <span class="o">=</span> <span class="s2">&quot; ¥®°²Æçéðπ⁉€∇⓵▲☑♂♥✓➔『にㄅ㊀中한︸🌈🌍👌😀&quot;</span>


<div class="viewcode-block" id="TranslationToolsTestCase">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase">[docs]</a>
<span class="k">class</span> <span class="nc">TranslationToolsTestCase</span><span class="p">(</span><span class="n">BaseCase</span><span class="p">):</span>
<div class="viewcode-block" id="TranslationToolsTestCase.assertItemsEqual">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.assertItemsEqual">[docs]</a>
    <span class="k">def</span> <span class="nf">assertItemsEqual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_quote_unquote">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_quote_unquote">[docs]</a>
    <span class="k">def</span> <span class="nf">test_quote_unquote</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">test_string</span><span class="p">(</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">quoted</span> <span class="o">=</span> <span class="n">quote</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
            <span class="c1">#print &quot;\n1:&quot;, repr(str)</span>
            <span class="c1">#print &quot;2:&quot;, repr(quoted)</span>
            <span class="n">unquoted</span> <span class="o">=</span> <span class="n">unquote</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">quoted</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="se">\n</span><span class="s1">&quot;&#39;</span><span class="p">)))</span>
            <span class="c1">#print &quot;3:&quot;, repr(unquoted)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unquoted</span><span class="p">)</span>

        <span class="n">test_string</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;test </span><span class="se">\n</span><span class="s2">all kinds</span><span class="se">\n</span><span class="s2"> </span><span class="se">\n</span><span class="s2"> o</span><span class="se">\r</span>
<span class="s2">         </span><span class="se">\\\\</span><span class="s2"> nope</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="s2">         &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># The ones with 1+ backslashes directly followed by</span>
        <span class="c1"># a newline or literal N can fail... we would need a</span>
        <span class="c1"># state-machine parser to handle these, but this would</span>
        <span class="c1"># be much slower so it&#39;s better to avoid them at the moment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="n">quote</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;test </span><span class="se">\n</span><span class="s2">all kinds</span><span class="se">\n\n</span><span class="s2">o</span><span class="se">\r</span>
<span class="s2">         </span><span class="se">\\\\</span><span class="s2">nope</span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="s2">         &quot;&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_base">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_base">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() without formatting elements. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;form string=&quot;Form stuff&quot;&gt;</span>
<span class="s2">                        &lt;h1&gt;Blah blah blah&lt;/h1&gt;</span>
<span class="s2">                        Put some more text here</span>
<span class="s2">                        &lt;field name=&quot;foo&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;Form stuff&#39;</span><span class="p">,</span> <span class="s1">&#39;Blah blah blah&#39;</span><span class="p">,</span> <span class="s1">&#39;Put some more text here&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_text">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_text">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() on plain text. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;Blah blah blah&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="p">[</span><span class="n">source</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_unicode">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_unicode">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_unicode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() on plain text with unicode characters. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;Un heureux évènement&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="p">[</span><span class="n">source</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_text_entity">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_text_entity">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_text_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() on plain text with HTML escaped entities. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;Blah&amp;amp;nbsp;blah&amp;amp;nbsp;blah&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="p">[</span><span class="n">source</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_inline1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_inline1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_inline1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() with formatting elements. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;form string=&quot;Form stuff&quot;&gt;</span>
<span class="s2">                        &lt;h1&gt;Blah &lt;i&gt;blah&lt;/i&gt; blah&lt;/h1&gt;</span>
<span class="s2">                        Put some &lt;b&gt;more text&lt;/b&gt; here</span>
<span class="s2">                        &lt;field name=&quot;foo&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;Form stuff&#39;</span><span class="p">,</span> <span class="s1">&#39;Blah &lt;i&gt;blah&lt;/i&gt; blah&#39;</span><span class="p">,</span> <span class="s1">&#39;Put some &lt;b&gt;more text&lt;/b&gt; here&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_inline2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_inline2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_inline2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() with formatting elements embedding other elements. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;form string=&quot;Form stuff&quot;&gt;</span>
<span class="s2">                        &lt;b&gt;&lt;h1&gt;Blah &lt;i&gt;blah&lt;/i&gt; blah&lt;/h1&gt;&lt;/b&gt;</span>
<span class="s2">                        Put &lt;em&gt;some &lt;b&gt;more text&lt;/b&gt;&lt;/em&gt; here</span>
<span class="s2">                        &lt;field name=&quot;foo&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;Form stuff&#39;</span><span class="p">,</span> <span class="s1">&#39;Blah &lt;i&gt;blah&lt;/i&gt; blah&#39;</span><span class="p">,</span> <span class="s1">&#39;Put &lt;em&gt;some &lt;b&gt;more text&lt;/b&gt;&lt;/em&gt; here&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_inline3">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_inline3">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_inline3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() with formatting elements without actual text. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;form string=&quot;Form stuff&quot;&gt;</span>
<span class="s2">                        &lt;div&gt;</span>
<span class="s2">                            &lt;span class=&quot;before&quot;/&gt;</span>
<span class="s2">                            &lt;h1&gt;Blah blah blah&lt;/h1&gt;</span>
<span class="s2">                            &lt;span class=&quot;after&quot;&gt;</span>
<span class="s2">                                &lt;i class=&quot;hack&quot;/&gt;</span>
<span class="s2">                            &lt;/span&gt;</span>
<span class="s2">                        &lt;/div&gt;</span>
<span class="s2">                    &lt;/form&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;Form stuff&#39;</span><span class="p">,</span> <span class="s1">&#39;Blah blah blah&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_inline4">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_inline4">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_inline4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() with inline elements with translated attrs only. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;form string=&quot;Form stuff&quot;&gt;</span>
<span class="s2">                        &lt;div&gt;</span>
<span class="s2">                            &lt;label for=&quot;stuff&quot;/&gt;</span>
<span class="s2">                            &lt;span class=&quot;fa fa-globe&quot; title=&quot;Title stuff&quot;/&gt;</span>
<span class="s2">                        &lt;/div&gt;</span>
<span class="s2">                    &lt;/form&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;Form stuff&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;span class=&quot;fa fa-globe&quot; title=&quot;Title stuff&quot;/&gt;&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_inline5">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_inline5">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_inline5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() with inline elements with empty translated attrs only. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;form string=&quot;Form stuff&quot;&gt;</span>
<span class="s2">                        &lt;div&gt;</span>
<span class="s2">                            &lt;label for=&quot;stuff&quot;/&gt;</span>
<span class="s2">                            &lt;span class=&quot;fa fa-globe&quot; title=&quot;&quot;/&gt;</span>
<span class="s2">                        &lt;/div&gt;</span>
<span class="s2">                    &lt;/form&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Form stuff&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_t">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_t">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_t</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() with t-* attributes. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;t t-name=&quot;stuff&quot;&gt;</span>
<span class="s2">                        stuff before</span>
<span class="s2">                        &lt;span t-field=&quot;o.name&quot;/&gt;</span>
<span class="s2">                        stuff after</span>
<span class="s2">                    &lt;/t&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;stuff before&#39;</span><span class="p">,</span> <span class="s1">&#39;stuff after&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_off">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_off">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_off</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() with attribute translate=&quot;off&quot;. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;div&gt;</span>
<span class="s2">                        stuff before</span>
<span class="s2">                        &lt;div t-translation=&quot;off&quot;&gt;Do not translate this&lt;/div&gt;</span>
<span class="s2">                        stuff after</span>
<span class="s2">                    &lt;/div&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;stuff before&#39;</span><span class="p">,</span> <span class="s1">&#39;stuff after&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_attribute">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_attribute">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() with &lt;attribute&gt; elements. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;field name=&quot;foo&quot; position=&quot;attributes&quot;&gt;</span>
<span class="s2">                        &lt;attribute name=&quot;string&quot;&gt;Translate this&lt;/attribute&gt;</span>
<span class="s2">                        &lt;attribute name=&quot;option&quot;&gt;Do not translate this&lt;/attribute&gt;</span>
<span class="s2">                    &lt;/field&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;Translate this&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_a">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_a">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() with &lt;a&gt; elements. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;t t-name=&quot;stuff&quot;&gt;</span>
<span class="s2">                        &lt;ul class=&quot;nav navbar-nav&quot;&gt;</span>
<span class="s2">                            &lt;li class=&quot;nav-item&quot;&gt;</span>
<span class="s2">                                &lt;a class=&quot;nav-link oe_menu_leaf&quot; href=&quot;/web#menu_id=42&amp;amp;action=54&quot;&gt;</span>
<span class="s2">                                    &lt;span class=&quot;oe_menu_text&quot;&gt;Blah&lt;/span&gt;</span>
<span class="s2">                                &lt;/a&gt;</span>
<span class="s2">                            &lt;/li&gt;</span>
<span class="s2">                        &lt;/ul&gt;</span>
<span class="s2">                    &lt;/t&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;&lt;span class=&quot;oe_menu_text&quot;&gt;Blah&lt;/span&gt;&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_with_namespace">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_with_namespace">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_with_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() on elements with namespaces. &quot;&quot;&quot;</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># do not slit the long line below, otherwise the result will not match</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;Invoice xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot; xmlns:cbc=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2&quot; xmlns=&quot;urn:oasis:names:specification:ubl:schema:xsd:Invoice-2&quot;&gt;</span>
<span class="s2">                        &lt;cbc:UBLVersionID t-esc=&quot;version_id&quot;/&gt;</span>
<span class="s2">                        &lt;t t-foreach=&quot;[1, 2, 3, 4]&quot; t-as=&quot;value&quot;&gt;</span>
<span class="s2">                            Oasis &lt;cac:Test t-esc=&quot;value&quot;/&gt;</span>
<span class="s2">                        &lt;/t&gt;</span>
<span class="s2">                    &lt;/Invoice&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">terms</span><span class="o">.</span><span class="n">append</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertItemsEqual</span><span class="p">(</span><span class="n">terms</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Oasis&#39;</span><span class="p">])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">term</span><span class="p">:</span> <span class="n">term</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_invalid_translations">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_invalid_translations">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_invalid_translations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() with invalid translations. &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;form string=&quot;Form stuff&quot;&gt;</span>
<span class="s2">                        &lt;h1&gt;Blah &lt;i&gt;blah&lt;/i&gt; blah&lt;/h1&gt;</span>
<span class="s2">                        Put some &lt;b&gt;more text&lt;/b&gt; here</span>
<span class="s2">                        &lt;field name=&quot;foo&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;&quot;&quot;&quot;</span>
        <span class="n">translations</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Put some &lt;b&gt;more text&lt;/b&gt; here&quot;</span><span class="p">:</span> <span class="s2">&quot;Mettre &lt;b&gt;plus de texte&lt;/i&gt; ici&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">expect</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;form string=&quot;Form stuff&quot;&gt;</span>
<span class="s2">                        &lt;h1&gt;Blah &lt;i&gt;blah&lt;/i&gt; blah&lt;/h1&gt;</span>
<span class="s2">                        Mettre &lt;b&gt;plus de texte ici</span>
<span class="s2">                        &lt;/b&gt;&lt;field name=&quot;foo&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="n">translations</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expect</span><span class="p">)</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_xml_illegal_translations">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_xml_illegal_translations">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_xml_illegal_translations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># attributes</span>
        <span class="n">make_xml</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;</span><span class="si">{}</span><span class="s1">&quot;&gt;test&lt;/form&gt;&#39;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="s1">&#39;Damien Roberts&quot; &lt;d.roberts@example.com&gt;&#39;</span>
        <span class="n">escaped_attr</span> <span class="o">=</span> <span class="s1">&#39;Damien Roberts&amp;quot; &amp;lt;d.roberts@example.com&amp;gt;&#39;</span>

        <span class="c1"># {legal: legal(not escaped attr)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">xml_translate</span><span class="p">({</span><span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">attr</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">make_xml</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)),</span>
            <span class="n">make_xml</span><span class="p">(</span><span class="n">escaped_attr</span><span class="p">),</span>
            <span class="s1">&#39;attr should be translated and escaped&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># {legal(not escaped attr): legal}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">xml_translate</span><span class="p">({</span><span class="n">attr</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">make_xml</span><span class="p">(</span><span class="n">escaped_attr</span><span class="p">)),</span>
            <span class="n">make_xml</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
            <span class="s1">&#39;attrs should be translated by using unescaped old terms&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># {illegal(escaped attr): legal}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">xml_translate</span><span class="p">({</span><span class="n">escaped_attr</span><span class="p">:</span> <span class="s1">&#39;X&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">make_xml</span><span class="p">(</span><span class="n">escaped_attr</span><span class="p">)),</span>
            <span class="n">make_xml</span><span class="p">(</span><span class="n">escaped_attr</span><span class="p">),</span>
            <span class="s1">&#39;attrs cannot be translated by using escaped old terms&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># text and elements</span>
        <span class="n">make_xml</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;</span><span class="si">{}</span><span class="s1">&lt;/form&gt;&#39;</span><span class="o">.</span><span class="n">format</span>
        <span class="n">term</span> <span class="o">=</span> <span class="s1">&#39;&lt;i class=&quot;fa fa-circle&quot; role=&quot;img&quot; aria-label=&quot;Invalid&quot; title=&quot;Invalid&quot;/&gt;&#39;</span>

        <span class="c1"># {legal: legal}</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="s1">&#39;&lt;i class=&quot;fa fa-circle&quot; role=&quot;img&quot; aria-label=&quot;Non-valide&quot; title=&quot;Non-valide&quot;/&gt;X&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">xml_translate</span><span class="p">({</span><span class="n">term</span><span class="p">:</span> <span class="n">valid</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">make_xml</span><span class="p">(</span><span class="n">term</span><span class="p">)),</span>
            <span class="n">make_xml</span><span class="p">(</span><span class="n">valid</span><span class="p">),</span>
            <span class="s1">&#39;content in inline-block should be treated as one term and translated&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># {legal: illegal(has no text)}</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="s1">&#39;&lt;i class=&quot;fa fa-circle&quot; role=&quot;img&quot;/&gt;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">xml_translate</span><span class="p">({</span><span class="n">term</span><span class="p">:</span> <span class="n">invalid</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">make_xml</span><span class="p">(</span><span class="n">term</span><span class="p">)),</span>
            <span class="n">make_xml</span><span class="p">(</span><span class="n">term</span><span class="p">),</span>
            <span class="sa">f</span><span class="s1">&#39;translation </span><span class="si">{</span><span class="n">invalid</span><span class="si">!r}</span><span class="s1"> has no text and should be dropped as a translation&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="s1">&#39;  &#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">xml_translate</span><span class="p">({</span><span class="n">term</span><span class="p">:</span> <span class="n">invalid</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">make_xml</span><span class="p">(</span><span class="n">term</span><span class="p">)),</span>
            <span class="n">make_xml</span><span class="p">(</span><span class="n">term</span><span class="p">),</span>
            <span class="sa">f</span><span class="s1">&#39;translation </span><span class="si">{</span><span class="n">invalid</span><span class="si">!r}</span><span class="s1"> has no text and should be dropped as a translation&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="s1">&#39;&lt;i&gt; &lt;/i&gt;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">xml_translate</span><span class="p">({</span><span class="n">term</span><span class="p">:</span> <span class="n">invalid</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">make_xml</span><span class="p">(</span><span class="n">term</span><span class="p">)),</span>
            <span class="n">make_xml</span><span class="p">(</span><span class="n">term</span><span class="p">),</span>
            <span class="sa">f</span><span class="s1">&#39;translation </span><span class="si">{</span><span class="n">invalid</span><span class="si">!r}</span><span class="s1"> has no text and should be dropped as a translation&#39;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># {legal: illegal(has non-translatable elements)}</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="s1">&#39;&lt;div&gt;X&lt;/div&gt;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">xml_translate</span><span class="p">({</span><span class="n">term</span><span class="p">:</span> <span class="n">invalid</span><span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">make_xml</span><span class="p">(</span><span class="n">term</span><span class="p">)),</span>
            <span class="n">make_xml</span><span class="p">(</span><span class="n">term</span><span class="p">),</span>
            <span class="sa">f</span><span class="s1">&#39;translation </span><span class="si">{</span><span class="n">invalid</span><span class="si">!r}</span><span class="s1"> has non-translatable elements(elements not in TRANSLATED_ELEMENTS)&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_html">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_html">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_html</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test html_translate(). &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;blockquote&gt;A &lt;h2&gt;B&lt;/h2&gt; C&lt;/blockquote&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">html_translate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">term</span><span class="p">:</span> <span class="n">term</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span></div>


<div class="viewcode-block" id="TranslationToolsTestCase.test_translate_html_i">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TranslationToolsTestCase.test_translate_html_i">[docs]</a>
    <span class="k">def</span> <span class="nf">test_translate_html_i</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test xml_translate() and html_translate() with &lt;i&gt; elements. &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;p&gt;A &lt;i class=&quot;fa-check&quot;&gt;&lt;/i&gt; B&lt;/p&gt;&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">xml_translate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">term</span><span class="p">:</span> <span class="n">term</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;&lt;p&gt;A &lt;i class=&quot;fa-check&quot;/&gt; B&lt;/p&gt;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">html_translate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">term</span><span class="p">:</span> <span class="n">term</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestLanguageInstall">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestLanguageInstall">[docs]</a>
<span class="k">class</span> <span class="nc">TestLanguageInstall</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestLanguageInstall.test_language_install">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestLanguageInstall.test_language_install">[docs]</a>
    <span class="k">def</span> <span class="nf">test_language_install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">fr</span><span class="p">)</span>
        <span class="n">wizard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;base.language.install&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;lang_ids&#39;</span><span class="p">:</span> <span class="n">fr</span><span class="o">.</span><span class="n">ids</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">flush_all</span><span class="p">()</span>

        <span class="c1"># running the wizard calls _load_module_terms() to load PO files</span>
        <span class="n">loaded</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">_load_module_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modules</span><span class="p">,</span> <span class="n">langs</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">loaded</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">modules</span><span class="p">,</span> <span class="n">langs</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">))</span>

        <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_module.Module._load_module_terms&#39;</span><span class="p">,</span> <span class="n">_load_module_terms</span><span class="p">):</span>
            <span class="n">wizard</span><span class="o">.</span><span class="n">lang_install</span><span class="p">()</span>

        <span class="c1"># _load_module_terms is called once with lang=&#39;fr_FR&#39; and overwrite=True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loaded</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">loaded</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestTranslationExport">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationExport">[docs]</a>
<span class="nd">@tagged</span><span class="p">(</span><span class="s1">&#39;post_install&#39;</span><span class="p">,</span> <span class="s1">&#39;-at_install&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestTranslationExport</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestTranslationExport.test_export_translatable_resources">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationExport.test_export_translatable_resources">[docs]</a>
    <span class="k">def</span> <span class="nf">test_export_translatable_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Read files of installed modules and export translatable terms&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertNoLogs</span><span class="p">(</span><span class="s1">&#39;odoo.tools.translate&#39;</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">):</span>
            <span class="n">TranslationModuleReader</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestTranslation">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation">[docs]</a>
<span class="k">class</span> <span class="nc">TestTranslation</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestTranslation.setUpClass">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.setUpClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.module_base&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">_update_translations</span><span class="p">([</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">])</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">customers</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Customers&#39;</span><span class="p">})</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">customers_xml_id</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">export_data</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;datas&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">po_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        #. module: __export__</span>
<span class="s1">        #: model:res.partner.category,name:</span><span class="si">%s</span>
<span class="s1">        msgid &quot;Customers&quot;</span>
<span class="s1">        msgstr &quot;Clients&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span> <span class="o">%</span> <span class="bp">cls</span><span class="o">.</span><span class="n">customers_xml_id</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">po_string</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dummy&#39;</span>
            <span class="n">translation_importer</span> <span class="o">=</span> <span class="n">TranslationImporter</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">translation_importer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;po&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
            <span class="n">translation_importer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslation.test_101_create_translated_record">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.test_101_create_translated_record">[docs]</a>
    <span class="k">def</span> <span class="nf">test_101_create_translated_record</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">with_context</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s2">&quot;Error in basic name&quot;</span><span class="p">)</span>

        <span class="n">category_fr</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_fr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Clients&#39;</span><span class="p">,</span> <span class="s2">&quot;Translation not found&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslation.test_102_duplicate_record">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.test_102_duplicate_record">[docs]</a>
    <span class="k">def</span> <span class="nf">test_102_duplicate_record</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">with_context</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">category_no</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_no</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s2">&quot;Duplication should copy all translations&quot;</span><span class="p">)</span>

        <span class="n">category_fr</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_fr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Clients&#39;</span><span class="p">,</span> <span class="s2">&quot;Did not found translation for initial value&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslation.test_103_duplicate_record_fr">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.test_103_duplicate_record_fr">[docs]</a>
    <span class="k">def</span> <span class="nf">test_103_duplicate_record_fr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">with_context</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">copy</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Clients (copie)&#39;</span><span class="p">})</span>

        <span class="n">category_no</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_no</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Clients (copie)&#39;</span><span class="p">,</span> <span class="s2">&quot;Duplication should set untranslated value&quot;</span><span class="p">)</span>

        <span class="n">category_fr</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_fr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Clients (copie)&#39;</span><span class="p">,</span> <span class="s2">&quot;Did not used default value for translated value&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslation.test_104_orderby_translated_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.test_104_orderby_translated_field">[docs]</a>
    <span class="k">def</span> <span class="nf">test_104_orderby_translated_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test search ordered by a translated field. &quot;&quot;&quot;</span>
        <span class="c1"># create a category with a French translation</span>
        <span class="n">padawans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Padawans&#39;</span><span class="p">})</span>
        <span class="n">padawans_fr</span> <span class="o">=</span> <span class="n">padawans</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">padawans_fr</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Apprentis&#39;</span><span class="p">})</span>
        <span class="c1"># search for categories, and sort them by (translated) name</span>
        <span class="n">categories</span> <span class="o">=</span> <span class="n">padawans_fr</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">padawans</span><span class="o">.</span><span class="n">id</span><span class="p">])],</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categories</span><span class="o">.</span><span class="n">ids</span><span class="p">,</span> <span class="p">[</span><span class="n">padawans</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
            <span class="s2">&quot;Search ordered by translated name should return Padawans (Apprentis) before Customers (Clients)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslation.test_105_duplicate_record_multi_no_en">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.test_105_duplicate_record_multi_no_en">[docs]</a>
    <span class="k">def</span> <span class="nf">test_105_duplicate_record_multi_no_en</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Klanten&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;zh_CN&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh_CN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;客户&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.lang_en&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.lang_zh_CN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span>
        <span class="n">translations</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_get_stored_translations</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertDictEqual</span><span class="p">(</span>
            <span class="n">translations</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="s1">&#39;Customers&#39;</span><span class="p">,</span>
                <span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="s1">&#39;Clients&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nl_NL&#39;</span><span class="p">:</span> <span class="s1">&#39;Klanten&#39;</span><span class="p">,</span>
                <span class="s1">&#39;zh_CN&#39;</span><span class="p">:</span> <span class="s1">&#39;客户&#39;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">category_copy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">translations</span> <span class="o">=</span> <span class="n">category_copy</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_get_stored_translations</span><span class="p">(</span><span class="n">category_copy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertDictEqual</span><span class="p">(</span>
            <span class="n">translations</span><span class="p">,</span>
            <span class="p">{</span>
                <span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="s1">&#39;Customers&#39;</span><span class="p">,</span>
                <span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="s1">&#39;Clients&#39;</span><span class="p">,</span>
                <span class="s1">&#39;nl_NL&#39;</span><span class="p">:</span> <span class="s1">&#39;Klanten&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s1">&#39;English, French and Dutch translation should be copied, Chinese translation should be dropped&#39;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslation.test_107_duplicate_record_en">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.test_107_duplicate_record_en">[docs]</a>
    <span class="k">def</span> <span class="nf">test_107_duplicate_record_en</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">with_context</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">category_no</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_no</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">,</span> <span class="s2">&quot;Duplication did not set untranslated value&quot;</span><span class="p">)</span>

        <span class="n">category_fr</span> <span class="o">=</span> <span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_fr</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Clients&#39;</span><span class="p">,</span> <span class="s2">&quot;Did not found translation for initial value&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslation.test_108_search_en">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.test_108_search_en">[docs]</a>
    <span class="k">def</span> <span class="nf">test_108_search_en</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">CategoryEn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span>
        <span class="n">category_equal</span> <span class="o">=</span> <span class="n">CategoryEn</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_equal</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;=&#39; doesn&#39;t work for English&quot;</span><span class="p">)</span>
        <span class="n">category_ilike</span> <span class="o">=</span> <span class="n">CategoryEn</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;stoMer&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="p">,</span> <span class="n">category_ilike</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;ilike&#39; doesn&#39;t work for English&quot;</span><span class="p">)</span>
        <span class="n">category_eq_ilike</span> <span class="o">=</span> <span class="n">CategoryEn</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;CustoMers&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="p">,</span> <span class="n">category_eq_ilike</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;=ilike&#39; doesn&#39;t work for English&quot;</span><span class="p">)</span>
        <span class="n">category_in</span> <span class="o">=</span> <span class="n">CategoryEn</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Customers&#39;</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="p">,</span> <span class="n">category_in</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;in&#39; doesn&#39;t work for English&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslation.test_109_search_fr">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.test_109_search_fr">[docs]</a>
    <span class="k">def</span> <span class="nf">test_109_search_fr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">CategoryFr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">category_equal</span> <span class="o">=</span> <span class="n">CategoryFr</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Clients&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_equal</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;=&#39; doesn&#39;t work for non English&quot;</span><span class="p">)</span>
        <span class="n">category_ilike</span> <span class="o">=</span> <span class="n">CategoryFr</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;lIen&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="p">,</span> <span class="n">category_ilike</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;ilike&#39; doesn&#39;t work for non English&quot;</span><span class="p">)</span>
        <span class="n">category_eq_ilike</span> <span class="o">=</span> <span class="n">CategoryFr</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;clieNts&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="p">,</span> <span class="n">category_eq_ilike</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;=ilike&#39; doesn&#39;t work for non English&quot;</span><span class="p">)</span>
        <span class="n">category_in</span> <span class="o">=</span> <span class="n">CategoryFr</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Clients&#39;</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="p">,</span> <span class="n">category_in</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;in&#39; doesn&#39;t work for non English&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslation.test_110_search_es">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.test_110_search_es">[docs]</a>
    <span class="k">def</span> <span class="nf">test_110_search_es</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span>
        <span class="n">langs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_installed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;English (US)&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;French / Français&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;es_ES&#39;</span><span class="p">,</span> <span class="s1">&#39;Spanish / Español&#39;</span><span class="p">)],</span>
                         <span class="n">langs</span><span class="p">,</span> <span class="s2">&quot;Test did not start with the expected languages&quot;</span><span class="p">)</span>
        <span class="n">CategoryEs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span>
        <span class="n">category_equal</span> <span class="o">=</span> <span class="n">CategoryEs</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_equal</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;=&#39; should use the English name if the current language translation is not available&quot;</span><span class="p">)</span>
        <span class="n">category_ilike</span> <span class="o">=</span> <span class="n">CategoryEs</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;usTom&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="p">,</span> <span class="n">category_ilike</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;ilike&#39; should use the English name if the current language translation is not available&quot;</span><span class="p">)</span>
        <span class="n">category_eq_ilike</span> <span class="o">=</span> <span class="n">CategoryEs</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;=ilike&#39;</span><span class="p">,</span> <span class="s1">&#39;CustoMers&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="p">,</span> <span class="n">category_eq_ilike</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;=ilike&#39; should use the English name if the current language translation is not available&quot;</span><span class="p">)</span>
        <span class="n">category_in</span> <span class="o">=</span> <span class="n">CategoryEs</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Customers&#39;</span><span class="p">])])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="p">,</span> <span class="n">category_in</span><span class="p">,</span> <span class="s2">&quot;Search with &#39;in&#39; should use the English name if the current language translation is not available&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslation.test_111_prefetch_langs">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslation.test_111_prefetch_langs">[docs]</a>
    <span class="k">def</span> <span class="nf">test_111_prefetch_langs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">category_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">customers</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.lang_nl&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">category_nl</span> <span class="o">=</span> <span class="n">category_en</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span>
        <span class="n">category_nl</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Klanten&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.lang_fr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>
        <span class="n">category_fr</span> <span class="o">=</span> <span class="n">category_en</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.lang_zh_CN&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>
        <span class="n">category_zh</span> <span class="o">=</span> <span class="n">category_en</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;zh_CN&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.lang_en&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">category_fr</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">prefetch_langs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
        <span class="n">category_nl</span><span class="o">.</span><span class="n">name</span>
        <span class="n">category_en</span><span class="o">.</span><span class="n">name</span>
        <span class="n">category_zh</span><span class="o">.</span><span class="n">name</span>
        <span class="n">category_fr</span><span class="o">.</span><span class="n">invalidate_recordset</span><span class="p">()</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueryCount</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_fr</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">prefetch_langs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Clients&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueryCount</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_nl</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Klanten&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_en</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category_zh</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;Customers&#39;</span><span class="p">)</span></div>
</div>



    <span class="c1"># TODO Currently, the unique constraint doesn&#39;t work for translatable field</span>
    <span class="c1"># def test_111_unique_en(self):</span>
    <span class="c1">#     Country = self.env[&#39;res.country&#39;]</span>
    <span class="c1">#     country_1 = Country.create({&#39;name&#39;: &#39;Odoo&#39;})</span>
    <span class="c1">#     country_1.with_context(lang=&#39;fr_FR&#39;).name = &#39;Odoo_Fr&#39;</span>
    <span class="c1">#     country_1.flush_recordset()</span>
    <span class="c1">#</span>
    <span class="c1">#     country_2 = Country.create({&#39;name&#39;: &#39;Odoo2&#39;})</span>
    <span class="c1">#     with self.assertRaises(IntegrityError), mute_logger(&#39;odoo.sql_db&#39;):</span>
    <span class="c1">#         country_2.name = &#39;Odoo&#39;</span>
    <span class="c1">#         country_2.flush_recordset()</span>
    <span class="c1">#</span>
    <span class="c1">#     with self.assertRaises(IntegrityError), mute_logger(&#39;odoo.sql_db&#39;):</span>
    <span class="c1">#         country_3 = Country.create({&#39;name&#39;: &#39;Odoo&#39;})</span>

<div class="viewcode-block" id="TestTranslationWrite">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite">[docs]</a>
<span class="k">class</span> <span class="nc">TestTranslationWrite</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestTranslationWrite.setUpClass">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.setUpClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">category</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Reblochon&#39;</span><span class="p">})</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">category_xml_id</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">export_data</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;datas&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="TestTranslationWrite.test_00">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_00">[docs]</a>
    <span class="k">def</span> <span class="nf">test_00</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>

        <span class="n">langs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_installed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;English (US)&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;French / Français&#39;</span><span class="p">)],</span> <span class="n">langs</span><span class="p">,</span>
                         <span class="s2">&quot;Test did not started with expected languages&quot;</span><span class="p">)</span>

        <span class="n">category</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;English&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English&#39;</span><span class="p">)</span>

        <span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;English 2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English 2&#39;</span><span class="p">)</span>

        <span class="n">category2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;French&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category2</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;French&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category2</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;French&#39;</span><span class="p">)</span>

        <span class="n">category2</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;English&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category2</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;French&#39;</span><span class="p">)</span>

        <span class="n">category3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner.category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;English&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category3</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category3</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English&#39;</span><span class="p">)</span>

        <span class="n">category3</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;French 2&#39;</span>
        <span class="n">category3</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;English 2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">category3</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;French 2&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslationWrite.test_03_fr_single">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_03_fr_single">[docs]</a>
    <span class="k">def</span> <span class="nf">test_03_fr_single</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.lang_en&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">langs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_installed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;French / Français&#39;</span><span class="p">)],</span> <span class="n">langs</span><span class="p">,</span> <span class="s2">&quot;Test did not started with expected languages&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;French Name&#39;</span><span class="p">})</span>

        <span class="n">fr_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fr_name</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="s2">&quot;French Name&quot;</span><span class="p">,</span> <span class="s2">&quot;Reference field not updated&quot;</span><span class="p">)</span>

        <span class="c1"># read from the cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;French Name&quot;</span><span class="p">)</span>

        <span class="c1"># read from database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">invalidate_recordset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;French Name&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslationWrite.test_04_fr_multi">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_04_fr_multi">[docs]</a>
    <span class="k">def</span> <span class="nf">test_04_fr_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>

        <span class="n">langs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_installed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;English (US)&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;French / Français&#39;</span><span class="p">)],</span> <span class="n">langs</span><span class="p">,</span>
            <span class="s2">&quot;Test did not started with expected languages&quot;</span><span class="p">)</span>

        <span class="n">po_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        #. module: __export__</span>
<span class="s1">        #: model:res.partner.category,name:</span><span class="si">%s</span>
<span class="s1">        msgid &quot;Reblochon&quot;</span>
<span class="s1">        msgstr &quot;Translated Name&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">category_xml_id</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">po_string</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dummy&#39;</span>
            <span class="n">translation_importer</span> <span class="o">=</span> <span class="n">TranslationImporter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">translation_importer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;po&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
            <span class="n">translation_importer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;French Name&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;English Name&#39;</span><span class="p">})</span>

        <span class="c1"># read from the cache first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;English Name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;French Name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;English Name&quot;</span><span class="p">)</span>

        <span class="c1"># force save to database and clear the cache: force a clean state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">invalidate_recordset</span><span class="p">()</span>

        <span class="c1"># read from database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;English Name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;French Name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;English Name&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslationWrite.test_04_fr_multi_no_en">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_04_fr_multi_no_en">[docs]</a>
    <span class="k">def</span> <span class="nf">test_04_fr_multi_no_en</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.lang_en&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">langs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_installed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;French / Français&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;es_ES&#39;</span><span class="p">,</span> <span class="s1">&#39;Spanish / Español&#39;</span><span class="p">)],</span> <span class="n">langs</span><span class="p">,</span>
                         <span class="s2">&quot;Test did not start with the expected languages&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;French Name&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Spanish Name&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;None Name&#39;</span><span class="p">})</span>

        <span class="c1"># read from the cache first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;French Name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Spanish Name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;None Name&quot;</span><span class="p">)</span>

        <span class="c1"># force save to database and clear the cache: force a clean state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">invalidate_recordset</span><span class="p">()</span>

        <span class="c1"># read from database</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;French Name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;Spanish Name&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;None Name&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslationWrite.test_05_remove_multi_false">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_05_remove_multi_false">[docs]</a>
    <span class="k">def</span> <span class="nf">test_05_remove_multi_false</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_05_remove_multi</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_test_05_remove_multi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">empty_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>

        <span class="n">langs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_installed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;English (US)&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;French / Français&#39;</span><span class="p">)],</span> <span class="n">langs</span><span class="p">,</span>
            <span class="s2">&quot;Test did not started with expected languages&quot;</span><span class="p">)</span>

        <span class="n">belgium</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.be&#39;</span><span class="p">)</span>
        <span class="c1"># vat_label is translatable and not required</span>
        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="s1">&#39;VAT&#39;</span><span class="p">})</span>
        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="s1">&#39;TVA&#39;</span><span class="p">})</span>

        <span class="c1"># remove the value</span>
        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="n">empty_value</span><span class="p">})</span>
        <span class="c1"># should recover the initial value from db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">empty_value</span><span class="p">,</span>
            <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">vat_label</span><span class="p">,</span>
            <span class="s2">&quot;Value should be the empty_value&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">empty_value</span><span class="p">,</span>
            <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">vat_label</span><span class="p">,</span>
            <span class="s2">&quot;Value should be the empty_value&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">empty_value</span><span class="p">,</span>
            <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">vat_label</span><span class="p">,</span>
            <span class="s2">&quot;Value should be the empty_value&quot;</span>
        <span class="p">)</span>

        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="s1">&#39;VAT&#39;</span><span class="p">})</span>
        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="s1">&#39;TVA&#39;</span><span class="p">})</span>

        <span class="c1"># remove the value</span>
        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="n">empty_value</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">empty_value</span><span class="p">,</span>
            <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">vat_label</span><span class="p">,</span>
            <span class="s2">&quot;Value should be the empty_value&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">empty_value</span><span class="p">,</span>
            <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">vat_label</span><span class="p">,</span>
            <span class="s2">&quot;Value should be the empty_value&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">empty_value</span><span class="p">,</span>
            <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">vat_label</span><span class="p">,</span>
            <span class="s2">&quot;Value should be the empty_value&quot;</span>
        <span class="p">)</span>

<div class="viewcode-block" id="TestTranslationWrite.test_write_empty_and_value">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_write_empty_and_value">[docs]</a>
    <span class="k">def</span> <span class="nf">test_write_empty_and_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span>

        <span class="n">langs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_installed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">,</span> <span class="s1">&#39;Dutch / Nederlands&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;English (US)&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;French / Français&#39;</span><span class="p">)],</span> <span class="n">langs</span><span class="p">,</span>
                         <span class="s2">&quot;Test did not started with expected languages&quot;</span><span class="p">)</span>

        <span class="n">belgium</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.be&#39;</span><span class="p">)</span>
        <span class="c1"># vat_label is translatable and not required</span>
        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="s1">&#39;VAT_US&#39;</span><span class="p">})</span>
        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="s1">&#39;VAT_FR&#39;</span><span class="p">})</span>
        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="s1">&#39;VAT_NL&#39;</span><span class="p">})</span>

        <span class="n">belgium</span><span class="o">.</span><span class="n">invalidate_recordset</span><span class="p">()</span>

        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="s1">&#39;TVA_FR2&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">vat_label</span><span class="p">,</span> <span class="s1">&#39;TVA_FR2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">vat_label</span><span class="p">,</span> <span class="s1">&#39;TVA_FR2&#39;</span><span class="p">)</span>

        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="s1">&#39;TVA_FR3&#39;</span><span class="p">})</span>
        <span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;vat_label&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">vat_label</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">belgium</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">vat_label</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslationWrite.test_create_empty_false">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_create_empty_false">[docs]</a>
    <span class="k">def</span> <span class="nf">test_create_empty_false</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_test_create_empty</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span></div>


    <span class="c1"># feature removed</span>
    <span class="c1"># def test_cresate_emtpy_empty_string(self):</span>
    <span class="c1">#     self._test_create_empty(&#39;&#39;)</span>

    <span class="k">def</span> <span class="nf">_test_create_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">empty_value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">langs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_installed</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([(</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;English (US)&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;French / Français&#39;</span><span class="p">)],</span> <span class="n">langs</span><span class="p">,</span>
                         <span class="s2">&quot;Test did not started with expected languages&quot;</span><span class="p">)</span>

        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.groups&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_group&#39;</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="n">empty_value</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">empty_value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="n">empty_value</span><span class="p">)</span>

        <span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;French comment&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="s1">&#39;French comment&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="s1">&#39;French comment&#39;</span><span class="p">)</span>

        <span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;French comment 2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="s1">&#39;French comment 2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="s1">&#39;French comment&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="TestTranslationWrite.test_update_field_translations">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_update_field_translations">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_field_translations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">categoryEN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span>
        <span class="n">categoryFR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="s1">&#39;English Name&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="s1">&#39;French Name&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryEN</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English Name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryFR</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;French Name&#39;</span><span class="p">)</span>

        <span class="c1"># void fr_FR translation and fallback to en_US</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryEN</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English Name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryFR</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English Name&#39;</span><span class="p">)</span>

        <span class="n">categoryEN</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;English Name 2&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryEN</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English Name 2&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryFR</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English Name 2&#39;</span><span class="p">)</span>

        <span class="c1"># cannot void en_US</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="s1">&#39;English Name&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="s1">&#39;French Name&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryEN</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English Name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryFR</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;French Name&#39;</span><span class="p">)</span>

        <span class="c1"># empty str is a valid translation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryEN</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;English Name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryFR</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="s1">&#39;French Name&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryEN</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">categoryFR</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;French Name&#39;</span><span class="p">)</span>

        <span class="c1"># raise error when the translations are in the form for model_terms translated fields</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">UserError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">category</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;English Name&#39;</span><span class="p">:</span> <span class="s1">&#39;French Name&#39;</span><span class="p">}})</span></div>


<div class="viewcode-block" id="TestTranslationWrite.test_update_field_translations_for_empty">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_update_field_translations_for_empty">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_field_translations_for_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.groups&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_group&#39;</span><span class="p">,</span> <span class="s1">&#39;comment&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>

        <span class="n">groupEN</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span>
        <span class="n">groupFR</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">groupNL</span> <span class="o">=</span> <span class="n">group</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">groupEN</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">groupFR</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">:</span> <span class="s1">&#39;Dutch Name&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="s1">&#39;French Name&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">groupEN</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="s1">&#39;French Name&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR value as the current env.lang is chosen as the default en_US value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">groupFR</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="s1">&#39;French Name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">groupNL</span><span class="o">.</span><span class="n">comment</span><span class="p">,</span> <span class="s1">&#39;Dutch Name&#39;</span><span class="p">)</span>

        <span class="n">group</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">groupFR</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">})</span>
        <span class="n">groupFR</span><span class="o">.</span><span class="n">flush_recordset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT comment FROM res_groups WHERE id = </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">id</span><span class="p">,))</span>
        <span class="p">(</span><span class="n">comment</span><span class="p">,)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">comment</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslationWrite.test_field_selection">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_field_selection">[docs]</a>
    <span class="k">def</span> <span class="nf">test_field_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test translations of field selections. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">selection</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;base&#39;</span><span class="p">])</span>

        <span class="n">ir_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.fields&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s1">&#39;ir.model&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">)</span>
        <span class="n">ir_field</span> <span class="o">=</span> <span class="n">ir_field</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">ir_field</span><span class="o">.</span><span class="n">selection_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Custo&#39;</span>
        <span class="n">ir_field</span><span class="o">.</span><span class="n">selection_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Pas touche!&#39;</span>

        <span class="n">fg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fields_get</span><span class="p">([</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fg</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">][</span><span class="s1">&#39;selection&#39;</span><span class="p">],</span> <span class="n">field</span><span class="o">.</span><span class="n">selection</span><span class="p">)</span>

        <span class="n">fg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fields_get</span><span class="p">([</span><span class="s1">&#39;state&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">fg</span><span class="p">[</span><span class="s1">&#39;state&#39;</span><span class="p">][</span><span class="s1">&#39;selection&#39;</span><span class="p">],</span>
                         <span class="p">[(</span><span class="s1">&#39;manual&#39;</span><span class="p">,</span> <span class="s1">&#39;Custo&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">,</span> <span class="s1">&#39;Pas touche!&#39;</span><span class="p">)])</span></div>


<div class="viewcode-block" id="TestTranslationWrite.test_load_views">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationWrite.test_load_views">[docs]</a>
    <span class="k">def</span> <span class="nf">test_load_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test translations of field descriptions in get_view(). &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>

        <span class="c1"># add translation for the string of field ir.model.name</span>
        <span class="n">ir_model_field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.fields&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_get</span><span class="p">(</span><span class="s1">&#39;ir.model&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="n">LABEL</span> <span class="o">=</span> <span class="s2">&quot;Description du Modèle&quot;</span>

        <span class="n">ir_model_field_xml_id</span> <span class="o">=</span> <span class="n">ir_model_field</span><span class="o">.</span><span class="n">export_data</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;datas&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">po_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        #. module: __export__</span>
<span class="s1">        #: model:ir.model.fields,field_description:</span><span class="si">%s</span>
<span class="s1">        msgid &quot;Model Description&quot;</span>
<span class="s1">        msgstr &quot;</span><span class="si">%s</span><span class="s1">&quot;</span>
<span class="s1">        &#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ir_model_field_xml_id</span><span class="p">,</span> <span class="n">LABEL</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="n">po_string</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;dummy&#39;</span>
            <span class="n">translation_importer</span> <span class="o">=</span> <span class="n">TranslationImporter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">translation_importer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;po&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
            <span class="n">translation_importer</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># check that fields_get() returns the expected label</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fields_get</span><span class="p">([</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="s1">&#39;string&#39;</span><span class="p">],</span> <span class="n">LABEL</span><span class="p">)</span>

        <span class="c1"># check that get_views() also returns the expected label</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_views</span><span class="p">([(</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">)])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;models&#39;</span><span class="p">][</span><span class="n">model</span><span class="o">.</span><span class="n">_name</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">][</span><span class="s1">&#39;string&#39;</span><span class="p">],</span> <span class="n">LABEL</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestXMLTranslation">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation">[docs]</a>
<span class="k">class</span> <span class="nc">TestXMLTranslation</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestXMLTranslation.setUpClass">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.setUpClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.module_base&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">_update_translations</span><span class="p">([</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestXMLTranslation.create_view">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.create_view">[docs]</a>
    <span class="k">def</span> <span class="nf">create_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archf</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;res.partner&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view</span><span class="o">.</span><span class="n">invalidate_recordset</span><span class="p">()</span>

        <span class="n">val</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">lang</span><span class="p">,</span> <span class="n">trans_terms</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">val</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">trans_terms</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;UPDATE ir_ui_view</span>
<span class="s2">                      SET arch_db = </span><span class="si">%s</span>
<span class="s2">                    WHERE id = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">Json</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">view</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_copy">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_copy">[docs]</a>
    <span class="k">def</span> <span class="nf">test_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create a simple view, fill in translations, and copy it. &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Knife&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork&#39;</span><span class="p">,</span> <span class="s1">&#39;Spoon&#39;</span><span class="p">)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Couteau&#39;</span><span class="p">,</span> <span class="s1">&#39;Fourchette&#39;</span><span class="p">,</span> <span class="s1">&#39;Cuiller&#39;</span><span class="p">)</span>
        <span class="n">view0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">)</span>

        <span class="n">env_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">})</span>
        <span class="n">env_fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>

        <span class="c1"># check translated field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view0</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view0</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>

        <span class="c1"># copy without lang</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="n">view0</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>

        <span class="c1"># copy with lang=&#39;fr_FR&#39;</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="n">view0</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>

        <span class="c1"># copy with lang=&#39;fr_FR&#39; and translate=html_translate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="s1">&#39;translate&#39;</span><span class="p">,</span> <span class="n">html_translate</span><span class="p">)</span>
        <span class="n">view3</span> <span class="o">=</span> <span class="n">view0</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">({})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view3</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view3</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_spaces">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_spaces">[docs]</a>
    <span class="k">def</span> <span class="nf">test_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Create translations where value has surrounding spaces. &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Knife&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork&#39;</span><span class="p">,</span> <span class="s1">&#39;Spoon&#39;</span><span class="p">)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39; Couteau&#39;</span><span class="p">,</span> <span class="s1">&#39;Fourchette &#39;</span><span class="p">,</span> <span class="s1">&#39; Cuiller &#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_sync">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_sync">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check translations after minor change in source terms. &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheeze&#39;</span><span class="p">,)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain et fromage&#39;</span><span class="p">,)</span>
        <span class="n">terms_nl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Brood and kaas&#39;</span><span class="p">,)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>

        <span class="n">env_nolang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">env_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">})</span>
        <span class="n">env_fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="n">env_nl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># modify source term in view (fixed type in &#39;cheeze&#39;)</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>

        <span class="c1"># check whether translations have been synchronized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_fr</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>
        <span class="c1"># modify source term in view in another language with close term</span>
        <span class="n">new_terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pains et fromage&#39;</span><span class="p">,)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">new_terms_fr</span><span class="p">})</span>

        <span class="c1"># check whether translations have been synchronized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">new_terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_sync_xml">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_sync_xml">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sync_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check translations of &#39;arch&#39; after xml tags changes in source terms. &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork&#39;</span><span class="p">)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain et fromage&#39;</span><span class="p">,</span> <span class="s1">&#39;Fourchette&#39;</span><span class="p">)</span>
        <span class="n">terms_nl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Brood and kaas&#39;</span><span class="p">,</span> <span class="s1">&#39;Vork&#39;</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>

        <span class="n">env_nolang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">env_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">})</span>
        <span class="n">env_fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="n">env_nl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># modify source term in view (add css style)</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread &lt;span style=&quot;font-weight:bold&quot;&gt;and&lt;/span&gt; cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>

        <span class="c1"># check whether translations have been kept</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># modify source term in view (actual text change)</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread &lt;span style=&quot;font-weight:bold&quot;&gt;and&lt;/span&gt; butter&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>

        <span class="c1"># check whether translations have been reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="p">(</span><span class="n">terms_en</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">terms_fr</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="p">(</span><span class="n">terms_en</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">terms_nl</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_sync_xml_no_en">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_sync_xml_no_en">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sync_xml_no_en</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span>

        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork&#39;</span><span class="p">)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain et fromage&#39;</span><span class="p">,</span> <span class="s1">&#39;Fourchetta&#39;</span><span class="p">)</span>
        <span class="n">terms_nl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Brood and kaas&#39;</span><span class="p">,</span> <span class="s1">&#39;Vork&#39;</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.lang_en&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">env_nolang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">env_fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="n">env_nl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">})</span>

        <span class="c1"># style change and typo change</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain &lt;span style=&quot;font-weight:bold&quot;&gt;et&lt;/span&gt; fromage&#39;</span><span class="p">,</span> <span class="s1">&#39;Fourchette&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_sync_text_to_xml">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_sync_text_to_xml">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sync_text_to_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check translations of &#39;arch&#39; after xml tags changes in source terms. &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&lt;span&gt;Hi&lt;/span&gt;&#39;</span><span class="p">,)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&lt;span&gt;Salut&lt;/span&gt;&#39;</span><span class="p">,)</span>
        <span class="n">terms_nl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&lt;span&gt;Hallo&lt;/span&gt;&#39;</span><span class="p">,)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>

        <span class="n">env_nolang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">env_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">})</span>
        <span class="n">env_fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>

        <span class="c1"># modify the arch view, keep the same text content: &#39;Hi&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="s1">&#39;Hi&#39;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;&lt;setting string=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&lt;span color=&quot;red&quot;/&gt;&lt;/setting&gt;&lt;/form&gt;&#39;</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="c1"># check that we didn&#39;t set string=&quot;&amp;lt;span&amp;gt;Salut&amp;lt;/span&amp;gt;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_sync_xml_collision">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_sync_xml_collision">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sync_xml_collision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check translations of &#39;arch&#39; after xml tags changes in source terms</span>
<span class="sd">            when the same term appears in different elements with different</span>
<span class="sd">            styles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;form class=&quot;row&quot;&gt;</span>
<span class="s1">    </span><span class="si">%s</span>
<span class="s1">    &lt;div class=&quot;s_table_of_content_vertical_navbar&quot; data-name=&quot;Navbar&quot; contenteditable=&quot;false&quot;&gt;</span>
<span class="s1">        &lt;div class=&quot;s_table_of_content_navbar&quot; style=&quot;top: 76px;&quot;&gt;&lt;a href=&quot;#table_of_content_heading_1672668075678_4&quot; class=&quot;table_of_content_link&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&lt;/div&gt;</span>
<span class="s1">    &lt;/div&gt;</span>
<span class="s1">    &lt;div class=&quot;s_table_of_content_main&quot; data-name=&quot;Content&quot;&gt;</span>
<span class="s1">        &lt;section class=&quot;pb16&quot;&gt;</span>
<span class="s1">            &lt;h1 data-anchor=&quot;true&quot; class=&quot;o_default_snippet_text&quot; id=&quot;table_of_content_heading_1672668075678_4&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/h1&gt;</span>
<span class="s1">        &lt;/section&gt;</span>
<span class="s1">    &lt;/div&gt;</span>
<span class="s1">&lt;/form&gt;&#39;&#39;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;Knive and Fork&#39;</span><span class="p">,</span> <span class="s1">&#39;Knive &lt;span style=&quot;font-weight:bold&quot;&gt;and&lt;/span&gt; Fork&#39;</span><span class="p">)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain et fromage&#39;</span><span class="p">,</span> <span class="s1">&#39;Couteau et Fourchette&#39;</span><span class="p">,</span> <span class="s1">&#39;Couteau et Fourchette&#39;</span><span class="p">)</span>
        <span class="n">terms_nl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Brood and kaas&#39;</span><span class="p">,</span> <span class="s1">&#39;Mes en Vork&#39;</span><span class="p">,</span> <span class="s1">&#39;Mes en Vork&#39;</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>

        <span class="n">env_nolang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">env_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">})</span>
        <span class="n">env_fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="n">env_nl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># modify source term in view (small change)</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;Knife and Fork&#39;</span><span class="p">,</span> <span class="s1">&#39;Knife &lt;span style=&quot;font-weight:bold&quot;&gt;and&lt;/span&gt; Fork&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>

        <span class="c1"># check whether translations have been kept</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># modify source term in view (actual text change)</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork and Knife&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork &lt;span style=&quot;font-weight:bold&quot;&gt;and&lt;/span&gt; Knife&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>

        <span class="c1"># check whether translations have been reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="p">(</span><span class="n">terms_fr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">terms_en</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">terms_en</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="p">(</span><span class="n">terms_nl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">terms_en</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">terms_en</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_sync_xml_inline_modifiers">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_sync_xml_inline_modifiers">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sync_xml_inline_modifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check translations of &#39;arch&#39; after xml tags changes in source terms</span>
<span class="sd">            when source term had updated modifiers attributes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;form class=&quot;row&quot;&gt;</span>
<span class="s1">    </span><span class="si">%s</span>
<span class="s1">    &lt;div class=&quot;s_table_of_content_vertical_navbar&quot; data-name=&quot;Navbar&quot; contenteditable=&quot;false&quot;&gt;</span>
<span class="s1">        &lt;div class=&quot;s_table_of_content_navbar&quot; style=&quot;top: 76px;&quot;&gt;&lt;a href=&quot;#table_of_content_heading_1672668075678_4&quot; class=&quot;table_of_content_link&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/a&gt;&lt;/div&gt;</span>
<span class="s1">    &lt;/div&gt;</span>
<span class="s1">    &lt;div class=&quot;s_table_of_content_main&quot; data-name=&quot;Content&quot;&gt;</span>
<span class="s1">        &lt;section class=&quot;pb16&quot;&gt;</span>
<span class="s1">            &lt;h1 data-anchor=&quot;true&quot; class=&quot;o_default_snippet_text&quot; id=&quot;table_of_content_heading_1672668075678_4&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/h1&gt;</span>
<span class="s1">        &lt;/section&gt;</span>
<span class="s1">    &lt;/div&gt;</span>
<span class="s1">&lt;/form&gt;&#39;&#39;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;Knive and Fork&#39;</span><span class="p">,</span> <span class="s1">&#39;Knive &lt;span style=&quot;font-weight:bold&quot;&gt;and&lt;/span&gt; Fork&#39;</span><span class="p">)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain et fromage&#39;</span><span class="p">,</span> <span class="s1">&#39;Couteau et Fourchette&#39;</span><span class="p">,</span> <span class="s1">&#39;Couteau &lt;span style=&quot;font-weight:bold&quot;&gt;et&lt;/span&gt; Fourchette&#39;</span><span class="p">)</span>
        <span class="n">terms_nl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Brood and kaas&#39;</span><span class="p">,</span> <span class="s1">&#39;Mes en Vork&#39;</span><span class="p">,</span> <span class="s1">&#39;Mes en Vork&#39;</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>

        <span class="n">env_nolang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;install_mode&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">env_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s2">&quot;install_mode&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">env_fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s2">&quot;install_mode&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="n">env_nl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">,</span> <span class="s2">&quot;install_mode&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># modify attributes in source term</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;Knife and Fork&#39;</span><span class="p">,</span> <span class="s1">&#39;Knife &lt;span invisible=&quot;1&quot;&gt;and&lt;/span&gt; Fork&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain et fromage&#39;</span><span class="p">,</span> <span class="s1">&#39;Couteau et Fourchette&#39;</span><span class="p">,</span> <span class="s1">&#39;Couteau &lt;span style=&quot;font-weight:bold&quot; invisible=&quot;1&quot;&gt;et&lt;/span&gt; Fourchette&#39;</span><span class="p">)</span>

        <span class="c1"># check whether translations have been kept</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># modify attributes in source term</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;Knife and Fork&#39;</span><span class="p">,</span> <span class="s1">&#39;Knife &lt;span readonly=&quot;1&quot;&gt;and&lt;/span&gt; Fork&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain et fromage&#39;</span><span class="p">,</span> <span class="s1">&#39;Couteau et Fourchette&#39;</span><span class="p">,</span> <span class="s1">&#39;Couteau &lt;span style=&quot;font-weight:bold&quot; readonly=&quot;1&quot;&gt;et&lt;/span&gt; Fourchette&#39;</span><span class="p">)</span>

        <span class="c1"># check whether translations have been kept</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_sync_xml_close_terms">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_sync_xml_close_terms">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sync_xml_close_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check translations of &#39;arch&#39; after xml tags changes in source terms. &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;</span><span class="si">%s</span><span class="s1">&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;RandomRandom1&#39;</span><span class="p">,</span> <span class="s1">&#39;RandomRandom2&#39;</span><span class="p">,</span> <span class="s1">&#39;RandomRandom3&#39;</span><span class="p">)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;RandomRandom1&#39;</span><span class="p">,</span> <span class="s1">&#39;AléatoireAléatoire2&#39;</span><span class="p">,</span> <span class="s1">&#39;AléatoireAléatoire3&#39;</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">)</span>

        <span class="n">env_nolang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">env_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">})</span>
        <span class="n">env_fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>

        <span class="c1"># modify source term in view</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;RandomRandom1&#39;</span><span class="p">,</span> <span class="s1">&#39;SomethingElse&#39;</span><span class="p">,</span> <span class="s1">&#39;RandomRandom3&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>

        <span class="c1"># check whether close terms have correct translations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;RandomRandom1&#39;</span><span class="p">,</span> <span class="s1">&#39;SomethingElse&#39;</span><span class="p">,</span> <span class="s1">&#39;AléatoireAléatoire3&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_cache_consistency">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_cache_consistency">[docs]</a>
    <span class="k">def</span> <span class="nf">test_cache_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;ir.ui.view&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;test_translate_xml_cache_invalidation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;res.partner&quot;</span><span class="p">,</span>
            <span class="s2">&quot;arch&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;form&gt;&lt;b&gt;content&lt;/b&gt;&lt;/form&gt;&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view_fr</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">({</span><span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;fr_FR&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;&quot;</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">arch_db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;&quot;</span><span class="p">,</span> <span class="n">view_fr</span><span class="o">.</span><span class="n">arch_db</span><span class="p">)</span>

        <span class="c1"># write with no lang, and check consistency in other languages</span>
        <span class="n">view</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;arch_db&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;form&gt;&lt;i&gt;content&lt;/i&gt;&lt;/form&gt;&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;i&gt;&quot;</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">arch_db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;i&gt;&quot;</span><span class="p">,</span> <span class="n">view_fr</span><span class="o">.</span><span class="n">arch_db</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_update_field_translations">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_update_field_translations">[docs]</a>
    <span class="k">def</span> <span class="nf">test_update_field_translations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork&#39;</span><span class="p">)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain et fromage&#39;</span><span class="p">,</span> <span class="s1">&#39;Fourchette&#39;</span><span class="p">)</span>
        <span class="n">terms_nl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Brood and kaas&#39;</span><span class="p">,</span> <span class="s1">&#39;Vork&#39;</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># cache arch_db</span>
        <span class="n">view</span><span class="o">.</span><span class="n">arch_db</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span>
        <span class="n">view_nl</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span>

        <span class="n">view</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;arch_db&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Fork&#39;</span><span class="p">:</span> <span class="s1">&#39;Fork2&#39;</span><span class="p">},</span>
            <span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Fourchette&#39;</span><span class="p">:</span> <span class="s1">&#39;Fourchette2&#39;</span><span class="p">}</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;Bread and cheese&lt;div&gt;Fork2&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;Bread and cheese&lt;div&gt;Fork2&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;Pain et fromage&lt;div&gt;Fourchette2&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">view_nl</span><span class="p">)</span>

        <span class="n">view</span><span class="o">.</span><span class="n">invalidate_recordset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;Bread and cheese&lt;div&gt;Fork2&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;Bread and cheese&lt;div&gt;Fork2&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;Pain et fromage&lt;div&gt;Fourchette2&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">view_nl</span><span class="p">)</span>

        <span class="c1"># update translations for fallback values and en_US</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;Bread and cheese&lt;div&gt;Fork2&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;arch_db&#39;</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Fork2&#39;</span><span class="p">:</span> <span class="s1">&#39;Fork3&#39;</span><span class="p">},</span>
            <span class="s1">&#39;es_ES&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Fork2&#39;</span><span class="p">:</span> <span class="s1">&#39;Tenedor3&#39;</span><span class="p">}</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;Bread and cheese&lt;div&gt;Fork3&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;es_ES&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;Bread and cheese&lt;div&gt;Tenedor3&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_delay_translations">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_delay_translations">[docs]</a>
    <span class="k">def</span> <span class="nf">test_delay_translations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Knife&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork&#39;</span><span class="p">,</span> <span class="s1">&#39;Spoon&#39;</span><span class="p">)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Couteau&#39;</span><span class="p">,</span> <span class="s1">&#39;Fourchette&#39;</span><span class="p">,</span> <span class="s1">&#39;Cuiller&#39;</span><span class="p">)</span>
        <span class="n">view0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">)</span>

        <span class="n">archf2</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&lt;p&gt;</span><span class="si">%s</span><span class="s1">&lt;/p&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;/form&gt;&#39;</span>
        <span class="n">terms_en2</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;new Knife&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork&#39;</span><span class="p">,</span> <span class="s1">&#39;Spoon&#39;</span><span class="p">)</span>
        <span class="c1"># write en_US with delay_translations</span>
        <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="n">delay_translations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span> <span class="o">=</span> <span class="n">archf2</span> <span class="o">%</span> <span class="n">terms_en2</span>
        <span class="n">view0</span><span class="o">.</span><span class="n">invalidate_recordset</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span>
            <span class="n">archf2</span> <span class="o">%</span> <span class="n">terms_en2</span><span class="p">,</span>
            <span class="s1">&#39;en_US value should be the latest one since it is updated directly&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="n">check_translations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span> <span class="n">archf2</span> <span class="o">%</span> <span class="n">terms_en2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span>
            <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">,</span>
            <span class="s2">&quot;fr_FR value should keep the same since its translations hasn&#39;t been confirmed&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="n">edit_translations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span>
            <span class="s1">&#39;&lt;form string=&quot;&#39;</span>
                <span class="s1">&#39;&amp;lt;span &#39;</span>
                     <span class="s1">&#39;class=&amp;quot;o_delay_translation&amp;quot; &#39;</span>
                     <span class="s1">&#39;data-oe-model=&amp;quot;ir.ui.view&amp;quot; &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;data-oe-id=&amp;quot;</span><span class="si">{</span><span class="n">view0</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&amp;quot; &#39;</span>
                     <span class="s1">&#39;data-oe-field=&amp;quot;arch_db&amp;quot; &#39;</span>
                     <span class="s1">&#39;data-oe-translation-state=&amp;quot;to_translate&amp;quot; &#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;data-oe-translation-initial-sha=&amp;quot;</span><span class="si">{</span><span class="n">sha256</span><span class="p">(</span><span class="n">terms_en2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="si">}</span><span class="s1">&amp;quot;&#39;</span>
                <span class="s1">&#39;&amp;gt;&#39;</span>
                    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">terms_en2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="s1">&#39;&amp;lt;/span&amp;gt;&quot;&#39;</span>
            <span class="s1">&#39;&gt;&#39;</span>
                <span class="s1">&#39;&lt;p&gt;&#39;</span>
                    <span class="s1">&#39;&lt;span &#39;</span>
                         <span class="s1">&#39;class=&quot;o_delay_translation&quot; &#39;</span>
                         <span class="s1">&#39;data-oe-model=&quot;ir.ui.view&quot; &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;data-oe-id=&quot;</span><span class="si">{</span><span class="n">view0</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
                         <span class="s1">&#39;data-oe-field=&quot;arch_db&quot; &#39;</span>
                         <span class="s1">&#39;data-oe-translation-state=&quot;translated&quot; &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;data-oe-translation-initial-sha=&quot;</span><span class="si">{</span><span class="n">sha256</span><span class="p">(</span><span class="n">terms_fr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                    <span class="s1">&#39;&gt;&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">terms_fr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;&lt;/span&gt;&#39;</span>
                <span class="s1">&#39;&lt;/p&gt;&#39;</span>
                <span class="s1">&#39;&lt;div&gt;&#39;</span>
                    <span class="s1">&#39;&lt;span &#39;</span>
                         <span class="s1">&#39;class=&quot;o_delay_translation&quot; &#39;</span>
                         <span class="s1">&#39;data-oe-model=&quot;ir.ui.view&quot; &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;data-oe-id=&quot;</span><span class="si">{</span><span class="n">view0</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">&quot; &#39;</span>
                         <span class="s1">&#39;data-oe-field=&quot;arch_db&quot; &#39;</span>
                         <span class="s1">&#39;data-oe-translation-state=&quot;translated&quot; &#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;data-oe-translation-initial-sha=&quot;</span><span class="si">{</span><span class="n">sha256</span><span class="p">(</span><span class="n">terms_fr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
                    <span class="s1">&#39;&gt;&#39;</span>
                        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">terms_fr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
                    <span class="s1">&#39;&lt;/span&gt;&#39;</span>
                <span class="s1">&#39;&lt;/div&gt;&#39;</span>
            <span class="s1">&#39;&lt;/form&gt;&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="n">check_translations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span>
            <span class="n">archf2</span> <span class="o">%</span> <span class="p">(</span><span class="n">terms_en2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">terms_fr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">terms_fr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span>
            <span class="n">archf2</span> <span class="o">%</span> <span class="n">terms_en2</span><span class="p">,</span>
            <span class="s2">&quot;nl_NL value should fallback to en_US value&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">,</span> <span class="n">check_translations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span>
            <span class="n">archf2</span> <span class="o">%</span> <span class="n">terms_en2</span>
        <span class="p">)</span>

        <span class="c1"># update and confirm translations</span>
        <span class="n">view0</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;arch_db&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="p">{}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span>
            <span class="n">archf2</span> <span class="o">%</span> <span class="p">(</span><span class="n">terms_en2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">terms_fr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">terms_fr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="n">check_translations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span>
            <span class="n">archf2</span> <span class="o">%</span> <span class="p">(</span><span class="n">terms_en2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">terms_fr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">terms_fr</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestXMLTranslation.test_delay_translations_no_term">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestXMLTranslation.test_delay_translations_no_term">[docs]</a>
    <span class="k">def</span> <span class="nf">test_delay_translations_no_term</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;</span><span class="si">%s</span><span class="s1">&quot;&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Knife&#39;</span><span class="p">,</span> <span class="s1">&#39;Fork&#39;</span><span class="p">,</span> <span class="s1">&#39;Spoon&#39;</span><span class="p">)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Couteau&#39;</span><span class="p">,</span> <span class="s1">&#39;Fourchette&#39;</span><span class="p">,</span> <span class="s1">&#39;Cuiller&#39;</span><span class="p">)</span>
        <span class="n">view0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">)</span>

        <span class="n">archf2</span> <span class="o">=</span> <span class="s1">&#39;&lt;form/&gt;&#39;</span>
        <span class="c1"># delay_translations only works when the written value has at least one translatable term</span>
        <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="n">delay_translations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span> <span class="o">=</span> <span class="n">archf2</span>
        <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span>
                <span class="n">archf2</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;arch_db for </span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1"> should be </span><span class="si">{</span><span class="n">archf2</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                <span class="n">view0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span> <span class="n">check_translations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">arch_db</span><span class="p">,</span>
                <span class="n">archf2</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;arch_db for </span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1"> should be </span><span class="si">{</span><span class="n">archf2</span><span class="si">}</span><span class="s1"> when check_translations&#39;</span>
            <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestHTMLTranslation">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestHTMLTranslation">[docs]</a>
<span class="k">class</span> <span class="nc">TestHTMLTranslation</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestHTMLTranslation.test_write_non_existing">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestHTMLTranslation.test_write_non_existing">[docs]</a>
    <span class="k">def</span> <span class="nf">test_write_non_existing</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">html</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;h1&gt;My First Heading&lt;/h1&gt;</span>
<span class="s1">&lt;p&gt;My first paragraph.&lt;/p&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>
        <span class="n">company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.company&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">browse</span><span class="p">(</span><span class="mi">9999</span><span class="p">)</span>
        <span class="n">company</span><span class="o">.</span><span class="n">report_footer</span> <span class="o">=</span> <span class="n">html</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertHTMLEqual</span><span class="p">(</span><span class="n">company</span><span class="o">.</span><span class="n">report_footer</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>
        <span class="c1"># flushing on non-existing records does not break for scalar fields; the</span>
        <span class="c1"># same behavior is expected for translated fields</span>
        <span class="n">company</span><span class="o">.</span><span class="n">flush_recordset</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestHTMLTranslation.test_delay_translations_no_term">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestHTMLTranslation.test_delay_translations_no_term">[docs]</a>
    <span class="k">def</span> <span class="nf">test_delay_translations_no_term</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span>
        <span class="n">Company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.company&#39;</span><span class="p">]</span>
        <span class="n">company0</span> <span class="o">=</span> <span class="n">Company</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;company_1&#39;</span><span class="p">,</span> <span class="s1">&#39;report_footer&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;h1&gt;Knife&lt;/h1&gt;&#39;</span><span class="p">})</span>
        <span class="n">company0</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;report_footer&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Knife&#39;</span><span class="p">:</span> <span class="s1">&#39;Couteau&#39;</span><span class="p">}})</span>

        <span class="k">for</span> <span class="n">html</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&lt;h1&gt;&lt;/h1&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="c1"># delay_translations only works when the written value has at least one translatable term</span>
            <span class="n">company0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="n">delay_translations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">report_footer</span> <span class="o">=</span> <span class="n">html</span>
            <span class="k">for</span> <span class="n">lang</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;en_US&#39;</span><span class="p">,</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                    <span class="n">company0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">)</span><span class="o">.</span><span class="n">report_footer</span><span class="p">,</span>
                    <span class="n">html</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;report_footer for </span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1"> should be </span><span class="si">{</span><span class="n">html</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
                    <span class="n">company0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="n">lang</span><span class="p">,</span> <span class="n">check_translations</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">report_footer</span><span class="p">,</span>
                    <span class="n">html</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;report_footer for </span><span class="si">{</span><span class="n">lang</span><span class="si">}</span><span class="s1"> should be </span><span class="si">{</span><span class="n">html</span><span class="si">}</span><span class="s1"> when check_translations&#39;</span>
                <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestLanguageInstallPerformance">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestLanguageInstallPerformance">[docs]</a>
<span class="nd">@tagged</span><span class="p">(</span><span class="s1">&#39;post_install&#39;</span><span class="p">,</span> <span class="s1">&#39;-at_install&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestLanguageInstallPerformance</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestLanguageInstallPerformance.test_language_install">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestLanguageInstallPerformance.test_language_install">[docs]</a>
    <span class="k">def</span> <span class="nf">test_language_install</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Install a language on a complete database. &quot;&quot;&quot;</span>
        <span class="n">fr_BE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.lang_fr_BE&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">fr_BE</span><span class="o">.</span><span class="n">active</span><span class="p">)</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">fr_BE</span><span class="o">.</span><span class="n">toggle_active</span><span class="p">()</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">_stats_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;installed language fr_BE in </span><span class="si">%.3f</span><span class="s2">s&quot;</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestTranslationTrigramIndexPatterns">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationTrigramIndexPatterns">[docs]</a>
<span class="k">class</span> <span class="nc">TestTranslationTrigramIndexPatterns</span><span class="p">(</span><span class="n">BaseCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestTranslationTrigramIndexPatterns.test_value_conversion">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationTrigramIndexPatterns.test_value_conversion">[docs]</a>
    <span class="k">def</span> <span class="nf">test_value_conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">SPECIAL_CHARACTERS</span>
        <span class="n">cases</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># pylint: disable=bad-whitespace</span>
            <span class="p">(</span> <span class="s1">&#39;abc&#39;</span><span class="p">,</span>    <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">bc%&#39;</span><span class="p">,</span>      <span class="s1">&#39;simple text is not escaped correctly&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;a&quot;bc&#39;</span><span class="p">,</span>  <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%a</span><span class="se">\\</span><span class="s1">&quot;bc%&#39;</span><span class="p">,</span>   <span class="s1">&#39;&quot; is not escaped correctly&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;a\bc&#39;</span><span class="p">,</span>  <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%a</span><span class="se">\\\\</span><span class="s1">bc%&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\ is not escaped correctly&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;a</span><span class="se">\n</span><span class="s1">bc&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%a</span><span class="se">\\</span><span class="s1">nbc%&#39;</span><span class="p">,</span>  <span class="sa">r</span><span class="s1">&#39;\n is not escaped correctly&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;a_bc&#39;</span><span class="p">,</span>  <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1">\_bc%&#39;</span><span class="p">,</span>    <span class="s1">&#39;_ is not escaped correctly&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;a%bc&#39;</span><span class="p">,</span>  <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1">\%bc%&#39;</span><span class="p">,</span>    <span class="s1">&#39;</span><span class="si">% i</span><span class="s1">s not escaped correctly&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;a_&#39;</span><span class="p">,</span>     <span class="s1">&#39;%&#39;</span><span class="p">,</span>          <span class="s1">&#39;values with less than 3 characters should be dropped&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="n">sc</span><span class="p">,</span>      <span class="sa">f</span><span class="s1">&#39;%</span><span class="si">{</span><span class="n">sc</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>     <span class="s1">&#39;special characters should not be escaped&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">expected</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">cases</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sql</span><span class="o">.</span><span class="n">value_to_translated_trigram_pattern</span><span class="p">(</span><span class="n">value</span><span class="p">),</span> <span class="n">expected</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTranslationTrigramIndexPatterns.test_pattern_conversion">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_translate.TestTranslationTrigramIndexPatterns.test_pattern_conversion">[docs]</a>
    <span class="k">def</span> <span class="nf">test_pattern_conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">sc</span> <span class="o">=</span> <span class="n">SPECIAL_CHARACTERS</span>
        <span class="n">cases</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1"># pylint: disable=bad-whitespace</span>
            <span class="p">(</span> <span class="s1">&#39;abc&#39;</span><span class="p">,</span>      <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">bc%&#39;</span><span class="p">,</span>      <span class="s1">&#39;simple pattern is not escaped correctly&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;a&quot;bc&#39;</span><span class="p">,</span>    <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%a</span><span class="se">\\</span><span class="s1">&quot;bc%&#39;</span><span class="p">,</span>   <span class="s1">&#39;&quot; is not escaped correctly&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;a</span><span class="se">\\</span><span class="s1">bc&#39;</span><span class="p">,</span>   <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%a</span><span class="se">\\\\</span><span class="s1">bc%&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\ is not escaped correctly&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;a</span><span class="se">\n</span><span class="s1">bc&#39;</span><span class="p">,</span>   <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%a</span><span class="se">\\</span><span class="s1">nbc%&#39;</span><span class="p">,</span>  <span class="sa">r</span><span class="s1">&#39;\n is not escaped correctly&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;a\_bc&#39;</span><span class="p">,</span>   <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1">\_bc%&#39;</span><span class="p">,</span>   <span class="sa">r</span><span class="s2">&quot;\_ shouldn&#39;t be escaped&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;a\%bc&#39;</span><span class="p">,</span>   <span class="sa">r</span><span class="s1">&#39;</span><span class="si">%a</span><span class="s1">\%bc%&#39;</span><span class="p">,</span>   <span class="sa">r</span><span class="s2">&quot;\</span><span class="si">% s</span><span class="s2">houldn&#39;t be escaped&quot;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;abc_def&#39;</span><span class="p">,</span>  <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">bc</span><span class="si">%d</span><span class="s1">ef%&#39;</span><span class="p">,</span>  <span class="s1">&#39;wildcard character _ should be changed to %&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;abc</span><span class="si">%d</span><span class="s1">ef&#39;</span><span class="p">,</span>  <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">bc</span><span class="si">%d</span><span class="s1">ef%&#39;</span><span class="p">,</span>  <span class="s2">&quot;wildcard character </span><span class="si">% s</span><span class="s2">houldn&#39;t be escaped&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;a\bc&#39;</span><span class="p">,</span>     <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">bc%&#39;</span><span class="p">,</span>     <span class="sa">r</span><span class="s1">&#39;redundant \ for pattern should be removed&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;abc_de&#39;</span><span class="p">,</span>   <span class="s1">&#39;</span><span class="si">%a</span><span class="s1">bc%&#39;</span><span class="p">,</span>      <span class="s1">&#39;sub patterns less than 3 characters should be dropped&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="s1">&#39;ab&#39;</span><span class="p">,</span>       <span class="s1">&#39;%&#39;</span><span class="p">,</span>          <span class="s1">&#39;patterns without trigram should be simplified&#39;</span><span class="p">),</span>
            <span class="p">(</span> <span class="n">sc</span><span class="p">,</span>        <span class="sa">f</span><span class="s1">&#39;%</span><span class="si">{</span><span class="n">sc</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">,</span>     <span class="s1">&#39;special characters should not be escaped&#39;</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">original_pattern</span><span class="p">,</span> <span class="n">escaped_pattern</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">cases</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">sql</span><span class="o">.</span><span class="n">pattern_to_translated_trigram_pattern</span><span class="p">(</span><span class="n">original_pattern</span><span class="p">),</span> <span class="n">escaped_pattern</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Amr.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>