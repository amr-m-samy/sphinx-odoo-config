<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>odoo.addons.base.tests.test_image &mdash; Amr  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Amr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">odoo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Amr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../../odoo.html">odoo</a></li>
          <li class="breadcrumb-item"><a href="../../base.html">odoo.addons.base</a></li>
      <li class="breadcrumb-item active">odoo.addons.base.tests.test_image</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for odoo.addons.base.tests.test_image</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Part of Odoo. See LICENSE file for full copyright and licensing details.</span>

<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">binascii</span>

<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">PngImagePlugin</span>

<span class="kn">from</span> <span class="nn">odoo</span> <span class="kn">import</span> <span class="n">tools</span>
<span class="kn">from</span> <span class="nn">odoo.exceptions</span> <span class="kn">import</span> <span class="n">UserError</span>
<span class="kn">from</span> <span class="nn">odoo.tests.common</span> <span class="kn">import</span> <span class="n">TransactionCase</span>


<div class="viewcode-block" id="img_open">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.img_open">[docs]</a>
<span class="k">def</span> <span class="nf">img_open</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>



<div class="viewcode-block" id="TestImage">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage">[docs]</a>
<span class="k">class</span> <span class="nc">TestImage</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tests for the different image tools helpers.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="TestImage.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestImage</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bg_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">135</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">123</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fill_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">157</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">img_1x1_png</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAADElEQVR4nGNgYGAAAAAEAAH2FzhVAAAAAElFTkSuQmCC&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_svg</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&lt;svg&gt;&lt;/svg&gt;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">)),</span> <span class="s1">&#39;JPEG&#39;</span><span class="p">)</span>
        <span class="c1"># The following image contains a tag `Lens Info` with a value of `3.99mm f/1.8`</span>
        <span class="c1"># This particular tag 0xa432 makes the `exif_transpose` method fail in 5.4.1 &lt; Pillow &lt; 7.2.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_exif_jpg</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;&quot;&quot;/9j/4AAQSkZJRgABAQAAAQABAAD/4QDQRXhpZgAATU0AKgAAAAgABgESAAMAAAABAAYAAAEaAAUA</span>
<span class="s2">                                  AAABAAAAVgEbAAUAAAABAAAAXgEoAAMAAAABAAEAAAITAAMAAAABAAEAAIdpAAQAAAABAAAAZgAA</span>
<span class="s2">                                  AAAAAAABAAAAAQAAAAEAAAABAAWQAAAHAAAABDAyMzGRAQAHAAAABAECAwCgAAAHAAAABDAxMDCg</span>
<span class="s2">                                  AQADAAAAAf//AACkMgAFAAAABAAAAKgAAAAAAAABjwAAAGQAAAGPAAAAZAAAAAkAAAAFAAAACQAA</span>
<span class="s2">                                  AAX/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAx</span>
<span class="s2">                                  NDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIy</span>
<span class="s2">                                  MjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAADAAYDASIAAhEBAxEB/8QAHwAAAQUBAQEB</span>
<span class="s2">                                  AQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1Fh</span>
<span class="s2">                                  ByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZ</span>
<span class="s2">                                  WmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXG</span>
<span class="s2">                                  x8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAEC</span>
<span class="s2">                                  AwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHB</span>
<span class="s2">                                  CSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0</span>
<span class="s2">                                  dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX</span>
<span class="s2">                                  2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD3+iiigD//2Q==&quot;&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># Draw a red square in the middle of the image, this will be used to</span>
        <span class="c1"># verify crop is working. The border is going to be `self.bg_color` and</span>
        <span class="c1"># the middle is going to be `self.fill_color`.</span>

        <span class="c1"># horizontal image (border is left/right)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bg_color</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_png</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s1">&#39;PNG&#39;</span><span class="p">)</span>

        <span class="c1"># vertical image (border is top/bottom)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1080</span><span class="p">,</span> <span class="mi">1920</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bg_color</span><span class="p">)</span>
        <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">offset</span><span class="p">),</span>
            <span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s1">&#39;PNG&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestImage.test_00_base64_to_image">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_00_base64_to_image">[docs]</a>
    <span class="k">def</span> <span class="nf">test_00_base64_to_image</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that base64 is correctly opened as a PIL image.&quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1x1_png</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="n">PngImagePlugin</span><span class="o">.</span><span class="n">PngImageFile</span><span class="p">,</span> <span class="s2">&quot;base64 as bytes, correct format&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;base64 as bytes, correct size&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">UserError</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;This file could not be decoded as an image file. Please try with a different file.&quot;</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">base64_to_image</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;oazdazpodazdpok&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">UserError</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;This file could not be decoded as an image file. Please try with a different file.&quot;</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">base64_to_image</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;oazdazpodazdpokd&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestImage.test_01_image_to_base64">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_01_image_to_base64">[docs]</a>
    <span class="k">def</span> <span class="nf">test_01_image_to_base64</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that a PIL image is correctly saved as base64.&quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">image_base64</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_to_base64</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s1">&#39;PNG&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image_base64</span><span class="p">,</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1x1_png</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestImage.test_02_image_fix_orientation">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_02_image_fix_orientation">[docs]</a>
    <span class="k">def</span> <span class="nf">test_02_image_fix_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that the orientation of images is correct.&quot;&quot;&quot;</span>

        <span class="c1"># Colors that can be distinguished among themselves even with jpeg loss.</span>
        <span class="n">blue</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
        <span class="n">yellow</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">green</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pink</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
        <span class="c1"># Image large enough so jpeg loss is not a huge factor in the corners.</span>
        <span class="n">size</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">yellow</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">pink</span><span class="p">)</span>

        <span class="c1"># They are all supposed to be same image: (blue, yellow, green, pink) in</span>
        <span class="c1"># that order, but each encoded with a different orientation.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation_test</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">yellow</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">pink</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>  <span class="c1"># top/left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation_test</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">yellow</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">pink</span><span class="p">,</span> <span class="n">green</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>  <span class="c1"># top/right</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation_test</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">(</span><span class="n">pink</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">yellow</span><span class="p">,</span> <span class="n">blue</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>  <span class="c1"># bottom/right</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation_test</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="p">(</span><span class="n">green</span><span class="p">,</span> <span class="n">pink</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">yellow</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>  <span class="c1"># bottom/left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation_test</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">yellow</span><span class="p">,</span> <span class="n">pink</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>  <span class="c1"># left/top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation_test</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">(</span><span class="n">yellow</span><span class="p">,</span> <span class="n">pink</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">green</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>  <span class="c1"># right/top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation_test</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="p">(</span><span class="n">pink</span><span class="p">,</span> <span class="n">yellow</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>  <span class="c1"># right/bottom</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orientation_test</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="p">(</span><span class="n">green</span><span class="p">,</span> <span class="n">blue</span><span class="p">,</span> <span class="n">pink</span><span class="p">,</span> <span class="n">yellow</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>  <span class="c1"># left/bottom</span></div>


<div class="viewcode-block" id="TestImage.test_03_image_fix_orientation_exif">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_03_image_fix_orientation_exif">[docs]</a>
    <span class="k">def</span> <span class="nf">test_03_image_fix_orientation_exif</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that a jpg image with exif orientation tag gets rotated&quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_exif_jpg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_fix_orientation</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestImage.test_10_image_process_source">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_10_image_process_source">[docs]</a>
    <span class="k">def</span> <span class="nf">test_10_image_process_source</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the source parameter of image_process.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="kc">False</span><span class="p">),</span> <span class="s2">&quot;return False if source is falsy&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_svg</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_svg</span><span class="p">,</span> <span class="s2">&quot;return source if format is SVG&quot;</span><span class="p">)</span>

        <span class="c1"># in the following tests, pass `quality` to force the processing</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">UserError</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;This file could not be decoded as an image file. Please try with a different file.&quot;</span><span class="p">):</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;oazdazpodazdpokd&#39;</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">95</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="s2">&quot;OK return the image&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestImage.test_11_image_process_size">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_11_image_process_size">[docs]</a>
    <span class="k">def</span> <span class="nf">test_11_image_process_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the size parameter of image_process.&quot;&quot;&quot;</span>

        <span class="c1"># Format of `tests`: (original image, size parameter, expected result, text)</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">108</span><span class="p">),</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">108</span><span class="p">),</span> <span class="s2">&quot;resize to given size&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="s2">&quot;same size, no change&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">108</span><span class="p">),</span> <span class="s2">&quot;set height from ratio&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">108</span><span class="p">),</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">108</span><span class="p">),</span> <span class="s2">&quot;set width from ratio&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">108</span><span class="p">),</span> <span class="s2">&quot;adapt to width&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">108</span><span class="p">),</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">108</span><span class="p">),</span> <span class="s2">&quot;adapt to height&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="s2">&quot;don&#39;t resize above original, both set&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="s2">&quot;don&#39;t resize above original, width set&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="s2">&quot;don&#39;t resize above original, height set&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">3000</span><span class="p">,</span> <span class="mi">192</span><span class="p">),</span> <span class="p">(</span><span class="mi">108</span><span class="p">,</span> <span class="mi">192</span><span class="p">),</span> <span class="s2">&quot;vertical image, resize if below&quot;</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">test</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">test</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;ensure the loop is ran&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestImage.test_12_image_process_verify_resolution">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_12_image_process_verify_resolution">[docs]</a>
    <span class="k">def</span> <span class="nf">test_12_image_process_verify_resolution</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the verify_resolution parameter of image_process.&quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="n">verify_resolution</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;size ok&quot;</span><span class="p">)</span>
        <span class="n">image_excessive</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">50001</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)),</span> <span class="s1">&#39;PNG&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">UserError</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;size excessive&quot;</span><span class="p">):</span>
            <span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">image_excessive</span><span class="p">,</span> <span class="n">verify_resolution</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestImage.test_13_image_process_quality">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_13_image_process_quality">[docs]</a>
    <span class="k">def</span> <span class="nf">test_13_image_process_quality</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the quality parameter of image_process.&quot;&quot;&quot;</span>

        <span class="c1"># CASE: PNG RGBA doesn&#39;t apply quality, just optimize</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1080</span><span class="p">,</span> <span class="mi">1920</span><span class="p">)),</span> <span class="s1">&#39;PNG&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>

        <span class="c1"># CASE: PNG RGB doesn&#39;t apply quality, just optimize</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1080</span><span class="p">,</span> <span class="mi">1920</span><span class="p">)),</span> <span class="s1">&#39;PNG&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>

        <span class="c1"># CASE: JPEG optimize + reduced quality</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">))</span>

        <span class="c1"># CASE: JPEG optimize + bigger size =&gt; original</span>
        <span class="n">pil_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bg_color</span><span class="p">)</span>
        <span class="c1"># Drawing non trivial content so that optimization matters.</span>
        <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">pil_image</span><span class="p">)</span><span class="o">.</span><span class="n">ellipse</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">(</span><span class="mi">1500</span><span class="p">,</span> <span class="mi">1080</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fill_color</span><span class="p">,</span> <span class="n">outline</span><span class="o">=</span><span class="p">(</span><span class="mi">240</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">40</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">pil_image</span><span class="p">,</span> <span class="s1">&#39;JPEG&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLess</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="s2">&quot;Low quality image should be smaller than original&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">),</span> <span class="s2">&quot;Original should be returned if size increased&quot;</span><span class="p">)</span>

        <span class="c1"># CASE: GIF doesn&#39;t apply quality, just optimize</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1080</span><span class="p">,</span> <span class="mi">1920</span><span class="p">)),</span> <span class="s1">&#39;GIF&#39;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertLessEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestImage.test_14_image_process_crop">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_14_image_process_crop">[docs]</a>
    <span class="k">def</span> <span class="nf">test_14_image_process_crop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the crop parameter of image_process.&quot;&quot;&quot;</span>

        <span class="c1"># Optimized PNG use palette, getpixel below will return palette value.</span>
        <span class="n">fill</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">bg</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># Format of `tests`: (original base64 image, size parameter, crop parameter, res size, res color (top, bottom, left, right), text)</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_png</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">bg</span><span class="p">),</span> <span class="s2">&quot;horizontal, verify initial&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1080</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;horizontal, crop biggest possible&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">),</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">540</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;horizontal, size vertical, limit height&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1920</span><span class="p">,</span> <span class="mi">960</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">bg</span><span class="p">),</span> <span class="s2">&quot;horizontal, size horizontal, limit width&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;horizontal, type center&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;horizontal, type top&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;horizontal, type bottom&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="s1">&#39;wrong&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;horizontal, wrong crop value, use center&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="mi">192</span><span class="p">,</span> <span class="mi">108</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">bg</span><span class="p">),</span> <span class="s2">&quot;horizontal, not cropped, just do resize&quot;</span><span class="p">),</span>

            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="mi">1080</span><span class="p">,</span> <span class="mi">1920</span><span class="p">),</span> <span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;vertical, verify initial&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1080</span><span class="p">,</span> <span class="mi">1080</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;vertical, crop biggest possible&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">),</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">960</span><span class="p">,</span> <span class="mi">1920</span><span class="p">),</span> <span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;vertical, size vertical, limit height&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1080</span><span class="p">,</span> <span class="mi">540</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;vertical, size horizontal, limit width&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;vertical, type center&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;vertical, type top&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;vertical, type bottom&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="s1">&#39;wrong&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="p">(</span><span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;vertical, wrong crop value, use center&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1080x1920_png</span><span class="p">,</span> <span class="p">(</span><span class="mi">108</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span><span class="mi">108</span><span class="p">,</span> <span class="mi">192</span><span class="p">),</span> <span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">fill</span><span class="p">,</span> <span class="n">fill</span><span class="p">),</span> <span class="s2">&quot;vertical, not cropped, just do resize&quot;</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="c1"># process the image, pass quality to make sure the result is palette</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">size</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">crop</span><span class="o">=</span><span class="n">test</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">quality</span><span class="o">=</span><span class="mi">95</span><span class="p">))</span>
            <span class="c1"># verify size</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">test</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - correct size&quot;</span> <span class="o">%</span> <span class="n">test</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>

            <span class="n">half_width</span><span class="p">,</span> <span class="n">half_height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="c1"># verify top</span>
            <span class="n">px</span> <span class="o">=</span> <span class="p">(</span><span class="n">half_width</span><span class="p">,</span> <span class="n">top</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">(</span><span class="n">px</span><span class="p">),</span> <span class="n">test</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - color top (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">px</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">px</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1"># verify bottom</span>
            <span class="n">px</span> <span class="o">=</span> <span class="p">(</span><span class="n">half_width</span><span class="p">,</span> <span class="n">bottom</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">(</span><span class="n">px</span><span class="p">),</span> <span class="n">test</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - color bottom (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">px</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">px</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1"># verify left</span>
            <span class="n">px</span> <span class="o">=</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">half_height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">(</span><span class="n">px</span><span class="p">),</span> <span class="n">test</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - color left (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">px</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">px</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="c1"># verify right</span>
            <span class="n">px</span> <span class="o">=</span> <span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">half_height</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">(</span><span class="n">px</span><span class="p">),</span> <span class="n">test</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> - color right (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">test</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">px</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">px</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">9</span><span class="p">,</span> <span class="s2">&quot;ensure the loop is ran&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestImage.test_15_image_process_colorize">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_15_image_process_colorize">[docs]</a>
    <span class="k">def</span> <span class="nf">test_15_image_process_colorize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the colorize parameter of image_process.&quot;&quot;&quot;</span>

        <span class="c1"># verify initial condition</span>
        <span class="n">image_rgba</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image_rgba</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;RGBA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image_rgba</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">rgba</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">image_rgba</span><span class="p">,</span> <span class="s1">&#39;PNG&#39;</span><span class="p">)</span>

        <span class="c1"># CASE: color random, color has changed</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">rgba</span><span class="p">,</span> <span class="n">colorize</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;RGB&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestImage.test_16_image_process_format">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_16_image_process_format">[docs]</a>
    <span class="k">def</span> <span class="nf">test_16_image_process_format</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test the format parameter of image_process.&quot;&quot;&quot;</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;PNG&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="s1">&#39;PNG&#39;</span><span class="p">,</span> <span class="s2">&quot;change format to PNG&quot;</span><span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1x1_png</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;JpEg&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="s1">&#39;JPEG&#39;</span><span class="p">,</span> <span class="s2">&quot;change format to JPEG (case insensitive)&quot;</span><span class="p">)</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1920x1080_jpeg</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;BMP&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="s1">&#39;PNG&#39;</span><span class="p">,</span> <span class="s2">&quot;change format to BMP converted to PNG&quot;</span><span class="p">)</span>

        <span class="n">image_1080_1920_rgba</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGBA&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">108</span><span class="p">,</span> <span class="mi">192</span><span class="p">)),</span> <span class="s1">&#39;PNG&#39;</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">image_1080_1920_rgba</span><span class="p">,</span> <span class="n">output_format</span><span class="o">=</span><span class="s1">&#39;jpeg&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="s1">&#39;JPEG&#39;</span><span class="p">,</span> <span class="s2">&quot;change format PNG with RGBA to JPEG&quot;</span><span class="p">)</span>

        <span class="c1"># pass quality to force the image to be processed</span>
        <span class="n">image_1080_1920_tiff</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">108</span><span class="p">,</span> <span class="mi">192</span><span class="p">)),</span> <span class="s1">&#39;TIFF&#39;</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">img_open</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_process</span><span class="p">(</span><span class="n">image_1080_1920_tiff</span><span class="p">,</span> <span class="n">quality</span><span class="o">=</span><span class="mi">95</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="s1">&#39;JPEG&#39;</span><span class="p">,</span> <span class="s2">&quot;unsupported format to JPEG&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestImage.test_17_get_webp_size">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_17_get_webp_size">[docs]</a>
    <span class="k">def</span> <span class="nf">test_17_get_webp_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Using 32 bytes image headers as data.</span>
        <span class="c1"># Lossy webp: 550x368</span>
        <span class="n">webp_lossy</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;RIFFhv</span><span class="se">\x00\x00</span><span class="s1">WEBPVP8 </span><span class="se">\\</span><span class="s1">v</span><span class="se">\x00\x00\xd2\xbe\x01\x9d\x01</span><span class="s1">*&amp;</span><span class="se">\x02</span><span class="s1">p</span><span class="se">\x01</span><span class="s1">&gt;</span><span class="se">\xd5</span><span class="s1">&#39;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_webp_size</span><span class="p">(</span><span class="n">webp_lossy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">550</span><span class="p">,</span> <span class="mi">368</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="s2">&quot;Wrong resolution for lossy webp&quot;</span><span class="p">)</span>
        <span class="c1"># Lossless webp: 421x163</span>
        <span class="n">webp_lossless</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;RIFF</span><span class="se">\xba\x84\x00\x00</span><span class="s1">WEBPVP8L</span><span class="se">\xad\x84\x00\x00</span><span class="s1">/</span><span class="se">\xa4\x81</span><span class="s1">(</span><span class="se">\x10</span><span class="s1">MHr</span><span class="se">\x1b</span><span class="s1">I</span><span class="se">\x92\xa4</span><span class="s1">&#39;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_webp_size</span><span class="p">(</span><span class="n">webp_lossless</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">421</span><span class="p">,</span> <span class="mi">163</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="s2">&quot;Wrong resolution for lossless webp&quot;</span><span class="p">)</span>
        <span class="c1"># Extended webp: 800x600</span>
        <span class="n">webp_extended</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;RIFF</span><span class="se">\x80\xce\x00\x00</span><span class="s1">WEBPVP8X</span><span class="se">\n\x00\x00\x00\x10\x00\x00\x00\x1f\x03\x00</span><span class="s1">W</span><span class="se">\x02\x00</span><span class="s1">AL&#39;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">get_webp_size</span><span class="p">(</span><span class="n">webp_extended</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">((</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">),</span> <span class="n">size</span><span class="p">,</span> <span class="s2">&quot;Wrong resolution for extended webp&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestImage.test_20_image_data_uri">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_20_image_data_uri">[docs]</a>
    <span class="k">def</span> <span class="nf">test_20_image_data_uri</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Test that image_data_uri is working as expected.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image_data_uri</span><span class="p">(</span><span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1x1_png</span><span class="p">)),</span> <span class="s1">&#39;data:image/png;base64,&#39;</span> <span class="o">+</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img_1x1_png</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestImage.test_21_image_guess_size_from_field_name">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_21_image_guess_size_from_field_name">[docs]</a>
    <span class="k">def</span> <span class="nf">test_21_image_guess_size_from_field_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_guess_size_from_field_name</span>
        <span class="c1"># Test case: empty field_name input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Test case: custom field_name input</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;custom_field&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Test case: field_name input that starts with &#39;x_&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;x_field&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Test case: field_name input that starts with &#39;x_&#39; and ends with a number less than 16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;x_studio_image_1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Test case: field_name input that starts with &#39;x_&#39; and ends with a number greater than 16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;x_studio_image_32&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Test case: field_name input that has a suffix less than 16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;image_15&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Test case: field_name input that has a suffix equal to 16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;image_16&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">))</span>
        <span class="c1"># Test case: field_name input that has a suffix greater than 16</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;image_32&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
        <span class="c1"># Test case: field_name input that has a suffix with 2 numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;image_1920_1080&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">1080</span><span class="p">,</span> <span class="mi">1080</span><span class="p">))</span>
        <span class="c1"># Test case: field_name input that has a float as suffix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;image_32.5&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="c1"># Test case: field_name input that has a suffix greater than 16 but no underscore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="s1">&#39;image32&#39;</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">_assertAlmostEqualSequence</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rgb1</span><span class="p">,</span> <span class="n">rgb2</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rgb1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rgb2</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">rgb1</span><span class="p">,</span> <span class="n">rgb2</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertAlmostEqual</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">delta</span><span class="o">=</span><span class="n">delta</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> vs </span><span class="si">%s</span><span class="s2"> at </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">rgb1</span><span class="p">,</span> <span class="n">rgb2</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_get_exif_colored_square</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">size</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bg_color</span><span class="p">)</span>
        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="c1"># Paint the colors on the 4 corners, to be able to test which colors</span>
        <span class="c1"># move on which corners.</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)],</span> <span class="n">fill</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>        <span class="c1"># top/left</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">[(</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)],</span> <span class="n">fill</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>     <span class="c1"># top/right</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="p">)],</span> <span class="n">fill</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>     <span class="c1"># bottom/left</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span><span class="n">xy</span><span class="o">=</span><span class="p">[(</span><span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">)],</span> <span class="n">fill</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># bottom/right</span>
        <span class="c1"># Set the proper exif tag based on orientation params.</span>
        <span class="n">exif</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;Exif</span><span class="se">\x00\x00</span><span class="s1">II*</span><span class="se">\x00\x08\x00\x00\x00\x01\x00\x12\x01\x03\x00\x01\x00\x00\x00</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">orientation</span><span class="p">])</span> <span class="o">+</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\x00\x00\x00\x00\x00\x00\x00</span><span class="s1">&#39;</span>
        <span class="c1"># The image image is saved with the exif tag.</span>
        <span class="k">return</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s1">&#39;JPEG&#39;</span><span class="p">,</span> <span class="n">exif</span><span class="o">=</span><span class="n">exif</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_orientation_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orientation</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
        <span class="c1"># Generate the test image based on orientation and order of colors.</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_exif_colored_square</span><span class="p">(</span><span class="n">orientation</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
        <span class="c1"># The image is read again now that it has orientation added.</span>
        <span class="n">fixed_image</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">image_fix_orientation</span><span class="p">(</span><span class="n">img_open</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
        <span class="c1"># Ensure colors are in the right order (blue, yellow, green, pink).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assertAlmostEqualSequence</span><span class="p">(</span><span class="n">fixed_image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">expected</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                <span class="c1"># top/left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assertAlmostEqualSequence</span><span class="p">(</span><span class="n">fixed_image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)),</span> <span class="n">expected</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>         <span class="c1"># top/right</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assertAlmostEqualSequence</span><span class="p">(</span><span class="n">fixed_image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">expected</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>         <span class="c1"># bottom/left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assertAlmostEqualSequence</span><span class="p">(</span><span class="n">fixed_image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">expected</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  <span class="c1"># bottom/right</span>

<div class="viewcode-block" id="TestImage.test_ptype_image_to_jpeg">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_image.TestImage.test_ptype_image_to_jpeg">[docs]</a>
    <span class="k">def</span> <span class="nf">test_ptype_image_to_jpeg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;converts to RGB when saving as JPEG&quot;&quot;&quot;</span>
        <span class="n">image1</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="n">image2</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">tools</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="s1">&#39;JPEG&#39;</span><span class="p">),</span> <span class="n">tools</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">image_apply_opt</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span> <span class="s1">&#39;JPEG&#39;</span><span class="p">))</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Amr.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>