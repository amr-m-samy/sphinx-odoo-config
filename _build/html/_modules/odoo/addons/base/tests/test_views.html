<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>odoo.addons.base.tests.test_views &mdash; Amr  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Amr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">odoo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Amr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../../odoo.html">odoo</a></li>
          <li class="breadcrumb-item"><a href="../../base.html">odoo.addons.base</a></li>
      <li class="breadcrumb-item active">odoo.addons.base.tests.test_views</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for odoo.addons.base.tests.test_views</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Part of Odoo. See LICENSE file for full copyright and licensing details.</span>
<span class="kn">import</span> <span class="nn">ast</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span>
<span class="kn">from</span> <span class="nn">lxml.builder</span> <span class="kn">import</span> <span class="n">E</span>
<span class="kn">from</span> <span class="nn">psycopg2</span> <span class="kn">import</span> <span class="n">IntegrityError</span>
<span class="kn">from</span> <span class="nn">psycopg2.extras</span> <span class="kn">import</span> <span class="n">Json</span>

<span class="kn">from</span> <span class="nn">odoo.exceptions</span> <span class="kn">import</span> <span class="n">AccessError</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">odoo.tests</span> <span class="kn">import</span> <span class="n">common</span><span class="p">,</span> <span class="n">tagged</span>
<span class="kn">from</span> <span class="nn">odoo.addons.base.tests.common</span> <span class="kn">import</span> <span class="n">TransactionCaseWithUserDemo</span>
<span class="kn">from</span> <span class="nn">odoo.tools</span> <span class="kn">import</span> <span class="n">get_cache_key_counter</span><span class="p">,</span> <span class="n">mute_logger</span><span class="p">,</span> <span class="n">view_validation</span><span class="p">,</span> <span class="n">safe_eval</span>
<span class="kn">from</span> <span class="nn">odoo.addons.base.models</span> <span class="kn">import</span> <span class="n">ir_ui_view</span>

<span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<div class="viewcode-block" id="ViewXMLID">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewXMLID">[docs]</a>
<span class="k">class</span> <span class="nc">ViewXMLID</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="ViewXMLID.test_model_data_id">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewXMLID.test_model_data_id">[docs]</a>
    <span class="k">def</span> <span class="nf">test_model_data_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check whether views know their xmlid record. &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.view_company_form&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">view</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">model_data_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">model_data_id</span><span class="o">.</span><span class="n">complete_name</span><span class="p">,</span> <span class="s1">&#39;base.view_company_form&#39;</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="ViewCase">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewCase">[docs]</a>
<span class="k">class</span> <span class="nc">ViewCase</span><span class="p">(</span><span class="n">TransactionCaseWithUserDemo</span><span class="p">):</span>
<div class="viewcode-block" id="ViewCase.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewCase.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="ViewCase.assertValid">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewCase.assertValid">[docs]</a>
    <span class="k">def</span> <span class="nf">assertValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arch</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;valid view&#39;</span><span class="p">,</span> <span class="n">inherit_id</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">inherit_id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">arch</span><span class="p">,</span>
        <span class="p">})</span></div>


<div class="viewcode-block" id="ViewCase.assertInvalid">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewCase.assertInvalid">[docs]</a>
    <span class="k">def</span> <span class="nf">assertInvalid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arch</span><span class="p">,</span> <span class="n">expected_message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;invalid view&#39;</span><span class="p">,</span> <span class="n">inherit_id</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">)</span> <span class="k">as</span> <span class="n">catcher</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">savepoint</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                        <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">inherit_id</span><span class="p">,</span>
                        <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">arch</span><span class="p">,</span>
                    <span class="p">})</span>
        <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">catcher</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">catcher</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expected_message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">expected_message</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewCase.assertWarning">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewCase.assertWarning">[docs]</a>
    <span class="k">def</span> <span class="nf">assertWarning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arch</span><span class="p">,</span> <span class="n">expected_message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;invalid view&#39;</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertLogs</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="s2">&quot;WARNING&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">log_catcher</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
                <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">arch</span><span class="p">,</span>
            <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">log_catcher</span><span class="o">.</span><span class="n">output</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;Exactly one warning should be logged&quot;</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">log_catcher</span><span class="o">.</span><span class="n">output</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;View error context&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&#39;name&#39;: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expected_message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="n">expected_message</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestNodeLocator">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNodeLocator">[docs]</a>
<span class="k">class</span> <span class="nc">TestNodeLocator</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">TransactionCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The node locator returns None when it can not find a node, and the first</span>
<span class="sd">    match when it finds something (no jquery-style node sets)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestNodeLocator.test_no_match_xpath">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNodeLocator.test_no_match_xpath">[docs]</a>
    <span class="k">def</span> <span class="nf">test_no_match_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        xpath simply uses the provided @expr pattern to find a node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">locate_node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">foo</span><span class="p">(),</span> <span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">(),</span> <span class="n">E</span><span class="o">.</span><span class="n">baz</span><span class="p">()),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//qux&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestNodeLocator.test_match_xpath">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNodeLocator.test_match_xpath">[docs]</a>
    <span class="k">def</span> <span class="nf">test_match_xpath</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">locate_node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">foo</span><span class="p">(),</span> <span class="n">bar</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">baz</span><span class="p">()),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//bar&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestNodeLocator.test_no_match_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNodeLocator.test_no_match_field">[docs]</a>
    <span class="k">def</span> <span class="nf">test_no_match_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A field spec will match by @name against all fields of the view</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">locate_node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">foo</span><span class="p">(),</span> <span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">(),</span> <span class="n">E</span><span class="o">.</span><span class="n">baz</span><span class="p">()),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;qux&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">locate_node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">),</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">),</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">)),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;qux&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestNodeLocator.test_match_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNodeLocator.test_match_field">[docs]</a>
    <span class="k">def</span> <span class="nf">test_match_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">locate_node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;foo&quot;</span><span class="p">),</span> <span class="n">bar</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;baz&quot;</span><span class="p">)),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;bar&quot;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">bar</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestNodeLocator.test_no_match_other">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNodeLocator.test_no_match_other">[docs]</a>
    <span class="k">def</span> <span class="nf">test_no_match_other</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Non-xpath non-fields are matched by node name first</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">locate_node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">foo</span><span class="p">(),</span> <span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">(),</span> <span class="n">E</span><span class="o">.</span><span class="n">baz</span><span class="p">()),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">qux</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestNodeLocator.test_match_other">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNodeLocator.test_match_other">[docs]</a>
    <span class="k">def</span> <span class="nf">test_match_other</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">()</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">locate_node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">foo</span><span class="p">(),</span> <span class="n">bar</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">baz</span><span class="p">()),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestNodeLocator.test_attribute_mismatch">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNodeLocator.test_attribute_mismatch">[docs]</a>
    <span class="k">def</span> <span class="nf">test_attribute_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Non-xpath non-field are filtered by matching attributes on spec and</span>
<span class="sd">        matched nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">locate_node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">),</span> <span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">),</span> <span class="n">E</span><span class="o">.</span><span class="n">baz</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">)),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;5&#39;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestNodeLocator.test_attribute_filter">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNodeLocator.test_attribute_filter">[docs]</a>
    <span class="k">def</span> <span class="nf">test_attribute_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">locate_node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">),</span> <span class="n">match</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">))),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">match</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestNodeLocator.test_version_mismatch">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNodeLocator.test_version_mismatch">[docs]</a>
    <span class="k">def</span> <span class="nf">test_version_mismatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A @version on the spec will be matched against the view&#39;s version</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">locate_node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">),</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;4&#39;</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">foo</span><span class="p">(</span><span class="n">attr</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">node</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestViewInheritance">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance">[docs]</a>
<span class="k">class</span> <span class="nc">TestViewInheritance</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestViewInheritance.arch_for">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.arch_for">[docs]</a>
    <span class="k">def</span> <span class="nf">arch_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">view_type</span><span class="o">=</span><span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Generates a trivial view of the specified ``view_type``.</span>

<span class="sd">        The generated view is empty but ``name`` is set as its root&#39;s ``@string``.</span>

<span class="sd">        If ``parent`` is not falsy, generates an extension view (instead of</span>
<span class="sd">        a root view) replacing the parent&#39;s ``@string`` by ``name``</span>

<span class="sd">        :param str name: ``@string`` value for the view root</span>
<span class="sd">        :param str view_type:</span>
<span class="sd">        :param bool parent:</span>
<span class="sd">        :return: generated arch</span>
<span class="sd">        :rtype: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parent</span><span class="p">:</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">view_type</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">E</span><span class="p">(</span><span class="n">view_type</span><span class="p">,</span>
                <span class="n">E</span><span class="o">.</span><span class="n">attribute</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">),</span>
                <span class="n">position</span><span class="o">=</span><span class="s1">&#39;attributes&#39;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewInheritance.makeView">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.makeView">[docs]</a>
    <span class="k">def</span> <span class="nf">makeView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Generates a basic ir.ui.view with the provided name, parent and arch.</span>

<span class="sd">        If no parent is provided, the view is top-level.</span>

<span class="sd">        If no arch is provided, generates one by calling :meth:`~.arch_for`.</span>

<span class="sd">        :param str name:</span>
<span class="sd">        :param int parent: id of the parent view, if any</span>
<span class="sd">        :param str arch:</span>
<span class="sd">        :returns: the created view&#39;s id.</span>
<span class="sd">        :rtype: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">arch</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">arch_for</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">),</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">parent</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="c1"># higher than default views</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">view</span>
        <span class="k">return</span> <span class="n">view</span></div>


<div class="viewcode-block" id="TestViewInheritance.get_views">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.get_views">[docs]</a>
    <span class="k">def</span> <span class="nf">get_views</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestViewInheritance.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestViewInheritance</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="p">,</span> <span class="s1">&#39;_init&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;ir.ui.view.custom&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s2">&quot;A1&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s2">&quot;A2&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s2">&quot;A11&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a11</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;primary&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s2">&quot;A111&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a11</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s2">&quot;A12&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s2">&quot;A21&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s2">&quot;A22&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s2">&quot;A221&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">a22</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arch_for</span><span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s1">&#39;tree&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s1">&#39;B1&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arch_for</span><span class="p">(</span><span class="s2">&quot;B1&quot;</span><span class="p">,</span> <span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">arch_for</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s1">&#39;tree&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span></div>


<div class="viewcode-block" id="TestViewInheritance.test_get_inheriting_views">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.test_get_inheriting_views">[docs]</a>
    <span class="k">def</span> <span class="nf">test_get_inheriting_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_get_inheriting_views</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_views</span><span class="p">(</span><span class="s1">&#39;A A1 A2 A12 A21 A22 A221&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span><span class="p">[</span><span class="s1">&#39;A21&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_get_inheriting_views</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_views</span><span class="p">([</span><span class="s1">&#39;A21&#39;</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span><span class="p">[</span><span class="s1">&#39;A11&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_get_inheriting_views</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_views</span><span class="p">([</span><span class="s1">&#39;A11&#39;</span><span class="p">,</span> <span class="s1">&#39;A111&#39;</span><span class="p">]),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span><span class="p">[</span><span class="s1">&#39;A11&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">_get_inheriting_views</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_views</span><span class="p">(</span><span class="s1">&#39;A A1 A2 A11 A111 A12 A21 A22 A221&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViewInheritance.test_default_view">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.test_default_view">[docs]</a>
    <span class="k">def</span> <span class="nf">test_default_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">default_view</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">view_type</span><span class="o">=</span><span class="s1">&#39;form&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">default_tree</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">default_view</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">view_type</span><span class="o">=</span><span class="s1">&#39;tree&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">default_tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewInheritance.test_no_default_view">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.test_no_default_view">[docs]</a>
    <span class="k">def</span> <span class="nf">test_no_default_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">default_view</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="s1">&#39;no_model.exist&#39;</span><span class="p">,</span> <span class="n">view_type</span><span class="o">=</span><span class="s1">&#39;form&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">default_view</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">view_type</span><span class="o">=</span><span class="s1">&#39;graph&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestViewInheritance.test_no_recursion">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.test_no_recursion">[docs]</a>
    <span class="k">def</span> <span class="nf">test_no_recursion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s1">&#39;R1&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">savepoint</span><span class="p">():</span>
            <span class="n">r1</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">r1</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>

        <span class="n">r2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s1">&#39;R2&#39;</span><span class="p">,</span> <span class="n">r1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">r3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s1">&#39;R3&#39;</span><span class="p">,</span> <span class="n">r2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">savepoint</span><span class="p">():</span>
            <span class="n">r2</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">r3</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">savepoint</span><span class="p">():</span>
            <span class="n">r1</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">r3</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">savepoint</span><span class="p">():</span>
            <span class="n">r1</span><span class="o">.</span><span class="n">write</span><span class="p">({</span>
                <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">r1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">arch_for</span><span class="p">(</span><span class="s1">&#39;itself&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="p">})</span></div>


<div class="viewcode-block" id="TestViewInheritance.test_write_arch">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.test_write_arch">[docs]</a>
    <span class="k">def</span> <span class="nf">test_write_arch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>

        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">makeView</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span> <span class="n">arch</span><span class="o">=</span><span class="s1">&#39;&lt;form string=&quot;Foo&quot;&gt;Bar&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="n">v</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;arch_db&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Foo&#39;</span><span class="p">:</span> <span class="s1">&#39;Fou&#39;</span><span class="p">,</span> <span class="s1">&#39;Bar&#39;</span><span class="p">:</span> <span class="s1">&#39;Barre&#39;</span><span class="p">}})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="s1">&#39;&lt;form string=&quot;Foo&quot;&gt;Bar&lt;/form&gt;&#39;</span><span class="p">)</span>

        <span class="c1"># modify v to discard translations; this should not invalidate &#39;arch&#39;!</span>
        <span class="n">v</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;&lt;form/&gt;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="s1">&#39;&lt;form/&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewInheritance.test_get_combined_arch_query_count">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.test_get_combined_arch_query_count">[docs]</a>
    <span class="k">def</span> <span class="nf">test_get_combined_arch_query_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># If the query count increases, you probably made the view combination</span>
        <span class="c1"># fetch an extra field on views. You better fetch that extra field with</span>
        <span class="c1"># the query of _get_inheriting_views() and manually feed the cache.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">invalidate_all</span><span class="p">()</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueryCount</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="c1"># 1: browse([self.view_ids[&#39;A&#39;]])</span>
            <span class="c1"># 2: _get_inheriting_views: id, inherit_id, mode, groups</span>
            <span class="c1"># 3: _combine: arch_db</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">view_ids</span><span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestViewInheritance.test_view_validate_button_action_query_count">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.test_view_validate_button_action_query_count">[docs]</a>
    <span class="k">def</span> <span class="nf">test_view_validate_button_action_query_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">get_cache_key_counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_xmlid_lookup</span><span class="p">,</span> <span class="s1">&#39;base.action_ui_view&#39;</span><span class="p">)</span>
        <span class="n">hit</span><span class="p">,</span> <span class="n">miss</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">counter</span><span class="o">.</span><span class="n">miss</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueryCount</span><span class="p">(</span><span class="mi">7</span><span class="p">):</span>
            <span class="n">base_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                    &lt;header&gt;</span>
<span class="s2">                        &lt;button type=&quot;action&quot; name=&quot;base.action_ui_view&quot;/&gt;</span>
<span class="s2">                        &lt;button type=&quot;action&quot; name=&quot;base.action_ui_view_custom&quot;/&gt;</span>
<span class="s2">                        &lt;button type=&quot;action&quot; name=&quot;base.action_ui_view&quot;/&gt;</span>
<span class="s2">                    &lt;/header&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">hit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">miss</span><span class="p">,</span> <span class="n">miss</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueryCount</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;field name=&quot;name&quot; position=&quot;replace&quot;/&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">inherit_id</span><span class="o">=</span><span class="n">base_view</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">hit</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">miss</span><span class="p">,</span> <span class="n">miss</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewInheritance.test_view_validate_attrs_groups_query_count">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewInheritance.test_view_validate_attrs_groups_query_count">[docs]</a>
    <span class="k">def</span> <span class="nf">test_view_validate_attrs_groups_query_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">counter</span> <span class="o">=</span> <span class="n">get_cache_key_counter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_xmlid_lookup</span><span class="p">,</span> <span class="s1">&#39;base.group_system&#39;</span><span class="p">)</span>
        <span class="n">hit</span><span class="p">,</span> <span class="n">miss</span> <span class="o">=</span> <span class="n">counter</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">counter</span><span class="o">.</span><span class="n">miss</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueryCount</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">base_view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;priority&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">hit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">miss</span><span class="p">,</span> <span class="n">miss</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueryCount</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;field name=&quot;name&quot; position=&quot;replace&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;key&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">inherit_id</span><span class="o">=</span><span class="n">base_view</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">hit</span><span class="p">,</span> <span class="n">hit</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">counter</span><span class="o">.</span><span class="n">miss</span><span class="p">,</span> <span class="n">miss</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestApplyInheritanceSpecs">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs">[docs]</a>
<span class="k">class</span> <span class="nc">TestApplyInheritanceSpecs</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Applies a sequence of inheritance specification nodes to a base</span>
<span class="sd">    architecture. IO state parameters (cr, uid, model, context) are used for</span>
<span class="sd">    error reporting</span>

<span class="sd">    The base architecture is altered in-place.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="TestApplyInheritanceSpecs.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestApplyInheritanceSpecs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">),</span>
            <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adv_arch</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
                <span class="s2">&quot;TEXT1&quot;</span><span class="p">,</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;subtarget&quot;</span><span class="p">),</span>
                <span class="s2">&quot;TEXT2&quot;</span><span class="p">,</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;anothersubtarget&quot;</span><span class="p">),</span>
                <span class="s2">&quot;TEXT3&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceSpecs.test_replace_outer">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.test_replace_outer">[docs]</a>
    <span class="k">def</span> <span class="nf">test_replace_outer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;replacement&quot;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;replacement&quot;</span><span class="p">),</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestApplyInheritanceSpecs.test_delete">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.test_delete">[docs]</a>
    <span class="k">def</span> <span class="nf">test_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestApplyInheritanceSpecs.test_insert_after">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.test_insert_after">[docs]</a>
    <span class="k">def</span> <span class="nf">test_insert_after</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted&quot;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted&quot;</span><span class="p">),</span>
                <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span>
            <span class="p">))</span></div>


<div class="viewcode-block" id="TestApplyInheritanceSpecs.test_insert_before">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.test_insert_before">[docs]</a>
    <span class="k">def</span> <span class="nf">test_insert_before</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted&quot;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">),</span>
                <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestApplyInheritanceSpecs.test_insert_inside">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.test_insert_inside">[docs]</a>
    <span class="k">def</span> <span class="nf">test_insert_inside</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">default</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">)</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted 2&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;inside&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted&quot;</span><span class="p">),</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted 2&quot;</span><span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">),</span>
                <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestApplyInheritanceSpecs.test_replace_inner">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.test_replace_inner">[docs]</a>
    <span class="k">def</span> <span class="nf">test_replace_inner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
            <span class="s2">&quot;TEXT 4&quot;</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;replacement&quot;</span><span class="p">),</span>
            <span class="s2">&quot;TEXT 5&quot;</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;replacement2&quot;</span><span class="p">),</span>
            <span class="s2">&quot;TEXT 6&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">)</span>

        <span class="n">expected</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
                <span class="s2">&quot;TEXT 4&quot;</span><span class="p">,</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;replacement&quot;</span><span class="p">),</span>
                <span class="s2">&quot;TEXT 5&quot;</span><span class="p">,</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;replacement2&quot;</span><span class="p">),</span>
                <span class="s2">&quot;TEXT 6&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">),</span>
            <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">)</span>

        <span class="c1"># applying spec to both base_arch and adv_arch is expected to give the same result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adv_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adv_arch</span><span class="p">,</span> <span class="n">expected</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceSpecs.test_unpack_data">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.test_unpack_data">[docs]</a>
    <span class="k">def</span> <span class="nf">test_unpack_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">data</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted 0&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted 1&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted 2&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted 3&quot;</span><span class="p">),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">),</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted 0&quot;</span><span class="p">),</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted 1&quot;</span><span class="p">),</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted 2&quot;</span><span class="p">),</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;inserted 3&quot;</span><span class="p">),</span>
                    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">),</span>
                <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Title&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestApplyInheritanceSpecs.test_invalid_position">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.test_invalid_position">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_invalid_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;whoops&quot;</span><span class="p">),</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;serious_series&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceSpecs.test_incorrect_version">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.test_incorrect_version">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_incorrect_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Version ignored on //field elements, so use something else</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">element</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="s2">&quot;42&quot;</span><span class="p">))</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">element</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;placeholder&quot;</span><span class="p">),</span>
            <span class="n">foo</span><span class="o">=</span><span class="s2">&quot;42&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;7.0&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceSpecs.test_target_not_found">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceSpecs.test_target_not_found">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_target_not_found</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;targut&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestApplyInheritanceWrapSpecs">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceWrapSpecs">[docs]</a>
<span class="k">class</span> <span class="nc">TestApplyInheritanceWrapSpecs</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestApplyInheritanceWrapSpecs.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceWrapSpecs.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestApplyInheritanceWrapSpecs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">)))</span></div>


<div class="viewcode-block" id="TestApplyInheritanceWrapSpecs.apply_spec">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceWrapSpecs.apply_spec">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceWrapSpecs.test_replace">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceWrapSpecs.test_replace">[docs]</a>
    <span class="k">def</span> <span class="nf">test_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="s2">&quot;$0&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s2">&quot;some&quot;</span><span class="p">}),</span>
            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s1">&#39;Content&#39;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">})</span>
            <span class="p">))</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs">[docs]</a>
<span class="k">class</span> <span class="nc">TestApplyInheritanceMoveSpecs</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestApplyInheritanceMoveSpecs</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">})),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">})</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="s2">&quot;aaaa&quot;</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">}),</span> <span class="s2">&quot;bbbb&quot;</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">})</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.apply_spec">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.apply_spec">[docs]</a>
    <span class="k">def</span> <span class="nf">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">apply_inheritance_specs</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.test_move_replace">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.test_move_replace">[docs]</a>
    <span class="k">def</span> <span class="nf">test_move_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">),</span>
            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//div[@class=&#39;target&#39;]&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">})</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="s2">&quot;aaaabbbb&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">})</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.test_move_inside">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.test_move_inside">[docs]</a>
    <span class="k">def</span> <span class="nf">test_move_inside</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">),</span>
            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//div[@class=&#39;target&#39;]&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;inside&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">}),</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">})</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="s2">&quot;aaaabbbb&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">}),</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">})</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.test_move_before">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.test_move_before">[docs]</a>
    <span class="k">def</span> <span class="nf">test_move_before</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">),</span>
            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//div[@class=&#39;target&#39;]&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;before&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">}),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">}),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="s2">&quot;aaaabbbb&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">}),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">}),</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.test_move_after">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.test_move_after">[docs]</a>
    <span class="k">def</span> <span class="nf">test_move_after</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">),</span>
            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//div[@class=&#39;target&#39;]&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">}),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">}),</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="s2">&quot;aaaabbbb&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">}),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">}),</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.test_move_with_other_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.test_move_with_other_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_move_with_other_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># multiple elements with move in first position</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;new_p&#39;</span><span class="p">}),</span>
            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//div[@class=&#39;target&#39;]&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">}),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">}),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;new_p&#39;</span><span class="p">}),</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.test_move_with_other_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.test_move_with_other_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_move_with_other_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># multiple elements with move in last position</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;new_p&#39;</span><span class="p">}),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">),</span>
            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//div[@class=&#39;target&#39;]&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wrapped_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="s2">&quot;aaaabbbb&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">}),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;new_p&#39;</span><span class="p">}),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">}),</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.test_incorrect_move_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.test_incorrect_move_1">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_incorrect_move_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># cannot move an inexisting element</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p[@name=&#39;none&#39;]&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">),</span>
            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//div[@class=&#39;target&#39;]&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.test_incorrect_move_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.test_incorrect_move_2">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_incorrect_move_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># move xpath cannot contain any children</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;new_p&#39;</span><span class="p">}),</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">),</span>
            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//div[@class=&#39;target&#39;]&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestApplyInheritanceMoveSpecs.test_incorrect_move_3">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritanceMoveSpecs.test_incorrect_move_3">[docs]</a>
    <span class="k">def</span> <span class="nf">test_incorrect_move_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># move won&#39;t be correctly applied if not a direct child of an xpath</span>
        <span class="n">spec</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;new_p&#39;</span><span class="p">}),</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wrapper&#39;</span><span class="p">}),</span>
            <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//div[@class=&#39;target&#39;]&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;after&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">apply_spec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">base_arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">template</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;some&#39;</span><span class="p">})),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;target&#39;</span><span class="p">}),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Content2&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;new_p&#39;</span><span class="p">}),</span> <span class="n">expr</span><span class="o">=</span><span class="s2">&quot;//p&quot;</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;move&quot;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wrapper&#39;</span><span class="p">}),</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestApplyInheritedArchs">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestApplyInheritedArchs">[docs]</a>
<span class="k">class</span> <span class="nc">TestApplyInheritedArchs</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Applies a sequence of modificator archs to a base view</span>
<span class="sd">    &quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="TestNoModel">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNoModel">[docs]</a>
<span class="k">class</span> <span class="nc">TestNoModel</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestNoModel.test_create_view_nomodel">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNoModel.test_create_view_nomodel">[docs]</a>
    <span class="k">def</span> <span class="nf">test_create_view_nomodel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;dummy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;template name=&quot;foo&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;arch&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;priority&#39;</span><span class="p">,</span> <span class="s1">&#39;inherit_id&#39;</span><span class="p">,</span> <span class="s1">&#39;model&#39;</span><span class="p">]</span>
        <span class="p">[</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;dummy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;template name=&quot;foo&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">})</span></div>


    <span class="n">text_para</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;legalese&#39;</span><span class="p">})</span>
    <span class="n">arch</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">body</span><span class="p">(</span>
        <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">h1</span><span class="p">(</span><span class="s2">&quot;Title&quot;</span><span class="p">),</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">),</span>
        <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Welcome!&quot;</span><span class="p">),</span>
        <span class="n">E</span><span class="o">.</span><span class="n">div</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">hr</span><span class="p">(),</span>
            <span class="n">text_para</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;footer&quot;</span><span class="p">),</span>
        <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s2">&quot;index&quot;</span><span class="p">},)</span>

<div class="viewcode-block" id="TestNoModel.test_qweb_translation">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestNoModel.test_qweb_translation">[docs]</a>
    <span class="k">def</span> <span class="nf">test_qweb_translation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test if translations work correctly without a model</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="n">ARCH</span> <span class="o">=</span> <span class="s1">&#39;&lt;template name=&quot;foo&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/template&gt;&#39;</span>
        <span class="n">TEXT_EN</span> <span class="o">=</span> <span class="s2">&quot;Copyright copyrighter&quot;</span>
        <span class="n">TEXT_FR</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;Copyrighter, tous droits rservs&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;dummy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">ARCH</span> <span class="o">%</span> <span class="n">TEXT_EN</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view</span><span class="o">.</span><span class="n">update_field_translations</span><span class="p">(</span><span class="s1">&#39;arch_db&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">TEXT_EN</span><span class="p">:</span> <span class="n">TEXT_FR</span><span class="p">}})</span>
        <span class="n">view</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">ARCH</span> <span class="o">%</span> <span class="n">TEXT_FR</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestTemplating">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating">[docs]</a>
<span class="k">class</span> <span class="nc">TestTemplating</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestTemplating.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestTemplating</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">registry</span><span class="p">,</span> <span class="s1">&#39;_init&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_inherit">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_inherit">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_inherit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;root&gt;</span>
<span class="s2">                &lt;item order=&quot;1&quot;/&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;xpath expr=&quot;//item&quot; position=&quot;before&quot;&gt;</span>
<span class="s2">                &lt;item order=&quot;2&quot;/&gt;</span>
<span class="s2">            &lt;/xpath&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//item[@order=1]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-id&#39;</span><span class="p">),</span>
            <span class="s2">&quot;initial should come from the root view&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/root[1]/item[1]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;initial&#39;s xpath should be within the root view only&quot;</span><span class="p">)</span>

        <span class="p">[</span><span class="n">second</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//item[@order=2]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="n">second</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-id&#39;</span><span class="p">),</span>
            <span class="s2">&quot;second should come from the extension view&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_inherit_replace_node">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_inherit_replace_node">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_inherit_replace_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;hello&gt;</span>
<span class="s2">                &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">                &lt;world&gt;&lt;t t-esc=&quot;hello&quot;/&gt;&lt;/world&gt;</span>
<span class="s2">                &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">            &lt;/hello&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;xpath expr=&quot;/hello/world[1]&quot; position=&quot;replace&quot;&gt;</span>
<span class="s2">                &lt;world&gt;Is a ghetto&lt;/world&gt;</span>
<span class="s2">                &lt;world&gt;Wonder when I&#39;ll find paradise&lt;/world&gt;</span>
<span class="s2">            &lt;/xpath&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="c1"># First world - has been replaced by inheritance</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]/world[1]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/xpath/world[1]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Inherited nodes have correct xpath&#39;</span><span class="p">)</span>

        <span class="c1"># Second world added by inheritance</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]/world[2]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/xpath/world[2]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Inherited nodes have correct xpath&#39;</span><span class="p">)</span>

        <span class="c1"># Third world - is not editable</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]/world[3]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;node containing t-esc is not branded&#39;</span><span class="p">)</span>

        <span class="c1"># The most important assert</span>
        <span class="c1"># Fourth world - should have a correct oe-xpath, which is 3rd in main view</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]/world[4]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/hello[1]/world[3]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_inherit_replace_node2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_inherit_replace_node2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_inherit_replace_node2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;hello&gt;</span>
<span class="s2">                &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">                &lt;world&gt;&lt;t t-esc=&quot;hello&quot;/&gt;&lt;/world&gt;</span>
<span class="s2">                &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">            &lt;/hello&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;xpath expr=&quot;/hello/world[1]&quot; position=&quot;replace&quot;&gt;</span>
<span class="s2">                &lt;war&gt;Is a ghetto&lt;/war&gt;</span>
<span class="s2">                &lt;world&gt;Wonder when I&#39;ll find paradise&lt;/world&gt;</span>
<span class="s2">            &lt;/xpath&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]/war[1]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/xpath/war&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Inherited nodes have correct xpath&#39;</span><span class="p">)</span>

        <span class="c1"># First world: from inheritance</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]/world[1]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/xpath/world&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Inherited nodes have correct xpath&#39;</span><span class="p">)</span>

        <span class="c1"># Second world - is not editable</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]/world[2]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;node containing t-esc is not branded&#39;</span><span class="p">)</span>

        <span class="c1"># The most important assert</span>
        <span class="c1"># Third world - should have a correct oe-xpath, which is 3rd in main view</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]/world[3]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/hello[1]/world[3]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_inherit_remove_node">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_inherit_remove_node">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_inherit_remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="c1"># The t-esc node is to ensure branding is distributed to both</span>
            <span class="c1"># &lt;world/&gt; elements from the start</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;hello&gt;</span>
<span class="s2">                    &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;world&gt;&lt;/world&gt;</span>

<span class="s2">                    &lt;t t-esc=&quot;foo&quot;/&gt;</span>
<span class="s2">                &lt;/hello&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;xpath expr=&quot;/hello/world[1]&quot; position=&quot;replace&quot;/&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="c1"># Only remaining world but still the second in original view</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]/world[1]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/hello[1]/world[2]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_inherit_remove_node2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_inherit_remove_node2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_inherit_remove_node2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;hello&gt;</span>
<span class="s2">                    &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">                &lt;/hello&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;xpath expr=&quot;/hello/world[1]&quot; position=&quot;replace&quot;/&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="c1"># Note: this test is a variant of the test_branding_inherit_remove_node</span>
        <span class="c1"># -&gt; in this case, we expect the branding to not be distributed on the</span>
        <span class="c1"># &lt;hello/&gt; element anymore but on the only remaining world.</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-model&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The inner content of the root was xpath&#39;ed, it should not receive branding anymore&quot;</span><span class="p">)</span>

        <span class="c1"># Only remaining world but still the second in original view</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;/hello[1]/world[1]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/hello[1]/world[2]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_inherit_multi_replace_node">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_inherit_multi_replace_node">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_inherit_multi_replace_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;hello&gt;</span>
<span class="s2">                    &lt;world class=&quot;a&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;world class=&quot;b&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;world class=&quot;c&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                &lt;/hello&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;xpath expr=&quot;//world&quot; position=&quot;replace&quot;&gt;</span>
<span class="s2">                        &lt;world class=&quot;new_a&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                        &lt;world class=&quot;z&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;/xpath&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>  <span class="c1"># Inherit from the child view and target the added element</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;xpath expr=&quot;//world[hasclass(&#39;new_a&#39;)]&quot; position=&quot;replace&quot;&gt;</span>
<span class="s2">                        &lt;world class=&quot;another_new_a&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;/xpath&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="c1"># Check if the replacement inside the child view did not mess up the</span>
        <span class="c1"># branding of elements in that child view</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//world[hasclass(&quot;z&quot;)]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/data/xpath/world[2]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span>

        <span class="c1"># Check if the replacement of the first worlds did not mess up the</span>
        <span class="c1"># branding of the last world.</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//world[hasclass(&quot;c&quot;)]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/hello[1]/world[3]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_inherit_multi_replace_node2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_inherit_multi_replace_node2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_inherit_multi_replace_node2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;hello&gt;</span>
<span class="s2">                    &lt;world class=&quot;a&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;world class=&quot;b&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;world class=&quot;c&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                &lt;/hello&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;xpath expr=&quot;//world&quot; position=&quot;replace&quot;&gt;</span>
<span class="s2">                        &lt;world class=&quot;new_a&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                        &lt;world class=&quot;z&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;/xpath&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>  <span class="c1"># Inherit from the parent view but actually target</span>
                            <span class="c1"># the element added by the first child view</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;xpath expr=&quot;//world&quot; position=&quot;replace&quot;&gt;</span>
<span class="s2">                        &lt;world class=&quot;another_new_a&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;/xpath&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="c1"># Check if the replacement inside the child view did not mess up the</span>
        <span class="c1"># branding of elements in that child view</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//world[hasclass(&quot;z&quot;)]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/data/xpath/world[2]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span>

        <span class="c1"># Check if the replacement of the first worlds did not mess up the</span>
        <span class="c1"># branding of the last world.</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//world[hasclass(&quot;c&quot;)]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/hello[1]/world[3]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_inherit_remove_added_from_inheritance">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_inherit_remove_added_from_inheritance">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_inherit_remove_added_from_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;hello&gt;</span>
<span class="s2">                    &lt;world class=&quot;a&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;world class=&quot;b&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                &lt;/hello&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="c1"># Note: class=&quot;x&quot; instead of t-field=&quot;x&quot; in this arch, should lead</span>
            <span class="c1"># to the same result that this test is ensuring but was actually</span>
            <span class="c1"># a different case in old stable versions.</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;xpath expr=&quot;//world[hasclass(&#39;a&#39;)]&quot; position=&quot;after&quot;&gt;</span>
<span class="s2">                        &lt;world t-field=&quot;x&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                        &lt;world class=&quot;y&quot;&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;/xpath&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>  <span class="c1"># Inherit from the child view and target the added element</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;xpath expr=&quot;//world[@t-field=&#39;x&#39;]&quot; position=&quot;replace&quot;/&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="c1"># Check if the replacement inside the child view did not mess up the</span>
        <span class="c1"># branding of elements in that child view, should not be the case as</span>
        <span class="c1"># that root level branding is not distributed.</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//world[hasclass(&quot;y&quot;)]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/data/xpath/world[2]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span>

        <span class="c1"># Check if the child view replacement of added nodes did not mess up</span>
        <span class="c1"># the branding of last world in the parent view.</span>
        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//world[hasclass(&quot;b&quot;)]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="s1">&#39;/hello[1]/world[2]&#39;</span><span class="p">,</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_inherit_remove_node_processing_instruction">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_inherit_remove_node_processing_instruction">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_inherit_remove_node_processing_instruction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;html&gt;</span>
<span class="s2">                    &lt;head&gt;</span>
<span class="s2">                        &lt;hello&gt;&lt;/hello&gt;</span>
<span class="s2">                    &lt;/head&gt;</span>
<span class="s2">                    &lt;body&gt;</span>
<span class="s2">                        &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;/body&gt;</span>
<span class="s2">                &lt;/html&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;xpath expr=&quot;//hello&quot; position=&quot;replace&quot;/&gt;</span>
<span class="s2">                    &lt;xpath expr=&quot;//world&quot; position=&quot;replace&quot;/&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>

        <span class="n">head</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">head_child</span> <span class="o">=</span> <span class="n">head</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">head_child</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
            <span class="s1">&#39;apply-inheritance-specs-node-removal&#39;</span><span class="p">,</span>
            <span class="s2">&quot;A node was removed at the start of the &lt;head&gt;, a processing instruction should exist as first child node&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">head_child</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;hello&#39;</span><span class="p">,</span>
            <span class="s2">&quot;The processing instruction should mention the tag of the node that was removed&quot;</span><span class="p">)</span>

        <span class="n">body</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//body&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">body_child</span> <span class="o">=</span> <span class="n">body</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">body_child</span><span class="o">.</span><span class="n">target</span><span class="p">,</span>
            <span class="s1">&#39;apply-inheritance-specs-node-removal&#39;</span><span class="p">,</span>
            <span class="s2">&quot;A node was removed at the start of the &lt;body&gt;, a processing instruction should exist as first child node&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">body_child</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
            <span class="s1">&#39;world&#39;</span><span class="p">,</span>
            <span class="s2">&quot;The processing instruction should mention the tag of the node that was removed&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="c1"># Test that both head and body have their processing instruction</span>
        <span class="c1"># &#39;apply-inheritance-specs-node-removal&#39; removed after branding</span>
        <span class="c1"># distribution. Note: test head and body separately as the code in</span>
        <span class="c1"># charge of the removal is different in each case.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">head</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;The processing instruction of the &lt;head&gt; should have been removed&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">body</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;The processing instruction of the &lt;body&gt; should have been removed&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_inherit_top_t_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_inherit_top_t_field">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_inherit_top_t_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;hello&gt;</span>
<span class="s2">                    &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;world t-field=&quot;a&quot;/&gt;</span>
<span class="s2">                    &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">                    &lt;world&gt;&lt;/world&gt;</span>
<span class="s2">                &lt;/hello&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;xpath expr=&quot;/hello/world[3]&quot; position=&quot;after&quot;&gt;</span>
<span class="s2">                    &lt;world t-field=&quot;b&quot;/&gt;</span>
<span class="s2">                &lt;/xpath&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="c1"># First t-field should have an indication of xpath</span>
        <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@t-field=&quot;a&quot;]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;/hello[1]/world[2]&#39;</span><span class="p">,</span>
            <span class="s1">&#39;First t-field has indication of xpath&#39;</span><span class="p">)</span>

        <span class="c1"># Second t-field, from inheritance, should also have an indication of xpath</span>
        <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//*[@t-field=&quot;b&quot;]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;/xpath/world&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Inherited t-field has indication of xpath&#39;</span><span class="p">)</span>

        <span class="c1"># The most important assert</span>
        <span class="c1"># The last world xpath should not have been impacted by the t-field from inheritance</span>
        <span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//world[last()]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;/hello[1]/world[4]&#39;</span><span class="p">,</span>
            <span class="s2">&quot;The node&#39;s xpath position should be correct&quot;</span><span class="p">)</span>

        <span class="c1"># Also test inherit via non-xpath t-field node, direct children of data,</span>
        <span class="c1"># is not impacted by the feature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;world t-field=&quot;a&quot; position=&quot;replace&quot;&gt;</span>
<span class="s2">                        &lt;world t-field=&quot;z&quot;/&gt;</span>
<span class="s2">                    &lt;/world&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="n">node</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//world&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;t-field&#39;</span><span class="p">),</span>
            <span class="s1">&#39;z&#39;</span><span class="p">,</span>
            <span class="s2">&quot;The node has properly been replaced&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_primary_inherit">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_primary_inherit">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_primary_inherit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;root&gt;</span>
<span class="s2">                &lt;item order=&quot;1&quot;/&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;xpath expr=&quot;//item&quot; position=&quot;after&quot;&gt;</span>
<span class="s2">                &lt;item order=&quot;2&quot;/&gt;</span>
<span class="s2">            &lt;/xpath&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view2</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="p">[</span><span class="n">initial</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//item[@order=1]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-id&#39;</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s2">&quot;initial should come from the root view&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">initial</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;/root[1]/item[1]&#39;</span><span class="p">,</span>
            <span class="s2">&quot;initial&#39;s xpath should be within the inherited view only&quot;</span><span class="p">)</span>

        <span class="p">[</span><span class="n">second</span><span class="p">]</span> <span class="o">=</span> <span class="n">arch</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//item[@order=2]&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">second</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-id&#39;</span><span class="p">),</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s2">&quot;second should come from the extension view&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">second</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">),</span>
            <span class="s1">&#39;/xpath/item&#39;</span><span class="p">,</span>
            <span class="s2">&quot;second xpath should be on the inheriting view only&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_distribute_inner">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_distribute_inner">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_distribute_inner</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Checks that the branding is correctly distributed within a view</span>
<span class="sd">        extension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;root&gt;</span>
<span class="s2">                &lt;item order=&quot;1&quot;/&gt;</span>
<span class="s2">            &lt;/root&gt;&quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;xpath expr=&quot;//item&quot; position=&quot;before&quot;&gt;</span>
<span class="s2">                &lt;item order=&quot;2&quot;&gt;</span>
<span class="s2">                    &lt;content t-att-href=&quot;foo&quot;&gt;bar&lt;/content&gt;</span>
<span class="s2">                &lt;/item&gt;</span>
<span class="s2">            &lt;/xpath&gt;&quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">content</span><span class="p">(</span><span class="s2">&quot;bar&quot;</span><span class="p">,</span> <span class="p">{</span>
                        <span class="s1">&#39;t-att-href&#39;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
                        <span class="s1">&#39;data-oe-model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;data-oe-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
                        <span class="s1">&#39;data-oe-field&#39;</span><span class="p">:</span> <span class="s1">&#39;arch&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">:</span> <span class="s1">&#39;/xpath/item/content[1]&#39;</span><span class="p">,</span>
                    <span class="p">}),</span> <span class="p">{</span>
                        <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span>
                    <span class="p">}),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">item</span><span class="p">({</span>
                    <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;data-oe-model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;data-oe-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
                    <span class="s1">&#39;data-oe-field&#39;</span><span class="p">:</span> <span class="s1">&#39;arch&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">:</span> <span class="s1">&#39;/root[1]/item[1]&#39;</span><span class="p">,</span>
                <span class="p">})</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestTemplating.test_branding_attribute_groups">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_branding_attribute_groups">[docs]</a>
    <span class="k">def</span> <span class="nf">test_branding_attribute_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base View&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;root&gt;</span>
<span class="s2">                &lt;item groups=&quot;base.group_no_one&quot;/&gt;</span>
<span class="s2">            &lt;/root&gt;&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">item</span><span class="p">({</span>
            <span class="s1">&#39;groups&#39;</span><span class="p">:</span> <span class="s1">&#39;base.group_no_one&#39;</span><span class="p">,</span>
            <span class="s1">&#39;data-oe-model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;data-oe-id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="s1">&#39;data-oe-field&#39;</span><span class="p">:</span> <span class="s1">&#39;arch&#39;</span><span class="p">,</span>
            <span class="s1">&#39;data-oe-xpath&#39;</span><span class="p">:</span> <span class="s1">&#39;/root[1]/item[1]&#39;</span><span class="p">,</span>
        <span class="p">})))</span></div>


<div class="viewcode-block" id="TestTemplating.test_call_no_branding">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_call_no_branding">[docs]</a>
    <span class="k">def</span> <span class="nf">test_call_no_branding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base View&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;root&gt;</span>
<span class="s2">                &lt;item&gt;&lt;span t-call=&quot;foo&quot;/&gt;&lt;/item&gt;</span>
<span class="s2">            &lt;/root&gt;&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">span</span><span class="p">({</span><span class="s1">&#39;t-call&#39;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">}))))</span></div>


<div class="viewcode-block" id="TestTemplating.test_esc_no_branding">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_esc_no_branding">[docs]</a>
    <span class="k">def</span> <span class="nf">test_esc_no_branding</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base View&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;root&gt;</span>
<span class="s2">                &lt;item&gt;&lt;span t-esc=&quot;foo&quot;/&gt;&lt;/item&gt;</span>
<span class="s2">            &lt;/root&gt;&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">span</span><span class="p">({</span><span class="s1">&#39;t-esc&#39;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">}))))</span></div>


<div class="viewcode-block" id="TestTemplating.test_ignore_unbrand">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestTemplating.test_ignore_unbrand">[docs]</a>
    <span class="k">def</span> <span class="nf">test_ignore_unbrand</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Base view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;root&gt;</span>
<span class="s2">                &lt;item order=&quot;1&quot; t-ignore=&quot;true&quot;&gt;</span>
<span class="s2">                    &lt;t t-esc=&quot;foo&quot;/&gt;</span>
<span class="s2">                &lt;/item&gt;</span>
<span class="s2">            &lt;/root&gt;&quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;Extension&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;xpath expr=&quot;//item[@order=&#39;1&#39;]&quot; position=&quot;inside&quot;&gt;</span>
<span class="s2">                &lt;item order=&quot;2&quot;&gt;</span>
<span class="s2">                    &lt;content t-att-href=&quot;foo&quot;&gt;bar&lt;/content&gt;</span>
<span class="s2">                &lt;/item&gt;</span>
<span class="s2">            &lt;/xpath&gt;&quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">arch_string</span> <span class="o">=</span> <span class="n">view1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_string</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">distribute_branding</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">arch</span><span class="p">,</span>
            <span class="n">E</span><span class="o">.</span><span class="n">root</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                    <span class="p">{</span><span class="s1">&#39;t-ignore&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;1&#39;</span><span class="p">},</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">t</span><span class="p">({</span><span class="s1">&#39;t-esc&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">}),</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">item</span><span class="p">(</span>
                        <span class="p">{</span><span class="s1">&#39;order&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">},</span>
                        <span class="n">E</span><span class="o">.</span><span class="n">content</span><span class="p">(</span>
                            <span class="p">{</span><span class="s1">&#39;t-att-href&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">},</span>
                            <span class="s2">&quot;bar&quot;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">),</span>
            <span class="s2">&quot;t-ignore should apply to injected sub-view branding, not just to&quot;</span>
            <span class="s2">&quot; the main view&#39;s&quot;</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestViews">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews">[docs]</a>
<span class="k">class</span> <span class="nc">TestViews</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestViews.test_nonexistent_attribute_removal">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_nonexistent_attribute_removal">[docs]</a>
    <span class="k">def</span> <span class="nf">test_nonexistent_attribute_removal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Test View&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.view_view_tree&#39;</span><span class="p">),</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s2">                        &lt;xpath expr=&quot;//field[@name=&#39;name&#39;]&quot; position=&quot;attributes&quot;&gt;</span>
<span class="s2">                            &lt;attribute name=&quot;non_existing_attribute&quot;&gt;&lt;/attribute&gt;</span>
<span class="s2">                        &lt;/xpath&gt;</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span></div>


    <span class="k">def</span> <span class="nf">_insert_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert view into database via a query to passtrough validation&quot;&quot;&quot;</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="s1">&#39;extension&#39;</span> <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;primary&#39;</span><span class="p">)</span>
        <span class="n">kw</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;arch_db&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">arch_db</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;arch_db&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">kw</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT type FROM ir_ui_view WHERE id = </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">]])</span>
                <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch_db</span><span class="p">)</span><span class="o">.</span><span class="n">tag</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;arch_db&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Json</span><span class="p">({</span><span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="n">arch_db</span><span class="p">})</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">lang</span> <span class="o">==</span> <span class="s1">&#39;en_US&#39;</span> <span class="k">else</span> <span class="n">Json</span><span class="p">({</span><span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="n">arch_db</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">lang</span><span class="p">:</span> <span class="n">arch_db</span><span class="p">})</span>

        <span class="n">keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\&quot;&#39;</span><span class="p">),)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%%</span><span class="s1">(</span><span class="si">%s</span><span class="s1">)s&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;INSERT INTO ir_ui_view(</span><span class="si">%s</span><span class="s1">) VALUES(</span><span class="si">%s</span><span class="s1">) RETURNING id&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">kw</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<div class="viewcode-block" id="TestViews.test_view_root_node_matches_view_type">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_view_root_node_matches_view_type">[docs]</a>
    <span class="k">def</span> <span class="nf">test_view_root_node_matches_view_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
                <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;form&#39;</span><span class="p">,</span>
                <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    &lt;data&gt;</span>
<span class="s2">                        &lt;div&gt;</span>
<span class="s2">                        &lt;/div&gt;</span>
<span class="s2">                        &lt;form&gt;</span>
<span class="s2">                        &lt;/form&gt;</span>
<span class="s2">                    &lt;/data&gt;</span>
<span class="s2">                &quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">})</span></div>


<div class="viewcode-block" id="TestViews.test_custom_view_validation">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_custom_view_validation">[docs]</a>
    <span class="k">def</span> <span class="nf">test_custom_view_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">model</span> <span class="o">=</span> <span class="s1">&#39;ir.actions.act_url&#39;</span>
        <span class="n">validate</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">_validate_custom_views</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

        <span class="c1"># validation of a single view</span>
        <span class="n">vid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_insert_view</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;base view&#39;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">arch_db</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s2">                        &lt;tree string=&quot;view&quot;&gt;</span>
<span class="s2">                          &lt;field name=&quot;url&quot;/&gt;</span>
<span class="s2">                        &lt;/tree&gt;</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">validate</span><span class="p">())</span>     <span class="c1"># single view</span>

        <span class="c1"># validation of a inherited view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insert_view</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;inherited view&#39;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">inherit_id</span><span class="o">=</span><span class="n">vid</span><span class="p">,</span>
            <span class="n">arch_db</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s2">                        &lt;xpath expr=&quot;//field[@name=&#39;url&#39;]&quot; position=&quot;before&quot;&gt;</span>
<span class="s2">                          &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                        &lt;/xpath&gt;</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">validate</span><span class="p">())</span>     <span class="c1"># inherited view</span>

        <span class="c1"># validation of a second inherited view (depending on 1st)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_insert_view</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;inherited view 2&#39;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="n">inherit_id</span><span class="o">=</span><span class="n">vid</span><span class="p">,</span>
            <span class="n">arch_db</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s2">                        &lt;xpath expr=&quot;//field[@name=&#39;name&#39;]&quot; position=&quot;after&quot;&gt;</span>
<span class="s2">                          &lt;field name=&quot;target&quot;/&gt;</span>
<span class="s2">                        &lt;/xpath&gt;</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">validate</span><span class="p">())</span>     <span class="c1"># inherited view</span></div>


<div class="viewcode-block" id="TestViews.test_view_inheritance">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_view_inheritance">[docs]</a>
    <span class="k">def</span> <span class="nf">test_view_inheritance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form string=&quot;Base title&quot;&gt;</span>
<span class="s2">                    &lt;separator name=&quot;separator&quot; string=&quot;Separator&quot; colspan=&quot;4&quot;/&gt;</span>
<span class="s2">                    &lt;footer&gt;</span>
<span class="s2">                        &lt;button name=&quot;action_archive&quot; type=&quot;object&quot; string=&quot;Next button&quot; class=&quot;btn-primary&quot;/&gt;</span>
<span class="s2">                        &lt;button string=&quot;Skip&quot; special=&quot;cancel&quot; class=&quot;btn-secondary&quot;/&gt;</span>
<span class="s2">                    &lt;/footer&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;edmund&quot;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;form position=&quot;attributes&quot;&gt;</span>
<span class="s2">                        &lt;attribute name=&quot;string&quot;&gt;Replacement title&lt;/attribute&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                    &lt;footer position=&quot;replace&quot;&gt;</span>
<span class="s2">                        &lt;footer&gt;</span>
<span class="s2">                            &lt;button name=&quot;action_archive&quot; type=&quot;object&quot; string=&quot;New button&quot;/&gt;</span>
<span class="s2">                        &lt;/footer&gt;</span>
<span class="s2">                    &lt;/footer&gt;</span>
<span class="s2">                    &lt;separator name=&quot;separator&quot; position=&quot;replace&quot;&gt;</span>
<span class="s2">                        &lt;p&gt;Replacement data&lt;/p&gt;</span>
<span class="s2">                    &lt;/separator&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;jake&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;footer position=&quot;attributes&quot;&gt;</span>
<span class="s2">                    &lt;attribute name=&quot;thing&quot;&gt;bob tata lolo&lt;/attribute&gt;</span>
<span class="s2">                    &lt;attribute name=&quot;thing&quot; add=&quot;bibi and co&quot; remove=&quot;tata&quot; separator=&quot; &quot; /&gt;</span>
<span class="s2">                    &lt;attribute name=&quot;otherthing&quot;&gt;bob, tata,lolo&lt;/attribute&gt;</span>
<span class="s2">                    &lt;attribute name=&quot;otherthing&quot; remove=&quot;tata, bob&quot;/&gt;</span>
<span class="s2">                &lt;/footer&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view3</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span>
                <span class="n">view</span><span class="p">[</span><span class="s1">&#39;arch&#39;</span><span class="p">],</span>
                <span class="n">parser</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">XMLParser</span><span class="p">(</span><span class="n">remove_blank_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Replacement data&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">footer</span><span class="p">(</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;action_archive&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;New button&quot;</span><span class="p">),</span>
                    <span class="n">thing</span><span class="o">=</span><span class="s2">&quot;bob lolo bibi and co&quot;</span><span class="p">,</span> <span class="n">otherthing</span><span class="o">=</span><span class="s2">&quot;lolo&quot;</span>
                <span class="p">),</span>
                <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Replacement title&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestViews.test_view_inheritance_text_inside">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_view_inheritance_text_inside">[docs]</a>
    <span class="k">def</span> <span class="nf">test_view_inheritance_text_inside</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test view inheritance when adding elements and text. &quot;&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;form string=&quot;F&quot;&gt;(&lt;div/&gt;)&lt;/form&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;div position=&quot;inside&quot;&gt;a&lt;p/&gt;b&lt;p/&gt;c&lt;/div&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="n">view2</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view</span><span class="p">[</span><span class="s1">&#39;arch&#39;</span><span class="p">],</span>
            <span class="s1">&#39;&lt;form string=&quot;F&quot;&gt;(&lt;div&gt;a&lt;p/&gt;b&lt;p/&gt;c&lt;/div&gt;)&lt;/form&gt;&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_view_inheritance_text_after">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_view_inheritance_text_after">[docs]</a>
    <span class="k">def</span> <span class="nf">test_view_inheritance_text_after</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test view inheritance when adding elements and text. &quot;&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;form string=&quot;F&quot;&gt;(&lt;div/&gt;)&lt;/form&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;div position=&quot;after&quot;&gt;a&lt;p/&gt;b&lt;p/&gt;c&lt;/div&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="n">view2</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view</span><span class="p">[</span><span class="s1">&#39;arch&#39;</span><span class="p">],</span>
            <span class="s1">&#39;&lt;form string=&quot;F&quot;&gt;(&lt;div/&gt;a&lt;p/&gt;b&lt;p/&gt;c)&lt;/form&gt;&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_view_inheritance_text_before">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_view_inheritance_text_before">[docs]</a>
    <span class="k">def</span> <span class="nf">test_view_inheritance_text_before</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test view inheritance when adding elements and text. &quot;&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;alpha&quot;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;form string=&quot;F&quot;&gt;(&lt;div/&gt;)&lt;/form&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;beta&quot;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;div position=&quot;before&quot;&gt;a&lt;p/&gt;b&lt;p/&gt;c&lt;/div&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="n">view2</span><span class="o">.</span><span class="n">ids</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view</span><span class="p">[</span><span class="s1">&#39;arch&#39;</span><span class="p">],</span>
            <span class="s1">&#39;&lt;form string=&quot;F&quot;&gt;(a&lt;p/&gt;b&lt;p/&gt;c&lt;div/&gt;)&lt;/form&gt;&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_view_inheritance_divergent_models">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_view_inheritance_divergent_models">[docs]</a>
    <span class="k">def</span> <span class="nf">test_view_inheritance_divergent_models</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;bob&quot;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view.custom&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form string=&quot;Base title&quot;&gt;</span>
<span class="s2">                    &lt;separator name=&quot;separator&quot; string=&quot;Separator&quot; colspan=&quot;4&quot;/&gt;</span>
<span class="s2">                    &lt;footer&gt;</span>
<span class="s2">                        &lt;button name=&quot;action_archive&quot; type=&quot;object&quot; string=&quot;Next button&quot; class=&quot;btn-primary&quot;/&gt;</span>
<span class="s2">                        &lt;button string=&quot;Skip&quot; special=&quot;cancel&quot; class=&quot;btn-secondary&quot;/&gt;</span>
<span class="s2">                    &lt;/footer&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;edmund&quot;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;data&gt;</span>
<span class="s2">                    &lt;form position=&quot;attributes&quot;&gt;</span>
<span class="s2">                        &lt;attribute name=&quot;string&quot;&gt;Replacement title&lt;/attribute&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                    &lt;footer position=&quot;replace&quot;&gt;</span>
<span class="s2">                        &lt;footer&gt;</span>
<span class="s2">                            &lt;button name=&quot;action_unarchive&quot; type=&quot;object&quot; string=&quot;New button&quot;/&gt;</span>
<span class="s2">                        &lt;/footer&gt;</span>
<span class="s2">                    &lt;/footer&gt;</span>
<span class="s2">                    &lt;separator name=&quot;separator&quot; position=&quot;replace&quot;&gt;</span>
<span class="s2">                        &lt;p&gt;Replacement data&lt;/p&gt;</span>
<span class="s2">                    &lt;/separator&gt;</span>
<span class="s2">                &lt;/data&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;jake&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.menu&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">17</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;footer position=&quot;attributes&quot;&gt;</span>
<span class="s2">                    &lt;attribute name=&quot;thing&quot;&gt;bob&lt;/attribute&gt;</span>
<span class="s2">                &lt;/footer&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view3</span><span class="o">.</span><span class="n">id</span><span class="p">])</span> \
                        <span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view_type</span><span class="o">=</span><span class="s1">&#39;form&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span>
                <span class="n">view</span><span class="p">[</span><span class="s1">&#39;arch&#39;</span><span class="p">],</span>
                <span class="n">parser</span><span class="o">=</span><span class="n">etree</span><span class="o">.</span><span class="n">XMLParser</span><span class="p">(</span><span class="n">remove_blank_text</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">form</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">p</span><span class="p">(</span><span class="s2">&quot;Replacement data&quot;</span><span class="p">),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">footer</span><span class="p">(</span>
                    <span class="n">E</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;action_unarchive&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="s2">&quot;New button&quot;</span><span class="p">)),</span>
                <span class="n">string</span><span class="o">=</span><span class="s2">&quot;Replacement title&quot;</span>
            <span class="p">))</span></div>


<div class="viewcode-block" id="TestViews.test_invalid_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_invalid_field">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_invalid_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;not_a_field&quot;/&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;Field &quot;not_a_field&quot; does not exist in model &quot;ir.ui.view&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                    &lt;field/&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span> <span class="s1">&#39;Field tag must have a &quot;name&quot; attribute defined&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_invalid_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_invalid_subfield">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_invalid_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree name=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                        &lt;field name=&quot;not_a_field&quot;/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;Field &quot;not_a_field&quot; does not exist in model &quot;ir.ui.view&quot;&#39;&#39;&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_context_in_view">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_context_in_view">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_context_in_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; context=&quot;{&#39;stuff&#39;: model}&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in context ({&#39;stuff&#39;: model}) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_context_in_subview">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_context_in_subview">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_context_in_subview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; context=&quot;{&#39;stuff&#39;: model}&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in context ({&#39;stuff&#39;: model}) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in context ({&#39;stuff&#39;: model}) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_context_in_subview_with_parent">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_context_in_subview_with_parent">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_context_in_subview_with_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; context=&quot;{&#39;stuff&#39;: parent.model}&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in context ({&#39;stuff&#39;: parent.model}) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in context ({&#39;stuff&#39;: parent.model}) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_context_in_subsubview_with_parent">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_context_in_subsubview_with_parent">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_context_in_subsubview_with_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                        &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                            &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                                &lt;field name=&quot;inherit_id&quot; context=&quot;{&#39;stuff&#39;: parent.parent.model}&quot;/&gt;</span>
<span class="s2">                            &lt;/form&gt;</span>
<span class="s2">                        &lt;/field&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in context ({&#39;stuff&#39;: parent.parent.model}) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in context ({&#39;stuff&#39;: parent.parent.model}) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in context ({&#39;stuff&#39;: parent.parent.model}) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_id_case">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_id_case">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_id_case</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># id is read by default and should be usable in domains</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; domain=&quot;[(&#39;id&#39;, &#39;=&#39;, False)]&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_boolean_case">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_boolean_case">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_boolean_case</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                </span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; domain=&quot;[(</span><span class="si">%s</span><span class="s2">, &#39;=&#39;, </span><span class="si">%s</span><span class="s2">)]&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">))</span>
        <span class="c1"># self.assertInvalid(arch % (&#39;&#39;, &#39;1&#39;, &#39;0&#39;))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;name&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;0 if name else 1&#39;</span><span class="p">))</span>
        <span class="c1"># self.assertInvalid(arch % (&#39;&lt;field name=&quot;name&quot;/&gt;&lt;field name=&quot;type&quot;/&gt;&#39;, &quot;&#39;tata&#39; if name else &#39;tutu&#39;&quot;, &#39;type&#39;), &#39;xxxx&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;0 if name else 1&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;name&#39; used in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(1, &#39;=&#39;, 0 if name else 1)]) must be present in view but is missing&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_in_view">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_in_view">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_in_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; domain=&quot;[(&#39;model&#39;, &#39;=&#39;, model)]&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;model&#39;, &#39;=&#39;, model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_unknown_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_unknown_field">[docs]</a>
    <span class="k">def</span> <span class="nf">test_domain_unknown_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; domain=&quot;[(&#39;invalid_field&#39;, &#39;=&#39;, &#39;res.users&#39;)]&quot;/&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;Unknown field &quot;ir.ui.view.invalid_field&quot; in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;invalid_field&#39;, &#39;=&#39;, &#39;res.users&#39;)])&#39;&#39;&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_field_searchable">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_field_searchable">[docs]</a>
    <span class="k">def</span> <span class="nf">test_domain_field_searchable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; domain=&quot;[(&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;=&#39;, &#39;test&#39;)]&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="c1"># computed field with a search method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;model_data_id&#39;</span><span class="p">)</span>
        <span class="c1"># computed field, not stored, no search</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;xml_id&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;Unsearchable field &#39;xml_id&#39; in path &#39;xml_id&#39; in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;xml_id&#39;, &#39;=&#39;, &#39;test&#39;)])&#39;&#39;&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_field_no_comodel">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_field_no_comodel">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_field_no_comodel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; domain=&quot;[(&#39;test&#39;, &#39;=&#39;, &#39;test&#39;)]&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;Domain on non-relational field </span><span class="se">\&quot;</span><span class="s2">name</span><span class="se">\&quot;</span><span class="s2"> makes no sense (domain:[(&#39;test&#39;, &#39;=&#39;, &#39;test&#39;)])&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_in_subview">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_in_subview">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_in_subview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; domain=&quot;[(&#39;model&#39;, &#39;=&#39;, model)]&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;model&#39;, &#39;=&#39;, model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;model&#39;, &#39;=&#39;, model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_in_subview_with_parent">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_in_subview_with_parent">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_in_subview_with_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; domain=&quot;[(&#39;model&#39;, &#39;=&#39;, parent.model)]&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                &lt;/field&gt;</span><span class="si">%s</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;model&#39;, &#39;=&#39;, parent.model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;model&#39;, &#39;=&#39;, parent.model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_on_field_in_view">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_on_field_in_view">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_on_field_in_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s2">&quot;[(&#39;model&#39;, &#39;=&#39;, model)]&quot;</span><span class="p">)</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of python field &#39;inherit_id&#39; ([(&#39;model&#39;, &#39;=&#39;, model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_on_field_in_subview">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_on_field_in_subview">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_on_field_in_subview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s2">&quot;[(&#39;model&#39;, &#39;=&#39;, model)]&quot;</span><span class="p">)</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of python field &#39;inherit_id&#39; ([(&#39;model&#39;, &#39;=&#39;, model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of python field &#39;inherit_id&#39; ([(&#39;model&#39;, &#39;=&#39;, model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_on_field_in_subview_with_parent">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_on_field_in_subview_with_parent">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_on_field_in_subview_with_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s2">&quot;[(&#39;model&#39;, &#39;=&#39;, parent.model)]&quot;</span><span class="p">)</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of python field &#39;inherit_id&#39; ([(&#39;model&#39;, &#39;=&#39;, parent.model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of python field &#39;inherit_id&#39; ([(&#39;model&#39;, &#39;=&#39;, parent.model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_on_field_in_noneditable_subview">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_on_field_in_noneditable_subview">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_on_field_in_noneditable_subview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s2">&quot;[(&#39;model&#39;, &#39;=&#39;, model)]&quot;</span><span class="p">)</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree string=&quot;Children&quot;</span><span class="si">%s</span><span class="s2">&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot;/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39; editable=&quot;bottom&quot;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of python field &#39;inherit_id&#39; ([(&#39;model&#39;, &#39;=&#39;, model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_on_readonly_field_in_view">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_on_readonly_field_in_view">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_on_readonly_field_in_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s2">&quot;[(&#39;model&#39;, &#39;=&#39;, model)]&quot;</span><span class="p">)</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; readonly=&quot;1&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;readonly&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_on_readonly_field_in_subview">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_on_readonly_field_in_subview">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_on_readonly_field_in_subview</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_fields</span><span class="p">[</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="s1">&#39;domain&#39;</span><span class="p">,</span> <span class="s2">&quot;[(&#39;model&#39;, &#39;=&#39;, model)]&quot;</span><span class="p">)</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;</span><span class="si">%s</span><span class="s2">&gt;</span>
<span class="s2">                    &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39; readonly=&quot;1&quot;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of python field &#39;inherit_id&#39; ([(&#39;model&#39;, &#39;=&#39;, model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_in_filter">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_in_filter">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_in_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;search string=&quot;Search&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;</span><span class="si">%s</span><span class="s2">&quot;/&gt;</span>
<span class="s2">                &lt;filter string=&quot;Dummy&quot; name=&quot;draft&quot; domain=&quot;[(&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;=&#39;, &#39;dummy&#39;)]&quot;/&gt;</span>
<span class="s2">            &lt;/search&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;inherit_children_ids.name&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;invalid_field&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Field &quot;invalid_field&quot; does not exist in model &quot;ir.ui.view&quot;&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;invalid_field&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Unknown field &quot;ir.ui.view.invalid_field&quot; in domain of &lt;filter name=&quot;draft&quot;&gt; ([(&#39;invalid_field&#39;, &#39;=&#39;, &#39;dummy&#39;)])&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;inherit_children_ids.invalid_field&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Unknown field &quot;ir.ui.view.invalid_field&quot; in domain of &lt;filter name=&quot;draft&quot;&gt; ([(&#39;inherit_children_ids.invalid_field&#39;, &#39;=&#39;, &#39;dummy&#39;)])&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>

        <span class="c1"># todo add check for non searchable fields and group by</span>

<div class="viewcode-block" id="TestViews.test_group_by_in_filter">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_group_by_in_filter">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_group_by_in_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;search string=&quot;Search&quot;&gt;</span>
<span class="s2">                &lt;filter string=&quot;Date&quot; name=&quot;month&quot; domain=&quot;[]&quot; context=&quot;{&#39;group_by&#39;:&#39;</span><span class="si">%s</span><span class="s2">&#39;}&quot;/&gt;</span>
<span class="s2">            &lt;/search&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;invalid_field&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Unknown field &quot;invalid_field&quot; in &quot;group_by&quot; value in context=&quot;{&#39;group_by&#39;:&#39;invalid_field&#39;}&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_domain_invalid_in_filter">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_domain_invalid_in_filter">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_domain_invalid_in_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># invalid domain: it should be a list of tuples</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; &lt;search string=&quot;Search&quot;&gt;</span>
<span class="sd">                    &lt;filter string=&quot;Dummy&quot; name=&quot;draft&quot; domain=&quot;[&#39;name&#39;, &#39;=&#39;, &#39;dummy&#39;]&quot;/&gt;</span>
<span class="sd">                &lt;/search&gt;</span>
<span class="sd">            &quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;Invalid domain of &lt;filter name=&quot;draft&quot;&gt;: &quot;[&#39;name&#39;, &#39;=&#39;, &#39;dummy&#39;]&quot;&#39;&#39;&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_searchpanel">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_searchpanel">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_searchpanel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;search&gt;</span>
<span class="s2">                </span><span class="si">%s</span>
<span class="s2">                &lt;searchpanel&gt;</span>
<span class="s2">                    </span><span class="si">%s</span>
<span class="s2">                    &lt;field name=&quot;groups_id&quot; select=&quot;multi&quot; domain=&quot;[(&#39;</span><span class="si">%s</span><span class="s2">&#39;, &#39;=&#39;, </span><span class="si">%s</span><span class="s2">)]&quot; enable_counters=&quot;1&quot;/&gt;</span>
<span class="s2">                &lt;/searchpanel&gt;</span>
<span class="s2">            &lt;/search&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;inherit_id&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;view_access&#39;</span><span class="p">,</span> <span class="s1">&#39;inherit_id&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;inherit_id&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;view_access&#39;</span><span class="p">,</span> <span class="s1">&#39;inherit_id&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;inherit_id&#39; used in domain of &lt;field name=&quot;groups_id&quot;&gt; ([(&#39;view_access&#39;, &#39;=&#39;, inherit_id)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;inherit_id&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;view_access&#39;</span><span class="p">,</span> <span class="s1">&#39;view_access&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;view_access&#39; used in domain of &lt;field name=&quot;groups_id&quot;&gt; ([(&#39;view_access&#39;, &#39;=&#39;, view_access)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;inherit_id&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;inherit_id&#39;</span><span class="p">,</span> <span class="s1">&#39;inherit_id&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Unknown field &quot;res.groups.inherit_id&quot; in domain of &lt;field name=&quot;groups_id&quot;&gt; ([(&#39;inherit_id&#39;, &#39;=&#39;, inherit_id)])&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;inherit_id&quot; select=&quot;multi&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;view_access&#39;</span><span class="p">,</span> <span class="s1">&#39;inherit_id&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;inherit_id&#39; used in domain of &lt;field name=&quot;groups_id&quot;&gt; ([(&#39;view_access&#39;, &#39;=&#39;, inherit_id)]) is present in view but is in select multi.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;search&gt;</span>
<span class="s2">                &lt;searchpanel&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; enable_counters=&quot;1&quot;/&gt;</span>
<span class="s2">                &lt;/searchpanel&gt;</span>
<span class="s2">                &lt;searchpanel&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; enable_counters=&quot;1&quot;/&gt;</span>
<span class="s2">                &lt;/searchpanel&gt;</span>
<span class="s2">            &lt;/search&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="s2">&quot;Search tag can only contain one search panel&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_groups_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_groups_field">[docs]</a>
    <span class="k">def</span> <span class="nf">test_groups_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;</span><span class="si">%s</span><span class="s2">&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;base.group_no_one&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;base.dummy&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_attrs_groups_behavior">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_attrs_groups_behavior">[docs]</a>
    <span class="k">def</span> <span class="nf">test_attrs_groups_behavior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;res.partner&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;company_id&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                    &lt;div id=&quot;foo&quot;/&gt;</span>
<span class="s2">                    &lt;div id=&quot;bar&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">user_demo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_demo</span>
        <span class="c1"># Make sure demo doesn&#39;t have the base.group_system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="n">user_demo</span><span class="p">)</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_group</span><span class="p">(</span><span class="s1">&#39;base.group_system&#39;</span><span class="p">))</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="n">user_demo</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_id</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="s1">&#39;arch&#39;</span><span class="p">]</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;name&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;company_id&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&quot;foo&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&quot;bar&quot;]&#39;</span><span class="p">))</span>

        <span class="n">user_admin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.user_admin&#39;</span><span class="p">)</span>
        <span class="c1"># Make sure admin has the base.group_system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="n">user_admin</span><span class="p">)</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_group</span><span class="p">(</span><span class="s1">&#39;base.group_system&#39;</span><span class="p">))</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="n">user_admin</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_id</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="s1">&#39;arch&#39;</span><span class="p">]</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;name&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;company_id&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&quot;foo&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&quot;bar&quot;]&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestViews.test_attrs_groups_validation">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_attrs_groups_validation">[docs]</a>
    <span class="k">def</span> <span class="nf">test_attrs_groups_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="s1">&#39;parent.&#39;</span> <span class="k">if</span> <span class="n">parent</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;invisible=&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;&quot; &quot;&quot;&quot;</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;domain=&quot;[(&#39;name&#39;, &#39;!=&#39;, </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name)]&quot; &quot;&quot;&quot;</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;context=&quot;</span><span class="se">{{</span><span class="s2">&#39;default_name&#39;: </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name</span><span class="se">}}</span><span class="s2">&quot; &quot;&quot;&quot;</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;decoration-info=&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;&quot; &quot;&quot;&quot;</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
                    <span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;invisible=&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;&quot; &quot;&quot;&quot;</span><span class="p">},</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Field &#39;name&#39; used in modifier &#39;invisible&#39; (</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;) is restricted to the group(s)&quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
                    <span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;domain=&quot;[(&#39;name&#39;, &#39;!=&#39;, </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name)]&quot; &quot;&quot;&quot;</span><span class="p">},</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Field &#39;name&#39; used in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;name&#39;, &#39;!=&#39;, </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name)]) is restricted to the group(s)&quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
                    <span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;context=&quot;</span><span class="se">{{</span><span class="s2">&#39;default_name&#39;: </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name</span><span class="se">}}</span><span class="s2">&quot; &quot;&quot;&quot;</span><span class="p">},</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Field &#39;name&#39; used in context (</span><span class="se">{{</span><span class="s2">&#39;default_name&#39;: </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name</span><span class="se">}}</span><span class="s2">) is restricted to the group(s)&quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
                    <span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;decoration-info=&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;&quot; &quot;&quot;&quot;</span><span class="p">},</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Field &#39;name&#39; used in decoration-info=&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;&quot; is restricted to the group(s)&quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>


        <span class="c1"># Assert using a field restricted to a group</span>
        <span class="c1"># in another field without the same group is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field without the same group is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field with the same group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field available for everyone</span>
        <span class="c1"># in a child field restricted to a group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field available for everyone</span>
        <span class="c1"># in another field restricted to a group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2"> groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a group</span>
        <span class="c1"># in another field with the same group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field available twice for 2 diffent groups</span>
        <span class="c1"># in another field restricted to one of the 2 groups is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_portal&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a group only</span>
        <span class="c1"># in other fields restricted to at least one different group is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_portal&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field available twice for 2 different groups</span>
        <span class="c1"># in other fields restricted to the same 2 group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_portal&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_portal&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field available for 2 diffent groups,</span>
        <span class="c1"># in another field restricted to one of the 2 groups is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_portal,base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field available for 1 group only</span>
        <span class="c1"># in another field restricted 2 groups is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_portal,base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a group</span>
        <span class="c1"># in another field restricted to a group including the group for which the field is available is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_erp_manager&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field restricted to a group including the group for which the field is available is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_erp_manager&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a group</span>
        <span class="c1"># in another field restricted to a group not including the group for which the field is available is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_erp_manager&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field restricted to a group not including the group for which the field is available is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_erp_manager&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field not restricted to the same group is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field within the same block restricted to a group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field within the same block restricted to a group and additional groups on the field node is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2"> groups=&quot;base.group_multi_currency,base.group_multi_company&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field within a block restricted to the same group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field within a block restricted to a group including the group for which the field is available</span>
        <span class="c1"># is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_erp_manager&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field within a block restricted to a group not including the group for which the field is available</span>
        <span class="c1"># is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_erp_manager&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field under a relational field restricted to the same group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot; groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field under a relational field restricted</span>
        <span class="c1"># to a group including the group for which the field is available is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_erp_manager&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot; groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field under a relational field restricted</span>
        <span class="c1"># to a group not including the group for which the field is available is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot; groups=&quot;base.group_erp_manager&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to users not having a group</span>
        <span class="c1"># in another field not restricted to any group is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field not restricted to any group</span>
        <span class="c1"># in another field restricted to users not having a group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to users not having multiple groups</span>
        <span class="c1"># in another field restricted to users not having one of the group only is invalid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is portal, the field &quot;name&quot; will not be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot; where &quot;name&quot; is used will be in the view</span>
        <span class="c1"># making it invalid.</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system,!base.group_portal&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to users not having a group</span>
        <span class="c1"># in another field restricted to users not having multiple group including the one above is valid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is portal, the field &quot;name&quot; will be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot; where &quot;name&quot; is used will not be in the view</span>
        <span class="c1"># making it valid.</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_user&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_user,!base.group_portal&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a non group</span>
        <span class="c1"># in another field for which the non group is not implied is invalid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is employee, the field &quot;name&quot; will not be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot; where &quot;name&quot; is used will be in the view,</span>
        <span class="c1"># making it invalid.</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_user&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a non group</span>
        <span class="c1"># in another field restricted to a non group implied in the non group of the available field is valid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is employee, the field &quot;name&quot; will be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot;, where &quot;name&quot; is used, will not be in the view,</span>
        <span class="c1"># therefore making it valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_user&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to non-admins, itself in a block restricted to employees,</span>
        <span class="c1"># in another field restricted to a block restricted to employees</span>
        <span class="c1"># is invalid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is admin, the field &quot;name&quot; will not be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot;, where &quot;name&quot; is used, will be in the view,</span>
        <span class="c1"># threfore making it invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_user&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_user&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a group</span>
        <span class="c1"># in another field restricted the opposite group is invalid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is admin, the field &quot;name&quot; will be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot;, where &quot;name&quot; is used, will not be in the view,</span>
        <span class="c1"># therefore making it invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert having two times the same field with a mutually exclusive group</span>
        <span class="c1"># and using that field in another field without any group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert having two times the same field with a mutually exclusive group</span>
        <span class="c1"># and using that field in another field using the group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert having two times the same field with a mutually exclusive group</span>
        <span class="c1"># and using that field in another field using the !group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert having two times the same field with a mutually exclusive group</span>
        <span class="c1"># and using that field in another field restricted to any other group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_portal&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a &#39;base.group_no_one&#39; in another</span>
        <span class="c1"># field with a group implied &#39;base.group_no_one&#39; is invalid. The group</span>
        <span class="c1"># &#39;base.group_no_one&#39; must be in the view because it&#39;s depending of the</span>
        <span class="c1"># session.</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_no_one&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2"> groups=&quot;base.group_user&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_no_one&quot;/&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_no_one&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2"> groups=&quot;base.group_user&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_empty_groups_attrib">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_empty_groups_attrib">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_empty_groups_attrib</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure we allow empty groups attribute&quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;res.partner&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot; groups=&quot;&quot; /&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_id</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="s1">&#39;arch&#39;</span><span class="p">]</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;//field[@name=&#39;name&#39; and not (@groups)]&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestViews.test_invisible_groups_with_groups_in_model">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_invisible_groups_with_groups_in_model">[docs]</a>
    <span class="k">def</span> <span class="nf">test_invisible_groups_with_groups_in_model</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Tests the attrs is well processed to modifiers for a field node combining:</span>
<span class="sd">        - a `groups` attribute on the field node in the view architecture</span>
<span class="sd">        - a `groups` attribute on the field in the Python model</span>
<span class="sd">        This is an edge case and it worths a unit test.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s1">&#39;groups&#39;</span><span class="p">,</span> <span class="s1">&#39;base.group_system&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">groups_id</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.group_multi_company&#39;</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;res.partner&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form&gt;</span>
<span class="s2">                    &lt;field name=&quot;active&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot; groups=&quot;base.group_multi_company&quot; invisible=&quot;active&quot;/&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_id</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="s1">&#39;arch&#39;</span><span class="p">]</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>
        <span class="n">node_field_name</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;name&quot;]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">node_field_name</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;invisible&#39;</span><span class="p">),</span> <span class="s2">&quot;active&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_button">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_button">[docs]</a>
    <span class="k">def</span> <span class="nf">test_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form&gt;</span>
<span class="s2">                &lt;button type=&quot;object&quot; name=&quot;</span><span class="si">%s</span><span class="s2">&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;action_archive&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;valid button name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;wtfzzz&#39;</span><span class="p">,</span> <span class="s1">&#39;wtfzzz is not a valid action on ir.ui.view&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;button name is not even a method&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;_check_xml&#39;</span><span class="p">,</span>
            <span class="s1">&#39;_check_xml on ir.ui.view is private and cannot be called from a button&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s1">&#39;button name is a private method&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;postprocess_and_fields&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;button name is a method that requires extra arguments&#39;</span><span class="p">)</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form&gt;</span>
<span class="s2">                &lt;button type=&quot;action&quot; name=&quot;</span><span class="si">%s</span><span class="s2">&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Action 0 (id: 0) does not exist for button of type action.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;base.random_xmlid&#39;</span><span class="p">,</span> <span class="s1">&#39;Invalid xmlid base.random_xmlid for button of type action&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;button type=&quot;action&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;Button must have a name&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;button special=&quot;dummy&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">,</span> <span class="s2">&quot;Invalid special &#39;dummy&#39; in button&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;base.partner_root&#39;</span><span class="p">,</span> <span class="s2">&quot;base.partner_root is of type res.partner, expected a subclass of ir.actions.actions&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_tree">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_tree">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_tree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;tree&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;button type=&#39;object&#39; name=&quot;action_archive&quot;/&gt;</span>
<span class="s2">                </span><span class="si">%s</span>
<span class="s2">            &lt;/tree&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&lt;group/&gt;&#39;</span><span class="p">,</span> <span class="s2">&quot;Tree child can only have one of field, button, control, groupby, widget, header tag (not group)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_tree_groupby">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_tree_groupby">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_tree_groupby</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;tree&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;groupby name=&quot;</span><span class="si">%s</span><span class="s2">&quot;&gt;</span>
<span class="s2">                    &lt;button type=&quot;object&quot; name=&quot;action_archive&quot;/&gt;</span>
<span class="s2">                &lt;/groupby&gt;</span>
<span class="s2">            &lt;/tree&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;model_data_id&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">),</span> <span class="s2">&quot;Field &#39;type&#39; found in &#39;groupby&#39; node can only be of type many2one, found selection&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;dummy&#39;</span><span class="p">),</span> <span class="s2">&quot;Field &#39;dummy&#39; found in &#39;groupby&#39; node does not exist in model ir.ui.view&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_tree_groupby_many2one">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_tree_groupby_many2one">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_tree_groupby_many2one</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;tree&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                </span><span class="si">%s</span>
<span class="s2">                &lt;groupby name=&quot;model_data_id&quot;&gt;</span>
<span class="s2">                    </span><span class="si">%s</span>
<span class="s2">                    &lt;button type=&quot;object&quot; name=&quot;action_archive&quot; invisible=&quot;noupdate&quot; string=&quot;Button1&quot;/&gt;</span>
<span class="s2">                &lt;/groupby&gt;</span>
<span class="s2">            &lt;/tree&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;noupdate&quot;/&gt;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;noupdate&#39; used in modifier &#39;invisible&#39; (noupdate) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;noupdate&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;Field &quot;noupdate&quot; does not exist in model &quot;ir.ui.view&quot;&#39;&#39;&#39;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;noupdate&quot;/&gt;&lt;field name=&quot;fake_field&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&#39;&#39;&#39;Field &quot;fake_field&quot; does not exist in model &quot;ir.model.data&quot;&#39;&#39;&#39;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_check_xml_on_reenable">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_check_xml_on_reenable">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_check_xml_on_reenable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;valid _check_xml&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;valid _check_xml&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;field name=&quot;foo&quot; position=&quot;after&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;bar&quot;/&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
            <span class="n">view2</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Re-enabling the view and correcting it at the same time should not raise the `_check_xml` constraint.</span>
        <span class="n">view2</span><span class="o">.</span><span class="n">write</span><span class="p">({</span>
            <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;field name=&quot;name&quot; position=&quot;after&quot;&gt;</span>
<span class="s2">                    &lt;span&gt;bar&lt;/span&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span></div>


<div class="viewcode-block" id="TestViews.test_for_in_label">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_for_in_label">[docs]</a>
    <span class="k">def</span> <span class="nf">test_for_in_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;field name=&quot;model&quot;/&gt;&lt;label for=&quot;model&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="s1">&#39;&lt;form&gt;&lt;field name=&quot;model&quot;/&gt;&lt;label/&gt;&lt;/form&gt;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Label tag must contain a &quot;for&quot;. To match label style without corresponding field or button, use &#39;class=&quot;o_form_label&quot;&#39;&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="s1">&#39;&lt;form&gt;&lt;label for=&quot;model&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Name or id &#39;model&#39; in &lt;label for=&quot;...&quot;&gt; must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_col_colspan_numerical">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_col_colspan_numerical">[docs]</a>
    <span class="k">def</span> <span class="nf">test_col_colspan_numerical</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;group col=&quot;5&quot;&gt;&lt;/group&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="s1">&#39;&lt;form&gt;&lt;group col=&quot;alpha&quot;&gt;&lt;/group&gt;&lt;/form&gt;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;&#39;col&#39; value must be an integer (alpha)&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div colspan=&quot;5&quot;&gt;&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="s1">&#39;&lt;form&gt;&lt;div colspan=&quot;alpha&quot;&gt;&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">,</span>
            <span class="s2">&quot;&#39;colspan&#39; value must be an integer (alpha)&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_alerts">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_alerts">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_alerts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;alert alert-success&quot; role=&quot;alert&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;alert alert-success&quot; role=&quot;alertdialog&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;alert alert-success&quot; role=&quot;status&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;alert alert-success&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_prohibited_none_role">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_prohibited_none_role">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_prohibited_none_role</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div role=&quot;none&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div role=&quot;presentation&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_alternative_image_text">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_alternative_image_text">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_alternative_image_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;img src=&quot;a&quot; alt=&quot;a image&quot;&gt;&lt;/img&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;img src=&quot;a&quot;&gt;&lt;/img&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_accessibility_icon_text">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_accessibility_icon_text">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_accessibility_icon_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span>
            <span class="s1">&#39;&lt;form&gt;&lt;span class=&quot;fa fa-warning&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;A &lt;span&gt; with fa class (fa fa-warning) must have title in its tag, parents, descendants or have text&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span>
            <span class="s1">&#39;&lt;form&gt;&lt;button icon=&quot;fa-warning&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;A button with icon attribute (fa-warning) must have title in its tag, parents, descendants or have text&#39;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;button icon=&quot;fa-warning&quot;/&gt;text&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;span class=&quot;fa fa-warning&quot;/&gt;text&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;text&lt;span class=&quot;fa fa-warning&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;span class=&quot;fa fa-warning&quot;&gt;text&lt;/span&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;span title=&quot;text&quot; class=&quot;fa fa-warning&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;span aria-label=&quot;text&quot; class=&quot;fa fa-warning&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_simili_button">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_simili_button">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_simili_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;a class=&quot;btn&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;a class=&quot;btn&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_dialog">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_dialog">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_dialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;modal&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div role=&quot;dialog&quot; class=&quot;modal&quot;&gt;&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;modal-header&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;header class=&quot;modal-header&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;modal-footer&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;footer class=&quot;modal-footer&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;modal-body&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;main class=&quot;modal-body&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_simili_dropdown">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_simili_dropdown">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_simili_dropdown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;ul class=&quot;dropdown-menu&quot; role=&quot;menu&quot;&gt;&lt;/ul&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;ul class=&quot;dropdown-menu&quot;&gt;&lt;/ul&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_simili_progressbar">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_simili_progressbar">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_simili_progressbar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;o_progressbar&quot; role=&quot;progressbar&quot; aria-valuenow=&quot;14&quot; aria-valuemin=&quot;0&quot; aria-valuemax=&quot;100&quot;&gt;14%&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;o_progressbar&quot; aria-valuenow=&quot;14&quot; aria-valuemin=&quot;0&quot; aria-valuemax=&quot;100&quot;&gt;14%&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;o_progressbar&quot; role=&quot;progressbar&quot; aria-valuemin=&quot;0&quot; aria-valuemax=&quot;100&quot;&gt;14%&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;o_progressbar&quot; role=&quot;progressbar&quot; aria-valuenow=&quot;14&quot; aria-valuemax=&quot;100&quot;&gt;14%&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;o_progressbar&quot; role=&quot;progressbar&quot; aria-valuenow=&quot;14&quot; aria-valuemin=&quot;0&quot; &gt;14%&lt;/div&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_simili_tabpanel">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_simili_tabpanel">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_simili_tabpanel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;tab-pane&quot; role=&quot;tabpanel&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;tab-pane&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_simili_tablist">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_simili_tablist">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_simili_tablist</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;nav-tabs&quot; role=&quot;tablist&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;nav-tabs&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_simili_tab">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_simili_tab">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_simili_tab</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;a data-bs-toggle=&quot;tab&quot; role=&quot;tab&quot; aria-controls=&quot;test&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;a data-bs-toggle=&quot;tab&quot; aria-controls=&quot;test&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;a data-bs-toggle=&quot;tab&quot; role=&quot;tab&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;a data-bs-toggle=&quot;tab&quot; role=&quot;tab&quot; aria-controls=&quot;#test&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_valid_focusable_button">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_valid_focusable_button">[docs]</a>
    <span class="k">def</span> <span class="nf">test_valid_focusable_button</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;a class=&quot;btn&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;button class=&quot;btn&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;select class=&quot;btn&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;input type=&quot;button&quot; class=&quot;btn&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;input type=&quot;submit&quot; class=&quot;btn&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;input type=&quot;reset&quot; class=&quot;btn&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div type=&quot;reset&quot; class=&quot;btn btn-group&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div type=&quot;reset&quot; class=&quot;btn btn-toolbar&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div type=&quot;reset&quot; class=&quot;btn btn-addr&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;div class=&quot;btn&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertWarning</span><span class="p">(</span><span class="s1">&#39;&lt;form&gt;&lt;input type=&quot;email&quot; class=&quot;btn&quot; role=&quot;button&quot;/&gt;&lt;/form&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_partial_validation">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_partial_validation">[docs]</a>
    <span class="k">def</span> <span class="nf">test_partial_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">load_all_views</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># base view</span>
        <span class="n">view0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;model&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; domain=&quot;[(&#39;model&#39;, &#39;=&#39;, model)]&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># added elements should be validated</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;&lt;form position=&quot;inside&quot;&gt;</span>
<span class="sd">                &lt;field name=&quot;groups_id&quot; domain=&quot;[(&#39;invalid_field&#39;, &#39;=&#39;, &#39;dummy&#39;)]&quot;/&gt;</span>
<span class="sd">            &lt;/form&gt;&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Unknown field &quot;res.groups.invalid_field&quot; in domain of &lt;field name=&quot;groups_id&quot;&gt; ([(&#39;invalid_field&#39;, &#39;=&#39;, &#39;dummy&#39;)]))&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">inherit_id</span><span class="o">=</span><span class="n">view0</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;&lt;form position=&quot;inside&quot;&gt;</span>
<span class="sd">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="sd">            &lt;/form&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">inherit_id</span><span class="o">=</span><span class="n">view0</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;&lt;form position=&quot;inside&quot;&gt;</span>
<span class="sd">                &lt;field name=&quot;groups_id&quot; domain=&quot;[(&#39;name&#39;, &#39;=&#39;, name)]&quot;/&gt;</span>
<span class="sd">                &lt;label for=&quot;groups_id&quot;/&gt;</span>
<span class="sd">            &lt;/form&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">inherit_id</span><span class="o">=</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># modifying attributes should validate the target element</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;&lt;field name=&quot;inherit_id&quot; position=&quot;attributes&quot;&gt;</span>
<span class="sd">                &lt;attribute name=&quot;domain&quot;&gt;[(&#39;invalid_field&#39;, &#39;=&#39;, &#39;dummy&#39;)]&lt;/attribute&gt;</span>
<span class="sd">            &lt;/field&gt;&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Unknown field &quot;ir.ui.view.invalid_field&quot; in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;invalid_field&#39;, &#39;=&#39;, &#39;dummy&#39;)]))&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">inherit_id</span><span class="o">=</span><span class="n">view0</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># replacing an element should validate the whole view</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;&lt;field name=&quot;model&quot; position=&quot;replace&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;model&#39;, &#39;=&#39;, model)]) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">inherit_id</span><span class="o">=</span><span class="n">view0</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># moving an element should have no impact; this test checks that the</span>
        <span class="c1"># implementation does not flag the inner element to be validated, which</span>
        <span class="c1"># prevents to locate the corresponding element inside the arch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;&lt;field name=&quot;groups_id&quot; position=&quot;before&quot;&gt;</span>
<span class="sd">                &lt;label for=&quot;groups_id&quot; position=&quot;move&quot;/&gt;</span>
<span class="sd">            &lt;/field&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="n">inherit_id</span><span class="o">=</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># modifying a view extension should validate the other views</span>
        <span class="k">with</span> <span class="n">mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">ValidationError</span><span class="p">):</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">savepoint</span><span class="p">():</span>
                    <span class="n">view1</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;form position=&quot;inside&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;type&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;&quot;&quot;&quot;</span></div>


<div class="viewcode-block" id="TestViews.test_graph_fields">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_graph_fields">[docs]</a>
    <span class="k">def</span> <span class="nf">test_graph_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;graph string=&quot;Graph&quot;&gt;&lt;field name=&quot;model&quot; type=&quot;row&quot;/&gt;&lt;field name=&quot;inherit_id&quot; type=&quot;measure&quot;/&gt;&lt;/graph&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="s1">&#39;&lt;graph string=&quot;Graph&quot;&gt;&lt;label for=&quot;model&quot;/&gt;&lt;field name=&quot;model&quot; type=&quot;row&quot;/&gt;&lt;field name=&quot;inherit_id&quot; type=&quot;measure&quot;/&gt;&lt;/graph&gt;&#39;</span><span class="p">,</span>
            <span class="s1">&#39;A &lt;graph&gt; can only contains &lt;field&gt; nodes, found a &lt;label&gt;&#39;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_graph_attributes">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_graph_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">test_graph_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s1">&#39;&lt;graph string=&quot;Graph&quot; cumulated=&quot;1&quot; &gt;&lt;field name=&quot;model&quot; type=&quot;row&quot;/&gt;&lt;field name=&quot;inherit_id&quot; type=&quot;measure&quot;/&gt;&lt;/graph&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_view_ref">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_view_ref">[docs]</a>
    <span class="k">def</span> <span class="nf">test_view_ref</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                &lt;form&gt;</span>
<span class="sd">                    &lt;field name=&quot;groups_id&quot; class=&quot;canary&quot;/&gt;</span>
<span class="sd">                &lt;/form&gt;</span>
<span class="sd">            &quot;&quot;&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;ir.model.data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test_views_test_view_ref&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;res_id&#39;</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">form_view_ref</span><span class="o">=</span><span class="s1">&#39;base.test_views_test_view_ref&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="s2">&quot;The view returned should be test_views_test_view_ref&quot;</span><span class="p">)</span>
        <span class="n">view_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">form_view_ref</span><span class="o">=</span><span class="s1">&#39;base.test_views_test_view_ref&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">view_data</span><span class="p">[</span><span class="s1">&#39;arch&#39;</span><span class="p">])</span>
        <span class="n">field_groups_id</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;groups_id&quot;]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">field_groups_id</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s2">&quot;.//*[@class=&#39;canary&#39;]&quot;</span><span class="p">)),</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="s2">&quot;The view test_views_test_view_ref should not be in the views of the many2many field groups_id&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_forbidden_owl_directives_in_form">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_forbidden_owl_directives_in_form">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_forbidden_owl_directives_in_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&lt;form&gt;</span><span class="si">%s</span><span class="s2">&lt;/form&gt;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;span t-esc=&quot;x&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Error while validating view near:</span>

<span class="sd">&lt;form __validate__=&quot;1&quot;&gt;&lt;span t-esc=&quot;x&quot;/&gt;&lt;/form&gt;</span>
<span class="sd">Forbidden owl directive used in arch (t-esc).&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;span t-on-click=&quot;x.doIt()&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Error while validating view near:</span>

<span class="sd">&lt;form __validate__=&quot;1&quot;&gt;&lt;span t-on-click=&quot;x.doIt()&quot;/&gt;&lt;/form&gt;</span>
<span class="sd">Forbidden owl directive used in arch (t-on-click).&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_forbidden_owl_directives_in_kanban">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_forbidden_owl_directives_in_kanban">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_forbidden_owl_directives_in_kanban</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&lt;kanban&gt;&lt;templates&gt;&lt;t t-name=&#39;kanban-box&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/t&gt;&lt;/templates&gt;&lt;/kanban&gt;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;span t-esc=&quot;record.resId&quot;/&gt;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;t t-debug=&quot;&quot;/&gt;&#39;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;span t-on-click=&quot;x.doIt()&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Error while validating view near:</span>

<span class="sd">&lt;kanban __validate__=&quot;1&quot;&gt;&lt;templates&gt;&lt;t t-name=&quot;kanban-box&quot;&gt;&lt;span t-on-click=&quot;x.doIt()&quot;/&gt;&lt;/t&gt;&lt;/templates&gt;&lt;/kanban&gt;</span>
<span class="sd">Forbidden owl directive used in arch (t-on-click).&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_forbidden_data_tooltip_attributes_in_form">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_forbidden_data_tooltip_attributes_in_form">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_forbidden_data_tooltip_attributes_in_form</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&lt;form&gt;</span><span class="si">%s</span><span class="s2">&lt;/form&gt;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;span data-tooltip=&quot;Test&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Error while validating view near:</span>

<span class="sd">&lt;form __validate__=&quot;1&quot;&gt;&lt;span data-tooltip=&quot;Test&quot;/&gt;&lt;/form&gt;</span>
<span class="sd">Forbidden attribute used in arch (data-tooltip).&quot;&quot;&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;span data-tooltip-template=&quot;test&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Error while validating view near:</span>

<span class="sd">&lt;form __validate__=&quot;1&quot;&gt;&lt;span data-tooltip-template=&quot;test&quot;/&gt;&lt;/form&gt;</span>
<span class="sd">Forbidden attribute used in arch (data-tooltip-template).&quot;&quot;&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_forbidden_data_tooltip_attributes_in_kanban">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_forbidden_data_tooltip_attributes_in_kanban">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_forbidden_data_tooltip_attributes_in_kanban</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&lt;kanban&gt;&lt;templates&gt;&lt;t t-name=&#39;kanban-box&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/t&gt;&lt;/templates&gt;&lt;/kanban&gt;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;span data-tooltip=&quot;Test&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Error while validating view near:</span>

<span class="sd">&lt;kanban __validate__=&quot;1&quot;&gt;&lt;templates&gt;&lt;t t-name=&quot;kanban-box&quot;&gt;&lt;span data-tooltip=&quot;Test&quot;/&gt;&lt;/t&gt;&lt;/templates&gt;&lt;/kanban&gt;</span>
<span class="sd">Forbidden attribute used in arch (data-tooltip).&quot;&quot;&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;span data-tooltip-template=&quot;test&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Error while validating view near:</span>

<span class="sd">&lt;kanban __validate__=&quot;1&quot;&gt;&lt;templates&gt;&lt;t t-name=&quot;kanban-box&quot;&gt;&lt;span data-tooltip-template=&quot;test&quot;/&gt;&lt;/t&gt;&lt;/templates&gt;&lt;/kanban&gt;</span>
<span class="sd">Forbidden attribute used in arch (data-tooltip-template).&quot;&quot;&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;span t-att-data-tooltip=&quot;test&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Error while validating view near:</span>

<span class="sd">&lt;kanban __validate__=&quot;1&quot;&gt;&lt;templates&gt;&lt;t t-name=&quot;kanban-box&quot;&gt;&lt;span t-att-data-tooltip=&quot;test&quot;/&gt;&lt;/t&gt;&lt;/templates&gt;&lt;/kanban&gt;</span>
<span class="sd">Forbidden attribute used in arch (t-att-data-tooltip).&quot;&quot;&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;span t-attf-data-tooltip-template=&quot;{{ test }}&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Error while validating view near:</span>

<span class="sd">&lt;kanban __validate__=&quot;1&quot;&gt;&lt;templates&gt;&lt;t t-name=&quot;kanban-box&quot;&gt;&lt;span t-attf-data-tooltip-template=&quot;{{ test }}&quot;/&gt;&lt;/t&gt;&lt;/templates&gt;&lt;/kanban&gt;</span>
<span class="sd">Forbidden attribute used in arch (t-attf-data-tooltip-template).&quot;&quot;&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestViews.test_forbidden_use_of___comp___in_kanban">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViews.test_forbidden_use_of___comp___in_kanban">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_forbidden_use_of___comp___in_kanban</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&lt;kanban&gt;&lt;templates&gt;&lt;t t-name=&#39;kanban-box&#39;&gt;</span><span class="si">%s</span><span class="s2">&lt;/t&gt;&lt;/templates&gt;&lt;/kanban&gt;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&lt;t t-esc=&quot;__comp__.props.resId&quot;/&gt;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Error while validating view near:</span>

<span class="sd">&lt;kanban __validate__=&quot;1&quot;&gt;&lt;templates&gt;&lt;t t-name=&quot;kanban-box&quot;&gt;&lt;t t-esc=&quot;__comp__.props.resId&quot;/&gt;&lt;/t&gt;&lt;/templates&gt;&lt;/kanban&gt;</span>
<span class="sd">Forbidden use of `__comp__` in arch.&quot;&quot;&quot;</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestDebugger">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestDebugger">[docs]</a>
<span class="nd">@tagged</span><span class="p">(</span><span class="s1">&#39;post_install&#39;</span><span class="p">,</span> <span class="s1">&#39;-at_install&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestDebugger</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestDebugger.test_t_debug_in_qweb_based_views">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestDebugger.test_t_debug_in_qweb_based_views">[docs]</a>
    <span class="k">def</span> <span class="nf">test_t_debug_in_qweb_based_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">View</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span>
        <span class="n">views_with_t_debug</span> <span class="o">=</span> <span class="n">View</span><span class="o">.</span><span class="n">search</span><span class="p">([[</span><span class="s2">&quot;arch_db&quot;</span><span class="p">,</span> <span class="s2">&quot;like&quot;</span><span class="p">,</span> <span class="s2">&quot;t-debug=&quot;</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">([</span><span class="n">v</span><span class="o">.</span><span class="n">xml_id</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">views_with_t_debug</span><span class="p">],</span> <span class="p">[])</span></div>
</div>



<div class="viewcode-block" id="TestViewTranslations">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewTranslations">[docs]</a>
<span class="k">class</span> <span class="nc">TestViewTranslations</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">TransactionCase</span><span class="p">):</span>
    <span class="c1"># these tests are essentially the same as in test_translate.py, but they use</span>
    <span class="c1"># the computed field &#39;arch&#39; instead of the translated field &#39;arch_db&#39;</span>

<div class="viewcode-block" id="TestViewTranslations.setUpClass">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewTranslations.setUpClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUpClass</span><span class="p">()</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="s1">&#39;nl_NL&#39;</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.module.module&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_load_module_terms</span><span class="p">([</span><span class="s1">&#39;base&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;fr_FR&#39;</span><span class="p">,</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">])</span></div>


<div class="viewcode-block" id="TestViewTranslations.create_view">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewTranslations.create_view">[docs]</a>
    <span class="k">def</span> <span class="nf">create_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">archf</span><span class="p">,</span> <span class="n">terms</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;res.partner&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="c1"># DLE P70: `_sync_terms_translations`, which delete translations for which there is no value, is called sooner than before</span>
        <span class="c1"># because it&#39;s called in `_write`, which is called by `flush`, which is called by the `search`.</span>
        <span class="c1"># `arch_db` is in `_write` instead of `create` because `arch_db` is the inverse of `arch`.</span>
        <span class="c1"># We need to flush `arch_db` before creating the translations otherwise the translation for which there is no value will be deleted,</span>
        <span class="c1"># while the `test_sync_update` specifically needs empty translations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">flush_all</span><span class="p">()</span>
        <span class="n">val</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;en_US&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">lang</span><span class="p">,</span> <span class="n">trans_terms</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">val</span><span class="p">[</span><span class="n">lang</span><span class="p">]</span> <span class="o">=</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">trans_terms</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;UPDATE ir_ui_view SET arch_db = </span><span class="si">%s</span><span class="s2"> WHERE id = </span><span class="si">%s</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">[</span><span class="n">Json</span><span class="p">(</span><span class="n">val</span><span class="p">),</span> <span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">invalidate_all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">view</span></div>


<div class="viewcode-block" id="TestViewTranslations.test_sync">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewTranslations.test_sync">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check translations of &#39;arch&#39; after minor change in source terms. &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheeze&#39;</span><span class="p">,)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain et fromage&#39;</span><span class="p">,)</span>
        <span class="n">terms_nl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Brood and kaas&#39;</span><span class="p">,)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>

        <span class="n">env_nolang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">env_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">})</span>
        <span class="n">env_fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="n">env_nl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># modify source term in view (fixed type in &#39;cheeze&#39;)</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>

        <span class="c1"># check whether translations have been synchronized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_fr</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>
        <span class="c1"># modify source term in view in another language with close term</span>
        <span class="n">new_terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pains et fromage&#39;</span><span class="p">,)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">new_terms_fr</span><span class="p">})</span>

        <span class="c1"># check whether translations have been synchronized</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">new_terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewTranslations.test_sync_xml">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewTranslations.test_sync_xml">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sync_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check translations of &#39;arch&#39; after xml tags changes in source terms. &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/form&gt;&#39;</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread and cheese&#39;</span><span class="p">,)</span>
        <span class="n">terms_fr</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Pain et fromage&#39;</span><span class="p">,)</span>
        <span class="n">terms_nl</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Brood and kaas&#39;</span><span class="p">,)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_en</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">,</span> <span class="n">fr_FR</span><span class="o">=</span><span class="n">terms_fr</span><span class="p">,</span> <span class="n">nl_NL</span><span class="o">=</span><span class="n">terms_nl</span><span class="p">)</span>

        <span class="n">env_nolang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{})</span>
        <span class="n">env_en</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">})</span>
        <span class="n">env_fr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;fr_FR&#39;</span><span class="p">})</span>
        <span class="n">env_nl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;nl_NL&#39;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># modify source term in view (add css style)</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread &lt;span style=&quot;font-weight:bold&quot;&gt;and&lt;/span&gt; cheese&#39;</span><span class="p">,)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>

        <span class="c1"># check whether translations have been kept</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_fr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_nl</span><span class="p">)</span>

        <span class="c1"># modify source term in view (actual text change)</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Bread &lt;span style=&quot;font-weight:bold&quot;&gt;and&lt;/span&gt; butter&#39;</span><span class="p">,)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">})</span>

        <span class="c1"># check whether translations have been reset</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nolang</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_en</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_fr</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">with_env</span><span class="p">(</span><span class="n">env_nl</span><span class="p">)</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">archf</span> <span class="o">%</span> <span class="n">terms_en</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewTranslations.test_sync_update">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewTranslations.test_sync_update">[docs]</a>
    <span class="k">def</span> <span class="nf">test_sync_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check translations after major changes in source terms. &quot;&quot;&quot;</span>
        <span class="n">archf</span> <span class="o">=</span> <span class="s1">&#39;&lt;form string=&quot;X&quot;&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;div&gt;</span><span class="si">%s</span><span class="s1">&lt;/div&gt;&lt;/form&gt;&#39;</span>
        <span class="n">terms_src</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Subtotal&#39;</span><span class="p">,</span> <span class="s1">&#39;Subtotal:&#39;</span><span class="p">)</span>
        <span class="n">terms_en</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Sub total:&#39;</span><span class="p">)</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_view</span><span class="p">(</span><span class="n">archf</span><span class="p">,</span> <span class="n">terms_src</span><span class="p">,</span> <span class="n">en_US</span><span class="o">=</span><span class="n">terms_en</span><span class="p">)</span>

        <span class="c1"># modifying the arch should sync existing translations without errors</span>
        <span class="n">new_arch</span> <span class="o">=</span> <span class="n">archf</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;Subtotal&#39;</span><span class="p">,</span> <span class="s1">&#39;Subtotal : &lt;br/&gt;&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;arch&quot;</span><span class="p">:</span> <span class="n">new_arch</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">arch</span><span class="p">,</span> <span class="n">new_arch</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewTranslations.test_cache_consistency">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewTranslations.test_cache_consistency">[docs]</a>
    <span class="k">def</span> <span class="nf">test_cache_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s2">&quot;ir.ui.view&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;test_translate_xml_cache_invalidation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;res.partner&quot;</span><span class="p">,</span>
            <span class="s2">&quot;arch&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;form&gt;&lt;b&gt;content&lt;/b&gt;&lt;/form&gt;&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view_fr</span> <span class="o">=</span> <span class="n">view</span><span class="o">.</span><span class="n">with_context</span><span class="p">({</span><span class="s2">&quot;lang&quot;</span><span class="p">:</span> <span class="s2">&quot;fr_FR&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;&quot;</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">arch_db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;&quot;</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">arch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;&quot;</span><span class="p">,</span> <span class="n">view_fr</span><span class="o">.</span><span class="n">arch_db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;b&gt;&quot;</span><span class="p">,</span> <span class="n">view_fr</span><span class="o">.</span><span class="n">arch</span><span class="p">)</span>

        <span class="c1"># write with no lang, and check consistency in other languages</span>
        <span class="n">view</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s2">&quot;arch&quot;</span><span class="p">:</span> <span class="s2">&quot;&lt;form&gt;&lt;i&gt;content&lt;/i&gt;&lt;/form&gt;&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;i&gt;&quot;</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">arch_db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;i&gt;&quot;</span><span class="p">,</span> <span class="n">view</span><span class="o">.</span><span class="n">arch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;i&gt;&quot;</span><span class="p">,</span> <span class="n">view_fr</span><span class="o">.</span><span class="n">arch_db</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;&lt;i&gt;&quot;</span><span class="p">,</span> <span class="n">view_fr</span><span class="o">.</span><span class="n">arch</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ViewModeField">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModeField">[docs]</a>
<span class="k">class</span> <span class="nc">ViewModeField</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This should probably, eventually, be folded back into other test case</span>
<span class="sd">    classes, integrating the test (or not) of the mode field to regular cases</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ViewModeField.testModeImplicitValue">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModeField.testModeImplicitValue">[docs]</a>
    <span class="k">def</span> <span class="nf">testModeImplicitValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; mode is auto-generated from inherit_id:</span>
<span class="sd">        * inherit_id -&gt; mode=extension</span>
<span class="sd">        * not inherit_id -&gt; mode=primary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;primary&#39;</span><span class="p">)</span>

        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;extension&#39;</span><span class="p">)</span>

        <span class="n">view2</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;primary&#39;</span><span class="p">)</span>

        <span class="n">view2</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;extension&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewModeField.testModeExplicit">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModeField.testModeExplicit">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">testModeExplicit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;primary&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;primary&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">IntegrityError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
                <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;extension&#39;</span><span class="p">,</span>
                <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span>
            <span class="p">})</span></div>


<div class="viewcode-block" id="ViewModeField.testPurePrimaryToExtension">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModeField.testPurePrimaryToExtension">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.sql_db&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">testPurePrimaryToExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A primary view with inherit_id=None can&#39;t be converted to extension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view_pure_primary</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span>
        <span class="p">})</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">IntegrityError</span><span class="p">):</span>
            <span class="n">view_pure_primary</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;extension&#39;</span><span class="p">})</span>
            <span class="n">view_pure_primary</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">flush_all</span><span class="p">()</span></div>


<div class="viewcode-block" id="ViewModeField.testInheritPrimaryToExtension">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModeField.testInheritPrimaryToExtension">[docs]</a>
    <span class="k">def</span> <span class="nf">testInheritPrimaryToExtension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A primary view with an inherit_id can be converted to extension</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span>
        <span class="p">})</span>

        <span class="n">view</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;extension&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="ViewModeField.testDefaultExtensionToPrimary">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModeField.testDefaultExtensionToPrimary">[docs]</a>
    <span class="k">def</span> <span class="nf">testDefaultExtensionToPrimary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        An extension view can be converted to primary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">base</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span>
        <span class="p">})</span>

        <span class="n">view</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">})</span></div>


<div class="viewcode-block" id="ViewModeField.testChangeInheritOfPrimary">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModeField.testChangeInheritOfPrimary">[docs]</a>
    <span class="k">def</span> <span class="nf">testChangeInheritOfPrimary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A primary view with an inherit_id must remain primary when changing the inherit_id</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">base2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">base1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;primary&#39;</span><span class="p">)</span>
        <span class="n">view</span><span class="o">.</span><span class="n">write</span><span class="p">({</span><span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">base2</span><span class="o">.</span><span class="n">id</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;primary&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestDefaultView">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestDefaultView">[docs]</a>
<span class="k">class</span> <span class="nc">TestDefaultView</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestDefaultView.testDefaultViewBase">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestDefaultView.testDefaultViewBase">[docs]</a>
    <span class="k">def</span> <span class="nf">testDefaultViewBase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">default_view</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;qweb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">default</span><span class="p">,</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">&quot;default_view should get the view with the lowest priority for &quot;</span>
            <span class="s2">&quot;a (model, view_type) pair&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestDefaultView.testDefaultViewPrimary">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestDefaultView.testDefaultViewPrimary">[docs]</a>
    <span class="k">def</span> <span class="nf">testDefaultViewPrimary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">view3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">default_view</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;qweb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">default</span><span class="p">,</span> <span class="n">view3</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">&quot;default_view should get the view with the lowest priority for &quot;</span>
            <span class="s2">&quot;a (model, view_type) pair in all the primary tables&quot;</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestViewCombined">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewCombined">[docs]</a>
<span class="k">class</span> <span class="nc">TestViewCombined</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    * When asked for a view, instead of looking for the closest parent with</span>
<span class="sd">      inherit_id=False look for mode=primary</span>
<span class="sd">    * If root.inherit_id, resolve the arch for root.inherit_id (?using which</span>
<span class="sd">      model?), then apply root&#39;s inheritance specs to it</span>
<span class="sd">    * Apply inheriting views on top</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestViewCombined.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewCombined.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestViewCombined</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">a1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb&gt;&lt;a1/&gt;&lt;/qweb&gt;&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//a1&quot; position=&quot;after&quot;&gt;&lt;a2/&gt;&lt;/xpath&gt;&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//a1&quot; position=&quot;after&quot;&gt;&lt;a3/&gt;&lt;/xpath&gt;&#39;</span>
        <span class="p">})</span>
        <span class="c1"># mode=primary should be an inheritance boundary in both direction,</span>
        <span class="c1"># even within a model it should not extend the parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//a1&quot; position=&quot;after&quot;&gt;&lt;a4/&gt;&lt;/xpath&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//a1&quot; position=&quot;after&quot;&gt;&lt;b1/&gt;&lt;/xpath&gt;&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">b1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//a1&quot; position=&quot;after&quot;&gt;&lt;b2/&gt;&lt;/xpath&gt;&#39;</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">c1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//a1&quot; position=&quot;after&quot;&gt;&lt;c1/&gt;&lt;/xpath&gt;&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">c1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//a1&quot; position=&quot;after&quot;&gt;&lt;c2/&gt;&lt;/xpath&gt;&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//a1&quot; position=&quot;after&quot;&gt;&lt;c3/&gt;&lt;/xpath&gt;&#39;</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">b1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//a1&quot; position=&quot;after&quot;&gt;&lt;d1/&gt;&lt;/xpath&gt;&#39;</span>
        <span class="p">})</span></div>


<div class="viewcode-block" id="TestViewCombined.test_basic_read">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewCombined.test_basic_read">[docs]</a>
    <span class="k">def</span> <span class="nf">test_basic_read</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_view_ids&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">ids</span><span class="p">}</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">qweb</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a3</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a2</span><span class="p">(),</span>
            <span class="p">),</span> <span class="n">arch</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewCombined.test_read_from_child">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewCombined.test_read_from_child">[docs]</a>
    <span class="k">def</span> <span class="nf">test_read_from_child</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_view_ids&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">ids</span><span class="p">}</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a3</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">qweb</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a3</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a2</span><span class="p">(),</span>
            <span class="p">),</span> <span class="n">arch</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewCombined.test_read_from_child_primary">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewCombined.test_read_from_child_primary">[docs]</a>
    <span class="k">def</span> <span class="nf">test_read_from_child_primary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_view_ids&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">ids</span><span class="p">}</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a4</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">qweb</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a4</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a3</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a2</span><span class="p">(),</span>
            <span class="p">),</span> <span class="n">arch</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewCombined.test_cross_model_simple">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewCombined.test_cross_model_simple">[docs]</a>
    <span class="k">def</span> <span class="nf">test_cross_model_simple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_view_ids&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">ids</span><span class="p">}</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">c2</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">qweb</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">c3</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">c2</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">c1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a3</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a2</span><span class="p">(),</span>
            <span class="p">),</span> <span class="n">arch</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewCombined.test_cross_model_double">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewCombined.test_cross_model_double">[docs]</a>
    <span class="k">def</span> <span class="nf">test_cross_model_double</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_view_ids&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">ids</span><span class="p">}</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d1</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">qweb</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">d1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">b2</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">b1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a3</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">a2</span><span class="p">(),</span>
            <span class="p">),</span> <span class="n">arch</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestViewCombined.test_primary_after_extensions">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestViewCombined.test_primary_after_extensions">[docs]</a>
    <span class="k">def</span> <span class="nf">test_primary_after_extensions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Here is a tricky use-case:                        a*</span>
        <span class="c1">#  - views a and d are primary                     / \</span>
        <span class="c1">#  - views b and c are extensions                 b   c</span>
        <span class="c1">#  - depth-first order is: a, b, d, c             |</span>
        <span class="c1">#  - combination order is: a, b, c, d             d*</span>
        <span class="c1">#</span>
        <span class="c1"># The arch of d has been chosen to fail if d is applied before c.</span>
        <span class="c1"># Because this child of &#39;b&#39; is primary, it must be applied *after* the</span>
        <span class="c1"># other extensions of a!</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb&gt;&lt;a/&gt;&lt;/qweb&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;a position=&quot;after&quot;&gt;&lt;b/&gt;&lt;/a&gt;&#39;</span>
        <span class="p">})</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>  <span class="c1"># pylint: disable=unused-variable</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;a position=&quot;after&quot;&gt;&lt;c/&gt;&lt;/a&gt;&#39;</span>
        <span class="p">})</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>  <span class="c1"># pylint: disable=unused-variable</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;a position=&quot;replace&quot;/&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span></div>
</div>



<div class="viewcode-block" id="TestOptionalViews">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestOptionalViews">[docs]</a>
<span class="k">class</span> <span class="nc">TestOptionalViews</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tests ability to enable/disable inherited views, formerly known as</span>
<span class="sd">    inherit_option_id</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestOptionalViews.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestOptionalViews.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestOptionalViews</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;qweb&gt;&lt;base/&gt;&lt;/qweb&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//base&quot; position=&quot;after&quot;&gt;&lt;v1/&gt;&lt;/xpath&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">9</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//base&quot; position=&quot;after&quot;&gt;&lt;v2/&gt;&lt;/xpath&gt;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;active&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;priority&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;xpath expr=&quot;//base&quot; position=&quot;after&quot;&gt;&lt;v3/&gt;&lt;/xpath&gt;&#39;</span>
        <span class="p">})</span></div>


<div class="viewcode-block" id="TestOptionalViews.test_applied">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestOptionalViews.test_applied">[docs]</a>
    <span class="k">def</span> <span class="nf">test_applied</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; mandatory and enabled views should be applied</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_view_ids&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">ids</span><span class="p">}</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">qweb</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">base</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">v1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">v2</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestOptionalViews.test_applied_state_toggle">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestOptionalViews.test_applied_state_toggle">[docs]</a>
    <span class="k">def</span> <span class="nf">test_applied_state_toggle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Change active states of v2 and v3, check that the results</span>
<span class="sd">        are as expected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">toggle_active</span><span class="p">()</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_view_ids&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">ids</span><span class="p">}</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">qweb</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">base</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">v1</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">v3</span><span class="o">.</span><span class="n">toggle_active</span><span class="p">()</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_view_ids&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">ids</span><span class="p">}</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">qweb</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">base</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">v1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">v3</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">v2</span><span class="o">.</span><span class="n">toggle_active</span><span class="p">()</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;check_view_ids&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span><span class="o">.</span><span class="n">ids</span><span class="p">}</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">v0</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get_combined_arch</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">qweb</span><span class="p">(</span>
                <span class="n">E</span><span class="o">.</span><span class="n">base</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">v1</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">v2</span><span class="p">(),</span>
                <span class="n">E</span><span class="o">.</span><span class="n">v3</span><span class="p">(),</span>
            <span class="p">)</span>
        <span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestXPathExtentions">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestXPathExtentions">[docs]</a>
<span class="k">class</span> <span class="nc">TestXPathExtentions</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">BaseCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestXPathExtentions.test_hasclass">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestXPathExtentions.test_hasclass">[docs]</a>
    <span class="k">def</span> <span class="nf">test_hasclass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">E</span><span class="o">.</span><span class="n">node</span><span class="p">(</span>
            <span class="n">E</span><span class="o">.</span><span class="n">node</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;foo bar baz&#39;</span><span class="p">}),</span>
            <span class="n">E</span><span class="o">.</span><span class="n">node</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;foo bar&#39;</span><span class="p">}),</span>
            <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s2">&quot;foo&quot;</span><span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//node[hasclass(&quot;foo&quot;)]&#39;</span><span class="p">)),</span>
            <span class="mi">3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//node[hasclass(&quot;bar&quot;)]&#39;</span><span class="p">)),</span>
            <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//node[hasclass(&quot;baz&quot;)]&#39;</span><span class="p">)),</span>
            <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//node[hasclass(&quot;foo&quot;)][not(hasclass(&quot;bar&quot;))]&#39;</span><span class="p">)),</span>
            <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//node[hasclass(&quot;foo&quot;, &quot;baz&quot;)]&#39;</span><span class="p">)),</span>
            <span class="mi">1</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestQWebRender">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestQWebRender">[docs]</a>
<span class="k">class</span> <span class="nc">TestQWebRender</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestQWebRender.test_render">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestQWebRender.test_render">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div&gt;&lt;span&gt;something&lt;/span&gt;&lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy_ext&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;xpath expr=&quot;//div&quot; position=&quot;inside&quot;&gt;</span>
<span class="s2">                    &lt;span&gt;another thing&lt;/span&gt;</span>
<span class="s2">                &lt;/xpath&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">view3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy_primary_ext&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;xpath expr=&quot;//div&quot; position=&quot;inside&quot;&gt;</span>
<span class="s2">                    &lt;span&gt;another primary thing&lt;/span&gt;</span>
<span class="s2">                &lt;/xpath&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="c1"># render view and child view with an id</span>
        <span class="n">content1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">content2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">content1</span><span class="p">,</span> <span class="n">content2</span><span class="p">)</span>

        <span class="c1"># render view and child view with an xmlid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ir_model_data(name, model, res_id, module)&quot;</span>
                            <span class="s2">&quot;VALUES (&#39;dummy&#39;, &#39;ir.ui.view&#39;, </span><span class="si">%s</span><span class="s2">, &#39;base&#39;)&quot;</span> <span class="o">%</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ir_model_data(name, model, res_id, module)&quot;</span>
                            <span class="s2">&quot;VALUES (&#39;dummy_ext&#39;, &#39;ir.ui.view&#39;, </span><span class="si">%s</span><span class="s2">, &#39;base&#39;)&quot;</span> <span class="o">%</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">content1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="s1">&#39;base.dummy&#39;</span><span class="p">)</span>
        <span class="n">content2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="s1">&#39;base.dummy_ext&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">content1</span><span class="p">,</span> <span class="n">content2</span><span class="p">)</span>

        <span class="c1"># render view and primary extension with an id</span>
        <span class="n">content1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view3</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">content3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view3</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">content1</span><span class="p">,</span> <span class="n">content3</span><span class="p">)</span>

        <span class="c1"># render view and primary extension with an xmlid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ir_model_data(name, model, res_id, module)&quot;</span>
                            <span class="s2">&quot;VALUES (&#39;dummy_primary_ext&#39;, &#39;ir.ui.view&#39;, </span><span class="si">%s</span><span class="s2">, &#39;base&#39;)&quot;</span> <span class="o">%</span> <span class="n">view3</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">content1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view3</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="s1">&#39;base.dummy&#39;</span><span class="p">)</span>
        <span class="n">content3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view3</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="s1">&#39;base.dummy_primary_ext&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertNotEqual</span><span class="p">(</span><span class="n">content1</span><span class="p">,</span> <span class="n">content3</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestValidationTools">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestValidationTools">[docs]</a>
<span class="k">class</span> <span class="nc">TestValidationTools</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">BaseCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestValidationTools.test_get_expression_identities">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestValidationTools.test_get_expression_identities">[docs]</a>
    <span class="k">def</span> <span class="nf">test_get_expression_identities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view_validation</span><span class="o">.</span><span class="n">get_expression_field_names</span><span class="p">(</span><span class="s2">&quot;context_today().strftime(&#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;)&quot;</span><span class="p">),</span>
            <span class="nb">set</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view_validation</span><span class="o">.</span><span class="n">get_expression_field_names</span><span class="p">(</span><span class="s2">&quot;field and field[0] or not field2&quot;</span><span class="p">),</span>
            <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">,</span> <span class="s1">&#39;field2&#39;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view_validation</span><span class="o">.</span><span class="n">get_expression_field_names</span><span class="p">(</span><span class="s2">&quot;context_today().strftime(&#39;%Y-%m-</span><span class="si">%d</span><span class="s2">&#39;) or field&quot;</span><span class="p">),</span>
            <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view_validation</span><span class="o">.</span><span class="n">get_expression_field_names</span><span class="p">(</span><span class="s2">&quot;(datetime.datetime.combine(context_today(), datetime.time(x,y,z)).to_utc()).strftime(&#39;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&#39;)&quot;</span><span class="p">),</span>
            <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">view_validation</span><span class="o">.</span><span class="n">get_expression_field_names</span><span class="p">(</span><span class="s2">&quot;set(field).intersection([1, 2])&quot;</span><span class="p">),</span>
            <span class="p">{</span><span class="s1">&#39;field&#39;</span><span class="p">},</span>
        <span class="p">)</span></div>
</div>


<div class="viewcode-block" id="TestAccessRights">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestAccessRights">[docs]</a>
<span class="k">class</span> <span class="nc">TestAccessRights</span><span class="p">(</span><span class="n">TransactionCaseWithUserDemo</span><span class="p">):</span>

<div class="viewcode-block" id="TestAccessRights.test_access">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestAccessRights.test_access">[docs]</a>
    <span class="nd">@common</span><span class="o">.</span><span class="n">users</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_access</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># a user can not access directly a view</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">AccessError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s2">&quot;res.partner&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;form&#39;</span><span class="p">)])</span>

        <span class="c1"># but can call view_get</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_type</span><span class="o">=</span><span class="s1">&#39;form&#39;</span><span class="p">)</span>

        <span class="c1"># unless he does not have access to the model</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">AccessError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_type</span><span class="o">=</span><span class="s1">&#39;form&#39;</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="TestAllViews">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestAllViews">[docs]</a>
<span class="nd">@common</span><span class="o">.</span><span class="n">tagged</span><span class="p">(</span><span class="s1">&#39;post_install&#39;</span><span class="p">,</span> <span class="s1">&#39;-at_install&#39;</span><span class="p">,</span> <span class="s1">&#39;-standard&#39;</span><span class="p">,</span> <span class="s1">&#39;migration&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestAllViews</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestAllViews.test_views">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestAllViews.test_views">[docs]</a>
    <span class="k">def</span> <span class="nf">test_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">views</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">([])</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">view</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">views</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">%</span> <span class="mi">500</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;checked </span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1"> views&#39;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">views</span><span class="p">))</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
                <span class="n">view</span><span class="o">.</span><span class="n">_check_xml</span><span class="p">()</span></div>
</div>


<div class="viewcode-block" id="TestRenderAllViews">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestRenderAllViews">[docs]</a>
<span class="nd">@common</span><span class="o">.</span><span class="n">tagged</span><span class="p">(</span><span class="s1">&#39;post_install&#39;</span><span class="p">,</span> <span class="s1">&#39;-at_install&#39;</span><span class="p">,</span> <span class="s1">&#39;-standard&#39;</span><span class="p">,</span> <span class="s1">&#39;render_all_views&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestRenderAllViews</span><span class="p">(</span><span class="n">TransactionCaseWithUserDemo</span><span class="p">):</span>

<div class="viewcode-block" id="TestRenderAllViews.test_render_all_views">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.TestRenderAllViews.test_render_all_views">[docs]</a>
    <span class="nd">@common</span><span class="o">.</span><span class="n">users</span><span class="p">(</span><span class="s1">&#39;demo&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_render_all_views</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">env</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;lang&#39;</span><span class="p">:</span> <span class="s1">&#39;en_US&#39;</span><span class="p">})</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">elapsed</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">env</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">model</span><span class="o">.</span><span class="n">_abstract</span> <span class="ow">and</span> <span class="n">model</span><span class="o">.</span><span class="n">check_access_rights</span><span class="p">(</span><span class="s1">&#39;read&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">):</span>
                    <span class="n">times</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
                        <span class="n">env</span><span class="o">.</span><span class="n">invalidate_all</span><span class="p">()</span>
                        <span class="n">before</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
                        <span class="n">model</span><span class="o">.</span><span class="n">get_view</span><span class="p">()</span>
                        <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span> <span class="o">-</span> <span class="n">before</span><span class="p">)</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">elapsed</span> <span class="o">+=</span> <span class="nb">min</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>

        <span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Rendered </span><span class="si">%d</span><span class="s1"> views as </span><span class="si">%s</span><span class="s1"> using (best of 5) </span><span class="si">%s</span><span class="s1">s&#39;</span><span class="p">,</span>
            <span class="n">count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">elapsed</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="CompRegexTest">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.CompRegexTest">[docs]</a>
<span class="k">class</span> <span class="nc">CompRegexTest</span><span class="p">(</span><span class="n">common</span><span class="o">.</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="CompRegexTest.test_comp_regex">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.CompRegexTest.test_comp_regex">[docs]</a>
    <span class="k">def</span> <span class="nf">test_comp_regex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;__comp__2&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;__comp___that&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;a__comp__&quot;</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;__comp__&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;__comp__ &quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot; __comp__ &quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;__comp__.props&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;__comp__ .props&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;__comp__[&#39;props&#39;]&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;__comp__ [&#39;props&#39;]&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;__comp__[</span><span class="se">\&quot;</span><span class="s2">props</span><span class="se">\&quot;</span><span class="s2">]&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;__comp__ [</span><span class="se">\&quot;</span><span class="s2">props</span><span class="se">\&quot;</span><span class="s2">]&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;    __comp__     [</span><span class="se">\&quot;</span><span class="s2">props</span><span class="se">\&quot;</span><span class="s2">]    &quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;record ? __comp__ : false&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;!__comp__.props.resId&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIsNotNone</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">ir_ui_view</span><span class="o">.</span><span class="n">COMP_REGEX</span><span class="p">,</span> <span class="s2">&quot;{{ __comp__ }}&quot;</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="ViewModifiers">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers">[docs]</a>
<span class="nd">@common</span><span class="o">.</span><span class="n">tagged</span><span class="p">(</span><span class="s1">&#39;at_install&#39;</span><span class="p">,</span> <span class="s1">&#39;modifiers&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ViewModifiers</span><span class="p">(</span><span class="n">ViewCase</span><span class="p">):</span>

<div class="viewcode-block" id="ViewModifiers.test_01_modifiers">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_01_modifiers">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_01_modifiers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">_test_modifiers</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="n">expected_vnames</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;field&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">what</span><span class="o">.</span><span class="n">items</span><span class="p">()})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">what</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">what</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">what</span>
            <span class="n">modifiers</span> <span class="o">=</span> <span class="p">{</span><span class="n">attr</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="n">attr</span><span class="p">]</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">attrib</span> <span class="k">if</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">ir_ui_view</span><span class="o">.</span><span class="n">VIEW_MODIFIERS</span><span class="p">}</span>
            <span class="n">vnames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">modifiers</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">vnames</span> <span class="o">|=</span> <span class="n">view_validation</span><span class="o">.</span><span class="n">get_expression_field_names</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span> <span class="o">-</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">}</span>
            <span class="k">assert</span> <span class="n">vnames</span> <span class="o">==</span> <span class="n">expected_vnames</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">vnames</span><span class="si">!r}</span><span class="s2"> != </span><span class="si">{</span><span class="n">expected_vnames</span><span class="si">!r}</span><span class="s2">&quot;</span>

        <span class="n">str_true</span> <span class="o">=</span> <span class="s2">&quot;True&quot;</span>

        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;a&quot;/&gt;&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;a&quot; invisible=&quot;1&quot;/&gt;&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;a&quot; readonly=&quot;1&quot;/&gt;&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;a&quot; required=&quot;1&quot;/&gt;&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;a&quot; invisible=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;a&quot; readonly=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;a&quot; required=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span>
        <span class="c1"># TODO: Order is not guaranteed</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;a&quot; invisible=&quot;1&quot; required=&quot;1&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="nb">set</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;a&quot; invisible=&quot;1&quot; required=&quot;0&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="nb">set</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;a&quot; invisible=&quot;0&quot; required=&quot;1&quot;/&gt;&#39;</span><span class="p">,</span>
            <span class="nb">set</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;b == &#39;c&#39;&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;b == &#39;c&#39;&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;b == &#39;c&#39;&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;(b == &#39;c&#39; or e == &#39;f&#39;)&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;b == &#39;c&#39;&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;user_id == uid&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;(user_id == other_field)&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;other_field&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;a == parent.b&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;parent.b&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;a == context.get(&#39;b&#39;)&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;a == context[&#39;b&#39;]&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;company_id == allowed_company_ids[0]&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;company_id&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;field name=&quot;a&quot; invisible=&quot;company_id == (field_1 or False)&quot;/&gt;&quot;&quot;&quot;</span><span class="p">,</span>
            <span class="p">{</span><span class="s2">&quot;company_id&quot;</span><span class="p">,</span> <span class="s2">&quot;field_1&quot;</span><span class="p">},</span>
        <span class="p">)</span>

        <span class="c1"># fields in a tree view</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            &lt;tree&gt;</span>
<span class="s1">                &lt;header&gt;</span>
<span class="s1">                    &lt;button name=&quot;a&quot; invisible=&quot;1&quot;/&gt;</span>
<span class="s1">                &lt;/header&gt;</span>
<span class="s1">                &lt;field name=&quot;a&quot;/&gt;</span>
<span class="s1">                &lt;field name=&quot;a&quot; invisible=&quot;0&quot;/&gt;</span>
<span class="s1">                &lt;field name=&quot;a&quot; column_invisible=&quot;1&quot;/&gt;</span>
<span class="s1">                &lt;field name=&quot;a&quot; invisible=&quot;b == &#39;c&#39;&quot;/&gt;</span>
<span class="s1">                &lt;field name=&quot;a&quot; invisible=&quot;(b == &#39;c&#39;)&quot;/&gt;</span>
<span class="s1">            &lt;/tree&gt;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">})</span>
        <span class="n">_test_modifiers</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;b&quot;</span><span class="p">})</span>

        <span class="c1"># The dictionary is supposed to be the result of fields_get().</span>
        <span class="n">_test_modifiers</span><span class="p">({},</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">({</span><span class="s2">&quot;invisible&quot;</span><span class="p">:</span> <span class="n">str_true</span><span class="p">},</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">_test_modifiers</span><span class="p">({</span><span class="s2">&quot;invisible&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span> <span class="nb">set</span><span class="p">())</span></div>


<div class="viewcode-block" id="ViewModifiers.test_03_modifier_attribute_is_boolean">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_03_modifier_attribute_is_boolean">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_03_modifier_attribute_is_boolean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;model&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; readonly=&quot;</span><span class="si">%s</span><span class="s2">&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;True&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s2">&quot;[(&#39;model&#39;, &#39;=&#39;, &#39;1&#39;)]&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewModifiers.test_04_modifier_attribute_using_context">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_04_modifier_attribute_using_context">[docs]</a>
    <span class="k">def</span> <span class="nf">test_04_modifier_attribute_using_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;</span>
<span class="s2">                    invisible=&quot;context.get(&#39;foo&#39;)&quot;</span>
<span class="s2">                    readonly=&quot;context.get(&#39;bar&#39;)&quot;</span>
<span class="s2">                    required=&quot;context.get(&#39;baz&#39;)&quot;</span>
<span class="s2">                /&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">foo</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="s1">&#39;arch&#39;</span><span class="p">]</span>
        <span class="n">field_node</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;name&quot;]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">field_node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;invisible&#39;</span><span class="p">),</span> <span class="s2">&quot;context.get(&#39;foo&#39;)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">field_node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;readonly&#39;</span><span class="p">),</span> <span class="s2">&quot;context.get(&#39;bar&#39;)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">field_node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;required&#39;</span><span class="p">),</span> <span class="s2">&quot;context.get(&#39;baz&#39;)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewModifiers.test_05_modifier_attribute_priority">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_05_modifier_attribute_priority">[docs]</a>
    <span class="k">def</span> <span class="nf">test_05_modifier_attribute_priority</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;type&quot; invisible=&quot;1&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; invisible=&quot;context.get(&#39;foo&#39;) and type == &#39;tree&#39;&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">type_value</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">expected</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="p">{},</span> <span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;form&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;foo&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">]:</span>
            <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="o">**</span><span class="n">context</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="s1">&#39;arch&#39;</span><span class="p">]</span>
            <span class="n">field_node</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;name&quot;]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">field_node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;invisible&#39;</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">safe_eval</span><span class="o">.</span><span class="n">safe_eval</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;context&#39;</span><span class="p">:</span> <span class="n">context</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">type_value</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="n">expected</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;With context: </span><span class="si">{</span><span class="n">context</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewModifiers.test_10_raise_for_old_attributes">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_10_raise_for_old_attributes">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_10_raise_for_old_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;model&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; attrs=&quot;{&#39;readonly&#39;: [(&#39;model&#39;, &#39;=&#39;, &#39;ir.ui.view&#39;)]&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;no longer used&quot;&quot;&quot;</span><span class="p">)</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;model&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; states=&quot;draft,done&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;no longer used&quot;&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewModifiers.test_11_attrs_field">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_11_attrs_field">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_11_attrs_field</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot;</span>
<span class="s2">                       readonly=&quot;model == &#39;ir.ui.view&#39;&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in modifier &#39;readonly&#39; (model == &#39;ir.ui.view&#39;) must be present in view but is missing&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ViewModifiers.test_12_invalid_syntax">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_12_invalid_syntax">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_12_invalid_syntax</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;model&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot;</span>
<span class="s2">                       readonly=&quot;model &#39;ir.ui.view&#39;&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Invalid modifier &#39;readonly&#39;&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;model&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot;</span>
<span class="s2">                       readonly=&quot;bidule.get(&#39;truc&#39;) or context.get(&#39;truc&#39;)&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;bidule&#39; used in modifier &#39;readonly&#39; (bidule.get(&#39;truc&#39;) or context.get(&#39;truc&#39;)) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;model&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot;</span>
<span class="s2">                       readonly=&quot;context.get(&#39;truc&#39;) or bidule.get(&#39;toto&#39;)&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span><span class="p">,</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;must be present in view but is missing&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ViewModifiers.test_13_attrs_states_invisible_to_modifier">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_13_attrs_states_invisible_to_modifier">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_13_attrs_states_invisible_to_modifier</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.module.module&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                    &lt;group invisible=&quot;state != &#39;finished&#39;&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;category_id&quot; invisible=&quot;not state&quot; /&gt;</span>
<span class="s2">                        &lt;field name=&quot;state&quot; invisible=&quot;name not in [&#39;qweb-pdf&#39;, &#39;qweb-html&#39;, &#39;qweb-text&#39;]&quot;/&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot; invisible=&quot;name != &#39;bidule&#39; and category_id != uid and state not in (&#39;draf&#39;, &#39;finished&#39;)&quot;/&gt;</span>
<span class="s2">                    &lt;/group&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.module.module&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_id</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="s1">&#39;arch&#39;</span><span class="p">]</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>

        <span class="n">invisible</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//group&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;invisible&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">invisible</span><span class="p">,</span> <span class="s2">&quot;state != &#39;finished&#39;&quot;</span><span class="p">)</span>

        <span class="n">invisible</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;category_id&quot;]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;invisible&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">invisible</span><span class="p">,</span> <span class="s2">&quot;not state&quot;</span><span class="p">)</span>

        <span class="n">invisible</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;state&quot;]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;invisible&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">invisible</span><span class="p">,</span> <span class="s2">&quot;name not in [&#39;qweb-pdf&#39;, &#39;qweb-html&#39;, &#39;qweb-text&#39;]&quot;</span><span class="p">)</span>

        <span class="n">invisible</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;name&quot;]&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;invisible&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">invisible</span><span class="p">,</span> <span class="s2">&quot;name != &#39;bidule&#39; and category_id != uid and state not in (&#39;draf&#39;, &#39;finished&#39;)&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="ViewModifiers.test_14_attrs_subfield">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_14_attrs_subfield">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_14_attrs_subfield</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot;</span>
<span class="s2">                               readonly=&quot;model == &#39;ir.ui.view&#39;&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in modifier &#39;readonly&#39; (model == &#39;ir.ui.view&#39;) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in modifier &#39;readonly&#39; (model == &#39;ir.ui.view&#39;) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ViewModifiers.test_15_attrs_subfield_with_parent">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_15_attrs_subfield_with_parent">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_15_attrs_subfield_with_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;form string=&quot;Children&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;name&quot;/&gt;</span><span class="si">%s</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot;</span>
<span class="s2">                               readonly=&quot;parent.model == &#39;ir.ui.view&#39;&quot;/&gt;</span>
<span class="s2">                    &lt;/form&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in modifier &#39;readonly&#39; (parent.model == &#39;ir.ui.view&#39;) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
            <span class="n">arch</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;field name=&quot;model&quot;/&gt;&#39;</span><span class="p">),</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Field &#39;model&#39; used in modifier &#39;readonly&#39; (parent.model == &#39;ir.ui.view&#39;) must be present in view but is missing.&quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="ViewModifiers.test_16_attrs_groups_behavior">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_16_attrs_groups_behavior">[docs]</a>
    <span class="k">def</span> <span class="nf">test_16_attrs_groups_behavior</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">View</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;res.partner&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;form&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;company_id&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                    &lt;div id=&quot;foo&quot;/&gt;</span>
<span class="s2">                    &lt;div id=&quot;bar&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;/form&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">user_demo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_demo</span>
        <span class="c1"># Make sure demo doesn&#39;t have the base.group_system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="n">user_demo</span><span class="p">)</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_group</span><span class="p">(</span><span class="s1">&#39;base.group_system&#39;</span><span class="p">))</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="n">user_demo</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_id</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="s1">&#39;arch&#39;</span><span class="p">]</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;name&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;company_id&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&quot;foo&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&quot;bar&quot;]&#39;</span><span class="p">))</span>

        <span class="n">user_admin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;base.user_admin&#39;</span><span class="p">)</span>
        <span class="c1"># Make sure admin has the base.group_system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="n">user_admin</span><span class="p">)</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">has_group</span><span class="p">(</span><span class="s1">&#39;base.group_system&#39;</span><span class="p">))</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="n">user_admin</span><span class="p">)</span><span class="o">.</span><span class="n">get_view</span><span class="p">(</span><span class="n">view_id</span><span class="o">=</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)[</span><span class="s1">&#39;arch&#39;</span><span class="p">]</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">arch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;name&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//field[@name=&quot;company_id&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&quot;foo&quot;]&#39;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//div[@id=&quot;bar&quot;]&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="ViewModifiers.test_17_attrs_groups_validation">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_views.ViewModifiers.test_17_attrs_groups_validation">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_ui_view&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_17_attrs_groups_validation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="s1">&#39;parent.&#39;</span> <span class="k">if</span> <span class="n">parent</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;invisible=&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;&quot; &quot;&quot;&quot;</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;domain=&quot;[(&#39;name&#39;, &#39;!=&#39;, </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name)]&quot; &quot;&quot;&quot;</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;context=&quot;</span><span class="se">{{</span><span class="s2">&#39;default_name&#39;: </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name</span><span class="se">}}</span><span class="s2">&quot; &quot;&quot;&quot;</span><span class="p">})</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertValid</span><span class="p">(</span><span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;decoration-info=&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;&quot; &quot;&quot;&quot;</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
                    <span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;invisible=&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;&quot; &quot;&quot;&quot;</span><span class="p">},</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Field &#39;name&#39; used in modifier &#39;invisible&#39; (</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;) is restricted to the group(s)&quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
                    <span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;domain=&quot;[(&#39;name&#39;, &#39;!=&#39;, </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name)]&quot; &quot;&quot;&quot;</span><span class="p">},</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Field &#39;name&#39; used in domain of &lt;field name=&quot;inherit_id&quot;&gt; ([(&#39;name&#39;, &#39;!=&#39;, </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name)]) is restricted to the group(s)&quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
                    <span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;context=&quot;</span><span class="se">{{</span><span class="s2">&#39;default_name&#39;: </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name</span><span class="se">}}</span><span class="s2">&quot; &quot;&quot;&quot;</span><span class="p">},</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Field &#39;name&#39; used in context (</span><span class="se">{{</span><span class="s2">&#39;default_name&#39;: </span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name</span><span class="se">}}</span><span class="s2">) is restricted to the group(s)&quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertInvalid</span><span class="p">(</span>
                    <span class="n">arch</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;attrs&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;decoration-info=&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;&quot; &quot;&quot;&quot;</span><span class="p">},</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Field &#39;name&#39; used in decoration-info=&quot;</span><span class="si">{</span><span class="n">parent</span><span class="si">}</span><span class="s2">name == &#39;foo&#39;&quot; is restricted to the group(s)&quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">)</span>


        <span class="c1"># Assert using a field restricted to a group</span>
        <span class="c1"># in another field without the same group is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field without the same group is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field with the same group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field available for everyone</span>
        <span class="c1"># in a child field restricted to a group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field available for everyone</span>
        <span class="c1"># in another field restricted to a group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2"> groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a group</span>
        <span class="c1"># in another field with the same group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field available twice for 2 diffent groups</span>
        <span class="c1"># in another field restricted to one of the 2 groups is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_portal&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a group only</span>
        <span class="c1"># in other fields restricted to at least one different group is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_portal&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field available twice for 2 different groups</span>
        <span class="c1"># in other fields restricted to the same 2 group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_portal&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_portal&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field available for 2 diffent groups,</span>
        <span class="c1"># in another field restricted to one of the 2 groups is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_portal,base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field available for 1 group only</span>
        <span class="c1"># in another field restricted 2 groups is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_portal,base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a group</span>
        <span class="c1"># in another field restricted to a group including the group for which the field is available is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_erp_manager&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field restricted to a group including the group for which the field is available is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_erp_manager&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a group</span>
        <span class="c1"># in another field restricted to a group not including the group for which the field is available is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_erp_manager&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field restricted to a group not including the group for which the field is available is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_erp_manager&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field not restricted to the same group is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field within the same block restricted to a group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field within the same block restricted to a group and additional groups on the field node is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2"> groups=&quot;base.group_multi_currency,base.group_multi_company&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field within a block restricted to the same group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field within a block restricted to a group including the group for which the field is available</span>
        <span class="c1"># is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_erp_manager&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field within a block restricted to a group</span>
        <span class="c1"># in another field within a block restricted to a group not including the group for which the field is available</span>
        <span class="c1"># is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_erp_manager&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field under a relational field restricted to the same group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot; groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field under a relational field restricted</span>
        <span class="c1"># to a group including the group for which the field is available is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_erp_manager&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot; groups=&quot;base.group_system&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a parent field restricted to a group</span>
        <span class="c1"># in a child field under a relational field restricted</span>
        <span class="c1"># to a group not including the group for which the field is available is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_children_ids&quot; groups=&quot;base.group_erp_manager&quot;&gt;</span>
<span class="s2">                    &lt;tree editable=&quot;bottom&quot;&gt;</span>
<span class="s2">                        &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                    &lt;/tree&gt;</span>
<span class="s2">                &lt;/field&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to users not having a group</span>
        <span class="c1"># in another field not restricted to any group is invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field not restricted to any group</span>
        <span class="c1"># in another field restricted to users not having a group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to users not having multiple groups</span>
        <span class="c1"># in another field restricted to users not having one of the group only is invalid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is portal, the field &quot;name&quot; will not be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot; where &quot;name&quot; is used will be in the view</span>
        <span class="c1"># making it invalid.</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system,!base.group_portal&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to users not having a group</span>
        <span class="c1"># in another field restricted to users not having multiple group including the one above is valid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is portal, the field &quot;name&quot; will be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot; where &quot;name&quot; is used will not be in the view</span>
        <span class="c1"># making it valid.</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_user&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_user,!base.group_portal&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a non group</span>
        <span class="c1"># in another field for which the non group is not implied is invalid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is employee, the field &quot;name&quot; will not be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot; where &quot;name&quot; is used will be in the view,</span>
        <span class="c1"># making it invalid.</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_user&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a non group</span>
        <span class="c1"># in another field restricted to a non group implied in the non group of the available field is valid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is employee, the field &quot;name&quot; will be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot;, where &quot;name&quot; is used, will not be in the view,</span>
        <span class="c1"># therefore making it valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_user&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to non-admins, itself in a block restricted to employees,</span>
        <span class="c1"># in another field restricted to a block restricted to employees</span>
        <span class="c1"># is invalid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is admin, the field &quot;name&quot; will not be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot;, where &quot;name&quot; is used, will be in the view,</span>
        <span class="c1"># threfore making it invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_user&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">                &lt;group groups=&quot;base.group_user&quot;&gt;</span>
<span class="s2">                    &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">                &lt;/group&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert using a field restricted to a group</span>
        <span class="c1"># in another field restricted the opposite group is invalid</span>
        <span class="c1"># e.g.</span>
        <span class="c1"># if the user is admin, the field &quot;name&quot; will be in the view</span>
        <span class="c1"># but the field &quot;inherit_id&quot;, where &quot;name&quot; is used, will not be in the view,</span>
        <span class="c1"># therefore making it invalid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Assert having two times the same field with a mutually exclusive group</span>
        <span class="c1"># and using that field in another field without any group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert having two times the same field with a mutually exclusive group</span>
        <span class="c1"># and using that field in another field using the group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert having two times the same field with a mutually exclusive group</span>
        <span class="c1"># and using that field in another field using the !group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;!base.group_system&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Assert having two times the same field with a mutually exclusive group</span>
        <span class="c1"># and using that field in another field restricted to any other group is valid</span>
        <span class="n">validate</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;form string=&quot;View&quot;&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;!base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;name&quot; groups=&quot;base.group_system&quot;/&gt;</span>
<span class="s2">                &lt;field name=&quot;inherit_id&quot; groups=&quot;base.group_portal&quot; </span><span class="si">%(attrs)s</span><span class="s2">/&gt;</span>
<span class="s2">            &lt;/form&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Amr.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>