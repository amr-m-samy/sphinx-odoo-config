<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>odoo.addons.base.tests.test_qweb &mdash; Amr  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Amr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">odoo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Amr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../../odoo.html">odoo</a></li>
          <li class="breadcrumb-item"><a href="../../base.html">odoo.addons.base</a></li>
      <li class="breadcrumb-item active">odoo.addons.base.tests.test_qweb</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for odoo.addons.base.tests.test_qweb</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Part of Odoo. See LICENSE file for full copyright and licensing details.</span>

<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os.path</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">markupsafe</span>

<span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span><span class="p">,</span> <span class="n">html</span>
<span class="kn">from</span> <span class="nn">lxml.builder</span> <span class="kn">import</span> <span class="n">E</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">textwrap</span> <span class="kn">import</span> <span class="n">dedent</span>

<span class="kn">from</span> <span class="nn">odoo.tests.common</span> <span class="kn">import</span> <span class="n">TransactionCase</span>
<span class="kn">from</span> <span class="nn">odoo.addons.base.models.ir_qweb</span> <span class="kn">import</span> <span class="n">QWebException</span><span class="p">,</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">odoo.tools</span> <span class="kn">import</span> <span class="n">misc</span><span class="p">,</span> <span class="n">mute_logger</span>
<span class="kn">from</span> <span class="nn">odoo.tools.json</span> <span class="kn">import</span> <span class="n">scriptsafe</span> <span class="k">as</span> <span class="n">json_scriptsafe</span>
<span class="kn">from</span> <span class="nn">odoo.exceptions</span> <span class="kn">import</span> <span class="n">UserError</span><span class="p">,</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">MissingError</span>

<span class="n">unsafe_eval</span> <span class="o">=</span> <span class="nb">eval</span>


<div class="viewcode-block" id="TestQWebTField">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebTField">[docs]</a>
<span class="k">class</span> <span class="nc">TestQWebTField</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestQWebTField.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebTField.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TestQWebTField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env_branding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">(</span><span class="n">context</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;inherit_branding&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env_branding</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="TestQWebTField.test_trivial">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebTField.test_trivial">[docs]</a>
    <span class="k">def</span> <span class="nf">test_trivial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;t-field&#39;</span><span class="p">:</span> <span class="s1">&#39;company.name&#39;</span><span class="p">})</span>
        <span class="n">company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.company&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;My Test Company&quot;</span><span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;company&#39;</span><span class="p">:</span> <span class="n">company</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;&lt;span data-oe-model=&quot;res.company&quot; data-oe-id=&quot;</span><span class="si">%d</span><span class="s1">&quot; &#39;</span>
                  <span class="s1">&#39;data-oe-field=&quot;name&quot; data-oe-type=&quot;char&quot; &#39;</span>
                  <span class="s1">&#39;data-oe-expression=&quot;company.name&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">company</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s2">&quot;My Test Company&quot;</span><span class="p">,</span>
            <span class="p">)),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebTField.test_i18n">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebTField.test_i18n">[docs]</a>
    <span class="k">def</span> <span class="nf">test_i18n</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;t-field&#39;</span><span class="p">:</span> <span class="s1">&#39;company.name&#39;</span><span class="p">})</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Testing «ταБЬℓσ»: 1&lt;2 &amp; 4+1&gt;3, now 20</span><span class="si">% o</span><span class="s2">ff!&quot;</span>
        <span class="n">company</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.company&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">s</span><span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;company&#39;</span><span class="p">:</span> <span class="n">company</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;&lt;span data-oe-model=&quot;res.company&quot; data-oe-id=&quot;</span><span class="si">%d</span><span class="s1">&quot; &#39;</span>
                  <span class="s1">&#39;data-oe-field=&quot;name&quot; data-oe-type=&quot;char&quot; &#39;</span>
                  <span class="s1">&#39;data-oe-expression=&quot;company.name&quot;&gt;</span><span class="si">%s</span><span class="s1">&lt;/span&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">company</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">misc</span><span class="o">.</span><span class="n">html_escape</span><span class="p">(</span><span class="n">s</span><span class="p">),</span>
            <span class="p">)),</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebTField.test_reject_crummy_tags">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebTField.test_reject_crummy_tags">[docs]</a>
    <span class="k">def</span> <span class="nf">test_reject_crummy_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;t-field&#39;</span><span class="p">:</span> <span class="s1">&#39;company.name&#39;</span><span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="n">QWebException</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;QWeb widgets do not work correctly&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;company&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span></div>


<div class="viewcode-block" id="TestQWebTField.test_reject_t_tag">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebTField.test_reject_t_tag">[docs]</a>
    <span class="k">def</span> <span class="nf">test_reject_t_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;t-field&#39;</span><span class="p">:</span> <span class="s1">&#39;company.name&#39;</span><span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="n">QWebException</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;t-field can not be used on a t element&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;company&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span></div>


<div class="viewcode-block" id="TestQWebTField.test_render_t_options">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebTField.test_render_t_options">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_t_options</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;&lt;root&gt;&lt;span t-esc=&quot;5&quot; t-options=&quot;{&#39;widget&#39;: &#39;char&#39;}&quot; t-options-widget=&quot;&#39;float&#39;&quot; t-options-precision=&quot;4&quot;/&gt;&lt;/root&gt;&lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">))</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="s1">&#39;5.0000&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebTField.test_xss_breakout">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebTField.test_xss_breakout">[docs]</a>
    <span class="k">def</span> <span class="nf">test_xss_breakout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;dummy&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;root&gt;</span>
<span class="s2">                        &lt;script type=&quot;application/javascript&quot;&gt;</span>
<span class="s2">                            var s = &lt;t t-esc=&quot;json.dumps({&#39;key&#39;: malicious})&quot;/&gt;;</span>
<span class="s2">                        &lt;/script&gt;</span>
<span class="s2">                    &lt;/root&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;malicious&#39;</span><span class="p">:</span> <span class="s1">&#39;1&lt;/script&gt;&lt;script&gt;alert(&quot;pwned&quot;)&lt;/script&gt;&lt;script&gt;&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;alert&#39;</span><span class="p">,</span> <span class="n">rendered</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%r</span><span class="s2"> doesn&#39;t seem to be rendered&quot;</span> <span class="o">%</span> <span class="n">rendered</span><span class="p">)</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">xpath</span><span class="p">(</span><span class="s1">&#39;//script&#39;</span><span class="p">)),</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebTField.test_default_value">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebTField.test_default_value">[docs]</a>
    <span class="k">def</span> <span class="nf">test_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;out-field-default&quot;&gt;</span>
<span class="s1">                &lt;div t-field=&quot;record.name&quot;&gt;</span>
<span class="s1">                    DEFAULT</span>
<span class="s1">                    &lt;t t-out=&quot;&#39;Text&#39;&quot; /&gt;</span>
<span class="s1">                &lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="c1"># record.name is non-empty</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;My Company&lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="n">Partner</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;My Company&#39;</span><span class="p">})</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="c1"># record.name is empty but not False or None, we should render depending on force_display</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;&lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="n">Partner</span><span class="o">.</span><span class="n">new</span><span class="p">({</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="c1"># record.name is False or None, we should render field default value</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;</span>
<span class="s2">                    DEFAULT</span>
<span class="s2">                    Text</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="n">Partner</span><span class="o">.</span><span class="n">new</span><span class="p">({})</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebTField.test_no_value_no_default_value">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebTField.test_no_value_no_default_value">[docs]</a>
    <span class="k">def</span> <span class="nf">test_no_value_no_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># no value, no default value with attributes on t-field</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;out-field-default&quot;&gt;</span>
<span class="s1">                &lt;div t-field=&quot;record.name&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div data-oe-xpath=&quot;/t[1]/div[1]&quot; data-oe-model=&quot;res.partner&quot; data-oe-field=&quot;name&quot; data-oe-type=&quot;char&quot; data-oe-expression=&quot;record.name&quot;&gt;&lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="c1"># inherit_branding puts attribute on the field tag as well as force the display in case the field is empty</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">inherit_branding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;record&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">new</span><span class="p">({}),</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="TestQWebNS">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS">[docs]</a>
<span class="k">class</span> <span class="nc">TestQWebNS</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestQWebNS.test_render_static_xml_with_namespace">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_static_xml_with_namespace">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_static_xml_with_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test the rendering on a namespaced view with no static content. The resulting string should be untouched.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;h:table xmlns:h=&quot;http://www.example.org/table&quot;&gt;</span>
<span class="s2">                    &lt;h:tr&gt;</span>
<span class="s2">                        &lt;h:td xmlns:h=&quot;http://www.w3.org/TD/html4/&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                        &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                    &lt;/h:tr&gt;</span>
<span class="s2">                &lt;/h:table&gt;</span>
<span class="s2">                &lt;f:table xmlns:f=&quot;http://www.example.org/furniture&quot;&gt;</span>
<span class="s2">                    &lt;f:width&gt;80&lt;/f:width&gt;</span>
<span class="s2">                &lt;/f:table&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span><span class="si">%s</span><span class="s2">&lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">expected_result</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">expected_result</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_static_xml_with_namespace_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_static_xml_with_namespace_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_static_xml_with_namespace_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test the rendering on a namespaced view with no static content. The resulting string should be untouched.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;html xmlns=&quot;http://www.w3.org/HTML/1998/html4&quot; xmlns:xdc=&quot;http://www.xml.com/books&quot;&gt;</span>
<span class="s2">                &lt;head&gt;</span>
<span class="s2">                    &lt;title&gt;Book Review&lt;/title&gt;</span>
<span class="s2">                &lt;/head&gt;</span>
<span class="s2">                &lt;body&gt;</span>
<span class="s2">                    &lt;xdc:bookreview&gt;</span>
<span class="s2">                        &lt;xdc:title&gt;XML: A Primer&lt;/xdc:title&gt;</span>
<span class="s2">                        &lt;table&gt;</span>
<span class="s2">                            &lt;tr align=&quot;center&quot;&gt;</span>
<span class="s2">                                &lt;td&gt;Author&lt;/td&gt;&lt;td&gt;Price&lt;/td&gt;</span>
<span class="s2">                                &lt;td&gt;Pages&lt;/td&gt;&lt;td&gt;Date&lt;/td&gt;</span>
<span class="s2">                            &lt;/tr&gt;</span>
<span class="s2">                            &lt;tr align=&quot;left&quot;&gt;</span>
<span class="s2">                                &lt;td&gt;&lt;xdc:author&gt;Simon St. Laurent&lt;/xdc:author&gt;&lt;/td&gt;</span>
<span class="s2">                                &lt;td&gt;&lt;xdc:price&gt;31.98&lt;/xdc:price&gt;&lt;/td&gt;</span>
<span class="s2">                                &lt;td&gt;&lt;xdc:pages&gt;352&lt;/xdc:pages&gt;&lt;/td&gt;</span>
<span class="s2">                                &lt;td&gt;&lt;xdc:date&gt;1998/01&lt;/xdc:date&gt;&lt;/td&gt;</span>
<span class="s2">                            &lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/xdc:bookreview&gt;</span>
<span class="s2">                &lt;/body&gt;</span>
<span class="s2">            &lt;/html&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span><span class="si">%s</span><span class="s2">&lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">expected_result</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">expected_result</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_static_xml_with_useless_distributed_namespace">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_static_xml_with_useless_distributed_namespace">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_static_xml_with_useless_distributed_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test that redundant namespaces are stripped upon rendering.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;root&gt;</span>
<span class="s2">                        &lt;h:table xmlns:h=&quot;http://www.example.org/table&quot;&gt;</span>
<span class="s2">                            &lt;h:tr xmlns:h=&quot;http://www.example.org/table&quot;&gt;</span>
<span class="s2">                                &lt;h:td xmlns:h=&quot;http://www.w3.org/TD/html4/&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                                &lt;h:td xmlns:h=&quot;http://www.example.org/table&quot;&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                            &lt;/h:tr&gt;</span>
<span class="s2">                        &lt;/h:table&gt;</span>
<span class="s2">                    &lt;/root&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;h:table xmlns:h=&quot;http://www.example.org/table&quot;&gt;</span>
<span class="s2">                    &lt;h:tr&gt;</span>
<span class="s2">                        &lt;h:td xmlns:h=&quot;http://www.w3.org/TD/html4/&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                        &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                    &lt;/h:tr&gt;</span>
<span class="s2">                &lt;/h:table&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span> <span class="n">expected_result</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_static_xml_with_namespace_3">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_static_xml_with_namespace_3">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_static_xml_with_namespace_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;cfdi:Comprobante xmlns:cfdi=&quot;http://www.sat.gob.mx/cfd/3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd&quot;&gt;&lt;/cfdi:Comprobante&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span><span class="si">%s</span><span class="s2">&lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">expected_result</span>
        <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">expected_result</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_static_xml_with_namespace_dynamic">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_static_xml_with_namespace_dynamic">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_static_xml_with_namespace_dynamic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test the rendering on a namespaced view with dynamic URI (need default namespace uri).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tempate</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root xmlns:h=&quot;https://default.namespace.url/h&quot;&gt;</span>
<span class="s2">                &lt;h:table t-att=&quot;{&#39;xmlns:h&#39;: h1}&quot;&gt;</span>
<span class="s2">                    &lt;h:tr&gt;</span>
<span class="s2">                        &lt;h:td t-att=&quot;{&#39;xmlns:h&#39;: h2}&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                        &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                    &lt;/h:tr&gt;</span>
<span class="s2">                &lt;/h:table&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root xmlns:h=&quot;https://default.namespace.url/h&quot;&gt;</span>
<span class="s2">                &lt;h:table xmlns:h=&quot;</span><span class="si">%(h1)s</span><span class="s2">&quot;&gt;</span>
<span class="s2">                    &lt;h:tr&gt;</span>
<span class="s2">                        &lt;h:td xmlns:h=&quot;</span><span class="si">%(h2)s</span><span class="s2">&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                        &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                    &lt;/h:tr&gt;</span>
<span class="s2">                &lt;/h:table&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">h1</span><span class="o">=</span><span class="s2">&quot;http://www.example.org/table&quot;</span><span class="p">,</span> <span class="n">h2</span><span class="o">=</span><span class="s2">&quot;http://www.w3.org/TD/html4/&quot;</span><span class="p">)</span>

        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span><span class="si">%s</span><span class="s2">&lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">tempate</span>
        <span class="p">})</span>

        <span class="n">rendering</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">rendering</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">expected_result</span> <span class="o">%</span> <span class="n">values</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_static_xml_with_namespace_dynamic_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_static_xml_with_namespace_dynamic_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_static_xml_with_namespace_dynamic_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test the rendering on a namespaced view with dynamic URI (need default namespace uri).</span>
<span class="sd">        Default URIs must be differents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tempate</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root xmlns:f=&quot;https://default.namespace.url/f&quot; xmlns:h=&quot;https://default.namespace.url/h&quot; &gt;</span>
<span class="s2">                &lt;h:table t-att=&quot;{&#39;xmlns:h&#39;: h1}&quot;&gt;</span>
<span class="s2">                    &lt;h:tr&gt;</span>
<span class="s2">                        &lt;h:td t-att=&quot;{&#39;xmlns:h&#39;: h2}&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                        &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                    &lt;/h:tr&gt;</span>
<span class="s2">                &lt;/h:table&gt;</span>
<span class="s2">                &lt;f:table t-att=&quot;{&#39;xmlns:f&#39;: f}&quot;&gt;</span>
<span class="s2">                    &lt;f:width&gt;80&lt;/f:width&gt;</span>
<span class="s2">                &lt;/f:table&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root xmlns:f=&quot;https://default.namespace.url/f&quot; xmlns:h=&quot;https://default.namespace.url/h&quot;&gt;</span>
<span class="s2">                &lt;h:table xmlns:h=&quot;</span><span class="si">%(h1)s</span><span class="s2">&quot;&gt;</span>
<span class="s2">                    &lt;h:tr&gt;</span>
<span class="s2">                        &lt;h:td xmlns:h=&quot;</span><span class="si">%(h2)s</span><span class="s2">&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                        &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                    &lt;/h:tr&gt;</span>
<span class="s2">                &lt;/h:table&gt;</span>
<span class="s2">                &lt;f:table xmlns:f=&quot;</span><span class="si">%(f)s</span><span class="s2">&quot;&gt;</span>
<span class="s2">                    &lt;f:width&gt;80&lt;/f:width&gt;</span>
<span class="s2">                &lt;/f:table&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">h1</span><span class="o">=</span><span class="s2">&quot;http://www.example.org/table&quot;</span><span class="p">,</span> <span class="n">h2</span><span class="o">=</span><span class="s2">&quot;http://www.w3.org/TD/html4/&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="s2">&quot;http://www.example.org/furniture&quot;</span><span class="p">)</span>

        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span><span class="si">%s</span><span class="s2">&lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">tempate</span>
        <span class="p">})</span>

        <span class="n">rendering</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">rendering</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">expected_result</span> <span class="o">%</span> <span class="n">values</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_dynamic_xml_with_namespace_t_esc">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_dynamic_xml_with_namespace_t_esc">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_dynamic_xml_with_namespace_t_esc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test that rendering a template containing a node having both an ns declaration and a t-esc attribute correctly</span>
<span class="sd">        handles the t-esc attribute and keep the ns declaration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;Invoice xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot; t-esc=&quot;&#39;test&#39;&quot;/&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;Invoice xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot;&gt;test&lt;/Invoice&gt;&quot;&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span> <span class="n">expected_result</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_dynamic_xml_with_namespace_t_esc_with_useless_distributed_namespace">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_dynamic_xml_with_namespace_t_esc_with_useless_distributed_namespace">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_dynamic_xml_with_namespace_t_esc_with_useless_distributed_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test that rendering a template containing a node having both an ns declaration and a t-esc attribute correctly</span>
<span class="sd">        handles the t-esc attribute and keep the ns declaration, and distribute correctly the ns declaration to its children.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;Invoice xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot; t-attf-test=&quot;test&quot;&gt;</span>
<span class="s2">                        &lt;cac:Test xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot;&gt;blabla&lt;/cac:Test&gt;</span>
<span class="s2">                    &lt;/Invoice&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;Invoice xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot; test=&quot;test&quot;&gt;</span>
<span class="s2">                &lt;cac:Test&gt;blabla&lt;/cac:Test&gt;</span>
<span class="s2">            &lt;/Invoice&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span> <span class="n">expected_result</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_dynamic_xml_with_namespace_t_attf">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_dynamic_xml_with_namespace_t_attf">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_dynamic_xml_with_namespace_t_attf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test that rendering a template containing a node having both an ns declaration and a t-attf attribute correctly</span>
<span class="sd">        handles the t-attf attribute and keep the ns declaration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;root&gt;</span>
<span class="s2">                        &lt;h:table xmlns:h=&quot;http://www.example.org/table&quot;&gt;</span>
<span class="s2">                            &lt;h:tr&gt;</span>
<span class="s2">                                &lt;h:td xmlns:h=&quot;http://www.w3.org/TD/html4/&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                                &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                            &lt;/h:tr&gt;</span>
<span class="s2">                        &lt;/h:table&gt;</span>
<span class="s2">                        &lt;f:table xmlns:f=&quot;http://www.example.org/furniture&quot;&gt;</span>
<span class="s2">                            &lt;f:width t-attf-test=&quot;1&quot;&gt;80&lt;/f:width&gt;</span>
<span class="s2">                        &lt;/f:table&gt;</span>
<span class="s2">                    &lt;/root&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;h:table xmlns:h=&quot;http://www.example.org/table&quot;&gt;</span>
<span class="s2">                    &lt;h:tr&gt;</span>
<span class="s2">                        &lt;h:td xmlns:h=&quot;http://www.w3.org/TD/html4/&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                        &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                    &lt;/h:tr&gt;</span>
<span class="s2">                &lt;/h:table&gt;</span>
<span class="s2">                &lt;f:table xmlns:f=&quot;http://www.example.org/furniture&quot;&gt;</span>
<span class="s2">                    &lt;f:width test=&quot;1&quot;&gt;80&lt;/f:width&gt;</span>
<span class="s2">                &lt;/f:table&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span> <span class="n">expected_result</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_dynamic_xml_with_namespace_t_attf_with_useless_distributed_namespace">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_dynamic_xml_with_namespace_t_attf_with_useless_distributed_namespace">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_dynamic_xml_with_namespace_t_attf_with_useless_distributed_namespace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test that rendering a template containing a node having both an ns declaration and a t-attf attribute correctly</span>
<span class="sd">        handles the t-attf attribute and that redundant namespaces are stripped upon rendering.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                &lt;root&gt;</span>
<span class="s2">                    &lt;h:table xmlns:h=&quot;http://www.example.org/table&quot;&gt;</span>
<span class="s2">                        &lt;h:tr&gt;</span>
<span class="s2">                            &lt;h:td xmlns:h=&quot;http://www.w3.org/TD/html4/&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                            &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                        &lt;/h:tr&gt;</span>
<span class="s2">                    &lt;/h:table&gt;</span>
<span class="s2">                    &lt;f:table xmlns:f=&quot;http://www.example.org/furniture&quot;&gt;</span>
<span class="s2">                        &lt;f:width xmlns:f=&quot;http://www.example.org/furniture&quot; t-attf-test=&quot;1&quot;&gt;80&lt;/f:width&gt;</span>
<span class="s2">                    &lt;/f:table&gt;</span>
<span class="s2">                &lt;/root&gt;</span>

<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;root&gt;</span>
<span class="s2">                    &lt;h:table xmlns:h=&quot;http://www.example.org/table&quot;&gt;</span>
<span class="s2">                        &lt;h:tr&gt;</span>
<span class="s2">                            &lt;h:td xmlns:h=&quot;http://www.w3.org/TD/html4/&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                            &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                        &lt;/h:tr&gt;</span>
<span class="s2">                    &lt;/h:table&gt;</span>
<span class="s2">                    &lt;f:table xmlns:f=&quot;http://www.example.org/furniture&quot;&gt;</span>
<span class="s2">                        &lt;f:width test=&quot;1&quot;&gt;80&lt;/f:width&gt;</span>
<span class="s2">                    &lt;/f:table&gt;</span>
<span class="s2">                &lt;/root&gt;</span>

<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span> <span class="n">expected_result</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_dynamic_xml_with_namespace_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_dynamic_xml_with_namespace_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_dynamic_xml_with_namespace_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;Invoice xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot; xmlns:cbc=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2&quot; xmlns=&quot;urn:oasis:names:specification:ubl:schema:xsd:Invoice-2&quot;&gt;</span>
<span class="s2">                        &lt;cbc:UBLVersionID t-esc=&quot;version_id&quot;/&gt;</span>
<span class="s2">                        &lt;t t-foreach=&quot;[1, 2, 3, 4]&quot; t-as=&quot;value&quot;&gt;</span>
<span class="s2">                            Oasis &lt;cac:Test t-esc=&quot;value&quot;/&gt;</span>
<span class="s2">                        &lt;/t&gt;</span>
<span class="s2">                    &lt;/Invoice&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;Invoice xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot; xmlns:cbc=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2&quot; xmlns=&quot;urn:oasis:names:specification:ubl:schema:xsd:Invoice-2&quot;&gt;</span>
<span class="s2">                &lt;cbc:UBLVersionID&gt;1.0&lt;/cbc:UBLVersionID&gt;</span>

<span class="s2">                    Oasis &lt;cac:Test&gt;1&lt;/cac:Test&gt;</span>

<span class="s2">                    Oasis &lt;cac:Test&gt;2&lt;/cac:Test&gt;</span>

<span class="s2">                    Oasis &lt;cac:Test&gt;3&lt;/cac:Test&gt;</span>

<span class="s2">                    Oasis &lt;cac:Test&gt;4&lt;/cac:Test&gt;</span>

<span class="s2">            &lt;/Invoice&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;version_id&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})),</span> <span class="n">expected_result</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_static_xml_with_namespaced_attributes">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_static_xml_with_namespaced_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_static_xml_with_namespaced_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;cfdi:Comprobante xmlns:cfdi=&quot;http://www.sat.gob.mx/cfd/3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd&quot;&gt;abc&lt;/cfdi:Comprobante&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;cfdi:Comprobante xmlns:cfdi=&quot;http://www.sat.gob.mx/cfd/3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd&quot;&gt;abc&lt;/cfdi:Comprobante&gt;&quot;&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span> <span class="n">expected_result</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_dynamic_xml_with_namespaced_attributes">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_dynamic_xml_with_namespaced_attributes">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_dynamic_xml_with_namespaced_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;cfdi:Comprobante xmlns:cfdi=&quot;http://www.sat.gob.mx/cfd/3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd&quot; t-esc=&quot;&#39;abc&#39;&quot;/&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;&lt;cfdi:Comprobante xmlns:cfdi=&quot;http://www.sat.gob.mx/cfd/3&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd&quot;&gt;abc&lt;/cfdi:Comprobante&gt;&quot;&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span> <span class="n">expected_result</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_static_xml_with_t_call">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_static_xml_with_t_call">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_static_xml_with_t_call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;cac:fruit xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot;</span>
<span class="s2">                               xmlns:cbc=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2&quot;&gt;</span>
<span class="s2">                        &lt;cac:table&gt;</span>
<span class="s2">                            &lt;cbc:td&gt;Appel&lt;/cbc:td&gt;</span>
<span class="s2">                            &lt;cbc:td&gt;Pineappel&lt;/cbc:td&gt;</span>
<span class="s2">                        &lt;/cac:table&gt;</span>
<span class="s2">                    &lt;/cac:fruit&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ir_model_data(name, model, res_id, module)&quot;</span>
                            <span class="s2">&quot;VALUES (&#39;dummy&#39;, &#39;ir.ui.view&#39;, </span><span class="si">%s</span><span class="s2">, &#39;base&#39;)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

        <span class="c1"># view2 will t-call view1</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy2&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy2&quot;&gt;</span>
<span class="s2">                    &lt;root xmlns=&quot;urn:oasis:names:specification:ubl:schema:xsd:Invoice-2&quot; xmlns:cac=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&quot; xmlns:cbc=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2&quot;&gt;</span>
<span class="s2">                        &lt;cac:line t-foreach=&quot;[1, 2]&quot; t-as=&quot;i&quot; t-call=&quot;base.dummy&quot;/&gt;</span>
<span class="s2">                    &lt;/root&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">result_etree</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># check that the root tag has all its xmlns</span>
        <span class="n">expected_ns</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;urn:oasis:names:specification:ubl:schema:xsd:Invoice-2&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;cac&#39;</span><span class="p">,</span> <span class="s1">&#39;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;cbc&#39;</span><span class="p">,</span> <span class="s1">&#39;urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2&#39;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">result_etree</span><span class="o">.</span><span class="n">nsmap</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">expected_ns</span><span class="p">)</span>

        <span class="c1"># check that the t-call did its work</span>
        <span class="n">cac_lines</span> <span class="o">=</span> <span class="n">result_etree</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s1">&#39;.//cac:line&#39;</span><span class="p">,</span> <span class="n">namespaces</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;cac&#39;</span><span class="p">:</span> <span class="s1">&#39;urn:oasis:names:specification:ubl:schema:xsd:CommonAggregateComponents-2&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cac_lines</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;Appel&#39;</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># check that the t-call dit not output again the xmlns declaration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;xmlns:cbc=&quot;urn:oasis:names:specification:ubl:schema:xsd:CommonBasicComponents-2&quot;&#39;</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_static_xml_with_extension">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_static_xml_with_extension">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_static_xml_with_extension</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test the extension of a view by an xpath expression on a ns prefixed element.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># primary view</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;root&gt;</span>
<span class="s2">                        &lt;h:table xmlns:h=&quot;http://www.example.org/table&quot;&gt;</span>
<span class="s2">                            &lt;h:tr&gt;</span>
<span class="s2">                                &lt;h:td xmlns:h=&quot;http://www.w3.org/TD/html4/&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                                &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                            &lt;/h:tr&gt;</span>
<span class="s2">                        &lt;/h:table&gt;</span>
<span class="s2">                    &lt;/root&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="c1"># extension patching the primary view</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy_ext&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;xpath expr=&quot;//{http://www.example.org/table}table/{http://www.example.org/table}tr&quot;&gt;</span>
<span class="s2">                        &lt;h:td xmlns:h=&quot;http://www.example.org/table&quot;&gt;Oranges&lt;/h:td&gt;</span>
<span class="s2">                &lt;/xpath&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;h:table xmlns:h=&quot;http://www.example.org/table&quot;&gt;</span>
<span class="s2">                    &lt;h:tr&gt;</span>
<span class="s2">                        &lt;h:td xmlns:h=&quot;http://www.w3.org/TD/html4/&quot;&gt;Apples&lt;/h:td&gt;</span>
<span class="s2">                        &lt;h:td&gt;Bananas&lt;/h:td&gt;</span>
<span class="s2">                        &lt;h:td&gt;Oranges&lt;/h:td&gt;</span>
<span class="s2">                    &lt;/h:tr&gt;</span>
<span class="s2">                &lt;/h:table&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">check_view_ids</span><span class="o">=</span><span class="p">[</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">])</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)),</span>
            <span class="n">expected_result</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebNS.test_render_dynamic_xml_with_code_error">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_dynamic_xml_with_code_error">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_dynamic_xml_with_code_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test that, when rendering a template containing a namespaced node</span>
<span class="sd">            that evaluates code with errors, the proper exception is raised</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;Invoice xmlns:od=&quot;http://odoo.com/od&quot;&gt;</span>
<span class="s2">                        &lt;od:name t-att-test=&quot;&#39;a&#39; + 1&quot;/&gt;</span>
<span class="s2">                    &lt;/Invoice&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">error_msg</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="s2">&quot;&quot;</span> <span class="o">+</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">QWebException</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">error_msg</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>



<div class="viewcode-block" id="TestQWebNS.test_render_static_xml_with_void_element">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebNS.test_render_static_xml_with_void_element">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_static_xml_with_void_element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test the rendering on a namespaced view with dynamic URI (need default namespace uri).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tempate</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;rss xmlns:g=&quot;http://base.google.com/ns/1.0&quot; version=&quot;2.0&quot;&gt;</span>
<span class="s2">                &lt;g:brand&gt;Odoo&lt;/g:brand&gt;</span>
<span class="s2">                &lt;g:link&gt;My Link&lt;/g:link&gt;</span>
<span class="s2">            &lt;/rss&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">expected_result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;rss xmlns:g=&quot;http://base.google.com/ns/1.0&quot; version=&quot;2.0&quot;&gt;</span>
<span class="s2">                &lt;g:brand&gt;Odoo&lt;/g:brand&gt;</span>
<span class="s2">                &lt;g:link&gt;My Link&lt;/g:link&gt;</span>
<span class="s2">            &lt;/rss&gt;</span>

<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span><span class="si">%s</span><span class="s2">&lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">tempate</span>
        <span class="p">})</span>

        <span class="n">rendering</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">rendering</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">expected_result</span><span class="p">))</span></div>
</div>


<div class="viewcode-block" id="TestQWebBasic">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic">[docs]</a>
<span class="k">class</span> <span class="nc">TestQWebBasic</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestQWebBasic.test_compile_expr">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_compile_expr">[docs]</a>
    <span class="k">def</span> <span class="nf">test_compile_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
            <span class="c1">#pylint: disable=C0326</span>
            <span class="c1"># source,                                   values,                         result</span>
            <span class="p">(</span><span class="s2">&quot;1 +2+ 3&quot;</span><span class="p">,</span>                                 <span class="p">{},</span>                             <span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;(((1 +2+ 3)))&quot;</span><span class="p">,</span>                           <span class="p">{},</span>                             <span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;(1) +(2+ (3))&quot;</span><span class="p">,</span>                           <span class="p">{},</span>                             <span class="mi">6</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;a == 5&quot;</span><span class="p">,</span>                                  <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">},</span>                       <span class="kc">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;{&#39;a&#39;: True}&quot;</span><span class="p">,</span>                             <span class="p">{},</span>                             <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
            <span class="p">(</span><span class="s2">&quot;object.count(1)&quot;</span><span class="p">,</span>                         <span class="p">{</span><span class="s1">&#39;object&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span><span class="mi">1</span><span class="p">]},</span>       <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;dict(a=True)&quot;</span><span class="p">,</span>                            <span class="p">{},</span>                             <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}),</span>
            <span class="p">(</span><span class="s2">&quot;fn(a=11, b=22) or a&quot;</span><span class="p">,</span>                     <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fn&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>  <span class="mi">1</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;fn(a=11, b=22) or a&quot;</span><span class="p">,</span>                     <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;fn&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">:</span> <span class="n">b</span><span class="p">},</span>  <span class="mi">22</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;(lambda a: a)(5)&quot;</span><span class="p">,</span>                        <span class="p">{},</span>                             <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;(lambda a: a[0])([5])&quot;</span><span class="p">,</span>                   <span class="p">{},</span>                             <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;(lambda test: len(test))(&#39;aaa&#39;)&quot;</span><span class="p">,</span>         <span class="p">{},</span>                             <span class="mi">3</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;{&#39;a&#39;: lambda a: a[0], &#39;b&#39;: 3}[&#39;a&#39;]([5])&quot;</span><span class="p">,</span> <span class="p">{},</span>                             <span class="mi">5</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;list(map(lambda a: a[0], r))&quot;</span><span class="p">,</span>            <span class="p">{</span><span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">22</span><span class="p">)]},</span>        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;z + (head or &#39;z&#39;)&quot;</span><span class="p">,</span>                       <span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">},</span>                     <span class="s2">&quot;az&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;z + (head or &#39;z&#39;)&quot;</span><span class="p">,</span>                       <span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;head&#39;</span><span class="p">:</span> <span class="s1">&#39;b&#39;</span><span class="p">},</span>        <span class="s2">&quot;ab&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;{a:b for a, b in [(1,11), (2, 22)]}&quot;</span><span class="p">,</span>     <span class="p">{},</span>                             <span class="p">{</span><span class="mi">1</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="mi">22</span><span class="p">}),</span>
            <span class="p">(</span><span class="s2">&quot;any({x == 2 for x in [1,2,3]})&quot;</span><span class="p">,</span>          <span class="p">{},</span>                             <span class="kc">True</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;any({x == 5 for x in [1,2,3]})&quot;</span><span class="p">,</span>          <span class="p">{},</span>                             <span class="kc">False</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;{x:y for x,y in [(&#39;a&#39;, 11),(&#39;b&#39;, 22)]}&quot;</span><span class="p">,</span>  <span class="p">{},</span>                             <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">11</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">}),</span>
            <span class="p">(</span><span class="s2">&quot;[(y,x) for x,y in [(1, 11),(2, 22)]]&quot;</span><span class="p">,</span>    <span class="p">{},</span>                             <span class="p">[(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]),</span>
            <span class="p">(</span><span class="s2">&quot;(lambda a: a + 5)(x)&quot;</span><span class="p">,</span>                    <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>                      <span class="mi">15</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;(lambda a: a + x)(5)&quot;</span><span class="p">,</span>                    <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>                      <span class="mi">15</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;sum(x for x in range(4)) + ((x))&quot;</span><span class="p">,</span>        <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>                      <span class="mi">16</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;[&#39;test_&#39; + x for x in [&#39;a&#39;, &#39;b&#39;]]&quot;</span><span class="p">,</span>       <span class="p">{},</span>                             <span class="p">[</span><span class="s1">&#39;test_a&#39;</span><span class="p">,</span> <span class="s1">&#39;test_b&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;&quot;&quot;1 and 2 and 0</span>
<span class="s2">                or 9&quot;&quot;&quot;</span><span class="p">,</span>                                <span class="p">{},</span>                             <span class="mi">9</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">expr</span><span class="p">,</span> <span class="n">q_values</span><span class="p">,</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">tests</span><span class="p">:</span>
            <span class="n">expr_namespace</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_compile_expr</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

            <span class="n">compiled</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;def test(values):</span><span class="se">\n</span><span class="s2">  values[&#39;result&#39;] = </span><span class="si">%s</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">expr_namespace</span><span class="p">,</span> <span class="s1">&#39;&lt;test&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>
            <span class="n">globals_dict</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_IrQWeb__prepare_globals</span><span class="p">()</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">unsafe_eval</span><span class="p">(</span><span class="n">compiled</span><span class="p">,</span> <span class="n">globals_dict</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>

            <span class="n">test</span><span class="p">(</span><span class="n">q_values</span><span class="p">)</span>
            <span class="n">q_result</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">q_values</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertDictEqual</span><span class="p">(</span><span class="n">q_values</span><span class="p">,</span> <span class="n">q_result</span><span class="p">,</span> <span class="s2">&quot;Should compile: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">expr</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_foreach_as_error_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_foreach_as_error_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_foreach_as_error_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;iter-list&quot;&gt;</span>
<span class="s1">                &lt;t t-foreach=&quot;[3, 2, 1]&quot;&gt;</span>
<span class="s1">                    [&lt;t t-esc=&quot;item_index&quot;/&gt;: &lt;t t-esc=&quot;item&quot;/&gt; &lt;t t-esc=&quot;item_value&quot;/&gt;]&lt;/t&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">QWebException</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">QWebException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;KeyError: &#39;t-as&#39;&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;t t-foreach=&quot;[3, 2, 1]&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_foreach_as_error_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_foreach_as_error_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_foreach_as_error_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;iter-list&quot;&gt;</span>
<span class="s1">                &lt;t t-foreach=&quot;[3, 2, 1]&quot; t-as=&quot;&quot;&gt;</span>
<span class="s1">                    [&lt;t t-esc=&quot;item_index&quot;/&gt;: &lt;t t-esc=&quot;item&quot;/&gt; &lt;t t-esc=&quot;item_value&quot;/&gt;]&lt;/t&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">QWebException</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">QWebException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;KeyError: &#39;t-as&#39;&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;t t-foreach=&quot;[3, 2, 1]&quot; t-as=&quot;&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_foreach_as_error_3">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_foreach_as_error_3">[docs]</a>
    <span class="k">def</span> <span class="nf">test_foreach_as_error_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;iter-list&quot;&gt;</span>
<span class="s1">                &lt;t t-foreach=&quot;[3, 2, 1]&quot; t-as=&quot;b-2&quot;&gt;</span>
<span class="s1">                    [&lt;t t-esc=&quot;item_index&quot;/&gt;: &lt;t t-esc=&quot;item&quot;/&gt; &lt;t t-esc=&quot;item_value&quot;/&gt;]&lt;/t&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">QWebException</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">QWebException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;The varname &#39;b-2&#39; can only contain alphanumeric characters and underscores&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;t t-foreach=&quot;[3, 2, 1]&quot; t-as=&quot;b-2&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_compile_expr_security">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_compile_expr_security">[docs]</a>
    <span class="k">def</span> <span class="nf">test_compile_expr_security</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-escaping&quot;&gt;</span>
<span class="s1">                &lt;div&gt;</span>
<span class="s1">                    &lt;t t-set=&quot;o&quot; t-value=&quot;(lambda a=open: a)()&quot;/&gt;</span>
<span class="s1">                    &lt;t t-out=&quot;o(&#39;/etc/passwd&#39;).read()&quot;/&gt;</span>
<span class="s1">                &lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;other&#39;</span><span class="p">:</span> <span class="s1">&#39;any value&#39;</span><span class="p">}</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="c1"># NotImplementedError for &#39;lambda a=open&#39; and Undefined value &#39;open&#39;.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_foreach_iter_list">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_foreach_iter_list">[docs]</a>
    <span class="k">def</span> <span class="nf">test_foreach_iter_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;iter-list&quot;&gt;</span>
<span class="s1">                &lt;t t-foreach=&quot;[3, 2, 1]&quot; t-as=&quot;item&quot;&gt;</span>
<span class="s1">                    [&lt;t t-esc=&quot;item_index&quot;/&gt;: &lt;t t-esc=&quot;item&quot;/&gt; &lt;t t-esc=&quot;item_value&quot;/&gt;]&lt;/t&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    [0: 3 3]</span>
<span class="s2">                    [1: 2 2]</span>
<span class="s2">                    [2: 1 1]</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_foreach_iter_dict">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_foreach_iter_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">test_foreach_iter_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;iter-dict&quot;&gt;</span>
<span class="s1">                &lt;t t-foreach=&quot;{&#39;a&#39;: 3, &#39;b&#39;: 2, &#39;c&#39;: 1}&quot; t-as=&quot;item&quot;&gt;</span>
<span class="s1">                    [&lt;t t-esc=&quot;item_index&quot;/&gt;: &lt;t t-esc=&quot;item&quot;/&gt; &lt;t t-esc=&quot;item_value&quot;/&gt;]&lt;/t&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                    [0: a 3]</span>
<span class="s2">                    [1: b 2]</span>
<span class="s2">                    [2: c 1]</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_att_escaping_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_att_escaping_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_att_escaping_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-escaping&quot;&gt;</span>
<span class="s1">                &lt;div t-att-bibi=&quot;json.dumps(bibi)&quot;&gt;1&lt;/div&gt;</span>
<span class="s1">                &lt;div t-att-toto=&quot;toto&quot;&gt;2&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div bibi=&quot;{&amp;#34;a&amp;#34;: &amp;#34;string&amp;#34;, &amp;#34;b&amp;#34;: 1}&quot;&gt;1&lt;/div&gt;</span>
<span class="s2">                &lt;div toto=&quot;a&amp;#39;b&amp;#34;c&quot;&gt;2&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;json&#39;</span><span class="p">:</span> <span class="n">json_scriptsafe</span><span class="p">,</span> <span class="s1">&#39;bibi&#39;</span><span class="p">:</span> <span class="nb">dict</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;toto&#39;</span><span class="p">:</span> <span class="s2">&quot;a&#39;b</span><span class="se">\&quot;</span><span class="s2">c&quot;</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_att_escaping_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_att_escaping_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_att_escaping_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-escaping&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;abc&quot;&gt; &lt;t t-if=&quot;add_abc&quot;&gt;&lt;t t-out=&quot;add_abc&quot;/&gt; &lt;span a=&quot;b&quot;&gt; | &lt;/span&gt;&lt;/t&gt;&lt;t t-out=&quot;efg&quot;/&gt; &lt;/t&gt;</span>
<span class="s1">                &lt;div t-att-abc=&quot;abc&quot;&gt;123&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div abc=&quot; &amp;amp;#34;yes&amp;amp;#34; &amp;lt;span a=&amp;#34;b&amp;#34;&amp;gt; | &amp;lt;/span&amp;gt;-efg- &quot;&gt;123&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;add_abc&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;yes&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;efg&#39;</span><span class="p">:</span> <span class="s1">&#39;-efg-&#39;</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_attf_escaping_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_attf_escaping_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_attf_escaping_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-escaping&quot;&gt;</span>
<span class="s1">                &lt;div t-attf-bibi=&quot;a, b &amp;gt; c &amp;gt; #</span><span class="si">{d}</span><span class="s1">&quot;&gt;1&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div bibi=&quot;a, b &amp;gt; c &amp;gt; a&amp;#39; &amp;gt; b&amp;#34;c&quot;&gt;1&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="s2">&quot;a&#39; &gt; b</span><span class="se">\&quot;</span><span class="s2">c&quot;</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_attf_escaping_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_attf_escaping_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_attf_escaping_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-escaping&quot;&gt;</span>
<span class="s1">                &lt;a t-attf-href=&quot;/link/#{ url }/#{other and &#39;sub&#39;}&quot;&gt;link&lt;/a&gt;</span>
<span class="s1">                &lt;a t-attf-href=&quot;/link/#{ url }/#{(not other) and &#39;sub&#39;}&quot;&gt;link2&lt;/a&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;a href=&quot;/link/odoo/sub&quot;&gt;link&lt;/a&gt;</span>
<span class="s2">                &lt;a href=&quot;/link/odoo/&quot;&gt;link2&lt;/a&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;odoo&#39;</span><span class="p">,</span> <span class="s1">&#39;other&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_attf_escaping_3">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_attf_escaping_3">[docs]</a>
    <span class="k">def</span> <span class="nf">test_attf_escaping_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-escaping&quot;&gt;</span>
<span class="s1">                &lt;div t-attf-abc=&quot;abc #</span><span class="si">{val}</span><span class="s1"> { other }&quot;&gt;123&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div abc=&quot;abc &amp;#34;yes&amp;#34; { other }&quot;&gt;123&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;yes&quot;&#39;</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_att_no_propagation_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_att_no_propagation_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_att_no_propagation_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;bibi&quot;&gt;</span>
<span class="s1">                &lt;div t-foreach=&quot;[1, 2]&quot; t-as=&quot;v&quot; class=&quot;toto&quot;/&gt;</span>
<span class="s1">                &lt;t class=&quot;remove_me&quot; t-set=&quot;data&quot;&gt;a&lt;/t&gt;</span>
<span class="s1">                &lt;div t-out=&quot;data&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div class=&quot;toto&quot;&gt;&lt;/div&gt;&lt;div class=&quot;toto&quot;&gt;&lt;/div&gt;</span>
<span class="s2">                &lt;div&gt;a&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_att_no_propagation_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_att_no_propagation_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_att_no_propagation_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;bibi&quot;&gt;</span>
<span class="s1">                &lt;section&gt;</span>
<span class="s1">                    &lt;div t-foreach=&quot;[1, 2]&quot; t-as=&quot;v&quot;&gt;</span>
<span class="s1">                        &lt;span t-att-test=&quot;v&quot; t-esc=&quot;v_index&quot;/&gt;</span>
<span class="s1">                    &lt;/div&gt;</span>
<span class="s1">                    &lt;div t-foreach=&quot;[1, 2]&quot; t-as=&quot;v&quot; class=&quot;o&quot;&gt;</span>
<span class="s1">                        &lt;span t-att-test=&quot;v&quot; t-esc=&quot;v_index&quot;/&gt;</span>
<span class="s1">                    &lt;/div&gt;</span>
<span class="s1">                &lt;/section&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;section&gt;</span>
<span class="s2">                    &lt;div&gt;</span>
<span class="s2">                        &lt;span test=&quot;1&quot;&gt;0&lt;/span&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                    &lt;div&gt;</span>
<span class="s2">                        &lt;span test=&quot;2&quot;&gt;1&lt;/span&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                    &lt;div class=&quot;o&quot;&gt;</span>
<span class="s2">                        &lt;span test=&quot;1&quot;&gt;0&lt;/span&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                    &lt;div class=&quot;o&quot;&gt;</span>
<span class="s2">                        &lt;span test=&quot;2&quot;&gt;1&lt;/span&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/section&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">rendered</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_set_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_set_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_set_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;a&quot; t-value=&quot;&#39;abc </span><span class="si">%s</span><span class="s1">&#39; % 1&quot;/&gt;</span>
<span class="s1">                &lt;div t-out=&quot;a&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;abc 1&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_set_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_set_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_set_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;a&quot; t-valuef=&quot;abc {{1}}&quot;/&gt;</span>
<span class="s1">                &lt;div t-out=&quot;a&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;abc 1&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_set_3">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_set_3">[docs]</a>
    <span class="k">def</span> <span class="nf">test_set_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&#39;{&quot;a&quot;: &quot;abc </span><span class="si">%s</span><span class="s1">&quot; % 1,</span>
<span class="s1">                    &quot;b&quot;: 2}&#39;/&gt;</span>
<span class="s1">                &lt;div t-out=&quot;a&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;abc 1&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_set_body_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_set_body_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_set_body_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;abc&quot;&gt; &lt;span a=&quot;b&quot;&gt; [</span><span class="si">%s</span><span class="s1">] &lt;/span&gt; &lt;/t&gt;</span>
<span class="s1">                &lt;div t-att-abc=&quot;abc </span><span class="si">% a</span><span class="s1">dd_abc&quot;&gt;123&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div abc=&quot; &amp;lt;span a=&amp;#34;b&amp;#34;&amp;gt; [&amp;amp;#34;yes&amp;amp;#34;] &amp;lt;/span&amp;gt; &quot;&gt;123&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;add_abc&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;yes&quot;&#39;</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_set_body_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_set_body_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_set_body_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;abc&quot;&gt; &lt;span a=&quot;b&quot;&gt; toto &lt;/span&gt; &lt;/t&gt;</span>
<span class="s1">                &lt;div t-att-abc=&quot;&#39;[</span><span class="si">%s</span><span class="s1">]&#39; </span><span class="si">% a</span><span class="s1">bc&quot;&gt;123&lt;/div&gt;</span>
<span class="s1">                &lt;div class=&quot;a1&quot; t-out=&quot;abc&quot;/&gt;</span>
<span class="s1">                &lt;div class=&quot;a2&quot; t-out=&quot;&#39;[</span><span class="si">%s</span><span class="s1">]&#39; </span><span class="si">% a</span><span class="s1">bc&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div abc=&quot;[ &amp;lt;span a=&amp;#34;b&amp;#34;&amp;gt; toto &amp;lt;/span&amp;gt; ]&quot;&gt;123&lt;/div&gt;</span>
<span class="s2">                &lt;div class=&quot;a1&quot;&gt; &lt;span a=&quot;b&quot;&gt; toto &lt;/span&gt; &lt;/div&gt;</span>
<span class="s2">                &lt;div class=&quot;a2&quot;&gt;[ &amp;lt;span a=&amp;#34;b&amp;#34;&amp;gt; toto &amp;lt;/span&amp;gt; ]&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_set_error_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_set_error_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_set_error_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;&quot; t-value=&quot;1&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">QWebException</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">QWebException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;KeyError: &#39;t-set&#39;&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;t t-set=&quot;&quot; t-value=&quot;1&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_set_error_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_set_error_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_set_error_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;b-2&quot; t-value=&quot;1&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">QWebException</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">QWebException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s2">&quot;The varname can only contain alphanumeric characters and underscores&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;t t-set=&quot;b-2&quot; t-value=&quot;1&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_out">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_out">[docs]</a>
    <span class="k">def</span> <span class="nf">test_out</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;out-format&quot;&gt;&lt;div t-out=&quot;a&quot;&gt;Default&lt;/div&gt;&lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;div&gt;1&lt;/div&gt;&quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_out_format_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_out_format_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_out_format_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;out-format&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;final_message&quot;&gt;Powered by </span><span class="si">%s%s</span><span class="s1">&lt;/t&gt;</span>
<span class="s1">                &lt;div t-out=&quot;final_message % (a, b and (&#39;-</span><span class="si">%s</span><span class="s1">&#39; % b) or &#39;&#39;)&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;Powered by 1-2&lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_out_format_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_out_format_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_out_format_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;toto&quot;&gt;Toto </span><span class="si">%s</span><span class="s1">&lt;/t&gt;</span>
<span class="s1">                &lt;t t-set=&quot;abc&quot;&gt; &lt;span a=&quot;b&quot;&gt; [</span><span class="si">%s</span><span class="s1"> , </span><span class="si">%s</span><span class="s1">] &lt;/span&gt; &lt;/t&gt;</span>
<span class="s1">                &lt;div t-out=&quot;(abc % (add_abc, toto)) % 5&quot;&gt;123&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt; &lt;span a=&quot;b&quot;&gt; [&amp;#34;yes&amp;#34; , Toto 5] &lt;/span&gt; &lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;add_abc&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;yes&quot;&#39;</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_out_format_3">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_out_format_3">[docs]</a>
    <span class="k">def</span> <span class="nf">test_out_format_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;toto&quot;&gt;Toto </span><span class="si">%s</span><span class="s1">&lt;/t&gt;</span>
<span class="s1">                &lt;t t-set=&quot;abc&quot;&gt; &lt;span a=&quot;b&quot;&gt; a &lt;/span&gt; &lt;/t&gt;</span>
<span class="s1">                &lt;div t-out=&quot;(toto + abc) % v&quot;&gt;123&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;Toto &amp;#34;yes&amp;#34; &lt;span a=&quot;b&quot;&gt; a &lt;/span&gt; &lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;yes&quot;&#39;</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_out_format_4">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_out_format_4">[docs]</a>
    <span class="k">def</span> <span class="nf">test_out_format_4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;abc&quot;&gt; &lt;span a=&quot;b&quot;&gt; a &lt;/span&gt; &lt;/t&gt;</span>
<span class="s1">                &lt;div t-out=&quot;(v + abc)&quot;&gt;123&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;&amp;#34;yes&amp;#34; &lt;span a=&quot;b&quot;&gt; a &lt;/span&gt; &lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;yes&quot;&#39;</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_out_format_5">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_out_format_5">[docs]</a>
    <span class="k">def</span> <span class="nf">test_out_format_5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;abc&quot;&gt; &lt;span a=&quot;b&quot;&gt; a &lt;/span&gt; &lt;/t&gt;</span>
<span class="s1">                &lt;div t-out=&quot;(abc + v)&quot;&gt;123&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt; &lt;span a=&quot;b&quot;&gt; a &lt;/span&gt; &amp;#34;yes&amp;#34;&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;yes&quot;&#39;</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_out_format_6">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_out_format_6">[docs]</a>
    <span class="k">def</span> <span class="nf">test_out_format_6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Use str method will use the string value. t-out will escape this str</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;abc&quot;&gt; &lt;span a=&quot;b&quot;&gt; a &lt;/span&gt; &lt;/t&gt;</span>
<span class="s1">                &lt;div t-out=&quot;(abc.strip() + v)&quot;&gt;123&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;&lt;span a=&quot;b&quot;&gt; a &lt;/span&gt;&amp;#34;yes&amp;#34;&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;yes&quot;&#39;</span><span class="p">}</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_out_escape_text">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_out_escape_text">[docs]</a>
    <span class="k">def</span> <span class="nf">test_out_escape_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;&lt;root&gt;&lt;span t-out=&quot;text&quot; t-options-widget=&quot;&#39;text&#39;&quot;/&gt;&lt;/root&gt;&lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;a</span>
<span class="s2">        b &lt;b&gt;c&lt;/b&gt;&quot;&quot;&quot;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">html</span><span class="p">,</span> <span class="s2">&quot;&quot;&quot;&lt;root&gt;&lt;span data-oe-type=&quot;text&quot; data-oe-expression=&quot;text&quot;&gt;a&lt;br&gt;</span>
<span class="s2">        b &amp;lt;b&amp;gt;c&amp;lt;/b&amp;gt;&lt;/span&gt;&lt;/root&gt;&quot;&quot;&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_out_markup">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_out_markup">[docs]</a>
    <span class="k">def</span> <span class="nf">test_out_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;esc-markup&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;content&quot;&gt;&lt;span&gt;toto&lt;/span&gt;&lt;/t&gt;</span>
<span class="s1">                &lt;div t-out=&quot;content&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;&lt;span&gt;toto&lt;/span&gt;&lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_out_default_value">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_out_default_value">[docs]</a>
    <span class="k">def</span> <span class="nf">test_out_default_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;out-default&quot;&gt;</span>
<span class="s1">                &lt;span rows=&quot;10&quot; t-out=&quot;a&quot;&gt;</span>
<span class="s1">                    DEFAULT</span>
<span class="s1">                    &lt;t t-out=&quot;&#39;Text&#39;&quot; /&gt;</span>
<span class="s1">                &lt;/span&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;span rows=&quot;10&quot;&gt;Hello&lt;/span&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;Hello&#39;</span><span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;span rows=&quot;10&quot;&gt;</span>
<span class="s2">                    DEFAULT</span>
<span class="s2">                    Text</span>
<span class="s2">                &lt;/span&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_esc_markup">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_esc_markup">[docs]</a>
    <span class="k">def</span> <span class="nf">test_esc_markup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># t-esc is equal to t-out</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;esc-markup&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;content&quot;&gt;&lt;span&gt;toto&lt;/span&gt;&lt;/t&gt;</span>
<span class="s1">                &lt;div t-esc=&quot;content&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;esc-markup&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;content&quot;&gt;&lt;span&gt;toto&lt;/span&gt;&lt;/t&gt;</span>
<span class="s1">                &lt;div t-out=&quot;content&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_if_from_body">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_if_from_body">[docs]</a>
    <span class="k">def</span> <span class="nf">test_if_from_body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;attr-set&quot;&gt;</span>
<span class="s1">                &lt;t t-set=&quot;abc&quot;&gt; &lt;span a=&quot;b&quot;&gt; a &lt;/span&gt; &lt;/t&gt;</span>
<span class="s1">                &lt;div t-if=&quot;abc&quot;&gt;123&lt;/div&gt;</span>
<span class="s1">                &lt;div t-if=&quot;not abc&quot;&gt;456&lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;123&lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_if_spaces">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_if_spaces">[docs]</a>
    <span class="k">def</span> <span class="nf">test_if_spaces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;test&quot;&gt;</span>
<span class="s1">                &lt;div&gt;</span>
<span class="s1">                    0</span>
<span class="s1">                    &lt;t&gt;1&lt;/t&gt;</span>
<span class="s1">                    &lt;t t-if=&quot;True&quot;&gt;2&lt;/t&gt;</span>
<span class="s1">                    &lt;t&gt;3&lt;/t&gt;</span>
<span class="s1">                    4</span>
<span class="s1">                    &lt;t&gt;5&lt;/t&gt;</span>
<span class="s1">                    6</span>
<span class="s1">                    &lt;t t-if=&quot;True&quot;&gt;7&lt;/t&gt;</span>
<span class="s1">                    8</span>
<span class="s1">                    &lt;t t-if=&quot;False&quot;&gt;9&lt;/t&gt;</span>
<span class="s1">                    10</span>
<span class="s1">                    &lt;t t-if=&quot;False&quot;&gt;11&lt;/t&gt;</span>
<span class="s1">                    &lt;t t-else=&quot;&quot;&gt;12&lt;/t&gt;</span>
<span class="s1">                    13</span>
<span class="s1">                &lt;/div&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;div&gt;</span>
<span class="s2">                    0</span>
<span class="s2">                    1</span>
<span class="s2">                    2</span>
<span class="s2">                    3</span>
<span class="s2">                    4</span>
<span class="s2">                    5</span>
<span class="s2">                    6</span>
<span class="s2">                    7</span>
<span class="s2">                    8</span>
<span class="s2">                    10</span>
<span class="s2">                    12</span>
<span class="s2">                    13</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_error_message_1">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_error_message_1">[docs]</a>
    <span class="k">def</span> <span class="nf">test_error_message_1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;test&quot;&gt;</span>
<span class="s1">                &lt;section&gt;</span>
<span class="s1">                    &lt;div t-esc=&quot;abc + def&quot;&gt;</span>
<span class="s1">                        &lt;span&gt;content&lt;/span&gt;</span>
<span class="s1">                    &lt;/div&gt;</span>
<span class="s1">                &lt;/section&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">QWebException</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">QWebException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;div t-esc=&quot;abc + def&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_error_message_2">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_error_message_2">[docs]</a>
    <span class="k">def</span> <span class="nf">test_error_message_2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&quot;test&quot;&gt;</span>
<span class="s1">                &lt;section&gt;</span>
<span class="s1">                    &lt;div t-esc=&quot;abc + def + (&quot;&gt;</span>
<span class="s1">                        &lt;span&gt;content&lt;/span&gt;</span>
<span class="s1">                    &lt;/div&gt;</span>
<span class="s1">                &lt;/section&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">QWebException</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">QWebException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;Can not compile expression&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;div t-esc=&quot;abc + def + (&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_error_message_3">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_error_message_3">[docs]</a>
    <span class="k">def</span> <span class="nf">test_error_message_3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># The format error tells the developer what to do.</span>
        <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;&lt;section&gt;</span>
<span class="s1">                    &lt;div t-esc=&quot;1+2&quot;&gt;</span>
<span class="s1">                        &lt;span&gt;content&lt;/span&gt;</span>
<span class="s1">                    &lt;/div&gt;</span>
<span class="s1">                &lt;/section&gt;&#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;Inline templates must be passed as `etree` documents&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="n">template</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;toto &lt;t t-esc=&quot;content&quot;/&gt;&#39;&#39;&#39;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;Inline templates must be passed as `etree` documents&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_error_message_4">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_error_message_4">[docs]</a>
    <span class="k">def</span> <span class="nf">test_error_message_4</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Template record view not found.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">MissingError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="o">-</span><span class="mi">999</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="o">-</span><span class="mi">999</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">MissingError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;Record does not exist or has been deleted.&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">ValueError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="s1">&#39;not.wrong_template_xmlid&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="s1">&#39;not.wrong_template_xmlid&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;External ID not found in the system&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">AssertionError</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;template is required&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_error_message_5">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_error_message_5">[docs]</a>
    <span class="k">def</span> <span class="nf">test_error_message_5</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Error not found a first rendering.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">MissingError</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Not Found&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_error_message_6">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_error_message_6">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_qweb&#39;</span><span class="p">)</span> <span class="c1"># warning for template not found</span>
    <span class="k">def</span> <span class="nf">test_error_message_6</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Error not found a second rendering (first rendering with option hide this error).</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">raise_if_not_found</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>

        <span class="c1"># re try this rendering without any error (use cached method)</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">raise_if_not_found</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>

        <span class="c1"># re try this rendering but raise (use cached method)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">MissingError</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Not Found&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_error_message_7">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_error_message_7">[docs]</a>
    <span class="k">def</span> <span class="nf">test_error_message_7</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># UserError not found a first rendering.</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">UserError</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Not Found&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_error_message_8">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_error_message_8">[docs]</a>
    <span class="nd">@mute_logger</span><span class="p">(</span><span class="s1">&#39;odoo.addons.base.models.ir_qweb&#39;</span><span class="p">)</span> <span class="c1"># warning for template not found</span>
    <span class="k">def</span> <span class="nf">test_error_message_8</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># UserError not found a second rendering (first rendering with option hide this error).</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">raise_if_not_found</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>

        <span class="c1"># re try this rendering without any error (use cached method)</span>
        <span class="n">html</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">,</span> <span class="n">raise_if_not_found</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">html</span><span class="p">)</span>

        <span class="c1"># re try this rendering but raise (use cached method)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">UserError</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Not Found&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="o">-</span><span class="mi">9999</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_call_set">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_call_set">[docs]</a>
    <span class="k">def</span> <span class="nf">test_call_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;table&gt;</span>
<span class="s2">                        &lt;tr&gt;&lt;td t-out=&quot;a&quot;/&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;t t-set=&quot;a&quot;&gt;3&lt;/t&gt;</span>
<span class="s2">                    &lt;/table&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ir_model_data(name, model, res_id, module)&quot;</span>
                            <span class="s2">&quot;VALUES (&#39;dummy&#39;, &#39;ir.ui.view&#39;, </span><span class="si">%s</span><span class="s2">, &#39;base&#39;)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">view0</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;other&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.other&quot;&gt;</span>
<span class="s2">                    &lt;div&gt;</span>
<span class="s2">                        &lt;t t-set=&quot;a&quot;&gt;1&lt;/t&gt;</span>
<span class="s2">                        &lt;t t-set=&quot;b&quot;&gt;1&lt;/t&gt;</span>
<span class="s2">                        &lt;t t-call=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                            &lt;t t-set=&quot;b&quot;&gt;2&lt;/t&gt;</span>
<span class="s2">                        &lt;/t&gt;</span>
<span class="s2">                        &lt;span t-out=&quot;a&quot;/&gt;</span>
<span class="s2">                        &lt;span t-out=&quot;b&quot;/&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">                &lt;span&gt;1&lt;/span&gt;</span>
<span class="s2">                &lt;span&gt;1&lt;/span&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;render t-call use lexical scoping, t-call content use independant scoping&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_call_error">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_call_error">[docs]</a>
    <span class="k">def</span> <span class="nf">test_call_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;other&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.other&quot;&gt;</span>
<span class="s2">                    &lt;div&gt;</span>
<span class="s2">                        &lt;t t-call=&quot;base.dummy&quot;/&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="n">QWebException</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">QWebException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;External ID not found in the system: base.dummy&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assertIn</span><span class="p">(</span><span class="s1">&#39;&lt;t t-call=&quot;base.dummy&quot;/&gt;&#39;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_render_t_call_propagates_t_lang">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_render_t_call_propagates_t_lang">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_t_call_propagates_t_lang</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">current_lang</span> <span class="o">=</span> <span class="s1">&#39;en_US&#39;</span>
        <span class="n">other_lang</span> <span class="o">=</span> <span class="s1">&#39;fr_FR&#39;</span>

        <span class="n">lang</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_activate_lang</span><span class="p">(</span><span class="n">other_lang</span><span class="p">)</span>
        <span class="n">lang</span><span class="o">.</span><span class="n">write</span><span class="p">({</span>
            <span class="s1">&#39;decimal_point&#39;</span><span class="p">:</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
            <span class="s1">&#39;thousands_sep&#39;</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span>
        <span class="p">})</span>

        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;callee&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.callee&quot;&gt;</span>
<span class="s2">                    &lt;t t-esc=&quot;9000000.00&quot; t-options=&quot;{&#39;widget&#39;: &#39;float&#39;, &#39;precision&#39;: 2}&quot; /&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.model.data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;callee&#39;</span><span class="p">,</span>
            <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="s1">&#39;ir.ui.view&#39;</span><span class="p">,</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;base&#39;</span><span class="p">,</span>
            <span class="s1">&#39;res_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;calling&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.calling&quot;&gt;</span>
<span class="s2">                    &lt;t t-call=&quot;base.callee&quot; t-lang=&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot; /&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">other_lang</span>
        <span class="p">})</span>

        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="n">current_lang</span><span class="p">)</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="s1">&#39;9/000/000*00&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_render_barcode">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_render_barcode">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_barcode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">partner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.partner&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;bacode_test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;barcode&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span>
        <span class="p">})</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;a_barcode_view&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">view</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;div t-field=&quot;partner.barcode&quot; t-options=&quot;{&#39;widget&#39;: &#39;barcode&#39;, &#39;width&#39;: 100, &#39;height&#39;: 30}&quot;/&gt;&quot;&quot;&quot;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;partner&#39;</span><span class="p">:</span> <span class="n">partner</span><span class="p">})</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">rendered</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&lt;div&gt;&lt;img alt=&quot;Barcode test&quot; src=&quot;data:image/png;base64,\S+&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">)</span>

        <span class="n">partner</span><span class="o">.</span><span class="n">barcode</span> <span class="o">=</span> <span class="s1">&#39;4012345678901&#39;</span>
        <span class="n">view</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;div t-field=&quot;partner.barcode&quot; t-options=&quot;{&#39;widget&#39;: &#39;barcode&#39;, &#39;symbology&#39;: &#39;EAN13&#39;, &#39;width&#39;: 100, &#39;height&#39;: 30, &#39;img_style&#39;: &#39;width:100%;&#39;, &#39;img_alt&#39;: &#39;Barcode&#39;}&quot;/&gt;&quot;&quot;&quot;</span>
        <span class="n">ean_rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;partner&#39;</span><span class="p">:</span> <span class="n">partner</span><span class="p">})</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">ean_rendered</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&lt;div&gt;&lt;img style=&quot;width:100%;&quot; alt=&quot;Barcode&quot; src=&quot;data:image/png;base64,\S+&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">)</span>

        <span class="n">view</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;div t-field=&quot;partner.barcode&quot; t-options=&quot;{&#39;widget&#39;: &#39;barcode&#39;, &#39;symbology&#39;: &#39;auto&#39;, &#39;width&#39;: 100, &#39;height&#39;: 30, &#39;img_style&#39;: &#39;width:100%;&#39;, &#39;img_alt&#39;: &#39;Barcode&#39;}&quot;/&gt;&quot;&quot;&quot;</span>
        <span class="n">auto_rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;partner&#39;</span><span class="p">:</span> <span class="n">partner</span><span class="p">})</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertRegex</span><span class="p">(</span><span class="n">auto_rendered</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;&lt;div&gt;&lt;img style=&quot;width:100%;&quot; alt=&quot;Barcode&quot; src=&quot;data:image/png;base64,\S+&quot;&gt;&lt;/div&gt;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_render_comment_tail">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_render_comment_tail">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_comment_tail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test the rendering of a tail text, near a comment.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s2">&quot;qweb&quot;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;t&gt;</span>
<span class="s2">                &lt;!-- it is a comment --&gt;</span>
<span class="s2">                &lt;!-- it is another comment --&gt;</span>
<span class="s2">                Text 1</span>
<span class="s2">                &lt;!-- it is still another comment --&gt;</span>
<span class="s2">                Text 2</span>
<span class="s2">                &lt;t&gt;ok&lt;/t&gt;</span>
<span class="s2">            &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">emptyline</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">                &#39;</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">markupsafe</span><span class="o">.</span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;Text 1&#39;</span> <span class="o">+</span> <span class="n">emptyline</span> <span class="o">+</span> <span class="n">emptyline</span> <span class="o">+</span> <span class="s1">&#39;Text 2&#39;</span> <span class="o">+</span> <span class="n">emptyline</span> <span class="o">+</span> <span class="s1">&#39;ok&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">expected</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_render_comments">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_render_comments">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_comments</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test the rendering of comments with and without the</span>
<span class="sd">            preserve_comments option.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">comment</span> <span class="o">=</span> <span class="s1">&#39;&lt;!-- Hello, world! --&gt;&#39;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;dummy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;&lt;t&gt;&lt;p&gt;</span><span class="si">{</span><span class="n">comment</span><span class="si">}</span><span class="s1">&lt;/p&gt;&lt;/t&gt;&#39;</span>
        <span class="p">})</span>
        <span class="n">QWeb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">QWeb</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">preserve_comments</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="n">markupsafe</span><span class="o">.</span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;&lt;/p&gt;&#39;</span><span class="p">),</span>
            <span class="s2">&quot;Should not have the comment&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">(</span><span class="s1">&#39;templates&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">QWeb</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">preserve_comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="n">markupsafe</span><span class="o">.</span><span class="n">Markup</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p&gt;</span><span class="si">{</span><span class="n">comment</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">),</span>
            <span class="s2">&quot;Should have the comment&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_render_processing_instructions">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_render_processing_instructions">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_processing_instructions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Test the rendering of processing instructions with and without the</span>
<span class="sd">            preserve_comments option.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">p_instruction</span> <span class="o">=</span> <span class="s1">&#39;&lt;?hello world?&gt;&#39;</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;dummy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;&lt;t&gt;&lt;p&gt;</span><span class="si">{</span><span class="n">p_instruction</span><span class="si">}</span><span class="s1">&lt;/p&gt;&lt;/t&gt;&#39;</span>
        <span class="p">})</span>
        <span class="n">QWeb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">QWeb</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">preserve_comments</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="n">markupsafe</span><span class="o">.</span><span class="n">Markup</span><span class="p">(</span><span class="s1">&#39;&lt;p&gt;&lt;/p&gt;&#39;</span><span class="p">),</span>
            <span class="s2">&quot;Should not have the processing instruction&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">registry</span><span class="o">.</span><span class="n">clear_cache</span><span class="p">(</span><span class="s1">&#39;templates&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span>
            <span class="n">QWeb</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">preserve_comments</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
            <span class="n">markupsafe</span><span class="o">.</span><span class="n">Markup</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&lt;p&gt;</span><span class="si">{</span><span class="n">p_instruction</span><span class="si">}</span><span class="s1">&lt;/p&gt;&#39;</span><span class="p">),</span>
            <span class="s2">&quot;Should have the processing instruction&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_render_widget_contact">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_render_widget_contact">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_widget_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.users&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;login&#39;</span><span class="p">:</span> <span class="s1">&#39;test@example.com&#39;</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">u</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;&lt;root&gt;&lt;span t-esc=&quot;user&quot; t-options=&#39;{&quot;widget&quot;: &quot;contact&quot;, &quot;fields&quot;: [&quot;name&quot;]}&#39; /&gt;&lt;/root&gt;&lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">u</span><span class="p">})</span>  <span class="c1"># should not crash</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_render_widget_duration_fallback">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_render_widget_duration_fallback">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_widget_duration_fallback</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;res.lang&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">active_test</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">([(</span><span class="s1">&#39;code&#39;</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">,</span> <span class="s1">&#39;pt_BR&#39;</span><span class="p">)])</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;&lt;root&gt;&lt;span t-esc=&quot;3600&quot; t-options=&#39;{&quot;widget&quot;: &quot;duration&quot;, &quot;format&quot;: &quot;short&quot;}&#39; /&gt;&lt;/root&gt;&lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">lang</span><span class="o">=</span><span class="s1">&#39;pt_BR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{})</span>  <span class="c1"># should not crash</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_void_element">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_void_element">[docs]</a>
    <span class="k">def</span> <span class="nf">test_void_element</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;master&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&#39;master&#39;&gt;</span>
<span class="s1">                &lt;meta name=&quot;1&quot;/&gt;</span>
<span class="s1">                &lt;t t-set=&quot;data&quot; t-value=&quot;1&quot;/&gt;</span>
<span class="s1">                &lt;meta groups=&quot;base.group_no_one&quot; name=&quot;2&quot;/&gt;</span>
<span class="s1">                &lt;meta t-if=&quot;False&quot; name=&quot;3&quot;/&gt;</span>
<span class="s1">                &lt;meta t-if=&quot;True&quot; name=&quot;4&quot;/&gt;</span>
<span class="s1">                &lt;span t-out=&quot;1&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                &lt;meta name=&quot;1&quot;/&gt;</span>
<span class="s1">                &lt;meta name=&quot;4&quot;/&gt;</span>
<span class="s1">                &lt;span&gt;1&lt;/span&gt;</span>
<span class="s1">            &#39;&#39;&#39;</span>
        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rendered</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="n">result</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_space_remove_technical_space_t_foreach">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_space_remove_technical_space_t_foreach">[docs]</a>
    <span class="k">def</span> <span class="nf">test_space_remove_technical_space_t_foreach</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;master&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&#39;master&#39;&gt;</span>
<span class="s1">                    &lt;section&gt;</span>
<span class="s1">                        &lt;article t-foreach=&quot;[0, 1, 2]&quot; t-as=&quot;value&quot; t-esc=&quot;value&quot;/&gt;</span>
<span class="s1">                        &lt;t t-foreach=&quot;[0, 1, 2]&quot; t-as=&quot;value&quot;&gt;</span>
<span class="s1">                            &lt;article t-esc=&quot;value&quot;/&gt;</span>
<span class="s1">                        &lt;/t&gt;</span>
<span class="s1">                    &lt;/section&gt;</span>
<span class="s1">                &lt;/t&gt;&#39;&#39;&#39;</span><span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                    &lt;section&gt;</span>
<span class="s1">                        &lt;article&gt;0&lt;/article&gt;&lt;article&gt;1&lt;/article&gt;&lt;article&gt;2&lt;/article&gt;</span>
<span class="s1">                            &lt;article&gt;0&lt;/article&gt;</span>
<span class="s1">                            &lt;article&gt;1&lt;/article&gt;</span>
<span class="s1">                            &lt;article&gt;2&lt;/article&gt;</span>
<span class="s1">                    &lt;/section&gt;&#39;&#39;&#39;</span>

        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rendered</span><span class="p">),</span> <span class="n">result</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQWebBasic.test_space_remove_technical_all">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQWebBasic.test_space_remove_technical_all">[docs]</a>
    <span class="k">def</span> <span class="nf">test_space_remove_technical_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">test</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;test&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&#39;test&#39;&gt;</span>
<span class="s1">                &lt;span t-out=&quot;value&quot;/&gt;</span>
<span class="s1">            &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO ir_model_data(name, model, res_id, module)&quot;</span>
                            <span class="s2">&quot;VALUES (&#39;test&#39;, &#39;ir.ui.view&#39;, </span><span class="si">%s</span><span class="s2">, &#39;base&#39;)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">test</span><span class="o">.</span><span class="n">id</span><span class="p">])</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;master&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch_db&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;&lt;t t-name=&#39;master&#39;&gt;</span>

<span class="s1">                    &lt;section&gt;</span>
<span class="s1">                        &lt;meta name=&quot;1&quot;/&gt;</span>
<span class="s1">                        &lt;t t-set=&quot;data&quot; t-value=&quot;1&quot;/&gt;</span>
<span class="s1">                        &lt;meta groups=&quot;base.group_no_one&quot; name=&quot;2&quot;/&gt;</span>
<span class="s1">                        &lt;meta t-if=&quot;False&quot; name=&quot;3&quot;/&gt;</span>
<span class="s1">                        &lt;meta t-if=&quot;True&quot; name=&quot;4&quot;/&gt;</span>

<span class="s1">                        &lt;article&gt;</span>
<span class="s1">                            &lt;t t-foreach=&quot;[0, 1]&quot; t-as=&quot;value&quot;&gt;</span>
<span class="s1">                                &lt;t t-call=&quot;base.test&quot;/&gt;</span>
<span class="s1">                            &lt;/t&gt;</span>

<span class="s1">                            &lt;t t-if=&quot;False&quot;&gt;</span>
<span class="s1">                                a</span>
<span class="s1">                            &lt;/t&gt;</span>
<span class="s1">                    </span>
<span class="s1">                            b</span>

<span class="s1">                            &lt;t t-if=&quot;True&quot;&gt;</span>
<span class="s1">                                c &lt;t t-out=&quot;1&quot;/&gt;  </span>
<span class="s1">                                d</span>
<span class="s1">                            &lt;/t&gt;</span>
<span class="s1">                        &lt;/article&gt;</span>


<span class="s1">                        &lt;article&gt;</span>
<span class="s1">                            &lt;div t-foreach=&quot;[0, 1]&quot; t-as=&quot;value&quot;&gt;</span>
<span class="s1">                                &lt;t t-call=&quot;base.test&quot;/&gt;</span>
<span class="s1">                            &lt;/div&gt;</span>

<span class="s1">                            &lt;i t-if=&quot;False&quot;&gt;</span>
<span class="s1">                                a</span>
<span class="s1">                            &lt;/i&gt;</span>
<span class="s1">                            &lt;u t-if=&quot;False&quot;&gt;</span>
<span class="s1">                                a</span>
<span class="s1">                            &lt;/u&gt;</span>
<span class="s1">                    </span>
<span class="s1">                            b</span>

<span class="s1">                            &lt;i t-if=&quot;True&quot;&gt;</span>
<span class="s1">                                c &lt;t t-out=&quot;1&quot;/&gt;  </span>
<span class="s1">                                d</span>
<span class="s1">                            &lt;/i&gt;</span>
<span class="s1">                        &lt;/article&gt;</span>
<span class="s1">                    &lt;/section&gt;</span>
<span class="s1">                &lt;/t&gt;&#39;&#39;&#39;</span>
        <span class="p">})</span>

        <span class="n">result</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                    &lt;section&gt;</span>
<span class="s1">                        &lt;meta name=&quot;1&quot;/&gt;</span>
<span class="s1">                        &lt;meta name=&quot;4&quot;/&gt;</span>

<span class="s1">                        &lt;article&gt;</span>
<span class="s1">                &lt;span&gt;0&lt;/span&gt;</span>
<span class="s1">                &lt;span&gt;1&lt;/span&gt;</span>

<span class="s1">                    </span>
<span class="s1">                            b</span>

<span class="s1">                                c 1  </span>
<span class="s1">                                d</span>
<span class="s1">                        &lt;/article&gt;</span>


<span class="s1">                        &lt;article&gt;</span>
<span class="s1">                            &lt;div&gt;</span>
<span class="s1">                &lt;span&gt;0&lt;/span&gt;</span>
<span class="s1">                            &lt;/div&gt;&lt;div&gt;</span>
<span class="s1">                &lt;span&gt;1&lt;/span&gt;</span>
<span class="s1">                            &lt;/div&gt;</span>

<span class="s1">                    </span>
<span class="s1">                            b</span>

<span class="s1">                            &lt;i&gt;</span>
<span class="s1">                                c 1  </span>
<span class="s1">                                d</span>
<span class="s1">                            &lt;/i&gt;</span>
<span class="s1">                        &lt;/article&gt;</span>
<span class="s1">                    &lt;/section&gt;&#39;&#39;&#39;</span>

        <span class="n">rendered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">rendered</span><span class="p">),</span> <span class="n">result</span><span class="p">)</span></div>
</div>


<div class="viewcode-block" id="TestQwebCache">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache">[docs]</a>
<span class="k">class</span> <span class="nc">TestQwebCache</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestQwebCache.test_render_xml_cache_base">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_cache_base">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_cache_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div t-cache=&quot;cache_id&quot; class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;1&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;2&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;3&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected_result</span><span class="p">,</span> <span class="s1">&#39;First rendering (add in cache)&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected_result</span><span class="p">,</span> <span class="s1">&#39;Next rendering use cache&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_cache_different">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_cache_different">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_cache_different</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                        &lt;table t-cache=&quot;cache_id2&quot;&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value2[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value2[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value2[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># use same cache id, display the same content</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;1&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;2&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;3&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;10&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;20&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;30&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;First rendering (add in cache with different cache)&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;41&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;42&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;43&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;51&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;52&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;53&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Use different cache id&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_cache_contains_nocache">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_cache_contains_nocache">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_cache_contains_nocache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div t-cache=&quot;cache_id&quot; class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr t-nocache=&quot;&quot;&gt;&lt;td&gt;&lt;span t-esc=&quot;value[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;1&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;2&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;3&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;First rendering add compiled values in cache&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;1&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;20&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;3&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Next rendering use cache exept for t-nocache=&quot;&quot;&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_cache_nocache_cache">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_cache_nocache_cache">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_cache_nocache_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;</span>
<span class="s2">                                &lt;td&gt;</span>
<span class="s2">                                    &lt;table t-nocache=&quot;The content is not used, we can put documentation in it.&quot; t-cache=&quot;cache_id2&quot;&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                    &lt;/table&gt;</span>
<span class="s2">                                &lt;/td&gt;</span>
<span class="s2">                            &lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># use same cache id, display the same content</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;20&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;30&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;First rendering (add in cache)&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;51&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;52&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;53&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Second rendering (change inside cache id)&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;31&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;20&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;30&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;33&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Third rendering (change main cache id, old cache inside)&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_cache_nocache_cache_on_same_tag">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_cache_nocache_cache_on_same_tag">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_cache_nocache_cache_on_same_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr t-nocache=&quot;&quot;&gt;</span>
<span class="s2">                                &lt;td&gt;</span>
<span class="s2">                                    &lt;table t-cache=&quot;cache_id2&quot;&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                    &lt;/table&gt;</span>
<span class="s2">                                &lt;/td&gt;</span>
<span class="s2">                            &lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># use same cache id, display the same content</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;20&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;30&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;First rendering (add in cache)&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;51&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;52&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;53&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Second rendering (change inside cache id)&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;31&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;20&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;30&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;33&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Third rendering (change main cache id, old cache inside)&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_dont_use_cache_base">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_dont_use_cache_base">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_dont_use_cache_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div t-cache=&quot;cache_id&quot; class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;1&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;2&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;3&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;First rendering&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;10&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;20&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;30&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Next rendering cannot cache (use_qweb_t_cache is False)&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_dont_use_cache_different">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_dont_use_cache_different">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_dont_use_cache_different</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                        &lt;table t-cache=&quot;cache_id2&quot;&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value2[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value2[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value2[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># use same cache id, display the same content</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;1&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;2&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;3&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;10&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;20&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;30&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;First rendering&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;41&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;42&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;43&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;51&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;52&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;53&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Use different cache id&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_dont_use_cache_contains_nocache">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_dont_use_cache_contains_nocache">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_dont_use_cache_contains_nocache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div t-cache=&quot;cache_id&quot; class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr t-nocache=&quot;&quot;&gt;&lt;td&gt;&lt;span t-esc=&quot;value[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;1&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;2&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;3&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;First rendering&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;10&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;20&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;30&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Next rendering cannot use cache (use_qweb_t_cache is False)&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_dont_use_cache_recursive">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_dont_use_cache_recursive">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_dont_use_cache_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;</span>
<span class="s2">                                &lt;td&gt;</span>
<span class="s2">                                    &lt;table t-nocache=&quot;&quot; t-cache=&quot;cache_id2&quot;&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                    &lt;/table&gt;</span>
<span class="s2">                                &lt;/td&gt;</span>
<span class="s2">                            &lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># use same cache id, display the same content</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;20&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;30&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;First rendering&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;41&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;51&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;52&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;53&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;43&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Next rendering cannot use cache (use_qweb_t_cache is False)&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;31&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;51&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;52&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;53&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;33&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Third rendering cannot use cache (use_qweb_t_cache is False)&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_dont_use_cache_false_recursive">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_dont_use_cache_false_recursive">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_dont_use_cache_false_recursive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr t-nocache=&quot;&quot;&gt;</span>
<span class="s2">                                &lt;td&gt;</span>
<span class="s2">                                    &lt;table t-cache=&quot;cache_id2&quot;&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                        &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value2[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                    &lt;/table&gt;</span>
<span class="s2">                                &lt;/td&gt;</span>
<span class="s2">                            &lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;t t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># use same cache id, display the same content</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;1&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;10&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;20&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;30&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;3&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;First rendering&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">41</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">43</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;41&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;51&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;52&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;53&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;43&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Next rendering cannot use cache (use_qweb_t_cache is False)&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
            <span class="s1">&#39;cache_id2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">31</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">33</span><span class="p">],</span>
            <span class="s1">&#39;value2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">51</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">53</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;31&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;</span>
<span class="s2">                        &lt;td&gt;</span>
<span class="s2">                            &lt;table&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;51&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;52&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                                &lt;tr&gt;&lt;td&gt;53&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;/table&gt;</span>
<span class="s2">                        &lt;/td&gt;</span>
<span class="s2">                    &lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;33&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">),</span> <span class="s1">&#39;Third rendering cannot use cache (use_qweb_t_cache is False)&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_nocache_use_the_root_values">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_nocache_use_the_root_values">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_nocache_use_the_root_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;template_page&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;template_page&quot;&gt;</span>
<span class="s2">                    &lt;section t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                        &lt;t t-set=&quot;counter&quot; t-value=&quot;counter + 100&quot;/&gt;</span>
<span class="s2">                        &lt;article t-nocache=&quot;&quot;&gt;&lt;t t-out=&quot;counter&quot;/&gt;&lt;/article&gt;</span>
<span class="s2">                        &lt;div&gt;cache: &lt;t t-out=&quot;counter&quot;/&gt;&lt;/div&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;section&gt;</span>
<span class="s2">                &lt;article&gt;1&lt;/article&gt;</span>
<span class="s2">                &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">            &lt;/section&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 1 (101 != 1: cached t-set should never be applied on root rendering)&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;section&gt;</span>
<span class="s2">                &lt;article&gt;2&lt;/article&gt;</span>
<span class="s2">                &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">            &lt;/section&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 2 (102 != 2: cached t-set should never be applied on root rendering)&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;section&gt;</span>
<span class="s2">                &lt;article&gt;3&lt;/article&gt;</span>
<span class="s2">                &lt;div&gt;cache: 103&lt;/div&gt;</span>
<span class="s2">            &lt;/section&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 3 (103 != 3: cached t-set should never be applied on root rendering)&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_nocache_use_the_root_values_and_cached_values">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_nocache_use_the_root_values_and_cached_values">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_nocache_use_the_root_values_and_cached_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;template_page&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;template_page&quot;&gt;</span>
<span class="s2">                    &lt;section t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                        &lt;t t-set=&quot;counter&quot; t-value=&quot;counter + 100&quot;/&gt;</span>
<span class="s2">                        &lt;article t-nocache=&quot;&quot; t-nocache-counter=&quot;counter&quot;&gt;&lt;t t-out=&quot;counter&quot;/&gt;&lt;/article&gt;</span>
<span class="s2">                        &lt;div&gt;cache: &lt;t t-out=&quot;counter&quot;/&gt;&lt;/div&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;section&gt;</span>
<span class="s2">                &lt;article&gt;101&lt;/article&gt;</span>
<span class="s2">                &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">            &lt;/section&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 1 (1 != 101: new cached values should be add to the root rendering)&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;section&gt;</span>
<span class="s2">                &lt;article&gt;101&lt;/article&gt;</span>
<span class="s2">                &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">            &lt;/section&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 2 (102 != 2: cached values should be used)&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;section&gt;</span>
<span class="s2">                &lt;article&gt;103&lt;/article&gt;</span>
<span class="s2">                &lt;div&gt;cache: 103&lt;/div&gt;</span>
<span class="s2">            &lt;/section&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 3 (3 != 103: new cached values should be add to the root rendering)&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_nocache_use_the_root_values_and_cached_values_error">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_nocache_use_the_root_values_and_cached_values_error">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_nocache_use_the_root_values_and_cached_values_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;template_page&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;template_page&quot;&gt;</span>
<span class="s2">                    &lt;section t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                        &lt;article t-nocache=&quot;&quot; t-nocache-record=&quot;view_record&quot;&gt;&lt;t t-out=&quot;view_record&quot;/&gt;&lt;/article&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaisesRegex</span><span class="p">(</span><span class="n">QWebException</span><span class="p">,</span> <span class="s2">&quot;The value type of &#39;t-nocache-record&#39; cannot be cached&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;view_record&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">([],</span> <span class="n">limit</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">})</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_cache_with_t_set_out_of_cache">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_cache_with_t_set_out_of_cache">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_cache_with_t_set_out_of_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;template_page&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;template_page&quot;&gt;</span>
<span class="s2">                    &lt;root&gt;</span>
<span class="s2">                        &lt;t t-set=&quot;counter&quot; t-value=&quot;counter + 100&quot;/&gt;</span>
<span class="s2">                        &lt;section t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                            &lt;article t-nocache=&quot;&quot;&gt;&lt;t t-out=&quot;counter&quot;/&gt;&lt;/article&gt;</span>
<span class="s2">                            &lt;div&gt;cache: &lt;t t-out=&quot;counter&quot;/&gt;&lt;/div&gt;</span>
<span class="s2">                        &lt;/section&gt;</span>
<span class="s2">                    &lt;/root&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;section&gt;</span>
<span class="s2">                    &lt;article&gt;1&lt;/article&gt;</span>
<span class="s2">                    &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">                &lt;/section&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 1 (1 != 101: cached t-set should is applied on first rendering)&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;section&gt;</span>
<span class="s2">                    &lt;article&gt;2&lt;/article&gt;</span>
<span class="s2">                    &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">                &lt;/section&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 2 (2 != 102: cached t-set should be applied the template part are rendered every time)&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;section&gt;</span>
<span class="s2">                    &lt;article&gt;3&lt;/article&gt;</span>
<span class="s2">                    &lt;div&gt;cache: 103&lt;/div&gt;</span>
<span class="s2">                &lt;/section&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 3 (3 != 103: cached t-set should applied because the new cache key is created)&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_cache_with_t_set_in_cache">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_cache_with_t_set_in_cache">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_cache_with_t_set_in_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;template_page&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;template_page&quot;&gt;</span>
<span class="s2">                    &lt;root&gt;</span>
<span class="s2">                        &lt;section t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                            &lt;t t-set=&quot;counter&quot; t-value=&quot;counter + 100&quot;/&gt;</span>
<span class="s2">                            &lt;article t-nocache=&quot;&quot;&gt;&lt;t t-out=&quot;counter&quot;/&gt;&lt;/article&gt;</span>
<span class="s2">                            &lt;div&gt;cache: &lt;t t-out=&quot;counter&quot;/&gt;&lt;/div&gt;</span>
<span class="s2">                        &lt;/section&gt;</span>
<span class="s2">                        &lt;div&gt;out of cache: &lt;t t-out=&quot;counter&quot;/&gt;&lt;/div&gt;</span>
<span class="s2">                    &lt;/root&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;section&gt;</span>
<span class="s2">                    &lt;article&gt;1&lt;/article&gt;</span>
<span class="s2">                    &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">                &lt;/section&gt;</span>
<span class="s2">                &lt;div&gt;out of cache: 1&lt;/div&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 1&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;section&gt;</span>
<span class="s2">                    &lt;article&gt;2&lt;/article&gt;</span>
<span class="s2">                    &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">                &lt;/section&gt;</span>
<span class="s2">                &lt;div&gt;out of cache: 2&lt;/div&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 2&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;section&gt;</span>
<span class="s2">                    &lt;article&gt;3&lt;/article&gt;</span>
<span class="s2">                    &lt;div&gt;cache: 103&lt;/div&gt;</span>
<span class="s2">                &lt;/section&gt;</span>
<span class="s2">                &lt;div&gt;out of cache: 3&lt;/div&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 3&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_cache_with_t_set_wrap_t_cache">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_cache_with_t_set_wrap_t_cache">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_cache_with_t_set_wrap_t_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;template_page&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;template_page&quot;&gt;</span>
<span class="s2">                    &lt;root t-cache=&quot;cache_1&quot;&gt;</span>
<span class="s2">                        &lt;t t-set=&quot;a&quot;&gt;</span>
<span class="s2">                            &lt;section t-cache=&quot;cache_2&quot;&gt;</span>
<span class="s2">                                &lt;t t-set=&quot;counter&quot; t-value=&quot;counter + 100&quot;/&gt;</span>
<span class="s2">                                &lt;article t-nocache=&quot;&quot; class=&quot;no_cache&quot;&gt;&lt;t t-out=&quot;counter&quot;/&gt;&lt;/article&gt;</span>
<span class="s2">                                &lt;div&gt;cache: &lt;t t-out=&quot;counter&quot;/&gt;&lt;/div&gt;</span>
<span class="s2">                            &lt;/section&gt;</span>
<span class="s2">                            &lt;footer t-nocache=&quot;&quot; class=&quot;no_cache&quot;&gt;&lt;t t-out=&quot;counter * 10&quot;/&gt;&lt;/footer&gt;</span>
<span class="s2">                        &lt;/t&gt;</span>
<span class="s2">                        &lt;div&gt;</span>
<span class="s2">                            &lt;t t-out=&quot;a&quot;/&gt;</span>
<span class="s2">                        &lt;/div&gt;</span>
<span class="s2">                    &lt;/root&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_1&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;cache_2&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;div&gt;</span>
<span class="s2">                    &lt;section&gt;</span>
<span class="s2">                        &lt;article class=&quot;no_cache&quot;&gt;1&lt;/article&gt;</span>
<span class="s2">                        &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                    &lt;footer class=&quot;no_cache&quot;&gt;10&lt;/footer&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 1&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_1&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;cache_2&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;div&gt;</span>
<span class="s2">                    &lt;section&gt;</span>
<span class="s2">                        &lt;article class=&quot;no_cache&quot;&gt;2&lt;/article&gt;</span>
<span class="s2">                        &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                    &lt;footer class=&quot;no_cache&quot;&gt;20&lt;/footer&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 2&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_1&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;cache_2&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;div&gt;</span>
<span class="s2">                    &lt;section&gt;</span>
<span class="s2">                        &lt;article class=&quot;no_cache&quot;&gt;2&lt;/article&gt;</span>
<span class="s2">                        &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                    &lt;footer class=&quot;no_cache&quot;&gt;20&lt;/footer&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 3&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_1&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;cache_2&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;div&gt;</span>
<span class="s2">                    &lt;section&gt;</span>
<span class="s2">                        &lt;article class=&quot;no_cache&quot;&gt;3&lt;/article&gt;</span>
<span class="s2">                        &lt;div&gt;cache: 103&lt;/div&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                    &lt;footer class=&quot;no_cache&quot;&gt;30&lt;/footer&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 4&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_t_set_wrap_t_cache">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_t_set_wrap_t_cache">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_t_set_wrap_t_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;template_page&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;template_page&quot;&gt;</span>
<span class="s2">                    &lt;root&gt;</span>
<span class="s2">                        &lt;t t-set=&quot;a&quot;&gt;</span>
<span class="s2">                            &lt;section t-cache=&quot;cache_id&quot;&gt;</span>
<span class="s2">                                &lt;t t-set=&quot;counter&quot; t-value=&quot;counter + 100&quot;/&gt;</span>
<span class="s2">                                &lt;article t-nocache=&quot;&quot; class=&quot;no_cache&quot;&gt;&lt;t t-out=&quot;counter&quot;/&gt;&lt;/article&gt;</span>
<span class="s2">                                &lt;div&gt;cache: &lt;t t-out=&quot;counter&quot;/&gt;&lt;/div&gt;</span>
<span class="s2">                            &lt;/section&gt;</span>
<span class="s2">                            &lt;footer t-nocache=&quot;&quot; class=&quot;no_cache&quot;&gt;&lt;t t-out=&quot;counter * 10&quot;/&gt;&lt;/footer&gt;</span>
<span class="s2">                        &lt;/t&gt;</span>
<span class="s2">                        &lt;div&gt;</span>
<span class="s2">                            &lt;t t-out=&quot;a&quot;/&gt;</span>
<span class="s2">                        &lt;/div&gt;</span>
<span class="s2">                    &lt;/root&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;div&gt;</span>
<span class="s2">                    &lt;section&gt;</span>
<span class="s2">                        &lt;article class=&quot;no_cache&quot;&gt;1&lt;/article&gt;</span>
<span class="s2">                        &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                    &lt;footer class=&quot;no_cache&quot;&gt;10&lt;/footer&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 1&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;div&gt;</span>
<span class="s2">                    &lt;section&gt;</span>
<span class="s2">                        &lt;article class=&quot;no_cache&quot;&gt;2&lt;/article&gt;</span>
<span class="s2">                        &lt;div&gt;cache: 101&lt;/div&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                    &lt;footer class=&quot;no_cache&quot;&gt;20&lt;/footer&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 2&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">&#39;counter&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;div&gt;</span>
<span class="s2">                    &lt;section&gt;</span>
<span class="s2">                        &lt;article class=&quot;no_cache&quot;&gt;3&lt;/article&gt;</span>
<span class="s2">                        &lt;div&gt;cache: 103&lt;/div&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                    &lt;footer class=&quot;no_cache&quot;&gt;30&lt;/footer&gt;</span>
<span class="s2">                &lt;/div&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 3&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_nocache_in_cache_in_cache">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_nocache_in_cache_in_cache">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_nocache_in_cache_in_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">template_page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;template_page&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;template_page&quot;&gt;</span>
<span class="s2">                    &lt;root&gt;</span>
<span class="s2">                        &lt;section t-cache=&quot;key1&quot;&gt;</span>
<span class="s2">                            &lt;span t-out=&quot;val&quot;/&gt;</span>
<span class="s2">                            &lt;article t-cache=&quot;key2&quot;&gt;</span>
<span class="s2">                                &lt;span t-nocache=&quot;&quot; t-out=&quot;val&quot;/&gt;</span>
<span class="s2">                            &lt;/article&gt;</span>
<span class="s2">                        &lt;/section&gt;</span>
<span class="s2">                    &lt;/root&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>

        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
            <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
            <span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;section&gt;</span>
<span class="s2">                    &lt;span&gt;1&lt;/span&gt;</span>
<span class="s2">                    &lt;article&gt;</span>
<span class="s2">                        &lt;span&gt;1&lt;/span&gt;</span>
<span class="s2">                    &lt;/article&gt;</span>
<span class="s2">                &lt;/section&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 1&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
            <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
            <span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;section&gt;</span>
<span class="s2">                    &lt;span&gt;1&lt;/span&gt;</span>
<span class="s2">                    &lt;article&gt;</span>
<span class="s2">                        &lt;span&gt;2&lt;/span&gt;</span>
<span class="s2">                    &lt;/article&gt;</span>
<span class="s2">                &lt;/section&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 2&#39;</span><span class="p">)</span>

        <span class="n">render</span> <span class="o">=</span> <span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">template_page</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span>
            <span class="s1">&#39;key1&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="p">,),</span>
            <span class="s1">&#39;key2&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">2</span><span class="p">,),</span>
            <span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;root&gt;</span>
<span class="s2">                &lt;section&gt;</span>
<span class="s2">                    &lt;span&gt;1&lt;/span&gt;</span>
<span class="s2">                    &lt;article&gt;</span>
<span class="s2">                        &lt;span&gt;3&lt;/span&gt;</span>
<span class="s2">                    &lt;/article&gt;</span>
<span class="s2">                &lt;/section&gt;</span>
<span class="s2">            &lt;/root&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">render</span><span class="p">),</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="s1">&#39;rendering 3&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_conditional_cache">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_conditional_cache">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_conditional_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div t-cache=&quot;cache_id if condition else None&quot; class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;1&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;2&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;3&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>

        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">is_t_cache_disabled</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected_result</span><span class="p">,</span> <span class="s1">&#39;First rendering (add in cache)&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;condition&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected_result</span><span class="p">,</span> <span class="s1">&#39;Next rendering use cache&#39;</span><span class="p">)</span>


        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;10&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;20&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;30&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;cache_id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected_result</span><span class="p">,</span> <span class="s1">&#39;Next rendering use cache&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_xml_cache_and_inherit_view">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_xml_cache_and_inherit_view">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_xml_cache_and_inherit_view</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">view1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;qweb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;base.dummy&quot;&gt;</span>
<span class="s2">                    &lt;div t-cache=&quot;True&quot; class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;table&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[0]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[1]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                            &lt;tr&gt;&lt;td&gt;&lt;span t-esc=&quot;value[2]&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                        &lt;/table&gt;</span>
<span class="s2">                    &lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span>
        <span class="p">})</span>
        <span class="c1"># t-cache value can be an interable then we can add value as a tuple (without parenthesis)</span>
        <span class="n">view2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.ui.view&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">create</span><span class="p">({</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Child View&#39;</span><span class="p">,</span>
            <span class="s1">&#39;mode&#39;</span><span class="p">:</span> <span class="s1">&#39;extension&#39;</span><span class="p">,</span>
            <span class="s1">&#39;inherit_id&#39;</span><span class="p">:</span> <span class="n">view1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s1">&#39;arch&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                &lt;xpath expr=&quot;//div[@t-cache]&quot; position=&quot;attributes&quot;&gt;</span>
<span class="s1">                    &lt;attribute name=&quot;t-cache&quot; add=&quot;company,value[0]&quot; remove=&quot;True,&quot; separator=&quot;,&quot;/&gt;</span>
<span class="s1">                &lt;/xpath&gt;</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">,</span>
        <span class="p">})</span>

        <span class="n">IrQweb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">[</span><span class="s1">&#39;ir.qweb&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">with_context</span><span class="p">(</span><span class="n">use_qweb_t_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;1&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;2&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;3&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected_result</span><span class="p">,</span> <span class="s1">&#39;First rendering create cache from company and the value 1&#39;</span><span class="p">)</span>

        <span class="n">expected_result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;div class=&quot;toto&quot;&gt;</span>
<span class="s2">                &lt;table&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;10&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;20&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                    &lt;tr&gt;&lt;td&gt;&lt;span&gt;30&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;</span>
<span class="s2">                &lt;/table&gt;</span>
<span class="s2">            &lt;/div&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">IrQweb</span><span class="o">.</span><span class="n">_render</span><span class="p">(</span><span class="n">view2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]}))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">expected_result</span><span class="p">,</span> <span class="s1">&#39;Next rendering create cache from company and the value 10&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestQwebCache.test_render_nodb">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_qweb.TestQwebCache.test_render_nodb">[docs]</a>
    <span class="k">def</span> <span class="nf">test_render_nodb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Render an html page without db ans wihtout registry</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">expected</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            &lt;html&gt;</span>
<span class="s2">                &lt;head&gt;</span>
<span class="s2">                    &lt;title&gt;Odoo&lt;/title&gt;</span>
<span class="s2">                &lt;/head&gt;</span>
<span class="s2">                &lt;body&gt;</span>
<span class="s2">                    &lt;section class=&quot;toto&quot;&gt;</span>
<span class="s2">                        &lt;div&gt;3&lt;/div&gt;</span>
<span class="s2">                    &lt;/section&gt;</span>
<span class="s2">                &lt;/body&gt;</span>
<span class="s2">            &lt;/html&gt;</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="n">templates</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;html&#39;</span><span class="p">:</span> <span class="n">html</span><span class="o">.</span><span class="n">document_fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;html t-name=&quot;html&quot;&gt;</span>
<span class="s2">                    &lt;head&gt;</span>
<span class="s2">                        &lt;title&gt;Odoo&lt;/title&gt;</span>
<span class="s2">                    &lt;/head&gt;</span>
<span class="s2">                    &lt;body&gt;</span>
<span class="s2">                        &lt;section class=&quot;toto&quot;&gt;</span>
<span class="s2">                            &lt;t t-call=&quot;content&quot;/&gt;</span>
<span class="s2">                        &lt;/section&gt;</span>
<span class="s2">                    &lt;/body&gt;</span>
<span class="s2">                &lt;/html&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">),</span>
            <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">html</span><span class="o">.</span><span class="n">fragment_fromstring</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">                &lt;t t-name=&quot;content&quot;&gt;</span>
<span class="s2">                        &lt;div&gt;&lt;t t-out=&quot;val&quot;/&gt;&lt;/div&gt;</span>
<span class="s2">                &lt;/t&gt;</span>
<span class="s2">            &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">template_name</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">templates</span><span class="p">[</span><span class="n">template_name</span><span class="p">],</span> <span class="n">template_name</span><span class="p">)</span>
        <span class="n">rendering</span> <span class="o">=</span> <span class="n">render</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;val&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span> <span class="n">load</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">html</span><span class="o">.</span><span class="n">document_fromstring</span><span class="p">(</span><span class="n">rendering</span><span class="p">),</span> <span class="n">html</span><span class="o">.</span><span class="n">document_fromstring</span><span class="p">(</span><span class="n">expected</span><span class="p">))</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Amr.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>