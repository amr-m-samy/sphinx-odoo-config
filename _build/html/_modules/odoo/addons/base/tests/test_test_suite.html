<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>odoo.addons.base.tests.test_test_suite &mdash; Amr  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../../index.html" class="icon icon-home">
            Amr
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../modules.html">odoo</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../../index.html">Amr</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../../../odoo.html">odoo</a></li>
          <li class="breadcrumb-item"><a href="../../base.html">odoo.addons.base</a></li>
      <li class="breadcrumb-item active">odoo.addons.base.tests.test_test_suite</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for odoo.addons.base.tests.test_test_suite</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1"># Part of Odoo. See LICENSE file for full copyright and licensing details.</span>

<span class="kn">import</span> <span class="nn">contextlib</span>
<span class="kn">import</span> <span class="nn">difflib</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">PurePath</span>
<span class="kn">from</span> <span class="nn">unittest</span> <span class="kn">import</span> <span class="n">SkipTest</span><span class="p">,</span> <span class="n">skip</span>
<span class="kn">from</span> <span class="nn">unittest.mock</span> <span class="kn">import</span> <span class="n">patch</span>

<span class="kn">from</span> <span class="nn">odoo.tests.case</span> <span class="kn">import</span> <span class="n">TestCase</span>
<span class="kn">from</span> <span class="nn">odoo.tests.common</span> <span class="kn">import</span> <span class="n">BaseCase</span><span class="p">,</span> <span class="n">TransactionCase</span><span class="p">,</span> <span class="n">users</span><span class="p">,</span> <span class="n">warmup</span>
<span class="kn">from</span> <span class="nn">odoo.tests.result</span> <span class="kn">import</span> <span class="n">OdooTestResult</span>

<span class="n">_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">odoo.tests</span> <span class="kn">import</span> <span class="n">MetaCase</span>


<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
    <span class="c1"># this is mainly to ensure that simple tests will continue to work even if BaseCase should be used</span>
    <span class="c1"># this only works if doClassCleanup is available on testCase because of the vendoring of suite.py.</span>
    <span class="c1"># this test will only work in python 3.8 +</span>
<div class="viewcode-block" id="TestTestSuite">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestTestSuite">[docs]</a>
    <span class="k">class</span> <span class="nc">TestTestSuite</span><span class="p">(</span><span class="n">TestCase</span><span class="p">,</span> <span class="n">metaclass</span><span class="o">=</span><span class="n">MetaCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestTestSuite.test_test_suite">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestTestSuite.test_test_suite">[docs]</a>
        <span class="k">def</span> <span class="nf">test_test_suite</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot; Check that OdooSuite handles unittest.TestCase correctly. &quot;&quot;&quot;</span></div>
</div>



<div class="viewcode-block" id="TestRunnerLoggingCommon">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLoggingCommon">[docs]</a>
<span class="k">class</span> <span class="nc">TestRunnerLoggingCommon</span><span class="p">(</span><span class="n">TransactionCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The purpose of this class is to do some &quot;metatesting&quot;: it actually checks</span>
<span class="sd">    that on error, the runner logged the error with the right file reference.</span>
<span class="sd">    This is mainly to avoid having errors in test/common.py or test/runner.py`.</span>
<span class="sd">    This kind of metatesting is tricky; in this case the logs are made outside</span>
<span class="sd">    of the test method, after the teardown actually.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TestRunnerLoggingCommon.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLoggingCommon.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_first_frame_methods</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">_addError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">):</span>
        <span class="c1"># We use this hook to catch the logged error. It is initially called</span>
        <span class="c1"># post tearDown, and logs the actual errors. Because of our hack</span>
        <span class="c1"># tests.common._ErrorCatcher, the errors are logged directly. This is</span>
        <span class="c1"># still useful to test errors raised from tests. We cannot assert what</span>
        <span class="c1"># was logged after the test inside the test, though. This method can be</span>
        <span class="c1"># temporary renamed to test the real failure.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">test_result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="c1"># while we are here, let&#39;s check that the first frame of the stack</span>
            <span class="c1"># is always inside the test method</span>

            <span class="k">if</span> <span class="n">exc_info</span><span class="p">:</span>
                <span class="n">tb</span> <span class="o">=</span> <span class="n">exc_info</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_check_first_frame</span><span class="p">(</span><span class="n">tb</span><span class="p">)</span>

            <span class="c1"># intercept all ir_logging. We cannot use log catchers or other</span>
            <span class="c1"># fancy stuff because makeRecord is too low level.</span>
            <span class="n">log_records</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">def</span> <span class="nf">makeRecord</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">lno</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sinfo</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
                <span class="n">log_records</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;logger&#39;</span><span class="p">:</span> <span class="n">logger</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">:</span> <span class="n">level</span><span class="p">,</span> <span class="s1">&#39;fn&#39;</span><span class="p">:</span> <span class="n">fn</span><span class="p">,</span> <span class="s1">&#39;lno&#39;</span><span class="p">:</span> <span class="n">lno</span><span class="p">,</span>
                    <span class="s1">&#39;msg&#39;</span><span class="p">:</span> <span class="n">msg</span> <span class="o">%</span> <span class="n">args</span><span class="p">,</span> <span class="s1">&#39;exc_info&#39;</span><span class="p">:</span> <span class="n">exc_info</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">:</span> <span class="n">func</span><span class="p">,</span> <span class="s1">&#39;extra&#39;</span><span class="p">:</span> <span class="n">extra</span><span class="p">,</span> <span class="s1">&#39;sinfo&#39;</span><span class="p">:</span> <span class="n">sinfo</span><span class="p">,</span>
                <span class="p">})</span>

            <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
                <span class="c1"># disable error logging</span>
                <span class="k">return</span>

            <span class="n">fake_result</span> <span class="o">=</span> <span class="n">OdooTestResult</span><span class="p">()</span>
            <span class="k">with</span> <span class="n">patch</span><span class="p">(</span><span class="s1">&#39;logging.Logger.makeRecord&#39;</span><span class="p">,</span> <span class="n">makeRecord</span><span class="p">),</span> <span class="n">patch</span><span class="p">(</span><span class="s1">&#39;logging.Logger.handle&#39;</span><span class="p">,</span> <span class="n">handle</span><span class="p">):</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_addError</span><span class="p">(</span><span class="n">fake_result</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">exc_info</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_check_log_records</span><span class="p">(</span><span class="n">log_records</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># we don&#39;t expect _feedErrorsToResult() to raise any exception, this</span>
            <span class="c1"># will make it more robust to future changes and eventual mistakes</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_first_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check that the first frame of the given traceback is the expected method name. &quot;&quot;&quot;</span>
        <span class="c1"># the list expected_first_frame_methods allow to define a list of first</span>
        <span class="c1"># expected frame (useful for setup/teardown tests)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_first_frame_methods</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expected_first_frame_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testMethodName</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">expected_first_frame_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_first_frame_methods</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">first_frame_method</span> <span class="o">=</span> <span class="n">tb</span><span class="o">.</span><span class="n">tb_frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
        <span class="k">if</span> <span class="n">first_frame_method</span> <span class="o">!=</span> <span class="n">expected_first_frame_method</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking first tb frame: </span><span class="si">{</span><span class="n">first_frame_method</span><span class="si">}</span><span class="s2"> is not equal to </span><span class="si">{</span><span class="n">expected_first_frame_method</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_log_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_records</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check that what was logged is what was expected. &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">log_record</span> <span class="ow">in</span> <span class="n">log_records</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assert_log_equal</span><span class="p">(</span><span class="n">log_record</span><span class="p">,</span> <span class="s1">&#39;logger&#39;</span><span class="p">,</span> <span class="n">_logger</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assert_log_equal</span><span class="p">(</span><span class="n">log_record</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;odoo.addons.base.tests.test_test_suite&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assert_log_equal</span><span class="p">(</span><span class="n">log_record</span><span class="p">,</span> <span class="s1">&#39;fn&#39;</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_assert_log_equal</span><span class="p">(</span><span class="n">log_record</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_testMethodName</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">log_record</span> <span class="ow">in</span> <span class="n">log_records</span><span class="p">:</span>
                <span class="n">level</span><span class="p">,</span> <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assert_log_equal</span><span class="p">(</span><span class="n">log_record</span><span class="p">,</span> <span class="s1">&#39;level&#39;</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_assert_log_equal</span><span class="p">(</span><span class="n">log_record</span><span class="p">,</span> <span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assert_log_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">log_record</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">expected</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Check the content of a log record. &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">log_record</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;msg&#39;</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clean_message</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">expected</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;msg&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` =&gt; `</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">` is not equal to `</span><span class="si">{</span><span class="n">expected</span><span class="si">}</span><span class="s2">` </span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">log_record</span><span class="p">[</span><span class="s1">&#39;msg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">expected</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Key `</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">` did not matched expected:</span><span class="se">\n</span><span class="si">{</span><span class="n">diff</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Log an actual error (about a log in a test that doesn&#39;t match expectations) &quot;&quot;&quot;</span>
        <span class="c1"># we would just log, but using the test_result will help keeping the tests counters correct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_result</span><span class="o">.</span><span class="n">addError</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="p">(</span><span class="ne">AssertionError</span><span class="p">,</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="n">message</span><span class="p">),</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_clean_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">root_path</span> <span class="o">=</span> <span class="n">PurePath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parents</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># removes /odoo/addons/base/tests/test_test_suite.py</span>
        <span class="n">python_path</span> <span class="o">=</span> <span class="n">PurePath</span><span class="p">(</span><span class="n">contextlib</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span>  <span class="c1"># /usr/lib/pythonx.x, C:\\python\\Lib, ...</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;line \d+&#39;</span><span class="p">,</span> <span class="s1">&#39;line $line&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;py:\d+&#39;</span><span class="p">,</span> <span class="s1">&#39;py:$line&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;decorator-gen-\d+&#39;</span><span class="p">,</span> <span class="s1">&#39;decorator-gen-xxx&#39;</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">root_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;/root_path/odoo&#39;</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">python_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&quot;/usr/lib/python&#39;</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">message</span></div>



<div class="viewcode-block" id="TestRunnerLogging">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging">[docs]</a>
<span class="k">class</span> <span class="nc">TestRunnerLogging</span><span class="p">(</span><span class="n">TestRunnerLoggingCommon</span><span class="p">):</span>

<div class="viewcode-block" id="TestRunnerLogging.test_has_add_error">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_has_add_error">[docs]</a>
    <span class="k">def</span> <span class="nf">test_has_add_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_addError&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_raise">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_raise">[docs]</a>
    <span class="k">def</span> <span class="nf">test_raise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_raise_subtest">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_raise_subtest">[docs]</a>
    <span class="k">def</span> <span class="nf">test_raise_subtest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        with subtest, we expect to have multiple errors, one per subtest</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">make_message</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span>
<span class="sa">f</span><span class="s1">&#39;&#39;&#39;ERROR: Subtest TestRunnerLogging.test_raise_subtest (&lt;subtest&gt;)</span>
<span class="s1">Traceback (most recent call last):</span>
<span class="s1">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in test_raise_subtest</span>
<span class="s1">    raise Exception(&#39;</span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s1">&#39;)</span>
<span class="s1">Exception: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">),</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">make_message</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)),</span>
        <span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span><span class="p">,</span> <span class="s2">&quot;Error should have been logged immediatly&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">),</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">make_message</span><span class="p">(</span><span class="s1">&#39;This is an error2&#39;</span><span class="p">)),</span>
        <span class="p">]</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error2&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">assertFalse</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span><span class="p">,</span> <span class="s2">&quot;Error should have been logged immediatly&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_with_decorators">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_with_decorators">[docs]</a>
    <span class="nd">@users</span><span class="p">(</span><span class="s1">&#39;__system__&#39;</span><span class="p">)</span>
    <span class="nd">@warmup</span>
    <span class="k">def</span> <span class="nf">test_with_decorators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># note, this test may be broken with a decorator in decorator=5.0.5 since the behaviour changed</span>
        <span class="c1"># but decoratorx was not introduced yet.</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
<span class="sd">&#39;&#39;&#39;ERROR: Subtest TestRunnerLogging.test_with_decorators (login=&#39;__system__&#39;)</span>
<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;&lt;decorator-gen-xxx&gt;&quot;, line $line, in test_with_decorators</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/tests/common.py&quot;, line $line, in _users</span>
<span class="sd">    func(*args, **kwargs)</span>
<span class="sd">  File &quot;&lt;decorator-gen-xxx&gt;&quot;, line $line, in test_with_decorators</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/tests/common.py&quot;, line $line, in warmup</span>
<span class="sd">    func(*args, **kwargs)</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in test_with_decorators</span>
<span class="sd">    raise Exception(&#39;This is an error&#39;)</span>
<span class="sd">Exception: This is an error</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">),</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_traverse_contextmanager">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_traverse_contextmanager">[docs]</a>
    <span class="k">def</span> <span class="nf">test_traverse_contextmanager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@contextmanager</span>
        <span class="k">def</span> <span class="nf">assertSomething</span><span class="p">():</span>
            <span class="k">yield</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">assertSomething</span><span class="p">():</span>
            <span class="k">pass</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_subtest_sub_call">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_subtest_sub_call">[docs]</a>
    <span class="k">def</span> <span class="nf">test_subtest_sub_call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span>

        <span class="n">func</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_call_stack">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_call_stack">[docs]</a>
    <span class="k">def</span> <span class="nf">test_call_stack</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
<span class="sd">&#39;&#39;&#39;ERROR: TestRunnerLogging.test_call_stack</span>
<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in test_call_stack</span>
<span class="sd">    alpha()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in alpha</span>
<span class="sd">    beta()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in beta</span>
<span class="sd">    gamma()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in gamma</span>
<span class="sd">    raise Exception(&#39;This is an error&#39;)</span>
<span class="sd">Exception: This is an error</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">),</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">alpha</span><span class="p">():</span>
            <span class="n">beta</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">beta</span><span class="p">():</span>
            <span class="n">gamma</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">gamma</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span>

        <span class="n">alpha</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_call_stack_context_manager">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_call_stack_context_manager">[docs]</a>
    <span class="k">def</span> <span class="nf">test_call_stack_context_manager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
<span class="sd">&#39;&#39;&#39;ERROR: TestRunnerLogging.test_call_stack_context_manager</span>
<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in test_call_stack_context_manager</span>
<span class="sd">    alpha()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in alpha</span>
<span class="sd">    beta()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in beta</span>
<span class="sd">    gamma()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in gamma</span>
<span class="sd">    raise Exception(&#39;This is an error&#39;)</span>
<span class="sd">Exception: This is an error</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">),</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">alpha</span><span class="p">():</span>
            <span class="n">beta</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">beta</span><span class="p">():</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">with_user</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">):</span>
                <span class="n">gamma</span><span class="p">()</span>
                <span class="k">return</span> <span class="mi">0</span>

        <span class="k">def</span> <span class="nf">gamma</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span>

        <span class="n">alpha</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_call_stack_subtest">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_call_stack_subtest">[docs]</a>
    <span class="k">def</span> <span class="nf">test_call_stack_subtest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
<span class="sd">&#39;&#39;&#39;ERROR: Subtest TestRunnerLogging.test_call_stack_subtest (&lt;subtest&gt;)</span>
<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in test_call_stack_subtest</span>
<span class="sd">    alpha()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in alpha</span>
<span class="sd">    beta()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in beta</span>
<span class="sd">    gamma()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in gamma</span>
<span class="sd">    raise Exception(&#39;This is an error&#39;)</span>
<span class="sd">Exception: This is an error</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">),</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">alpha</span><span class="p">():</span>
            <span class="n">beta</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">beta</span><span class="p">():</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">():</span>
                <span class="n">gamma</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">gamma</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span>

        <span class="n">alpha</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_assertQueryCount">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_assertQueryCount">[docs]</a>
    <span class="k">def</span> <span class="nf">test_assertQueryCount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
<span class="sd">&#39;&#39;&#39;FAIL: Subtest TestRunnerLogging.test_assertQueryCount (&lt;subtest&gt;)</span>
<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in test_assertQueryCount</span>
<span class="sd">    with self.assertQueryCount(system=0):</span>
<span class="sd">  File &quot;/usr/lib/python/contextlib.py&quot;, line $line, in __exit__</span>
<span class="sd">    next(self.gen)</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/tests/common.py&quot;, line $line, in assertQueryCount</span>
<span class="sd">    self.fail(msg % (login, count, expected, funcname, filename, linenum))</span>
<span class="sd">AssertionError: Query count more than expected for user __system__: 1 &gt; 0 in test_assertQueryCount at base/tests/test_test_suite.py:$line</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_python_version</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;with self.assertQueryCount(system=0):&quot;</span><span class="p">,</span> <span class="s2">&quot;self.env.cr.execute(&#39;SELECT 1&#39;)&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">),</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">),</span>
        <span class="p">]</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueryCount</span><span class="p">(</span><span class="n">system</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT 1&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_assertQueryCount_with_decorators">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_assertQueryCount_with_decorators">[docs]</a>
    <span class="nd">@users</span><span class="p">(</span><span class="s1">&#39;__system__&#39;</span><span class="p">)</span>
    <span class="nd">@warmup</span>
    <span class="k">def</span> <span class="nf">test_assertQueryCount_with_decorators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertQueryCount</span><span class="p">(</span><span class="n">system</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">cr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT 1&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_reraise">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_reraise">[docs]</a>
    <span class="k">def</span> <span class="nf">test_reraise</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
<span class="sd">&#39;&#39;&#39;ERROR: TestRunnerLogging.test_reraise</span>
<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in test_reraise</span>
<span class="sd">    alpha()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in alpha</span>
<span class="sd">    beta()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in beta</span>
<span class="sd">    raise Exception(&#39;This is an error&#39;)</span>
<span class="sd">Exception: This is an error</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">),</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">alpha</span><span class="p">():</span>
            <span class="c1"># pylint: disable=try-except-raise</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">beta</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span>

        <span class="k">def</span> <span class="nf">beta</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span>

        <span class="n">alpha</span><span class="p">()</span></div>


<div class="viewcode-block" id="TestRunnerLogging.test_handle_error">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLogging.test_handle_error">[docs]</a>
    <span class="k">def</span> <span class="nf">test_handle_error</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span>
<span class="sd">&#39;&#39;&#39;ERROR: TestRunnerLogging.test_handle_error</span>
<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in alpha</span>
<span class="sd">    beta()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in beta</span>
<span class="sd">    raise Exception(&#39;This is an error&#39;)</span>
<span class="sd">Exception: This is an error</span>

<span class="sd">During handling of the above exception, another exception occurred:</span>

<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in test_handle_error</span>
<span class="sd">    alpha()</span>
<span class="sd">  File &quot;/root_path/odoo/odoo/addons/base/tests/test_test_suite.py&quot;, line $line, in alpha</span>
<span class="sd">    raise Exception(&#39;This is an error2&#39;)</span>
<span class="sd">Exception: This is an error2</span>
<span class="sd">&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_logs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span> <span class="o">*</span> <span class="mi">70</span><span class="p">),</span>
            <span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span><span class="p">,</span> <span class="n">message</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">alpha</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">beta</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error2&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">beta</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is an error&#39;</span><span class="p">)</span>

        <span class="n">alpha</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="TestRunnerLoggingSetup">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLoggingSetup">[docs]</a>
<span class="k">class</span> <span class="nc">TestRunnerLoggingSetup</span><span class="p">(</span><span class="n">TestRunnerLoggingCommon</span><span class="p">):</span>

<div class="viewcode-block" id="TestRunnerLoggingSetup.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLoggingSetup.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_first_frame_methods</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;setUp&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cleanupError2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cleanupError&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">cleanupError</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This is a cleanup error&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">cleanupError</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">cleanupError2</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This is a second cleanup error&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">cleanupError2</span><span class="p">)</span>

        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is a setup error&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestRunnerLoggingSetup.test_raises_setup">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLoggingSetup.test_raises_setup">[docs]</a>
    <span class="k">def</span> <span class="nf">test_raises_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;This shouldn&#39;t be executed&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestRunnerLoggingSetup.tearDown">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLoggingSetup.tearDown">[docs]</a>
    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;This shouldn&#39;t be executed since setup failed&quot;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestRunnerLoggingTeardown">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLoggingTeardown">[docs]</a>
<span class="k">class</span> <span class="nc">TestRunnerLoggingTeardown</span><span class="p">(</span><span class="n">TestRunnerLoggingCommon</span><span class="p">):</span>
<div class="viewcode-block" id="TestRunnerLoggingTeardown.setUp">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLoggingTeardown.setUp">[docs]</a>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">setUp</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_first_frame_methods</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;test_raises_teardown&#39;</span><span class="p">,</span>
            <span class="s1">&#39;test_raises_teardown&#39;</span><span class="p">,</span>
            <span class="s1">&#39;test_raises_teardown&#39;</span><span class="p">,</span>
            <span class="s1">&#39;tearDown&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cleanupError2&#39;</span><span class="p">,</span>
            <span class="s1">&#39;cleanupError&#39;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">def</span> <span class="nf">cleanupError</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This is a cleanup error&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">cleanupError</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">cleanupError2</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;This is a second cleanup error&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addCleanup</span><span class="p">(</span><span class="n">cleanupError2</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestRunnerLoggingTeardown.tearDown">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLoggingTeardown.tearDown">[docs]</a>
    <span class="k">def</span> <span class="nf">tearDown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is a tearDown error&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestRunnerLoggingTeardown.test_raises_teardown">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestRunnerLoggingTeardown.test_raises_teardown">[docs]</a>
    <span class="k">def</span> <span class="nf">test_raises_teardown</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is a subTest error&#39;</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is a second subTest error&#39;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This is a test error&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestSubtests">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestSubtests">[docs]</a>
<span class="k">class</span> <span class="nc">TestSubtests</span><span class="p">(</span><span class="n">BaseCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestSubtests.test_nested_subtests">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestSubtests.test_nested_subtests">[docs]</a>
    <span class="k">def</span> <span class="nf">test_nested_subtests</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subtest</span><span class="o">.</span><span class="n">_subDescription</span><span class="p">(),</span> <span class="s1">&#39;(b=3, x=4, a=1)&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">subTest</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">6</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_subtest</span><span class="o">.</span><span class="n">_subDescription</span><span class="p">(),</span> <span class="s1">&#39;(b=5, x=6, a=1)&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TestClassSetup">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestClassSetup">[docs]</a>
<span class="k">class</span> <span class="nc">TestClassSetup</span><span class="p">(</span><span class="n">BaseCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestClassSetup.setUpClass">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestClassSetup.setUpClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SkipTest</span><span class="p">(</span><span class="s1">&#39;Skip this class&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestClassSetup.test_method">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestClassSetup.test_method">[docs]</a>
    <span class="k">def</span> <span class="nf">test_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="TestClassTeardown">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestClassTeardown">[docs]</a>
<span class="k">class</span> <span class="nc">TestClassTeardown</span><span class="p">(</span><span class="n">BaseCase</span><span class="p">):</span>

<div class="viewcode-block" id="TestClassTeardown.tearDownClass">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestClassTeardown.tearDownClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">tearDownClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">SkipTest</span><span class="p">(</span><span class="s1">&#39;Skip this class&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="TestClassTeardown.test_method">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestClassTeardown.test_method">[docs]</a>
    <span class="k">def</span> <span class="nf">test_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="Test01ClassCleanups">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.Test01ClassCleanups">[docs]</a>
<span class="k">class</span> <span class="nc">Test01ClassCleanups</span><span class="p">(</span><span class="n">BaseCase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The purpose of this test combined with Test02ClassCleanupsCheck is to check that</span>
<span class="sd">    class cleanup work. class cleanup where introduced in python3.8 but tests should</span>
<span class="sd">    remain compatible with python 3.7</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">executed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">cleanup</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Test01ClassCleanups.setUpClass">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.Test01ClassCleanups.setUpClass">[docs]</a>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setUpClass</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">executed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span> <span class="nf">doCleanup</span><span class="p">():</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">cleanup</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">addClassCleanup</span><span class="p">(</span><span class="n">doCleanup</span><span class="p">)</span></div>


<div class="viewcode-block" id="Test01ClassCleanups.test_dummy">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.Test01ClassCleanups.test_dummy">[docs]</a>
    <span class="k">def</span> <span class="nf">test_dummy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span></div>
</div>



<div class="viewcode-block" id="Test02ClassCleanupsCheck">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.Test02ClassCleanupsCheck">[docs]</a>
<span class="k">class</span> <span class="nc">Test02ClassCleanupsCheck</span><span class="p">(</span><span class="n">BaseCase</span><span class="p">):</span>
<div class="viewcode-block" id="Test02ClassCleanupsCheck.test_classcleanups">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.Test02ClassCleanupsCheck.test_classcleanups">[docs]</a>
    <span class="k">def</span> <span class="nf">test_classcleanups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">Test01ClassCleanups</span><span class="o">.</span><span class="n">executed</span><span class="p">,</span> <span class="s2">&quot;This test only makes sence when executed after Test01ClassCleanups&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertTrue</span><span class="p">(</span><span class="n">Test01ClassCleanups</span><span class="o">.</span><span class="n">cleanup</span><span class="p">,</span> <span class="s2">&quot;TestClassCleanup shoudl have been cleanuped&quot;</span><span class="p">)</span></div>
</div>



<span class="nd">@skip</span>
<span class="k">class</span> <span class="nc">TestSkipClass</span><span class="p">(</span><span class="n">BaseCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_classcleanups</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This should be skipped&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="TestSkipMethof">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestSkipMethof">[docs]</a>
<span class="k">class</span> <span class="nc">TestSkipMethof</span><span class="p">(</span><span class="n">BaseCase</span><span class="p">):</span>
<div class="viewcode-block" id="TestSkipMethof.test_skip_method">
<a class="viewcode-back" href="../../../../../odoo.addons.base.tests.html#odoo.addons.base.tests.test_test_suite.TestSkipMethof.test_skip_method">[docs]</a>
    <span class="nd">@skip</span>
    <span class="k">def</span> <span class="nf">test_skip_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This should be skipped&#39;</span><span class="p">)</span></div>
</div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Amr.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>